function formData(t){var o=[];return t.find("input,textarea,select").each(function(){this.type&&0<=["radio","checkbox"].indexOf(this.type)&&!this.checked||o.push(encodeURIComponent(this.name)+"="+encodeURIComponent($(this).val().toString()))}),o.join("&")}function bindBlogPage(){$(".book-nav").on("click",function(){$(this).toggleClass("hover")}),$(".book-search").focus(function(){$(this).addClass("focus")}).blur(function(){$(this).removeClass("focus")}),$(".book-search .fa-search").on("click",function(){var t=$(".book-search");t.hasClass("focus")?$(".book-search form").submit():t.addClass("focus")}),$(".book-navicon").on("click",function(){$(".book-skin").toggleClass("book-collapsed")}),$(".book-search [name=keywords]").keypress(function(){var t=$(this).val();t&&$.getJSON(BASE_URI+"home/suggestion?keywords="+t,function(t){var n;200==t.code&&(n="",$.each(t.data,function(t,o){n+='<li><a href="'+o.url+'">'+o.title+"</li>"}),$(".book-search .search-tip").html(n))})})}function bindBlog(t,o,n){void 0===n&&(n={}),bindLoadImg();var e=$(".book-dynamic"),i=($.get(BASE_URI+"log",{blog:t},function(t){e.html(t)}),$.getJSON(BASE_URI+"counter",{blog:t},function(t){200==t.code&&($(".book-body .tools .comment b").text(t.data.comment_count),$(".book-body .tools .click b").text(t.data.click_count),$(".book-body .tools .recommend-blog b").text(t.data.recommend_count))}),$(".book-footer")),c=(0<i.length&&$.get(BASE_URI+"comment",{blog_id:t},function(t){i.html(t)}),$(".book-body .toggle-open").on("click",function(){$(this).closest(".book-body").toggleClass("open"),s()}).on("click","a",function(t){t.stopPropagation()}),$(".rule-box button").on("click",function(){var t=$(this);$.post(t.data("url"),formData(t.closest(".rule-box")),function(t){200!=t.code?alert(t.message):(alert(t.message),setTimeout(function(){t.data.refresh?window.location.reload():t.data.url&&(window.location.href=t.data.url)},500))},"json")}),$(".recommend-blog").on("click",function(){var o=$(this).find("b");$.getJSON(BASE_URI+"recommend",{id:t},function(t){200==t.code?o.text(t.data):parseAjax(t)})}),$(".book-skin")),a=($(".book-navicon").on("click",function(){c.toggleClass("book-collapsed")}),$("#content").sideNav({target:".book-side-nav",contentLength:20,maxLength:8,title:n.side_title,maxFixedTop:function(t,o){var n=i.length<1?c.offset().top+c.height():i.offset().top,n=o+$(window).height()-t.height()<n;return n?((o=e.offset().top+e.height()-o)<=0?o=0:o+=20,t.css("top",o+"px")):t.css("top","auto"),n}})),s=function(){a.headers.length<1||a.box.toggle(d.hasClass("open")&&767<$(window).width())},d=$(".book-body");s(),$(window).resize(function(){s()}),bindCopy()}function bindLoadImg(){$("img.lazy").lazyload({callback:"img"});var t,n=$("#content img");n.length<1||(t=Dialog.create({type:"image",onrequest:function(t){var t=n.eq(t),o=t.data("src");return o||t.attr("src")}}),n.on("click",function(){t.showIndex(n.index(this))}))}function bindCopy(){function t(){setTimeout(function(){e.text("复制")},2e3)}var n,o=document.createElement("div"),e=(o.classList.add("copy-btn"),o.innerText="复制",document.body.append(o),$(o)),o=($("#content code").on("click mouseenter",function(){var t,o=$(this);"block"===o.css("display")&&(t=o.offset(),e.css({right:$(window).width()-t.left-o.width(),top:t.top,display:"block"}),n=o)}),new ClipboardJS(o,{text:function(){return n?n.text():""}}));o.on("success",function(){e.text("复制成功"),t()}),o.on("error",function(){e.text("复制失败"),t()})}function bindBlogComment(t,n){void 0===n&&(n={});function o(o,n){void 0===n&&(n=e),$.get(BASE_URI+"comment/more",{blog_id:t,page:o,order:i?"desc":"asc"},function(t){o<2?n.html(t):n.append(t)})}var e=$("#comment-box"),i=!0,c=($(".comment-item .expand").on("click",function(){$(this).parent().parent().toggleClass("active")}),$(".book-comments").on("click","*[data-type=reply]",function(){var t=$(this),o=$(".book-comment-form");t.parent().append(o),o.find(".title").text(n.reply_title),o.find(".btn-submit").text(n.reply_btn),o.find("input[name=parent_id]").val(t.parents(".comment-item").attr("data-id"))}).on("click",".order span",function(){var t=$(this);t.hasClass("active")||(t.addClass("active").siblings().removeClass("active"),i=t.index()<1,o(1))}).on("click",".actions .agree",function(){var o=$(this),t=o.closest(".comment-item").data("id");$.getJSON(BASE_URI+"comment/agree",{id:t},function(t){302==t.code?window.location.href=t.url:200!=t.code?alert(t.message):o.find("b").text(t.data)})}).on("click",".actions .disagree",function(){var o=$(this),t=o.closest(".comment-item").data("id");$.getJSON(BASE_URI+"comment/disagree",{id:t},function(t){302==t.code?window.location.href=t.url:200!=t.code?alert(t.message):o.find("b").text(t.data)})}));$(".book-comment-form .btn-cancel").on("click",function(){var t=$(this).closest(".book-comment-form"),o=$(".hot-comments");0<o.length?o.after(t):c.before(t),t.find("textarea").val(""),t.find(".title").text(n.comment_title),t.find(".btn-submit").text(n.comment_btn),t.find("input[name=parent_id]").val(0)}),$("#comment-form").submit(function(){var o=$(this);return $.post(o.attr("action"),o.serialize(),function(t){200==t.code?o.find(".btn-cancel").trigger("click"):alert(t.message)},"json"),!1}),e.on("click",".load-more",function(){var t=$(this);o(t.data("page")),t.remove()}),o(1)}$(function(){});