var OTHER_CODE=[8220,8221,8216,8217,65281,12290,65292,12304,12305,12289,65311,65288,65289,12288,12298,12299,65306];function getStrLength(t){if(!t)return 0;for(var i,e=0,n=0;i=t.charCodeAt(e);)e++,i<48||57<i&&i<65||90<i&&i<97||122<i&&i<128||128<i&&0<=OTHER_CODE.indexOf(i)||n++;return n}function bindChapter(){var i=$(".length-box"),e=$("#content-box"),t=function(){var t=getStrLength(e.val());i.find("span").text(t),i.find("input").val(t)};e.on("input propertychange",function(){t()}).on("keydown",function(t){if(9===t.keyCode){t.preventDefault();var i=this.selectionStart+4;this.value=this.value.substr(0,this.selectionStart)+"    "+this.value.substr(this.selectionStart),this.selectionStart=i,this.selectionEnd=i,this.focus()}}),t()}function bindImport(a){var o=$(".book-box"),s=[];$(".search form").submit(function(){return postJson(a+"spider/search",$(this).serialize(),function(t){if(200==t.code){s=t.data;for(var i="",e=0;e<s.length;e++){var n=s[e];i+='<div class="book-item" data-index="'+e+'"><div class="info"><p>'+n.name+"("+n.author+")</p><p>总字数： "+n.size+"</p> <p>最新章节： "+n.last_chapter+'</p></div><div class="actions"><a href="javascript:;">同步</a></div></div>'}o.html(i)}else parseAjax(t)}),!1}),o.on("click",".book-item .actions a",function(t){t.preventDefault();var i=$(this).closest(".book-item").data("index"),e=s[i];if(e){var n=Dialog.loading();postJson(a+"spider/async",e,function(t){n.close(),parseAjax(t)})}else Dialog.tip("书籍不存在")})}