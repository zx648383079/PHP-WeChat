var OTHER_CODE=[8220,8221,8216,8217,65281,12290,65292,12304,12305,12289,65311,65288,65289,12288,12298,12299,65306];function getStrLength(t){if(!t)return 0;for(var e,a=0,n=0;e=t.charCodeAt(a);)a++,e<48||57<e&&e<65||90<e&&e<97||122<e&&e<128||128<e&&0<=OTHER_CODE.indexOf(e)||n++;return n}function bindChapter(){var e=$(".length-box"),a=$("#content-box"),t=function(){var t=getStrLength(a.val());e.find("span").text(t),e.find("input").val(t)};a.on("input propertychange",function(){t()}).on("keydown",function(t){if(9===t.keyCode){t.preventDefault();var e=this.selectionStart+4;this.value=this.value.substr(0,this.selectionStart)+"    "+this.value.substr(this.selectionStart),this.selectionStart=e,this.selectionEnd=e,this.focus()}}),t()}function bindImport(n){var i=$(".book-box"),o=[],e=$(".dialog-progress"),s=function(t){if(200==t.code&&"object"==typeof t.data&&t.data.key)return e.show().find("progress").val(100*t.data.next/t.data.count).next("span").text(t.data.next+"/"+t.data.count),void postJson(n+"spider/async",t.data,s);e.hide(),parseAjax(t)};$(".search form").submit(function(){return postJson(n+"spider/search",$(this).serialize(),function(t){if(200==t.code){o=t.data;for(var e="",a=0;a<o.length;a++){var n=o[a];e+='<div class="book-item" data-index="'+a+'"><div class="info"><p>'+n.name+"("+n.author+")</p><p>总字数： "+n.size+"</p> <p>最新章节： "+n.last_chapter+'</p></div><div class="actions"><a href="javascript:;">同步</a></div></div>'}i.html(e)}else parseAjax(t)}),!1}),i.on("click",".book-item .actions a",function(t){t.preventDefault();var e=$(this).closest(".book-item").data("index"),a=o[e];a?postJson(n+"spider/async",a,s):Dialog.tip("书籍不存在")})}