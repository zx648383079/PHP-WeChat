function insertHtmlAtCaret(o){var a,i,e=$(".dialog-chat-room .dialog-message-text");if(e.is(":focus")||(e.focus(),(i=document.createRange()).setStartAfter(e[0]),i.setEnd(e[0],e[0].childNodes.length)),window.getSelection&&(a=window.getSelection()).getRangeAt&&a.rangeCount){i||(i=a.getRangeAt(0)).deleteContents();var t=document.createElement("div");t.innerHTML=o;for(var n,l,c=document.createDocumentFragment();n=t.firstChild;)l=c.appendChild(n);i.insertNode(c),l&&((i=i.cloneRange()).setStartAfter(l),i.collapse(!0),a.removeAllRanges(),a.addRange(i))}}$(function(){var o=$(".dialog-chat-box"),a=$(".dialog-add-box"),i=$(".dialog-user-box"),e=$(".dialog-search-box"),t=$(".dialog-chat-room");$(document).click(function(){$(".dialog-menu").hide()}).on("selectionchange",function(o){console.log(o)}),o.click(function(){$(this).hasClass("dialog-min")&&$(this).removeClass("dialog-min")}),o.on("click",".dialog-header .fa-minus",function(a){a.stopPropagation(),o.addClass("dialog-min")}),$(".dialog-box").on("click",".dialog-header .fa-close",function(){$(this).closest(".dialog-box").hide()}),o.on("click",".dialog-header .fa-plus",function(){e.show()}),o.on("click",".dialog-tab .dialog-tab-header .dialog-tab-item",function(){var o=$(this);o.addClass("active").siblings().removeClass("active"),o.closest(".dialog-tab").find(".dialog-tab-box .dialog-tab-item").eq(o.index()).addClass("active").siblings().removeClass("active")}),o.on("click",".dialog-panel .dialog-panel-header",function(){$(this).closest(".dialog-panel").toggleClass("expanded")}),o.on("click",".dialog-tab .dialog-user",function(){$(this).closest(".dialog-chat").find(".dialog-chat-room").show()}),e.on("click",".dialog-search-list .dialog-info",function(){a.show()}),e.on("click",".dialog-tab-header .dialog-tab-item",function(){$(this).addClass("active").siblings().removeClass("active")}),o.on("contextmenu",".dialog-tab .dialog-user",function(a){return o.find(".dialog-menu").css({left:a.clientX+"px",top:a.clientY+"px"}).show(),!1}),o.on("click",".dialog-menu li",function(){i.show()}),t.on("click",".fa-smile-o",function(){insertHtmlAtCaret('<img src="./image/avatar.jpg" alt="">')})});