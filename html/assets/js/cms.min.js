var Search=function(){function t(t){this.box=t,this.engine=0,this.showTip=!0,this.SEARCH_ENGINE=[{name:"百度",icon:"icon-baidu",url:"https://www.baidu.com/s?wd={word}",suggest:function(t,i){this.jsonp("https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?wd="+t,function(t){i(t.s)})}},{name:"Bing",icon:"icon-bing",url:"https://cn.bing.com/search?q={word}"},{name:"Google",icon:"icon-google",url:"https://www.google.com/search?q={word}"},{name:"DuckDuckGo",icon:"icon-duckduckgo",url:"https://duckduckgo.com/?q={word}",suggest:function(t,i){var e=this;this.jsonp("https://duckduckgo.com/ac/?q="+t,function(t){i(e.pluck(t,"phrase"))},"callback")}},{name:"Github",icon:"icon-github",url:"https://github.com/search?utf8=✓&q={word}"},{name:"哔哩哔哩",icon:"icon-bilibili",url:"https://search.bilibili.com/all?keyword={word}",suggest:function(t,i){var e=this;this.jsonp("https://s.search.bilibili.com/main/suggest?func=suggest&suggest_type=accurate&sub_type=tag&main_ver=v1&highlight=&userid=0&bangumi_acc_num=1&special_acc_num=1&topic_acc_num=1&upuser_acc_num=3&tag_num=10&special_num=10&bangumi_num=10&upuser_num=3&term="+t,function(t){return t&&t.result.tag?i(e.pluck(t.result.tag,"value")):i([])},"jsoncallback")}},{name:"淘宝",icon:"icon-taobao",url:"https://s.taobao.com/search?q={word}"},{name:"京东",icon:"icon-jd",url:"https://search.jd.com/Search?keyword={word}"}],this.refreshEngine(),this.refreshDefault(),this.bindEvent()}return t.prototype.bindEvent=function(){var c=this,i=this.box.find(".search-engine");i.click(function(t){t.stopPropagation()}).on("click",".toggle-box",function(t){$(this).toggleClass("checked"),c.showTip=$(this).hasClass("checked")}).on("click",".search-engine-body li",function(){c.changeEngine($(this).index()),i.hide()}),this.box.on("click",".search-icon",function(t){t.stopPropagation(),i.show()}).on("keyup",".search-input input",function(t){var i=$(this),e=i.val();if("Enter"!==t.key){if(c.showTip)if("ArrowDown"===t.key||"ArrowUp"===t.key){var n=c.box.find(".search-tips li");if(!(n.length<0)){for(var o=-1,s=0;s<n.length;s++){var a=$(n[s]);if(a.hasClass("active")){o=s,a.removeClass("active");break}}"ArrowDown"===t.key?o=o<n.length-1?o+1:0:"ArrowUp"===t.key&&(o=o<1?n.length-1:o);var r=n.eq(o);r.addClass("active"),i.val(r.text().replace(/^\d+/,""))}}else c.refreshTip(e)}else c.tapSearch(e)}).on("click",".search-input input",function(t){t.stopPropagation(),i.hide()}).on("click",".search-tips li",function(){c.tapSearch($(this).text().replace(/^\d+/,""))}),$(document).click(function(){c.box.find(".search-tips").hide(),i.hide()})},t.prototype.changeEngine=function(t){this.engine=t,this.refreshDefault()},t.prototype.tapSearch=function(t){if((t=t.trim())&&!(t.length<1)){this.box.find(".search-tips").hide();var i=this.SEARCH_ENGINE[this.engine].url.replace("{word}",encodeURI(t.trim()));window.open(i,"_blank")}},t.prototype.refreshDefault=function(){var t=this.SEARCH_ENGINE[this.engine];this.box.find(".search-icon").attr("class","search-icon "+t.icon)},t.prototype.refreshTip=function(t){var i=this,e=this.box.find(".search-tips"),n=e.find("ul");if(!t||t.length<1)return n.html(""),void e.hide();var o=this.SEARCH_ENGINE[this.engine],s=o.suggest?o.suggest:this.SEARCH_ENGINE[0].suggest;t=encodeURI(t),"string"!=typeof s?s.call(this,t,function(t){if(!t||t.length<1)return n.html(""),void e.hide();n.html(i.getTipList(t||[])),e.show()}):this.jsonp(s+t,function(t){if(!t||!t.data||t.data.length<1)return n.html(""),void e.hide();n.html(i.getTipList(t.data||[])),e.show()})},t.prototype.pluck=function(t,i){var e=[];return t&&$.each(t,function(){this[i]&&e.push(this[i])}),e},t.prototype.jsonp=function(t,i,e){void 0===e&&(e="cb"),$.ajax({url:t,dataType:"jsonp",jsonp:e}).done(function(t){i(t)}).fail(function(){i()})},t.prototype.refreshEngine=function(){this.box.find(".search-engine-body").html(this.getEngineList())},t.prototype.getEngineList=function(){var i="";return this.SEARCH_ENGINE.forEach(function(t){i+='<li><span class="'+t.icon+'"></span>'+t.name+"</li>"}),i},t.prototype.getTipList=function(t){var e="";return t.forEach(function(t,i){e+="<li><span>"+(i+=1)+"</span> "+t+"</li>"}),e},t}(),NAV_COOKIE="nav_self",Navigation=function(){function t(t,i){void 0===i&&(i=[]),this.box=t,this.groups=i,this.editData=[],this.dialog=$("#add-box").dialog(),this.load(),this.refresh(),this.bindEvent()}return t.prototype.load=function(){if(!(0<this.groups.length)){var t=window.localStorage.getItem(NAV_COOKIE);if(t&&0<=t.indexOf("{"))this.groups=JSON.parse(t);else{var e=this;this.groups=[],this.box.find(".panel-body .group-item").each(function(){var t=$(this),i={name:t.find(".group-name").text(),items:[]};t.find(".site-item").each(function(){var t=$(this);i.items.push({name:t.text(),url:t.attr("href")})}),e.groups.push(i)})}}},t.prototype.bindEvent=function(){var i=this;this.box.on("click",".custom-btn",function(){$(this).closest(".self-box").toggleClass("edit-mode")}).on("click",".panel-close",function(){$(this).closest(".self-box").removeClass("edit-mode")}).on("click",".site-item",function(t){$(this).closest(".self-box").hasClass("edit-mode")&&t.preventDefault()}).on("click",".site-item .fa-times",function(t){i.deleteByA($(this).closest(".site-item"))}).on("click",".site-item .fa-edit",function(t){i.editByA($(this).closest(".site-item"))}).on("click",".add-btn",function(){i.showDialog({group:"作为分组名",name:"",link:""})}).on("click",".panel-footer .btn",function(){var t=$(this).text();return 0<=t.indexOf("本")?(window.localStorage.setItem(NAV_COOKIE,JSON.stringify(i.groups)),void Dialog.tip("本地保存成功！")):0<=t.indexOf("恢")?(i.groups=[],window.localStorage.removeItem(NAV_COOKIE),Dialog.tip("清空成功！"),void i.saveAsync()):void(0<=t.indexOf("云")&&i.saveAsync())}),this.dialog.find("select").change(function(){var t=$(this).val();i.dialog.find(".input-group").eq(2).toggle("作为分组名"!==t)}),this.dialog.on("done",function(){var t={group:this.find("select").val(),name:this.find("[name=name]").val(),link:this.find("[name=link]").val()};if("作为分组名"==t.group)t.group;else if(!t.link||t.link.indexOf("//")<0)return void alert("请输入完整的网址");i.save(t),this.close()})},t.prototype.deleteByA=function(t){var i=t.closest(".group-item").index(),e=t.index();this.groups[i].items.splice(e,1),t.remove()},t.prototype.editByA=function(t){var i=t.closest(".group-item").index(),e=t.index();this.editData=[i,e],this.showDialog({group:this.groups[i].name,name:this.groups[i].items[e].name,link:this.groups[i].items[e].url})},t.prototype.getItemByA=function(t){var i=t.closest(".group-item").index(),e=t.index();return this.groups[i].items[e]},t.prototype.save=function(t){""==t.group||"作为分组名"==t.group?this.saveGroup(t.name):this.saveSite(t),this.refresh()},t.prototype.saveAsync=function(){$.post("form/save",{model:"navigation",content:JSON.stringify(this.groups),title:"我的导航"},function(t){200!=t.code?Dialog.tip(t.errors):Dialog.tip("保存成功")},"json")},t.prototype.addSite=function(t){for(var i=0,e=this.groups;i<e.length;i++){var n=e[i];n.name==t.group&&n.items.push({name:t.name,url:t.link})}},t.prototype.saveSite=function(t){if(2===this.editData.length){var i=this.editData,e=i[0],n=i[1];t.group===this.groups[e].name?this.groups[e].items[n]={name:t.name,url:t.link}:(this.groups[e].items.splice(n,1),this.addSite(t))}else this.addSite(t);this.editData=[]},t.prototype.saveGroup=function(t){this.groups.push({name:t,items:[]})},t.prototype.showDialog=function(t){for(var i="<option>作为分组名</option>",e=0,n=this.groups;e<n.length;e++){i+="<option>"+n[e].name+"</option>"}for(var o in this.dialog.find("select").html(i),t)t.hasOwnProperty(o)&&this.dialog.find("[name="+o+"]").val(t[o]);this.dialog.find("select").trigger("change"),this.dialog.show()},t.prototype.refresh=function(){this.box.find(".panel-body").html(this.getHtml())},t.prototype.getHtml=function(){var e="";return!this.groups||this.groups.length<1||this.groups.forEach(function(t){var i="";t.items.forEach(function(t){i+='<a href="'+t.url+'" target="_blank" class="site-item" rel="noopener noreferrer">\n                <i class="fa fa-times"></i>\n                '+t.name+'\n                <i class="fa fa-edit"></i>\n            </a>'}),e+='<div class="group-item">\n            <div class="group-name">'+t.name+"</div>\n            <div>\n                "+i+"\n            </div>\n        </div>"}),e},t}();function bindNavigation(t){new Search($(".search-box")),new Navigation($(".self-box"),t)}function bindTheme(){$(".theme-list .item").mouseenter(function(){var t=$(this).find(".thumb img"),i=t.closest(".thumb").innerHeight(),e=t.height();e<=i||t.css("top",i-e+"px")}).mouseleave(function(){$(this).find(".thumb img").css("top",0)})}$(function(){$(document).on("click",".tab-box .tab-header .tab-item",function(){var t=$(this);t.addClass("active").siblings().removeClass("active"),t.closest(".tab-box").find(".tab-body .tab-item").eq(t.index()).addClass("active").siblings().removeClass("active")}).on("click",".nav-bar .nav-toggle",function(){$(this).closest(".nav-bar").toggleClass("open")}),$("img.lazy").lazyload({callback:"img"})});