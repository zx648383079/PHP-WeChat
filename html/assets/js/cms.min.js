var Search=function(){function i(i){this.box=i,this.engine=0,this.showTip=!0,this.SEARCH_ENGINE=[{name:"百度",icon:"icon-baidu",url:"https://www.baidu.com/s?wd={word}",suggest:function(i,t){this.jsonp("https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?wd="+i,function(i){t(i.s)})}},{name:"Bing",icon:"icon-bing",url:"https://cn.bing.com/search?q={word}"},{name:"Google",icon:"icon-google",url:"https://www.google.com/search?q={word}"},{name:"Github",icon:"icon-github",url:"https://github.com/search?utf8=✓&q={word}"},{name:"哔哩哔哩",icon:"icon-bilibili",url:"https://search.bilibili.com/all?keyword={word}",suggest:function(i,t){var e=this;this.jsonp("https://s.search.bilibili.com/main/suggest?func=suggest&suggest_type=accurate&sub_type=tag&main_ver=v1&highlight=&userid=0&bangumi_acc_num=1&special_acc_num=1&topic_acc_num=1&upuser_acc_num=3&tag_num=10&special_num=10&bangumi_num=10&upuser_num=3&term="+i,function(i){return i&&i.result.tag?t(e.pluck(i.result.tag,"value")):t([])},"jsoncallback")}},{name:"淘宝",icon:"icon-taobao",url:"https://s.taobao.com/search?q={word}"},{name:"京东",icon:"icon-jd",url:"https://search.jd.com/Search?keyword={word}"}],this.refreshEngine(),this.refreshDefault(),this.bindEvent()}return i.prototype.bindEvent=function(){var c=this,t=this.box.find(".search-engine");t.click(function(i){i.stopPropagation()}).on("click",".toggle-box",function(i){$(this).toggleClass("checked"),c.showTip=$(this).hasClass("checked")}).on("click",".search-engine-body li",function(){c.changeEngine($(this).index()),t.hide()}),this.box.on("click",".search-icon",function(i){i.stopPropagation(),t.show()}).on("keyup",".search-input input",function(i){var t=$(this),e=t.val();if("Enter"!==i.key){if(c.showTip)if("ArrowDown"===i.key||"ArrowUp"===i.key){var n=c.box.find(".search-tips li");if(!(n.length<0)){for(var o=-1,s=0;s<n.length;s++){var a=$(n[s]);if(a.hasClass("active")){o=s,a.removeClass("active");break}}"ArrowDown"===i.key?o=o<n.length-1?o+1:0:"ArrowUp"===i.key&&(o=o<1?n.length-1:o);var r=n.eq(o);r.addClass("active"),t.val(r.text().replace(/^\d+/,""))}}else c.refreshTip(e)}else c.tapSearch(e)}).on("click",".search-input input",function(i){i.stopPropagation(),t.hide()}).on("click",".search-tips li",function(){c.tapSearch($(this).text().replace(/^\d+/,""))}),$(document).click(function(){c.box.find(".search-tips").hide(),t.hide()})},i.prototype.changeEngine=function(i){this.engine=i,this.refreshDefault()},i.prototype.tapSearch=function(i){if((i=i.trim())&&!(i.length<1)){this.box.find(".search-tips").hide();var t=this.SEARCH_ENGINE[this.engine].url.replace("{word}",encodeURI(i.trim()));window.open(t,"_blank")}},i.prototype.refreshDefault=function(){var i=this.SEARCH_ENGINE[this.engine];this.box.find(".search-icon").attr("class","search-icon "+i.icon)},i.prototype.refreshTip=function(i){var t=this,e=this.box.find(".search-tips"),n=e.find("ul");if(!i||i.length<1)return n.html(""),void e.hide();var o=this.SEARCH_ENGINE[this.engine],s=o.suggest?o.suggest:this.SEARCH_ENGINE[0].suggest;i=encodeURI(i),"string"!=typeof s?s.call(this,i,function(i){if(!i||i.length<1)return n.html(""),void e.hide();n.html(t.getTipList(i||[])),e.show()}):this.jsonp(s+i,function(i){if(!i||!i.data||i.data.length<1)return n.html(""),void e.hide();n.html(t.getTipList(i.data||[])),e.show()})},i.prototype.pluck=function(i,t){var e=[];return i&&$.each(i,function(){this[t]&&e.push(this[t])}),e},i.prototype.jsonp=function(i,t,e){void 0===e&&(e="cb"),$.ajax({url:i,dataType:"jsonp",jsonp:e}).done(function(i){t(i)}).fail(function(){t()})},i.prototype.refreshEngine=function(){this.box.find(".search-engine-body").html(this.getEngineList())},i.prototype.getEngineList=function(){var t="";return this.SEARCH_ENGINE.forEach(function(i){t+='<li><span class="'+i.icon+'"></span>'+i.name+"</li>"}),t},i.prototype.getTipList=function(i){var e="";return i.forEach(function(i,t){e+="<li><span>"+(t+=1)+"</span> "+i+"</li>"}),e},i}(),NAV_COOKIE="n_co",Navigation=function(){function i(i,t){void 0===t&&(t=[]),this.box=i,this.groups=t,this.editData=[],this.dialog=$("#add-box").dialog(),this.load(),this.refresh(),this.bindEvent()}return i.prototype.load=function(){var i=$.cookie(NAV_COOKIE);i&&(this.groups=JSON.parse(i))},i.prototype.bindEvent=function(){var t=this;this.box.on("click",".custom-btn",function(){$(this).closest(".self-box").toggleClass("edit-mode")}).on("click",".panel-close",function(){$(this).closest(".self-box").removeClass("edit-mode")}).on("click",".site-item",function(i){$(this).closest(".self-box").hasClass("edit-mode")&&i.preventDefault()}).on("click",".site-item .fa-times",function(i){t.deleteByA($(this).closest(".site-item"))}).on("click",".site-item .fa-edit",function(i){t.editByA($(this).closest(".site-item"))}).on("click",".add-btn",function(){t.showDialog({group:"作为分组名",name:"",link:""})}).on("click",".panel-footer .btn",function(){var i=$(this).text();return 0<=i.indexOf("本")?($.cookie(NAV_COOKIE,JSON.stringify(this.groups),{expires:365}),void Dialog.tip("本地保存成功！")):0<=i.indexOf("恢")?(this.groups=[],$.cookie(NAV_COOKIE,null),void Dialog.tip("清空成功！")):void 0}),this.dialog.find("select").change(function(){var i=$(this).val();t.dialog.find(".input-group").eq(2).toggle("作为分组名"!==i)}),this.dialog.on("done",function(){var i={group:this.find("select").val(),name:this.find("[name=name]").val(),link:this.find("[name=link]").val()};if("作为分组名"==i.group)i.group;else if(!i.link||i.link.indexOf("//")<0)return void alert("请输入完整的网址");t.save(i),this.close()})},i.prototype.deleteByA=function(i){var t=i.closest(".group-item").index(),e=i.index();this.groups[t].items.splice(e,1),i.remove()},i.prototype.editByA=function(i){var t=i.closest(".group-item").index(),e=i.index();this.editData=[t,e],this.showDialog({group:this.groups[t].name,name:this.groups[t].items[e].name,link:this.groups[t].items[e].url})},i.prototype.getItemByA=function(i){var t=i.closest(".group-item").index(),e=i.index();return this.groups[t].items[e]},i.prototype.save=function(i){""==i.group||"作为分组名"==i.group?this.saveGroup(i.name):this.saveSite(i),this.refresh()},i.prototype.addSite=function(i){for(var t=0,e=this.groups;t<e.length;t++){var n=e[t];n.name==i.group&&n.items.push({name:i.name,url:i.link})}},i.prototype.saveSite=function(i){if(2===this.editData.length){var t=this.editData,e=t[0],n=t[1];i.group===this.groups[e].name?this.groups[e].items[n]={name:i.name,url:i.link}:(this.groups[e].items.splice(n,1),this.addSite(i))}else this.addSite(i);this.editData=[]},i.prototype.saveGroup=function(i){this.groups.push({name:i,items:[]})},i.prototype.showDialog=function(i){for(var t="<option>作为分组名</option>",e=0,n=this.groups;e<n.length;e++){t+="<option>"+n[e].name+"</option>"}for(var o in this.dialog.find("select").html(t),i)i.hasOwnProperty(o)&&this.dialog.find("[name="+o+"]").val(i[o]);this.dialog.find("select").trigger("change"),this.dialog.show()},i.prototype.refresh=function(){this.box.find(".panel-body").html(this.getHtml())},i.prototype.getHtml=function(){var e="";return!this.groups||this.groups.length<1||this.groups.forEach(function(i){var t="";i.items.forEach(function(i){t+='<a href="'+i.url+'" target="_blank" class="site-item" rel="noopener noreferrer">\n                <i class="fa fa-times"></i>\n                '+i.name+'\n                <i class="fa fa-edit"></i>\n            </a>'}),e+='<div class="group-item">\n            <div class="group-name">'+i.name+"</div>\n            <div>\n                "+t+"\n            </div>\n        </div>"}),e},i}();function bindNavigation(){new Search($(".search-box")),new Navigation($(".self-box"))}function bindTheme(){$(".theme-list .item").mouseenter(function(){var i=$(this).find(".thumb img"),t=i.closest(".thumb").innerHeight(),e=i.height();e<=t||i.css("top",t-e+"px")}).mouseleave(function(){$(this).find(".thumb img").css("top",0)})}$(function(){$(document).on("click",".tab-box .tab-header .tab-item",function(){var i=$(this);i.addClass("active").siblings().removeClass("active"),i.closest(".tab-box").find(".tab-body .tab-item").eq(i.index()).addClass("active").siblings().removeClass("active")}).on("click",".nav-bar .nav-toggle",function(){$(this).closest(".nav-bar").toggleClass("open")})});