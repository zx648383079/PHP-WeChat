function bindEditQuestion(){var t=$("input[name=id]").val()||0;$('select[name="type"]').change(function(){$.get(BASE_URI+"question/option",{id:t,type:$(this).val()},function(t){$(".option-box").html(t)})}),$("input[name=title]").on("change",function(){var e=$(this),t=e.val();if(t&&!(t.toString().trim().length<1)){var n=$("input[name=id]").val();postJson(BASE_URI+"question/check",{id:n,title:t},function(t){e.next("a").remove(),200===t.code&&t.data&&e.after('<a href="'+t.data.url+'" target="_blank">已存在【'+t.data.title+"】</a>")})}}),$(".option-box").on("click",".option-item .remove-btn",function(t){t.preventDefault();var e=$(this).closest(".option-item");e.siblings(".option-item").length<1||e.remove()}).on("click",".add-option",function(t){t.preventDefault();var e=$(this),n=e.prev(".option-item").clone();e.before(n),n.find("input,textarea").val(""),n.find("select").val(0)}).on("change",'.option-item select[name="option[is_right][]"]',function(t){$(this).val()<1||0<$('select[name="type"]').val()||$(this).closest(".option-item").siblings(".option-item").find('select[name="option[is_right][]"]').val(0)}).on("change",'.option-item select[name="option[type][]"]',function(t){if(!($(this).val()<1))$(this).closest(".option-item").find('input[name="option[content][]"]')})}function bindDo(t){$(".question-panel").on("change","input,textarea",function(){saveQuestion(t+"pager/save",$(this).closest(".question-item"))})}function bindDoPage(t){$(".question-panel").on("change","input,textarea",function(){saveQuestion(t+"page/save",$(this).closest(".question-item"))});var n=$(".time-counter"),i=setInterval(function(){var t=(new Date).getTime()-new Date(n.data("start")).getTime(),e=n.data("limit");if(!e||e<1)n.text("已耗时："+formatTime(t));else{if((t=6e4*e-t)<=0)return clearInterval(i),void $(".tool-bar a").trigger("click");n.text("剩余时间："+formatTime(t))}},500)}function formatTime(t,e){isNaN(t)&&(t=0);function n(t){return t<10&&0<=t?"0"+t:t}var i=(t=Math.floor(t/1e3))%60,o=e&&e.indexOf("h")<0?Math.floor(t/60):Math.floor(t/60)%60,a=Math.floor(t/3600);return e?e.replace(/h+/,n(a)).replace(/i+/,n(o)).replace(/s+/,n(i)):(0!==a?n(a)+":":"")+n(o)+":"+n(i)}function bindDoQuestion(t){$(".question-panel").on("click",".tool-bar .btn-bar button",function(){var t=$(this),e=t.data("target");if(e){var n=t.text(),i=0<=n.indexOf("显示");return $(e).toggle(i),void t.text(i?n.replace("显示","收起"):n.replace("收起","显示"))}}).on("click",".tool-bar .btn-bar a",function(t){var e=$(this);if("check"===e.data("type")){t.preventDefault();var n=e.closest(".question-panel").find(".question-item-box");$.post(e.attr("href"),questionData(n),function(t){n.html(t)})}})}function questionData(t){var e=[];return t.find("input,textarea").each(function(){this.type&&0<=["radio","checkbox"].indexOf(this.type)&&!this.checked||e.push(encodeURIComponent(this.name)+"="+encodeURIComponent($(this).val().toString()))}),e.join("&")}function saveQuestion(t,e,n){var i=questionData(e);i.length<1||postJson(t,i,function(t){200===t.code&&n&&n(t.data)})}function bindDatePicker(t,e,n){void 0===t&&(t="start_at"),void 0===e&&(e="end_at"),void 0===n&&(n="yyyy-mm-dd");var i=$("[name="+t+"]").datetimer({format:n});e&&$("[name="+e+"]").datetimer({format:n,min:i})}function bindEditPage(){bindDatePicker();var t=$(".rule-box").on("click",".fa-times",function(){1!==t.find("tbody tr").length&&$(this).closest("tr").remove()}).on("click",".fa-plus",function(){t.find("tbody").append(t.find("tbody tr")[0].outerHTML)})}