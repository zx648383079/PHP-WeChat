function bindEditQuestion(){var t=$("input[name=id]").val()||0;$('select[name="type"]').change(function(){$.get(BASE_URI+"question/option",{id:t,type:$(this).val()},function(t){$(".option-box").html(t)})}),$("input[name=title]").on("change",function(){var t,e=$(this),n=e.val();!n||n.toString().trim().length<1||(t=$("input[name=id]").val(),postJson(BASE_URI+"question/check",{id:t,title:n},function(t){e.next("a").remove(),200===t.code&&t.data&&e.after('<a href="'+t.data.url+'" target="_blank">已存在【'+t.data.title+"】</a>")}))}),$(".option-box").on("click",".option-item .remove-btn",function(t){t.preventDefault();t=$(this).closest(".option-item");t.siblings(".option-item").length<1||t.remove()}).on("click",".add-option",function(t){t.preventDefault();var t=$(this),e=t.prev(".option-item").clone();t.before(e),e.find("input,textarea").val(""),e.find("select").val(0)}).on("change",'.option-item select[name="option[is_right][]"]',function(t){$(this).val()<1||0<$('select[name="type"]').val()||$(this).closest(".option-item").siblings(".option-item").find('select[name="option[is_right][]"]').val(0)}).on("change",'.option-item select[name="option[type][]"]',function(t){$(this).val()<1||$(this).closest(".option-item").find('input[name="option[content][]"]')})}function bindDo(t){$(".question-panel").on("change","input,textarea",function(){saveQuestion(t+"pager/save",$(this).closest(".question-item"))})}function bindDoPage(t){$(".question-panel").on("change","input,textarea",function(){saveQuestion(t+"page/save",$(this).closest(".question-item"))});var n=$(".time-counter"),i=setInterval(function(){var t=(new Date).getTime()-new Date(n.data("start")).getTime(),e=n.data("limit");!e||e<1?n.text("已耗时："+formatTime(t)):(t=6e4*e-t)<=0?(clearInterval(i),$(".tool-bar a").trigger("click")):n.text("剩余时间："+formatTime(t))},500)}function formatTime(t,e){isNaN(t)&&(t=0);function n(t){return t<10&&0<=t?"0"+t:t}var i=(t=Math.floor(t/1e3))%60,o=e&&e.indexOf("h")<0?Math.floor(t/60):Math.floor(t/60)%60,t=Math.floor(t/3600);return e?e.replace(/h+/,n(t)).replace(/i+/,n(o)).replace(/s+/,n(i)):(0!==t?n(t)+":":"")+n(o)+":"+n(i)}function bindDoQuestion(t){$(".question-panel").on("click",".tool-bar .btn-bar button",function(){var t,e,n=$(this),i=n.data("target");i&&(e=0<=(t=n.text()).indexOf("显示"),$(i).toggle(e),n.text(e?t.replace("显示","收起"):t.replace("收起","显示")))}).on("click",".tool-bar .btn-bar a",function(t){var e,n=$(this);"check"===n.data("type")&&(t.preventDefault(),e=n.closest(".question-panel").find(".question-item-box"),$.post(n.attr("href"),questionData(e),function(t){e.html(t)}))})}function questionData(t){var e=[];return t.find("input,textarea").each(function(){this.type&&0<=["radio","checkbox"].indexOf(this.type)&&!this.checked||e.push(encodeURIComponent(this.name)+"="+encodeURIComponent($(this).val().toString()))}),e.join("&")}function saveQuestion(t,e,n){e=questionData(e);e.length<1||postJson(t,e,function(t){200===t.code&&n&&n(t.data)})}function bindDatePicker(t,e,n){void 0===t&&(t="start_at"),void 0===e&&(e="end_at"),void 0===n&&(n="yyyy-mm-dd");t=$("[name="+t+"]").datetimer({format:n});e&&$("[name="+e+"]").datetimer({format:n,min:t})}function bindEditPage(){bindDatePicker();var t=$(".rule-box").on("click",".fa-times",function(){1!==t.find("tbody tr").length&&$(this).closest("tr").remove()}).on("click",".fa-plus",function(){t.find("tbody").append(t.find("tbody tr")[0].outerHTML)})}