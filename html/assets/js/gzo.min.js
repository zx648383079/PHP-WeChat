function bindCurd(){$.getJSON(BASE_URI+"sql/table",function(t){var e;200==t.code&&(e='<option value="">请选择</option>',$.each(t.data,function(t,n){e+='<option value="'+n+'">'+n+"</option>"}),$("#table1").html(e))})}function bindImport(){$.getJSON(BASE_URI+"sql/schema",function(t){var e;200==t.code&&(e='<option value="">请选择</option>',$.each(t.data,function(t,n){e+='<option value="'+n+'">'+n+"</option>"}),$("#schema1").html(e))})}function bindExport(){bindImport(),$("#schema1").change(function(){$("#table-box").hide(),$.getJSON(BASE_URI+"sql/table?schema="+$(this).val(),function(t){var e="";200==t.code&&$.each(t.data,function(t,n){e+='<option value="'+n+'">'+n+"</option>"}),$("#table1").html(e),$("#table-box").toggle(""!=e)})})}function bindCopy(){function a(t,n){var e=t.split("."),a=e[0],i=e[1];if(0<(e=o.hasOwnProperty(a)&&o[a].hasOwnProperty(i)?o[a][i]:[]).length)return n(e);$.getJSON(BASE_URI+"sql/column?table="+t,function(t){200==t.code&&(o[a][i]=t.data,n(t.data))})}function t(t){n.show(),c=t}var o={},n=$(".dialog-select"),i=$(".dialog-column-select"),c=void 0;!function(n){var t=Object.keys(o);if(0<t.length)return n(t);$.getJSON(BASE_URI+"sql/schema",function(t){200==t.code&&($.each(t.data,function(){o[this]={}}),n(t.data))})}(function(t){var e="";$.each(t,function(t,n){e+='<option value="'+n+'">'+n+"</option>"}),n.find('select[name="schame"]').html(e).trigger("change")}),n.on("change",'select[name="schame"]',function(){var a=n.find('select[name="table"]').val();!function(e,a){var t=o.hasOwnProperty(e)?Object.keys(o[e]):[];if(0<t.length)return a(t);$.getJSON(BASE_URI+"sql/table?schema="+e,function(t){var n;200==t.code&&(n={},$.each(t.data,function(){n[this]=[]}),o[e]=n,a(t.data))})}($(this).val(),function(t){var e="";$.each(t,function(t,n){e+='<option value="'+n+'" '+(a===n?"selected":"")+">"+n+"</option>"}),n.find('select[name="table"]').html(e).trigger("change")})}).on("click","button",function(){n.hide(),c&&c(n.find('select[name="schame"]').val()+"."+n.find('select[name="table"]').val())}),i.on("click","button",function(){i.hide();var t={type:0,value:null},n=i.find('[name="type"]:checked');n.length<1||(t.type=n.val(),t.value=n.next().val(),c&&c(t))}),$(document).on("click",'*[data-action="table-select"]',function(){var e=$(this);t(function(t){e.text(t),a(t,function(t){var n="";t.forEach(function(t){n+='<div class="column-item"><span class="dist-column">'+t.label+'</span><i>&lt;-</i><span class="src-column" data-action="column-select">请选择</span><i class="fa fa-times"></i></div>'}),e.closest(".panel").find(".panel-body").html(n)})})}).on("click",'*[data-action="table-add"]',function(){var n=$(this);0<=n.closest(".panel-header").find(".dist-item").text().indexOf("请选择")?Dialog.tip("请先选择目标表"):t(function(t){n.before('<span class="table-item">'+t+'<i class="fa fa-times"></i></span>'),a(t,function(a){var t=n.closest(".panel");t.data("column",a),t.find(".panel-body .column-item").each(function(t,n){var e=$(n),n=function(t,n){for(var e=0,a=n;e<a.length;e++){var i=a[e];if(t===i.value)return i.is_used=!0,i}}(e.find(".dist-column").text().split("(")[0],a);n&&e.find('[data-action="column-select"]').text(n.label)})})})}).on("click",'*[data-action="column-select"]',function(){var n=$(this),t=n.closest(".panel"),e=(t.find(".dist-item").text(),t.find(".table-item"));e.length<1?Dialog.tip("请先选择数据表"):(t=e.eq(0).text(),e=function(t){n.text(t.type<1?'"'+t.value+'"':t.value)},a(t,function(t){var n="";t.forEach(function(t){n+='<option value="'+t.label+'">'+t.label+"</option>"}),i.find("select").html(n)}),i.show(),c=e)}).on("click",".table-item .fa-times",function(){$(this).closest(".table-item").remove()}).on("click",".column-item .fa-times",function(){$(this).closest(".column-item").remove()}).on("click",'*[data-type="reset"]',function(){var t=$(this).closest("form");t.find(".dist-item").text("请选择"),t.find(".table-item").remove(),t.find(".panel-body").html("")}).on("submit",'form[data-type="post"]',function(t){var e={dist:"",src:"",column:{}},n=$(this);return e.dist=n.find(".dist-item").text(),e.src=n.find(".table-item").eq(0).text(),n.find(".column-item").each(function(){var t="",n="";$(this).find("span").each(function(){$(this).data("action")?n=this.innerText:t=this.innerText}),e.column[t]=n}),postJson(n.attr("action"),e,function(t){200==t.code?Dialog.tip("复制成功"):parseAjax(t)}),!1})}$(document).ready(function(){$(document).on("click","button[data-type=preview]",function(){var t=$(this).parents("form");return postJson(t.attr("action")+"?preview=true",t.serialize(),function(t){200==t.code?Dialog.box({title:"预览",content:'<pre><code class="language-php">'+Prism.highlight(t.data.code,Prism.languages.php)+"</code></pre>"}):parseAjax(t)}),!1})});