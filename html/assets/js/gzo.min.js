function bindCurd(){$.getJSON(BASE_URI+"sql/table",function(t){var e;200==t.code&&(e='<option value="">请选择</option>',$.each(t.data,function(t,n){e+='<option value="'+n+'">'+n+"</option>"}),$("#table1").html(e))})}function bindImport(){$.getJSON(BASE_URI+"sql/schema",function(t){var e;200==t.code&&(e='<option value="">请选择</option>',$.each(t.data,function(t,n){e+='<option value="'+n+'">'+n+"</option>"}),$("#schema1").html(e))})}function bindExport(){bindImport(),$("#schema1").change(function(){$("#table-box").hide(),$.getJSON(BASE_URI+"sql/table?schema="+$(this).val(),function(t){var e="";200==t.code&&$.each(t.data,function(t,n){e+='<option value="'+n+'">'+n+"</option>"}),$("#table1").html(e),$("#table-box").toggle(""!=e)})})}function bindCopy(){function a(t,n){var e=t.split("."),a=e[0],i=e[1];if(0<(e=o.hasOwnProperty(a)&&o[a].hasOwnProperty(i)?o[a][i]:[]).length)return n(e);$.getJSON(BASE_URI+"sql/column?table="+t,function(t){200==t.code&&(o[a][i]=t.data,n(t.data))})}function t(t){c.show(),l=t}function n(t,n,e){void 0===n&&(n={});var a={dist:"",src:"",column:{}};a.dist=t.find(".dist-item").text(),a.src=t.find(".table-item").eq(0).text(),t.find(".column-item").each(function(){var t="",n="";$(this).find("span").each(function(){$(this).data("action")?n=this.innerText:t=this.innerText}),a.column[t]=n}),postJson(t.attr("action"),Object.assign({},a,n),function(t){(200!=t.code?parseAjax:e)(t)})}var o={},c=$(".dialog-select"),i=$(".dialog-column-select"),l=void 0;!function(n){var t=Object.keys(o);if(0<t.length)return n(t);$.getJSON(BASE_URI+"sql/schema",function(t){200==t.code&&($.each(t.data,function(){o[this]={}}),n(t.data))})}(function(t){var e="";$.each(t,function(t,n){e+='<option value="'+n+'">'+n+"</option>"}),c.find('select[name="schame"]').html(e).trigger("change")}),c.on("change",'select[name="schame"]',function(){var a=c.find('select[name="table"]').val(),e=$(this).val(),i=function(t){var e="";$.each(t,function(t,n){e+='<option value="'+n+'" '+(a===n?"selected":"")+">"+n+"</option>"}),c.find('select[name="table"]').html(e).trigger("change")},t=o.hasOwnProperty(e)?Object.keys(o[e]):[];0<t.length?i(t):$.getJSON(BASE_URI+"sql/table?schema="+e,function(t){var n;200==t.code&&(n={},$.each(t.data,function(){n[this]=[]}),o[e]=n,i(t.data))})}).on("click","button",function(){c.hide(),l&&l(c.find('select[name="schame"]').val()+"."+c.find('select[name="table"]').val())}),i.on("click","button",function(){i.hide();var t={type:0,value:null},n=i.find('[name="type"]:checked');n.length<1||(t.type=n.val(),t.value=n.next().val(),l&&l(t))});$(document).on("click",'*[data-action="table-select"]',function(){var e=$(this);t(function(t){e.text(t),a(t,function(t){var n="";t.forEach(function(t){n+='<div class="column-item"><span class="dist-column">'+t.label+'</span><i>&lt;-</i><span class="src-column" data-action="column-select">请选择</span><i class="fa fa-times"></i></div>'}),e.closest(".panel").find(".panel-body").html(n)})})}).on("click",'*[data-action="table-add"]',function(){var n=$(this);0<=n.closest(".panel-header").find(".dist-item").text().indexOf("请选择")?Dialog.tip("请先选择目标表"):t(function(t){n.before('<span class="table-item">'+t+'<i class="fa fa-times"></i></span>'),a(t,function(a){var t=n.closest(".panel");t.data("column",a),t.find(".panel-body .column-item").each(function(t,n){var n=$(n),e=function(t,n){for(var e=0,a=n;e<a.length;e++){var i=a[e];if(t===i.value)return i.is_used=!0,i}}(n.find(".dist-column").text().split("(")[0],a);e&&n.find('[data-action="column-select"]').text(e.label)})})})}).on("click",'*[data-action="column-select"]',function(){var t,n=$(this),e=n.closest(".panel"),e=(e.find(".dist-item").text(),e.find(".table-item"));e.length<1?Dialog.tip("请先选择数据表"):(e=e.eq(0).text(),t=function(t){n.text(t.type<1?'"'+t.value+'"':t.value)},a(e,function(t){var n="";t.forEach(function(t){n+='<option value="'+t.label+'">'+t.label+"</option>"}),i.find("select").html(n)}),i.show(),l=t)}).on("click",".table-item .fa-times",function(){$(this).closest(".table-item").remove()}).on("click",".column-item .fa-times",function(){$(this).closest(".column-item").remove()}).on("click",'*[data-type="reset"]',function(){var t=$(this).closest("form");t.find(".dist-item").text("请选择"),t.find(".table-item").remove(),t.find(".panel-body").html("")}).on("submit",'form[data-type="post"]',function(t){return n($(this),{},function(){Dialog.tip("复制成功")}),!1}).on("click","button[data-action=preview]",function(t){return t.preventDefault(),n($(this).parents("form"),{preview:!0},function(t){Dialog.box({title:"预览",content:"<p>".concat(t.data.code,"</p><p>").concat(JSON.stringify(t.data.parameters),"</p>")})}),!1})}$(function(){$(document).on("click","button[data-type=preview]",function(){var t=$(this).parents("form");return postJson(t.attr("action")+"?preview=true",t.serialize(),function(t){200!=t.code?parseAjax(t):Dialog.box({title:"预览",content:'<pre><code class="language-php">'+Prism.highlight(t.data.code,Prism.languages.php)+"</code></pre>"})}),!1})});