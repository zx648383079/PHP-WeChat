function bindCurd(){$.getJSON(BASE_URI+"sql/table",function(t){if(200==t.code){var e='<option value="">请选择</option>';$.each(t.data,function(t,n){e+='<option value="'+n+'">'+n+"</option>"}),$("#table1").html(e)}})}function bindImport(){$.getJSON(BASE_URI+"sql/schema",function(t){if(200==t.code){var e='<option value="">请选择</option>';$.each(t.data,function(t,n){e+='<option value="'+n+'">'+n+"</option>"}),$("#schema1").html(e)}})}function bindExport(){bindImport(),$("#schema1").change(function(){$("#table-box").hide(),$.getJSON(BASE_URI+"sql/table?schema="+$(this).val(),function(t){var e="";200==t.code&&$.each(t.data,function(t,n){e+='<option value="'+n+'">'+n+"</option>"}),$("#table1").html(e),$("#table-box").toggle(""!=e)})})}function bindCopy(){function o(t,n){var e=t.split("."),a=e[0],i=e[1],o=c.hasOwnProperty(a)&&c[a].hasOwnProperty(i)?c[a][i]:[];if(0<o.length)return n(o);$.getJSON(BASE_URI+"sql/column?table="+t,function(t){200==t.code&&(c[a][i]=t.data,n(t.data))})}function t(t){n.show(),s=t}var c={},n=$(".dialog-select"),l=$(".dialog-column-select"),s=void 0;!function(n){var t=Object.keys(c);if(0<t.length)return n(t);$.getJSON(BASE_URI+"sql/schema",function(t){200==t.code&&($.each(t.data,function(){c[this]={}}),n(t.data))})}(function(t){var e="";$.each(t,function(t,n){e+='<option value="'+n+'">'+n+"</option>"}),n.find('select[name="schame"]').html(e).trigger("change")}),n.on("change",'select[name="schame"]',function(){!function(e,a){var t=c.hasOwnProperty(e)?Object.keys(c[e]):[];if(0<t.length)return a(t);$.getJSON(BASE_URI+"sql/table?schema="+e,function(t){if(200==t.code){var n={};$.each(t.data,function(){n[this]=[]}),c[e]=n,a(t.data)}})}($(this).val(),function(t){var e="";$.each(t,function(t,n){e+='<option value="'+n+'">'+n+"</option>"}),n.find('select[name="table"]').html(e).trigger("change")})}).on("click","button",function(){n.hide(),s&&s(n.find('select[name="schame"]').val()+"."+n.find('select[name="table"]').val())}),l.on("click","button",function(){l.hide();var t={type:0,value:null},n=l.find('[name="type"]:checked');n.length<1||(t.type=n.val(),t.value=n.next().val(),s&&s(t))}),$(document).on("click",'*[data-action="table-select"]',function(){c={};var e=$(this);t(function(t){e.text(t),o(t,function(t){var n="";t.forEach(function(t){n+='<div class="column-item"><span>'+t.label+'</span>&lt;-<span data-action="column-select">请选择</span><i class="fa fa-times"></i></div>'}),e.closest(".panel").find(".panel-body").html(n)})})}).on("click",'*[data-action="table-add"]',function(){var n=$(this);0<=n.closest(".panel-header").find(".dist-item").text().indexOf("请选择")?Dialog.tip("请先选择目标表"):t(function(t){n.before('<span class="table-item">'+t+'<i class="fa fa-times"></i></span>'),o(t,function(e){var t=n.closest(".panel");t.data("column",e),t.find(".panel-body .column-item").each(function(t,n){e.length<=t||$(n).find('[data-action="column-select"]').text(e[t].label)})})})}).on("click",'*[data-action="column-select"]',function(){var t,n,e=$(this),a=e.closest(".panel"),i=(a.find(".dist-item").text(),a.find(".table-item"));i.length<1?Dialog.tip("请先选择数据表"):(t=i.eq(0).text(),n=function(t){e.text(t.type<1?'"'+t.value+'"':t.value)},o(t,function(t){var n="";t.forEach(function(t){n+='<option value="'+t.label+'">'+t.label+"</option>"}),l.find("select").html(n)}),l.show(),s=n)}).on("click",".table-item .fa-times",function(){$(this).closest(".table-item").remove()}).on("click",".column-item .fa-times",function(){$(this).closest(".column-item").remove()}).on("submit",'form[data-type="post"]',function(t){var e={dist:"",src:"",column:{}},n=$(this);return e.dist=n.find(".dist-item").text(),e.src=n.find(".table-item").eq(0).text(),n.find(".column-item").each(function(){var t="",n="";$(this).find("span").each(function(){$(this).data("action")?n=this.innerText:t=this.innerText}),e.column[t]=n}),postJson(n.attr("action"),e,function(t){200==t.code?Dialog.tip("复制成功"):parseAjax(t)}),!1})}$(document).ready(function(){$(document).on("click","button[data-type=preview]",function(){var t=$(this).parents("form");return postJson(t.attr("action")+"?preview=true",t.serialize(),function(t){200==t.code?Dialog.box({title:"预览",content:'<pre><code class="language-php">'+Prism.highlight(t.data.code,Prism.languages.php)+"</code></pre>"}):parseAjax(t)}),!1})});