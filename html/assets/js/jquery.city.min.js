var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function o(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),Box=function(){function t(){}return t.prototype.showPosition=function(){return this.setPosition(),this.box.show(),this},t.prototype.setPosition=function(){var t=this.element.offset(),i=t.left-$(window).scrollLeft(),e=t.top+this.element.outerHeight()-$(window).scrollTop();return this.box.css({left:i+"px",top:e+"px"}),this},t.prototype.on=function(t,i){return this.options["on"+t]=i,this},t.prototype.hasEvent=function(t){return this.options.hasOwnProperty("on"+t)},t.prototype.trigger=function(t){for(var i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];var o="on"+t;if(this.hasEvent(t)){return(n=this.options[o]).call.apply(n,[this].concat(i));var n}},t.getReal=function(t,i){return i>1?i:t*i},t}(),City=function(t){function i(i,e){var o=t.call(this)||this;if(o.element=i,o._index=-1,o.options=$.extend({},new CityDefaultOptions,e),"function"==typeof o.options.data&&(o.options.data=o.options.data.call(o)),"object"==typeof o.options.data)return o.init(),o;var n=o;return"string"==typeof o.options.data&&$.getJSON(o.options.data,function(t){0==t.code&&(n.options.data=t.data,n.init())}),o}return __extends(i,t),Object.defineProperty(i.prototype,"val",{get:function(){var t="";return this.map(function(i){t=i}),t},set:function(t){this._val=t,this.box&&this._selectedPath.apply(this,this.getPath(t))},enumerable:!0,configurable:!0}),i.prototype._selectedPath=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var e=this.options.data;this._index=-1,this._header.html(""),this._body.html("");var o;do{if(this._index++,o=t.shift(),"object"!=typeof e||!e.hasOwnProperty(o))return void this.addTab(e);this.addTab(e,"请选择",o),e=e[o][this.options.children]}while(t.length>0);o&&this.trigger("change")},i.prototype.init=function(){this._create(),this._bindEvent(),this.val=this._val},i.prototype._getHtml=function(t,i,e){void 0===i&&(i="请选择");var o="",n=this,s='<li class="active">'+i+"</li>";return $.each(t,function(t,i){var r=n._getIdAndName(i,t),a=r[0],h=r[1];if(e&&a==e)return o+='<li class="selected" data-id="'+a+'">'+h+"</li>",void(s='<li class="active" data-id="'+a+'">'+h+"</li>");o+='<li data-id="'+a+'">'+h+"</li>"}),[s,'<ul class="active">'+o+"</ul>"]},i.prototype._getIdAndName=function(t,i){if("object"!=typeof t)return[i,t];var e=t[this.options.name];return this.options.id&&t.hasOwnProperty(this.options.id)?[t[this.options.id],e]:[i,e]},i.prototype._create=function(){this.box=$('<div class="selector" data-type="selector"></div>');var t='<ul class="selector-header"></ul><div class="selector-body"></div>';this.options.auto||(t+='<div class="selector-footer"><button class="selector-yes">确定</button></div>'),this.box.html(t+'<i class="fa fa-close"></i>'),$(document.body).append(this.box),this._header=this.box.find(".selector-header"),this._body=this.box.find(".selector-body")},i.prototype._bindEvent=function(){var t=this;this.box.on("click",".fa-close",function(){t.close()}),this._header.on("click","li",function(){t.selectedTab($(this).index())}),this._body.on("click","li",function(){var i=$(this),e=i.attr("data-id"),o=i.parent().index();i.addClass("selected").siblings().removeClass("selected"),t._header.find("li").eq(o).attr("data-id",e).text(i.text()),t.selected(e,o)}),this.options.auto||this.box.on("click",".selector-yes",function(){t.trigger("done")}),this.box.click(function(t){t.stopPropagation()}),this.element.click(function(t){t.stopPropagation()}),this.options.auto&&$(document).click(function(){t.box.hide()}),$(window).scroll(function(){t.setPosition()}),this.element.click(function(){t.show()})},i.prototype.bodyMap=function(t,i){void 0===i&&(i=this._index),this._body.find("ul").eq(i).find("li").each(function(i,e){var o=$(e),n=o.attr("data-id");if(n)return 0!=t.call(o,n,o.text(),i)&&void 0})},i.prototype.selected=function(t,i){void 0===i&&(i=this._index),this.remove(i+1);var e=this._getNextData();return this.trigger("change"),"object"==typeof e&&this.addTab(e,"请选择"),e&&0!=e.length?this:(this.trigger("done"),this)},i.prototype._getNextData=function(){var t=this.options.data,i=this;return this.map(function(e){return"object"==typeof t&&t.hasOwnProperty(e)?(t=t[e][i.options.children],t?void 0:(t=[],!1)):(t=[],!1)}),t},i.prototype.selectedId=function(t,i){void 0===i&&(i=this._index),this.bodyMap(function(i){if(i==t)return this.trigger("click"),!1},i)},i.prototype.close=function(){return this.box.hide(),this},i.prototype.show=function(){return this.setPosition(),this.box.show(),this},i.prototype.selectedTab=function(t){return this._index=t,this._header.find("li").eq(t).addClass("active").siblings().removeClass("active"),this._body.find("ul").eq(t).addClass("active").siblings().removeClass("active"),this},i.prototype.addTab=function(t,i,e){void 0===i&&(i="请选择"),this._header.find("li").removeClass("active"),this._body.find("ul").removeClass("active");var o=this._getHtml(t,i,e),n=o[0],s=o[1];return this._header.append(n),this._body.append(s),this},i.prototype.remove=function(t){void 0===t&&(t=1);for(var i=this._header.find("li"),e=this._body.find("ul"),o=i.length-1;o>=t;o--)i.eq(o).remove(),e.eq(o).remove();return this},i.prototype.map=function(t){return this._header.find("li").each(function(i,e){var o=$(e),n=o.attr("data-id");if(n)return 0!=t.call(o,n,o.text(),i)&&void 0}),this},i.prototype.text=function(t){void 0===t&&(t=this.options.line);var i=[];return this.map(function(t,e){i.push(e)}),i.join(t)},i.prototype.all=function(){var t=[];return this.map(function(i){t.push(i)}),t},i.prototype.output=function(t){if(void 0===t&&(t=this.element),t.attr("data-id",this.val),t.is("input")||t.is("textarea"))return void t.val(this.text());t.text(this.text())},i.prototype.change=function(t){return this.on("change",t)},i.prototype.done=function(t){return this.on("done",t)},i.prototype.getPath=function(t){if(!t)return[];if(this.options.hasOwnProperty(t))return[t];var i=[],e=!1,o=this,n=function(s){if("object"==typeof s)return s.hasOwnProperty(t)?(i.push(t),void(e=!0)):void $.each(s,function(t,s){if(n(s[o.options.children]),e)return i.push(t),!1})};return $.each(this.options.data,function(t,s){if(n(s[o.options.children]),e)return i.push(t),!1}),i.reverse(),i},i}(Box),CityDefaultOptions=function(){function t(){this.id="id",this.name="name",this.children="children",this.line="-",this.auto=!0}return t}();!function(t){t.fn.city=function(t){return new City(this,t)}}(jQuery);