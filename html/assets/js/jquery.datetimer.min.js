var ZUtils,__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(t,i){function e(){this.constructor=t}n(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}}();!function(t){var i=(e.getRealMonth=function(t){return t.getMonth()+1},e.format=function(t,i){void 0===i&&(i="y年m月d日");var e={"y+":t.getFullYear(),"m+":this.getRealMonth(t),"d+":t.getDate(),"h+":t.getHours(),"i+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};for(var n in e)if(new RegExp("("+n+")").test(i)){var o=(""+e[n]).length;i=i.replace(RegExp.$1,1==RegExp.$1.length||RegExp.$1.length==o?e[n]:("00"+e[n]).substr((""+e[n]).length))}return i},e);function e(){}t.time=i}(ZUtils||(ZUtils={}));var Eve=function(){function t(){}return t.prototype.on=function(t,i){return this.options["on"+t]=i,this},t.prototype.hasEvent=function(t){return this.options.hasOwnProperty("on"+t)},t.prototype.trigger=function(t){for(var i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];var n,o="on"+t;if(this.hasEvent(t))return(n=this.options[o]).call.apply(n,[this].concat(i))},t}(),Box=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.showPosition=function(){return this.setPosition(),this.box.show(),this},i.prototype.setPosition=function(){var t=this.element.offset(),i=t.left,e=this.box.outerWidth(),n=$(window).scrollLeft()+$(window).width();n-e<i&&n<i+e&&(i=n-e);var o=this.box.outerHeight(),s=$(window).scrollTop(),r=$(window).height(),h=this.element.outerHeight(),a=t.top+h;return s+r<a+o&&t.top-o>s&&(a=t.top-o),this.box.css({left:i+"px",top:a+"px"}),this},i.getReal=function(t,i){return 1<i?i:t*i},i}(Eve),DateTimer=function(n){function o(t,i){var e=n.call(this)||this;return e.element=t,e._hasTime=!0,e.options=$.extend({},new DateTimerDefaultOptions,i),"object"!=typeof e.options.min&&(e.options.min=e._tD(e.options.min)),"object"!=typeof e.options.max&&(e.options.max=e._tD(e.options.max)),e.options.format.indexOf("h")<0&&(e._hasTime=!1),e.options.readonly&&e.element.prop("readonly",!0),e.createHtml(),e}return __extends(o,n),o.prototype._getMin=function(){var t=this._tD(this.options.min);if(t)return this._hasTime||t.setHours(23,59,59,99),t},o.prototype._getMax=function(){var t=this._tD(this.options.max);if(t)return this._hasTime||t.setHours(0,0,0,0),t},o.prototype.init=function(t){this.showDate(t),this.open(),this._refreshTime()},o.prototype.show=function(){return this.init(this.val()),this},o.prototype.hide=function(){return this.box.hide(),this},o.prototype.createHtml=function(){this.box=$('<div class="datetimer" data-type="datetimer"></div>');var t=this._nLi(60,0),i='<div class="header"><i class="fa fa-backward previousYear"></i><i class="fa fa-chevron-left previousMonth"></i><span></span><i class="fa fa-chevron-right nextMonth"></i><i class="fa fa-forward nextYear"></i></div><div class="body"><div class="month-grid"><ol><li>日</li><li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li>六</li></ol><ul>'+this._nLi(42,0,!1)+'</ul></div><div class="year-grid"><div class="list-group year"><div class="title">年</div><ul>'+this._nLi(this.options.maxYear+1,this.options.minYear)+'</ul></div><div class="list-group month"><div class="title">月</div><ul>'+this._nLi(13,1)+'</ul></div><i class="fa fa-close"></i></div>';this._hasTime&&(i+='<div class="day-grid"><div class="list-group hour"><div class="title">小时</div><ul>'+this._nLi(24)+'</ul></div><div class="list-group minute"><div class="title">分钟</div><ul>'+t+'</ul></div><div class="list-group second"><div class="title">秒钟</div><ul>'+t+'</ul></div><i class="fa fa-close"></i></div>'),i+="</div>",this._hasTime&&(i+='<div class="footer"><input type="text" class="hour" value="00">:<input type="text" class="minute" value="00">:<input type="text" class="second" value="00"><button>确定</button></div>'),this.box.html(i),$(document.body).append(this.box),this._yearBox=this.box.find(".body .year-grid .year ul"),this._monthBox=this.box.find(".body .year-grid .month ul"),this._yearGrid=this.box.find(".body .year-grid"),this._hasTime&&(this._dayGrid=this.box.find(".body .day-grid"),this._hourBox=this.box.find(".body .day-grid .hour ul"),this._minuteBox=this.box.find(".body .day-grid .minute ul"),this._secondBox=this.box.find(".body .day-grid .second ul")),this._bindEvent()},o.prototype._iTs=function(t){return t<10?"0"+t:t.toString()},o.prototype._nLi=function(t,i,e){void 0===i&&(i=0),void 0===e&&(e=!0);for(var n="";i<t;i++)n+=e?"<li>"+this._iTs(i)+"</li>":"<li></li>";return n},o.prototype.open=function(){"fixed"!=this.box.css("position")?this.showPosition():this.box.attr("style","").show()},o.prototype.getCurrentDate=function(){return this._currentDate?this._currentDate:this._currentDate=this._tD(this.box.data("date"))},o.prototype.getDateOrNull=function(){if(this._currentDate)return this._currentDate},o.prototype.previousYear=function(){this._changeYear(this.getCurrentDate().getFullYear()-1)},o.prototype.nextYear=function(){this._changeYear(this.getCurrentDate().getFullYear()+1)},o.prototype.previousMonth=function(){this._changeMonth(this.getCurrentDate().getMonth())},o.prototype.nextMonth=function(){this._changeMonth(this.getCurrentDate().getMonth()+2)},o.prototype.showDate=function(t,i){this._currentDate=this._tD(t,i),this._hasTime||this._currentDate.setHours(12,0,0,0),this.box.data("date",this._currentDate),this._refreshDay()},o.prototype._refreshYearList=function(){this.options.min instanceof o&&this.options.max instanceof o&&this._yearBox.html(this._nLi(this._getMax().getFullYear()+1,this._getMin().getFullYear()))},o.prototype._refreshYearGrid=function(){this._refreshYearList(),this._changeListGroup(this._yearBox,this._currentDate.getFullYear()-this._getMin().getFullYear()),this._changeListGroup(this._monthBox,this._currentDate.getMonth())},o.prototype._refreshDayGrid=function(){this._changeListGroup(this._hourBox,this._currentDate.getHours()),this._changeListGroup(this._minuteBox,this._currentDate.getMinutes()),this._changeListGroup(this._secondBox,this._currentDate.getSeconds())},o.prototype._changeListGroup=function(t,i){var e=t.find("li").eq(i);e.addClass("active").siblings().removeClass("active"),t.scrollTop(e.offset().top-t.offset().top+t.scrollTop()-t.height()/2)},o.prototype._changeYear=function(t){var i=this._currentDate.getMonth();this._currentDate.setFullYear(t),this._currentDate.getMonth()!=i&&this._currentDate.setDate(0),this._refreshDay(),this._changeListGroup(this._yearBox,t-this.options.minYear)},o.prototype._changeMonth=function(t){this._currentDate.setMonth(t-1),this._currentDate.getMonth()!=t-1&&this._currentDate.setDate(0),this._refreshDay(),this._changeListGroup(this._yearBox,this._currentDate.getFullYear()-this.options.minYear),this._changeListGroup(this._monthBox,this._currentDate.getMonth())},o.prototype._changeHour=function(t){this._currentDate.setHours(t),this.box.find(".footer .hour").val(this._iTs(t)),this._changeListGroup(this._hourBox,t)},o.prototype._changeMinute=function(t){this._currentDate.setMinutes(t),this.box.find(".footer .minute").val(this._iTs(t)),this._changeListGroup(this._minuteBox,t)},o.prototype._changeSecond=function(t){this._currentDate.setSeconds(t),this.box.find(".footer .second").val(this._iTs(t)),this._changeListGroup(this._secondBox,t)},o.prototype._refreshDay=function(){this.box.find(".header span").text(ZUtils.time.format(this._currentDate,this.options.title));var t=this._mLi(this._currentDate.getFullYear(),ZUtils.time.getRealMonth(this._currentDate)),n=this.box.find(".body .month-grid ul li");n.removeClass("active").removeClass("disable");var o=this,s=this._currentDate.getDate();t.forEach(function(t,i){var e=n.eq(i).text(o._iTs(t));i<t-10||t+10<i?e.addClass("disable"):t==s&&e.addClass("active")})},o.prototype._refreshTime=function(){this._hasTime&&(this._changeHour(this.getCurrentDate().getHours()),this._changeMinute(this.getCurrentDate().getMinutes()),this._changeSecond(this.getCurrentDate().getSeconds()))},o.prototype._mLi=function(t,i){var e,n=[],o=this._mD(t,i),s=o[0],r=o[1];if(0<s){var h=this._yD(t,i-1);for(e=h-s+1;e<=h;e++)n.push(e)}for(e=1;e<=r;e++)n.push(e);if(s+r<42){var a=41-s-r+1;for(e=1;e<=a;e++)n.push(e)}return n},o.prototype._bindEvent=function(){var i=this;this.box.find(".month-grid li").click(function(){i._clickDay($(this))}),this.box.find(".previousYear").click(function(){i.previousYear()}),this.box.find(".previousMonth").click(function(){i.previousMonth()}),this.box.find(".nextMonth").click(function(){i.nextMonth()}),this.box.find(".nextYear").click(function(){i.nextYear()}),this.box.find(".header span").click(function(){i._yearGrid.is(":hidden")?(i._hasTime&&i._dayGrid.hide(),i._yearGrid.show(),i._refreshYearGrid()):i._yearGrid.hide()}),this._yearBox.find("li").click(function(){i._changeYear(parseInt($(this).text()))}),this._monthBox.find("li").click(function(){i._changeMonth(parseInt($(this).text()))}),this._yearGrid.find(".fa-close").click(function(){i._yearGrid.hide()}),this._hasTime&&(this.box.find(".footer button").click(function(){i.output(!0)}),this.box.find(".footer input").click(function(){if(i._dayGrid.is(":hidden"))return i._yearGrid.hide(),i._dayGrid.show(),void i._refreshDayGrid();i._dayGrid.hide()}),this._hourBox.find("li").click(function(){i._changeHour(parseInt($(this).text()))}),this._minuteBox.find("li").click(function(){i._changeMinute(parseInt($(this).text()))}),this._secondBox.find("li").click(function(){i._changeSecond(parseInt($(this).text()))}),this._dayGrid.find(".fa-close").click(function(){i._dayGrid.hide()})),this.box.click(function(t){t.stopPropagation()}),this.element&&this.element.click(function(t){t.stopPropagation(),$("[data-type=datetimer]").hide(),i.init($(this).val())}),$(document).click(function(){i.options.autoHide&&i.box.hide()}),"object"==typeof this.options.min&&this.options.min instanceof o&&this.options.min.done(function(){i._currentDate&&!i.checkDate(i._currentDate)&&i.clear()}),"object"==typeof this.options.max&&this.options.max instanceof o&&this.options.max.done(function(){i._currentDate&&!i.checkDate(i._currentDate)&&i.clear()}),$.fn.swipe&&this.box.swipe({swipeLeft:function(){i.nextMonth()},swipeRight:function(){i.previousMonth()}})},o.prototype._clickDay=function(t){var i=parseInt(t.text()),e=new Date(this._currentDate.getTime());t.hasClass("disable")&&(i>t.index()?e.setMonth(e.getMonth()-1):e.setMonth(e.getMonth()+1)),e.setDate(i),0!=this.trigger("click",e,t)&&(this.checkDate(e)?(e.getMonth()==this._currentDate.getMonth()?(t.addClass("active").siblings().removeClass("active"),this._currentDate=e):this.showDate(e),this.output()):this.trigger("error",e))},o.prototype._yD=function(t,i){return new Date(t,i,0).getDate()},o.prototype._mD=function(t,i){var e=new Date(t,i,0),n=e.getDate();return e.setDate(1),[e.getDay(),n]},o.prototype.val=function(){return ZUtils.time.format(this.getCurrentDate(),this.options.format)},o.prototype.checkDate=function(t){var i=this._getMin();if(i&&t<=i)return!1;var e=this._getMax();return!e||t<e},o.prototype.clear=function(){this._currentDate=void 0,this.element.val("")},o.prototype.output=function(t){void 0===t&&(t=!1),this.checkDate(this.getCurrentDate())?0!=this.trigger("done")&&(this.element.val(this.val()),this._hasTime&&!t||this.box.hide()):this.trigger("error",this.getCurrentDate())},o.prototype._tD=function(t,i){if(!t)return new Date;if("object"==typeof t)return t instanceof o?t.getDateOrNull():t;if("number"==typeof t&&"number"==typeof i)return new Date(t,i-1,1);"string"==typeof t&&0<t.indexOf("-")&&t.replace("-","/");var e=new Date(t);return isNaN(e.getTime())?new Date:e},o.prototype.done=function(t){return this.on("done",t)},o}(Box),DateTimerDefaultOptions=function(){this.format="y-m-d h:i:s",this.min="1900/01/01 00:00:00",this.max="2099/12/31 23:59:59",this.title="y年m月",this.readonly=!1,this.minYear=1900,this.maxYear=2099,this.autoHide=!0};jQuery.fn.datetimer=function(t){return new DateTimer(this,t)};