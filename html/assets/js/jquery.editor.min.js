var EditorBlockType,__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var o,i=0,r=t.length;i<r;i++)!o&&i in t||((o=o||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(o||Array.prototype.slice.call(t))},EditorCodeComponent=function(){function e(){}return e.prototype.render=function(){return'<div class="editor-modal-box">\n        <div class="input-header-block">\n            <input type="text" name="language">\n            <label for="">代码语言</label>\n        </div>\n        <div class="input-header-block">\n            <textarea name="code" rows="10"></textarea>\n            <label for="">标题</label>\n        </div>\n        <div class="modal-action">\n            <div class="btn btn-outline-primary">插入</div>\n        </div>\n    </div>'},e.prototype.bindEvent=function(){var t=this;EditorHelper.modalInputBind(this.element,function(e){t.confirmFn&&t.confirmFn({value:e.code,language:e.language})})},e.prototype.modalReady=function(e,t,n){this.element||(this.element=$(this.render())),t.append(this.element),this.bindEvent()},e.prototype.open=function(e,t){this.element.addClass("modal-visible"),this.confirmFn=t},e}(),EditorColorComponent=function(){function e(){this.hY=0,this.x=0,this.y=0,this.hsv=[0,0,0],this.disabled=!1}return e.prototype.render=function(){return'<div class="editor-modal-box editor-color-modal">\n        <div class="editor-color-layer">\n            <div class="color-picker-sv">\n                <div class="color-picker-white"></div>\n                <div class="color-picker-black"></div>\n                <i></i>\n            </div>\n            <div class="color-picker-h">\n                <i></i>\n            </div>\n        </div>\n        <div class="input-header-block">\n            <input type="text" name="color">\n            <label for="">Hex</label>\n        </div>\n        <div class="modal-action">\n            <div class="btn btn-outline-primary">确认</div>\n        </div>\n    </div>'},e.prototype.bindEvent=function(){var t=this;this.element.on("touchstart",".color-picker-h",function(e){t.touchHStart(e)}).on("touchmove",".color-picker-h",function(e){t.touchHMove(e)}).on("click",".color-picker-h",function(e){t.tapHNotTouch(e)}).on("touchstart",".color-picker-sv",function(e){t.touchStart(e)}).on("touchmove",".color-picker-sv",function(e){t.touchMove(e)}).on("touchend",".color-picker-sv",function(e){t.touchEnd(e)}).on("click",".color-picker-sv",function(e){t.tapNotTouch(e)}),EditorHelper.modalInputBind(this.element,function(e){t.confirmFn&&t.confirmFn({value:e.color})})},e.prototype.modalReady=function(e,t,n){this.element||(this.element=$(this.render())),t.append(this.element),this.bindEvent(),this.triggerHStyle(),this.triggerSvStyle()},e.prototype.open=function(e,t){this.element.addClass("modal-visible"),this.confirmFn=t},e.prototype.triggerSvStyle=function(){this.element.find(".color-picker-sv i").css({left:this.x-5+"px",top:this.y-5+"px"})},e.prototype.triggerHStyle=function(){this.element.find(".color-picker-h i").css({top:this.hY-3+"px"})},e.prototype.tapNotTouch=function(e){var t,n;this.disabled||"ontouchstart"in document.documentElement||(t=e.clientX+document.body.scrollLeft,n=e.clientY+document.body.scrollTop,this.touchMove({target:e.target,targetTouches:[{clientX:t,clientY:n}]}),this.triggerChange())},e.prototype.tapHNotTouch=function(e){var t,n;this.disabled||"ontouchstart"in document.documentElement||(t=e.clientX+document.body.scrollLeft,n=e.clientY+document.body.scrollTop,this.touchHMove({target:e.target,targetTouches:[{clientX:t,clientY:n}]}))},e.prototype.touchStart=function(e){this.disabled||this.doColor(e)},e.prototype.touchMove=function(e){this.disabled||this.doColor(e)},e.prototype.touchEnd=function(e){this.disabled||this.triggerChange()},e.prototype.touchHStart=function(e){this.disabled||this.doH(e)},e.prototype.touchHMove=function(e){this.disabled||this.doH(e)},e.prototype.applyColor=function(e){this.hsv=this.parse(e),this.hY=this.clamp(160-160*this.hsv[0],0,160),this.setBackground(this.hsv[0]),this.x=this.clamp(160*this.hsv[1],0,160),this.y=this.clamp(160-160*this.hsv[2],0,160),this.triggerHStyle(),this.triggerSvStyle()},e.prototype.setBackground=function(e){this.hsv[0]=e;e=this.HSV2RGB([e,1,1]);this.element.find(".color-picker-sv").css("background-color","rgb("+e.join(",")+")")},e.prototype.triggerChange=function(){this.element.find("input").val("#"+this.HSV2HEX(this.hsv)).trigger("change")},e.prototype.doColor=function(e){var t=e.target.getBoundingClientRect();this.y=this.clamp(e.targetTouches[0].clientY-t.top,0,t.height),this.x=this.clamp(e.targetTouches[0].clientX-t.left,0,t.width),this.hsv[1]=this.x/t.width,this.hsv[2]=(t.height-this.y)/t.height,this.triggerChange(),this.triggerSvStyle()},e.prototype.doH=function(e){var t=e.target.getBoundingClientRect();this.hY=this.clamp(e.targetTouches[0].clientY-t.top,0,t.height),this.setBackground(t.height-this.hY/t.height),this.triggerChange(),this.triggerHStyle()},e.prototype.clamp=function(e,t,n){return n<e?n:e<t?t:e},e.prototype.parse=function(e){var t,n;return"object"==typeof e?e:(t=/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i.exec(e),n=/\s*hsv\s*\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)\s*$/i.exec(e),"#"===e[0]&&e.match(/^#([\da-f]{3}|[\da-f]{6})$/i)?this.HEX2HSV(e.slice(1)):n?this._2HSV_pri([+n[1],+n[2],+n[3]]):t?this.RGB2HSV([+t[1],+t[2],+t[3]]):[0,1,1])},e.prototype.HSV2RGB=function(e){var t=+e[0],n=+e[1],o=+e[2],i=0,r=0,a=0,e=Math.floor(6*t),t=6*t-e,s=o*(1-n),l=o*(1-t*n)||0,d=o*(1-(1-t)*n)||0;switch((e||0)%6){case 0:i=o,r=d,a=s;break;case 1:i=l,r=o,a=s;break;case 2:i=s,r=o,a=d;break;case 3:i=s,r=l,a=o;break;case 4:i=d,r=s,a=o;break;case 5:i=o,r=s,a=l}return[this.round(255*i),this.round(255*r),this.round(255*a)]},e.prototype.HSV2HEX=function(e){return this.RGB2HEX(this.HSV2RGB(e))},e.prototype.RGB2HSV=function(e){var t=+e[0],n=+e[1],o=+e[2],e=Math.max(t,n,o),i=Math.min(t,n,o),r=e-i,a=0,s=0===e?0:r/e,l=e/255;switch(e){case i:a=0;break;case t:a=n-o+r*(n<o?6:0),a/=6*r;break;case n:a=o-t+2*r,a/=6*r;break;case o:a=t-n+4*r,a/=6*r}return[a,s,l]},e.prototype.RGB2HEX=function(e){return("000000"+(+e[2]|+e[1]<<8|+e[0]<<16).toString(16)).slice(-6)},e.prototype.HEX2HSV=function(e){return this.RGB2HSV(this.HEX2RGB(e))},e.prototype.HEX2RGB=function(e){return 3===e.length&&(e=e.replace(/./g,"$&$&")),[this.num(e[0]+e[1],16),this.num(e[2]+e[3],16),this.num(e[4]+e[5],16)]},e.prototype._2HSV_pri=function(e){return[+e[0]/360,+e[1]/100,+e[2]/100]},e.prototype._2HSV_pub=function(e){return[this.round(360*+e[0]),this.round(100*+e[1]),this.round(100*+e[2])]},e.prototype._2RGB_pri=function(e){return[+e[0]/255,+e[1]/255,+e[2]/255]},e.prototype.num=function(e,t){return void 0===t&&(t=10),parseInt(e,t||10)},e.prototype.round=function(e){return Math.round(e)},e}(),EditorFontItems=[{name:"Arial",value:"Arial,Helvetica,sans-serif"},{name:"Georgia",value:"Georgia,serif"},{name:"Impact",value:"Impact,Charcoal,sans-serif"},{name:"微软雅黑",value:"微软雅黑,sans-serif"},{name:"宋体",value:"serif"},{name:"黑体",value:"sans-serif"}],EditorDropdownComponent=function(){function e(e){this.isNodeTag=e=void 0===e?!1:e,this.items=[]}return e.prototype.render=function(){return'<div class="editor-modal-box editor-dropdown-modal"></div>'},e.prototype.renderItems=function(e){void 0===e&&(e=!1);for(var t="",n=0,o=this.items;n<o.length;n++){var i=o[n];t+=this.renderItem(i,e?i.value:"li")}var r=e?"div":"ul";return"<".concat(r,' class="option-bar">').concat(t,"</").concat(r,">")},e.prototype.renderItem=function(e,t){return"<".concat(t=void 0===t?"li":t,' class="option-item" style="').concat(EditorHelper.nodeStyle(e.style),'">').concat(e.name,"</").concat(t,">")},e.prototype.modalReady=function(e,t,n){if(this.element||(this.element=$(this.render())),t.append(this.element),this.bindEvent(),"font"===e.name)this.items=EditorFontItems.map(function(e){return e.style={"font-family":e.value},e});else if("fontsize"===e.name){for(var o=[],i=7,r=1,a=0;a<16;a++){0<a&&a%3==0&&(r*=2);var s=i+r;o.push({name:s,value:s}),i=s}this.items=o}else if("head"===e.name){for(o=[],a=1;a<7;a++){s="h".concat(a);o.push({name:s,value:s})}this.items=o}this.element.html(this.renderItems(this.isNodeTag))},e.prototype.bindEvent=function(){var t=this;this.element.on("click",".option-item",function(){var e=$(this);e.addClass("selected").siblings().removeClass("selected"),t.tapConfirm(t.items[e.index()])})},e.prototype.open=function(e,t,n){this.element.css(n?{left:n.x+"px",top:n.y+"px"}:{}),this.element.addClass("modal-visible"),this.confirmFn=t},e.prototype.tapConfirm=function(e){this.confirmFn&&this.confirmFn({value:e.value})},e}(),EditorFileComponent=function(){function e(){}return e.prototype.render=function(){return'<div class="editor-modal-box">\n        <label class="drag-input" for="editor-modal-file">\n            拖放文件\n            <p>(或点击)</p>\n            <input type="file" id="editor-modal-file">\n        </label>\n        <div class="loading-ring">\n            <span></span>\n            <span></span>\n            <span></span>\n            <span></span>\n            <span></span>\n        </div>\n    </div>'},e.prototype.bindEvent=function(){EditorHelper.modalFileUpload(this.element,this.uploadFiles.bind(this))},e.prototype.modalReady=function(e,t,n){this.element||(this.element=$(this.render())),t.append(this.element),this.bindEvent(),this.option=n},e.prototype.open=function(e,t){this.element.addClass("modal-visible"),this.confirmFn=t},e.prototype.uploadFiles=function(e){var t=this;this.element.hasClass("editor-modal-loading")||e.length<1||(this.element.addClass("editor-modal-loading"),this.option.upload(e[0],"file",function(e){t.element.removeClass("editor-modal-loading"),t.tapConfirm(e.url,e.title,e.size)},function(){t.element.removeClass("editor-modal-loading")}))},e.prototype.tapConfirm=function(e,t,n){this.confirmFn&&this.confirmFn({value:e,title:t,size:n})},e}(),EditorImageComponent=function(){function e(){}return e.prototype.render=function(){return'<div class="editor-modal-box">\n        <div class="tab-bar">\n            <a class="item" title="上传">\n                <i class="fa fa-upload"></i>\n            </a>\n            <a class="item active" title="链接">\n                <i class="fa fa-link"></i>\n            </a>\n            <a class="item" title="在线图库">\n                <i class="fa fa-folder-open"></i>\n            </a>\n        </div>\n        <div class="tab-body-item">\n            <label class="drag-input" for="editor-modal-image">\n                拖放文件\n                <p>(或点击)</p>\n                <input type="file" id="editor-modal-image" accept="image/*">\n            </label>\n        </div>\n        <div class="tab-body-item active">\n            <div class="input-header-block">\n                <input type="text" name="url">\n                <label for="">链接</label>\n            </div>\n            <div class="modal-action">\n                <div class="btn btn-outline-primary">插入</div>\n            </div>\n        </div>\n        <div class="loading-ring">\n            <span></span>\n            <span></span>\n            <span></span>\n            <span></span>\n            <span></span>\n        </div>\n    </div>'},e.prototype.bindEvent=function(){var t=this,e=this;this.element.on("click",".tab-bar .item",function(){var t=$(this);t.addClass("active").siblings().removeClass("active"),e.element.find(".tab-body-item").each(function(e){$(this).toggleClass("active",t.index()===e)})}),EditorHelper.modalFileUpload(this.element,this.uploadFiles.bind(this)),EditorHelper.modalInputBind(this.element,function(e){t.output({value:e.url})})},e.prototype.modalReady=function(e,t,n){this.element||(this.element=$(this.render())),t.append(this.element),this.bindEvent(),this.option=n},e.prototype.open=function(e,t){this.element.addClass("modal-visible"),this.confirmFn=t},e.prototype.uploadFiles=function(e){var t=this;this.element.hasClass("editor-modal-loading")||e.length<1||(this.element.addClass("editor-modal-loading"),this.option.upload(e[0],"image",function(e){t.element.removeClass("editor-modal-loading"),t.output({value:e.url,title:e.title})},function(){t.element.removeClass("editor-modal-loading")}))},e.prototype.output=function(e){this.confirmFn&&this.confirmFn(e)},e}(),EditorLinkComponent=function(){function e(){}return e.prototype.render=function(){return'<div class="editor-modal-box">\n        <div class="input-header-block">\n            <input type="url" name="url">\n            <label for="">网址</label>\n        </div>\n        <div class="input-header-block">\n            <input type="text" name="title">\n            <label for="">标题</label>\n        </div>\n        <div class="input-flex-line">\n            <i class="fa check-input fa-square" name="is_blank"></i>\n            在新标签页打开\n        </div>\n        <div class="modal-action">\n            <div class="btn btn-outline-primary">插入</div>\n        </div>\n    </div>'},e.prototype.bindEvent=function(){var t=this;EditorHelper.modalInputBind(this.element,function(e){t.confirmFn&&t.confirmFn({value:e.url,title:e.title,target:e.is_blank})})},e.prototype.modalReady=function(e,t,n){this.element||(this.element=$(this.render())),t.append(this.element),this.bindEvent()},e.prototype.open=function(e,t){this.element.addClass("modal-visible"),this.confirmFn=t},e}(),EditorResizerComponent=function(){function e(){this.toolType=0,this.mouseMoveListeners={move:void 0,finish:void 0}}return e.prototype.render=function(){return'<div class="editor-resizer-modal">\n        <div class="selection-container">\n            <div class="rotate-icon">\n                <i class="iconfont icon-refresh"></i>\n            </div>\n            <div class="eight-corner">\n                <div class="cursor lt"></div>\n                <div class="cursor t"></div>\n                <div class="cursor rt"></div>\n                <div class="cursor r"></div>\n                <div class="cursor rb"></div>\n                <div class="cursor b"></div>\n                <div class="cursor lb"></div>\n                <div class="cursor l"></div>\n            </div>\n        </div>\n        <div class="horizontal-bar"></div>\n        <div class="vertical-bar"></div>\n    </div>'},e.prototype.triggerBoxStyle=function(){this.element.find(".selection-container").css(1!==this.toolType?{display:"none"}:{display:"block",left:this.rectBound.x+"px",top:this.rectBound.y+"px",width:this.rectBound.width+"px",height:this.rectBound.height+"px"})},e.prototype.triggerHorizontalStyle=function(){this.element.find(".horizontal-bar").css(2!==this.toolType?{display:"none"}:{display:"block",left:this.rectBound.x+"px",top:this.rectBound.y+"px",height:this.rectBound.height+"px"})},e.prototype.triggerVerticalStyle=function(){this.element.find(".vertical-bar").css(3!==this.toolType?{display:"none"}:{display:"block",left:this.rectBound.x+"px",top:this.rectBound.y+"px",width:this.rectBound.width+"px"})},e.prototype.bindEvent=function(){var n=this,o=[this.onMoveLt,this.onMoveT,this.onMoveRt,this.onMoveR,this.onMoveRb,this.onMoveB,this.onMoveLb,this.onMoveL];this.element.on("mousedown",".eight-corner .cursor",function(e){var t=o[$(this).index()];t&&t.call(n,e)}),$(document).on("mousemove",this.docMouseMove.bind(this)).on("mouseup",this.docMouseUp.bind(this))},e.prototype.docMouseMove=function(e){this.mouseMoveListeners.move&&this.mouseMoveListeners.move({x:e.clientX,y:e.clientY})},e.prototype.docMouseUp=function(e){this.mouseMoveListeners.finish&&this.mouseMoveListeners.finish({x:e.clientX,y:e.clientY})},e.prototype.ready=function(e){this.element||(this.element=$(this.render())),e.append(this.element),this.bindEvent()},e.prototype.openResize=function(e,t){this.rectBound=e,this.toggleType(1),this.updatedHandler=t},e.prototype.openHorizontalResize=function(e,t){this.rectBound=e,this.toggleType(2),this.updatedHandler=t,this.mouseMove(void 0,function(e,t,n){return __assign(__assign({},e),{x:e.x+t})})},e.prototype.openVerticalResize=function(e,t){this.rectBound=e,this.toggleType(3),this.updatedHandler=t,this.mouseMove(void 0,function(e,t,n){return __assign(__assign({},e),{y:e.y+n})})},e.prototype.close=function(){this.toggleType(0)},e.prototype.toggleType=function(e){var t;this.toolType!==(e=void 0===e?0:e)&&(t=this.toolType,this.toolType=e,this.updateStyle(t),this.updateStyle(e))},e.prototype.updateStyle=function(e){1===(e=void 0===e?this.toolType:e)?this.triggerBoxStyle():2===e?this.triggerHorizontalStyle():3===e&&this.triggerVerticalStyle()},e.prototype.onMoveLt=function(e){this.mouseMove(e,function(e,t,n){return{x:e.x+t,y:e.y+n,width:e.width-t,height:e.height-n}})},e.prototype.onMoveT=function(e){this.mouseMove(e,function(e,t,n){return __assign(__assign({},e),{y:e.y+n,height:e.height-n})})},e.prototype.onMoveRt=function(e){this.mouseMove(e,function(e,t,n){return __assign(__assign({},e),{y:e.y+n,height:e.height-n,width:e.width+t})})},e.prototype.onMoveR=function(e){this.mouseMove(e,function(e,t,n){return __assign(__assign({},e),{width:e.width+t})})},e.prototype.onMoveRb=function(e){this.mouseMove(e,function(e,t,n){return __assign(__assign({},e),{height:e.height+n,width:e.width+t})})},e.prototype.onMoveB=function(e){this.mouseMove(e,function(e,t,n){return __assign(__assign({},e),{height:e.height+n})})},e.prototype.onMoveLb=function(e){this.mouseMove(e,function(e,t,n){return __assign(__assign({},e),{x:e.x+t,width:e.width-t,height:e.height+n})})},e.prototype.onMoveL=function(e){this.mouseMove(e,function(e,t,n){return __assign(__assign({},e),{x:e.x+t,width:e.width-t})})},e.prototype.mouseMove=function(e,o){var i,r=this;this.toolType<1||(e&&(e.stopPropagation(),i={x:e.clientX,y:e.clientY}),this.onMouseMove(function(e){var t,n;i=i?(t=e.x-i.x,n=e.y-i.y,r.rectBound=o(r.rectBound,t,n),r.updateStyle(),e):{x:e.x,y:e.y}},function(e){var t=r.toolType;r.toggleType(0),r.updatedHandler&&(1===t?r.updatedHandler(__assign({type:EditorBlockType.NodeResize},r.rectBound)):2!==t&&3!==t||r.updatedHandler(__assign({type:EditorBlockType.NodeMove},r.rectBound)))}))},e.prototype.onMouseMove=function(e,t){var n=this;this.mouseMoveListeners={move:e,finish:e||t?function(e){n.mouseMoveListeners={move:void 0,finish:void 0},t&&t(e)}:void 0}},e}(),EditorSizeComponent=function(){function e(){}return e.prototype.render=function(){return'<div class="editor-modal-box">\n        <div class="tab-bar">\n            <a class="item">\n                <i class="fa fa-arrow-left"></i>\n            </a>\n        </div>\n        <div class="input-flex-group">\n            <div class="input-header-block">\n                <input type="text" name="width">\n                <label for="">宽</label>\n            </div>\n            <div class="input-header-block">\n                <input type="text" name="height">\n                <label for="">高</label>\n            </div>\n        </div>\n        <div class="modal-action">\n            <div class="btn btn-outline-primary">更新</div>\n        </div>\n    </div>'},e.prototype.bindEvent=function(){var t=this;EditorHelper.modalInputBind(this.element,function(e){t.confirmFn&&t.confirmFn({height:e.height,width:e.width})})},e.prototype.modalReady=function(e,t,n){this.element||(this.element=$(this.render())),t.append(this.element),this.bindEvent()},e.prototype.open=function(e,t){this.element.addClass("modal-visible"),this.confirmFn=t},e}(),EditorTableComponent=function(){function e(){}return e.prototype.render=function(){return'<div class="editor-modal-box editor-table-modal"><div class="table-grid"></div></div>'},e.prototype.renderTableRow=function(e){void 0===e&&(e=10);for(var t="",n=0;n<e;n++)t+='<span class="table-cell"></span>';return'<div class="table-row">'.concat(t,"</div>")},e.prototype.renderTable=function(e,t){void 0===t&&(t=10);for(var n="",o=0;o<e;o++)n+=this.renderTableRow(t);this.element.find(".table-grid").html(n)},e.prototype.bindEvent=function(){var l=this;this.element.on("mouseover",".table-cell",function(){for(var e=$(this),t=e.index(),e=e.parent(),n=e.index(),o=e[0].parentNode,i=0;i<o.children.length;i++)for(var r=o.children[i],a=0;a<r.children.length;a++){var s=r.children[a];$(s).toggleClass("active",i<=n&&a<=t)}n<o.children.length-1||9<=n||$(o).append(l.renderTableRow())}).on("click",".table-cell",function(){var e=$(this);l.confirmFn&&l.confirmFn({row:e.parent().index()+1,column:e.index()+1})})},e.prototype.modalReady=function(e,t,n){this.element||(this.element=$(this.render())),t.append(this.element),this.bindEvent()},e.prototype.open=function(e,t){this.renderTable(2,10),this.element.addClass("modal-visible"),this.confirmFn=t},e}(),EditorTextComponent=function(){function e(e){this.label=e=void 0===e?"文字":e}return e.prototype.render=function(){return'<div class="editor-modal-box">\n        <div class="tab-bar">\n            <a class="item">\n                <i class="fa fa-arrow-left"></i>\n            </a>\n        </div>\n        <div class="input-header-block">\n            <input type="text" name="value">\n            <label for="">'.concat(this.label,'</label>\n        </div>\n        <div class="modal-action">\n            <div class="btn btn-outline-primary">更新</div>\n        </div>\n    </div>')},e.prototype.bindEvent=function(){var t=this;EditorHelper.modalInputBind(this.element,function(e){t.confirmFn&&t.confirmFn({value:e.value})})},e.prototype.modalReady=function(e,t,n){this.element||(this.element=$(this.render())),t.append(this.element),this.bindEvent()},e.prototype.open=function(e,t){this.element.addClass("modal-visible"),this.confirmFn=t},e}(),EditorVideoComponent=function(){function e(){}return e.prototype.render=function(){return'<div class="editor-modal-box">\n        <div class="tab-bar">\n            <a class="item active" title="链接">\n                <i class="fa fa-link"></i>\n            </a>\n            <a class="item" title="代码">\n                <i class="fa fa-code"></i>\n            </a>\n            <a class="item" title="上传">\n                <i class="fa fa-upload"></i>\n            </a>\n        </div>\n        <div class="tab-body-item active">\n            <div class="input-header-block">\n                <input type="text" name="url">\n                <label for="">链接</label>\n            </div>\n            <div class="input-flex-line">\n                <i class="fa fa-square check-input" name="auto_play"></i>\n                自动播放\n            </div>\n            <div class="modal-action">\n                <div class="btn btn-outline-primary">插入</div>\n            </div>\n        </div>\n        <div class="tab-body-item">\n            <div class="input-header-block">\n                <textarea name="code" rows="4"></textarea>\n                <label for="">代码</label>\n            </div>\n            <div class="modal-action">\n                <div class="btn btn-outline-primary">插入</div>\n            </div>\n        </div>\n        <div class="tab-body-item">\n            <label class="drag-input" for="editor-modal-video">\n                拖放文件\n                <p>(或点击)</p>\n                <input type="file" id="editor-modal-video" accept="video/*">\n            </label>\n        </div>\n\n        <div class="loading-ring">\n            <span></span>\n            <span></span>\n            <span></span>\n            <span></span>\n            <span></span>\n        </div>\n    </div>'},e.prototype.bindEvent=function(){var n=this,e=this;this.element.on("click",".tab-bar .item",function(){var t=$(this);t.addClass("active").siblings().removeClass("active"),e.element.find(".tab-body-item").each(function(e){$(this).toggleClass("active",t.index()===e)})}),EditorHelper.modalFileUpload(this.element,this.uploadFiles.bind(this)),EditorHelper.modalInputBind(this.element,function(e){var t;n.confirmFn&&(t=n.element.find(".tab-bar .active").index(),n.confirmFn(2===t?{code:e.code}:{value:e.url,autoplay:e.auto_play}))})},e.prototype.modalReady=function(e,t,n){this.element||(this.element=$(this.render())),t.append(this.element),this.bindEvent(),this.option=n},e.prototype.open=function(e,t){this.element.addClass("modal-visible"),this.confirmFn=t},e.prototype.uploadFile=function(e){e=e.target.files;this.uploadFiles(e)},e.prototype.uploadFiles=function(e){var t=this;this.element.hasClass("editor-modal-loading")||e.length<1||(this.element.addClass("editor-modal-loading"),this.option.upload(e[0],"video",function(e){t.element.removeClass("editor-modal-loading"),t.confirmFn&&t.confirmFn({value:e.url})},function(){t.element.removeClass("editor-modal-loading")}))},e}(),CodeElement=function(){function e(e,t){this.element=e,this.container=t,this.isComposition=!1,this.init(),this.bindEvent()}return Object.defineProperty(e.prototype,"selection",{get:function(){var e=window.getSelection().getRangeAt(0);return{start:e.startOffset,end:e.endOffset,range:e.cloneRange()}},set:function(e){var t,n=window.getSelection();e.range?t=e.range:((t=n.getRangeAt(0)).deleteContents(),(t=t.cloneRange()).setStart(this.bodyPanel,e.start),t.setEnd(this.bodyPanel,e.end)),n.removeAllRanges(),n.addRange(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectedValue",{get:function(){return""},set:function(e){var t=this.selection.range;this.addTextExecute(t,{value:e})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){var t=[];return this.eachLine(function(e){t.push(e.textContent.replace("\n",""))}),t.join("\n")},set:function(e){var t=this;this.bodyPanel.innerHTML="",e.split("\n").forEach(function(e){t.addLine(e)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.value.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wordLength",{get:function(){return EditorHelper.wordLength(this.value)},enumerable:!1,configurable:!0}),e.prototype.selectAll=function(){var e=window.getSelection(),t=document.createRange();t.selectNodeContents(this.bodyPanel),e.removeAllRanges(),e.addRange(t)},e.prototype.insert=function(e,t){t=t||this.selection;var n=this[(e.type===EditorBlockType.AddRaw?EditorBlockType.AddText:e.type)+"Execute"];if("function"!=typeof n)throw new Error("insert type error:[".concat(e.type,"]"));n.call(this,t.range,e)},e.prototype.focus=function(){this.bodyPanel.focus({preventScroll:!0})},e.prototype.blur=function(){return this.bodyPanel.blur()},e.prototype.destroy=function(){},e.prototype.init=function(){this.linePanel=document.createElement("div"),this.linePanel.className="editor-line-numbers",this.bodyPanel=document.createElement("div"),this.bodyPanel.className="editor-content",this.bodyPanel.contentEditable="true",this.bodyPanel.spellcheck=!1,this.element.appendChild(this.linePanel),this.element.appendChild(this.bodyPanel),this.addLine()},e.prototype.bindResize=function(){var i=this,r=0,e=new ResizeObserver(function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];o.contentRect.height!==r&&(0===r&&i.updateLineNoStyle(),r=o.contentRect.height)}});e.observe(this.element),this.container.on(EDITOR_EVENT_EDITOR_DESTORY,function(){e.disconnect()})},e.prototype.bindEvent=function(){var t=this;this.bindResize(),this.bodyPanel.addEventListener("keydown",function(e){t.container.saveSelection(),t.container.emit(EDITOR_EVENT_INPUT_KEYDOWN,e)}),this.bodyPanel.addEventListener("keyup",function(e){t.isComposition||(t.selectRangeLine(t.selection.range),t.container.emit(EDITOR_EVENT_EDITOR_CHANGE),"Backspace"===e.key&&t.updateLineCount())}),this.element.addEventListener("mouseup",function(){t.container.saveSelection(),t.selectRangeLine(t.selection.range)}),this.element.addEventListener("paste",function(e){e.preventDefault(),t.paste(e.clipboardData||window.clipboardData)}),this.bodyPanel.addEventListener("compositionstart",function(){t.isComposition=!0}),this.bodyPanel.addEventListener("compositionend",function(){t.isComposition=!1,t.container.saveSelection(),t.container.emit(EDITOR_EVENT_SELECTION_CHANGE),t.container.emit(EDITOR_EVENT_EDITOR_CHANGE)})},e.prototype.paste=function(e){e=e.getData("text");e&&this.insert({type:EditorBlockType.AddText,value:e})},e.prototype.addTextExecute=function(e,t){var n=this.getRangeLineNo(e),o=n[0],n=n[1],t=t.value.split("\n");t[0]=this.getLinePrevious(e)+t[0],t[t.length-1]+=this.getLineNext(e),this.insertLines.apply(this,__spreadArray([o,n],t,!1))},e.prototype.addLineBreakExecute=function(e){var t=this.getRangeLineNo(e),n=t[0],t=t[1];this.insertLines(n,t,this.getLinePrevious(e),this.getLineNext(e))},e.prototype.indentExecute=function(e){this.replaceSelectLine(function(e){return"    "+e},e)},e.prototype.outdentExecute=function(e){this.replaceSelectLine(function(e){if(e.length<1)return e;switch(e.charCodeAt(0)){case 9:return e.substring(1);case 32:return e.replace(/^\s{1,4}/,"");default:return e}},e)},e.prototype.replaceSelectLine=function(e,t){for(var t=this.getRangeLineNo(t),n=t[0],o=t[1],i=n;i<=o;i++){var r=this.bodyPanel.children[i-1];this.renderLine(r,e(r.textContent))}},e.prototype.getLinePrevious=function(e){var t=[];return this.eachLinePrevious(e,function(e){t.push(e)}),t.reverse().join("")},e.prototype.getLineNext=function(e){var t=[];return this.eachLineNext(e,function(e){t.push(e)}),t.join("")},e.prototype.eachLinePrevious=function(e,t){if(e.startContainer!==this.bodyPanel&&!(e.startContainer instanceof HTMLDivElement)){0<e.startOffset&&t(e.startContainer.textContent.substring(0,e.startOffset));for(var n=e.startContainer;;)if(n.previousSibling)t((n=n.previousSibling).textContent);else{if(n.parentNode instanceof HTMLDivElement)break;n=n.parentNode}}},e.prototype.eachLineNext=function(e,t){if(e.endContainer!==this.bodyPanel&&!(e.endContainer instanceof HTMLDivElement))for(var n=e.endContainer,o=(t(0<e.endOffset?n.textContent.substring(e.endOffset):n.textContent),e.endContainer);;)if(o.nextSibling){if(o.nextSibling instanceof HTMLBRElement)break;t((o=o.nextSibling).textContent)}else{if(o.parentNode instanceof HTMLDivElement)break;o=o.parentNode}},e.prototype.getRangeLineNo=function(e){var t=this.findLine(e.startContainer),n=this.getLineNo(t),o=n;return e.startContainer!==e.endContainer&&t!==(t=this.findLine(e.endContainer))&&(o=this.getLineNo(t)),[Math.max(n,1),Math.max(o,1)]},e.prototype.getLineNo=function(e){if(!e||e===this.element)return 1;for(var t=0;t<this.bodyPanel.children.length;t++)if(this.bodyPanel.children[t]===e)return t+1;return-1},e.prototype.findLine=function(e){for(;!(e instanceof HTMLDivElement);){if(e===this.bodyPanel)return;e=e.parentNode}return e},e.prototype.removeLine=function(e){e-=1;this.bodyPanel.children.length>e&&this.bodyPanel.removeChild(this.bodyPanel.children[e]),this.linePanel.children.length>e&&this.linePanel.removeChild(this.linePanel.children[e])},e.prototype.insertLines=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];for(var i=this.bodyPanel.children.length,r=0,a=0;a<n.length;a++)(r=e+a)<=i&&r<=t?this.updateLine(r,n[a]):i<r?this.addLine(n[a]):this.beforeLine(r,n[a]);for(a=t;r<a;a--)this.removeLine(a);this.updateLineNo();var s=e+n.length-1;s>this.bodyPanel.children.length||(this.selectNode(this.bodyPanel.children[s-1].firstChild,0),this.selectLine(s))},e.prototype.selectLine=function(){for(var o=this,i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];this.eachLine(function(e,t,n){n=0<=i.indexOf(n);o.toggleClass(e,"editor-line-active",n),o.toggleClass(t,"editor-line-active",n)})},e.prototype.selectRangeLine=function(e){var o=this,e=this.getRangeLineNo(e),i=e[0],r=e[1];this.eachLine(function(e,t,n){n=i<=n&&n<=r;t.style.height=EditorHelper.height(e)+"px",o.toggleClass(e,"editor-line-active",n),o.toggleClass(t,"editor-line-active",n)})},e.prototype.updateLineCount=function(){for(var e=Math.max(5,this.bodyPanel.children.length),t=this.linePanel.children.length-1;e<=t;t--)this.linePanel.removeChild(this.linePanel.children[t])},e.prototype.updateLineNoStyle=function(){for(var e=0,t=0;t<this.bodyPanel.children.length;t++){var n=this.bodyPanel.children[t];0<(a=EditorHelper.height(n))&&(0===e||a<e)&&(e=a)}if(!(e<=0))for(var o=Math.max(this.bodyPanel.children.length,this.linePanel.children.length),t=0;t<o;t++){var i=this.bodyPanel.children.length>t?this.bodyPanel.children[t]:void 0,r=(r=this.linePanel.children.length>t?this.linePanel.children[t]:void 0)||this.createLineNo(t+1),a=i?EditorHelper.height(i):0;r.style.height=(e<a?a:e)+"px"}},e.prototype.toggleClass=function(e,t,n){(n=void 0===n?!e.classList.contains(t):n)?e.classList.add(t):e.classList.remove(t)},e.prototype.selectNode=function(e,t){void 0===t&&(t=0);var n=window.getSelection(),o=n.getRangeAt(0);o.deleteContents(),(o=o.cloneRange()).setStart(e,t),o.setEnd(e,t),n.removeAllRanges(),n.addRange(o)},e.prototype.addLines=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,o=e;n<o.length;n++)this.addLine(o[n])},e.prototype.beforeLine=function(e,t){t=this.createLine(t);this.bodyPanel.insertBefore(t,this.bodyPanel.children[e-1]),this.linePanel.children.length>=this.bodyPanel.children.length||this.linePanel.insertBefore(this.createLineNo(e,t),this.linePanel.children[e-1])},e.prototype.addLine=function(e){var t=this.bodyPanel.children.length+1,e=this.createLine(e);this.bodyPanel.appendChild(e),this.linePanel.children.length>=this.bodyPanel.children.length?this.updateLine(t):this.linePanel.appendChild(this.createLineNo(t,e))},e.prototype.createLineNo=function(e,t){var n=document.createElement("div");return n.className="editor-line-no",n.textContent=e.toString(),t&&(n.style.height=EditorHelper.height(t)+"px"),n},e.prototype.createLine=function(e){var t=document.createElement("div");return t.className="editor-line",this.renderLine(t,e),this.appendBr(t),t},e.prototype.updateLine=function(e,t){var e=e-1,n=this.bodyPanel.children[e];void 0!==t&&this.renderLine(n,t),this.linePanel.children[e].style.height=EditorHelper.height(n)+"px"},e.prototype.updateLineNo=function(e){for(void 0===e&&(e=1);e<=this.linePanel.children.length;e++)this.linePanel.children[e-1].textContent=e.toString()},e.prototype.renderLine=function(e,t){void 0!==t&&(e.innerText=t,this.appendBr(e))},e.prototype.appendBr=function(e){0<e.childNodes.length&&"BR"===e.childNodes[e.childNodes.length-1].nodeName||e.appendChild(document.createElement("br"))},e.prototype.eachLine=function(e){for(var t=0;t<this.bodyPanel.children.length;t++)if(!1===e(this.bodyPanel.children[t],this.linePanel.children[t],t+1))break},e}(),EditorContainer=function(){function e(e){void 0===e&&(e=new EditorOptionManager),this.option=e,this.undoStack=[],this.asyncTimer=0,this.listeners={}}return e.prototype.ready=function(e){var n=this;e instanceof HTMLDivElement?this.element=new DivElement(e,this):e instanceof HTMLTextAreaElement?this.element=new TextareaElement(e,this):this.element=e,this.element&&(this.on(EDITOR_EVENT_INPUT_KEYDOWN,function(e){var t=[],t=(e.ctrlKey&&t.push("Ctrl"),e.shiftKey&&t.push("Shift"),e.altKey&&t.push("Alt"),e.metaKey&&t.push("Meta"),"Control"!==e.key&&t.indexOf(e.key)<0&&t.push(1===e.key.length?e.key.toUpperCase():e.key),n.option.hotKeyModule(t.join("+")));t?(e.preventDefault(),n.execute(t)):"Enter"===e.key?(e.preventDefault(),n.insert({type:EditorBlockType.AddLineBreak})):"Tab"===e.key&&(e.preventDefault(),n.insert({type:EditorBlockType.Indent}))}),this.on(EDITOR_EVENT_INPUT_BLUR,function(){n.saveSelection()}),this.on(EDITOR_EVENT_EDITOR_CHANGE,function(){n.asynSave()}),this.on(EDITOR_EVENT_EDITOR_AUTO_SAVE,function(){0<=n.undoIndex&&n.undoIndex<n.undoStack.length-1&&n.undoStack.splice(n.undoIndex);var e=n.option.maxUndoCount;e<n.undoStack.length&&n.undoStack.splice(0,n.undoStack.length-e-1),n.undoStack.push(n.value),n.undoIndex=n.undoStack.length-1,n.emit(EDITOR_EVENT_UNDO_CHANGE)}),this.emit(EDITOR_EVENT_EDITOR_READY))},Object.defineProperty(e.prototype,"canUndo",{get:function(){return 0<this.undoIndex&&0<this.undoStack.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canRedo",{get:function(){return this.undoIndex<this.undoStack.length&&0<this.undoStack.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSelection",{get:function(){return this.selection&&this.selection.start<this.selection.end},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.element?this.element.value:""},set:function(e){var t=this;this.element?this.element.value=void 0===e?"":e:this.once(EDITOR_EVENT_EDITOR_READY,function(){t.element.value=e})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.element?this.element.length:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wordLength",{get:function(){return this.element?this.element.wordLength:0},enumerable:!1,configurable:!0}),e.prototype.checkSelection=function(){this.selection||(this.selection=this.element.selection)},e.prototype.selectAll=function(){this.element.selectAll()},e.prototype.saveSelection=function(){this.selection=this.element.selection},e.prototype.insert=function(e,t){"object"!=typeof e&&(e={type:EditorBlockType.AddText,value:e}),this.element.insert(e,null!=t?t:this.selection)},e.prototype.execute=function(e,t,n){e=this.option.toModule(e);e&&e.handler&&e.handler(this,null!=t?t:this.selection,n)},e.prototype.paste=function(e){this.element.paste(e)},e.prototype.clear=function(e){void 0===e&&(e=!0),this.element.value="",e&&this.focus()},e.prototype.focus=function(){this.checkSelection(),this.element.selection=this.selection,this.element.focus()},e.prototype.asynSave=function(){var e=this;0<this.asyncTimer&&clearTimeout(this.asyncTimer),this.asyncTimer=window.setTimeout(function(){e.asyncTimer=0,e.emit(EDITOR_EVENT_EDITOR_AUTO_SAVE)},2e3)},e.prototype.blur=function(){this.element.blur()},e.prototype.destroy=function(){this.element.destroy(),this.emit(EDITOR_EVENT_EDITOR_DESTORY),this.listeners={}},e.prototype.undo=function(){this.canUndo?(this.undoIndex--,this.value=this.undoStack[this.undoIndex]):this.emit(EDITOR_EVENT_UNDO_CHANGE)},e.prototype.redo=function(){this.canRedo?(this.undoIndex++,this.value=this.undoStack[this.undoIndex]):this.emit(EDITOR_EVENT_UNDO_CHANGE)},e.prototype.on=function(e,t){return Object.prototype.hasOwnProperty.call(this.listeners,e)||(this.listeners[e]=[]),this.listeners[e].push(t),this},e.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Object.prototype.hasOwnProperty.call(this.listeners,e))for(var o=this.listeners[e],i=o.length-1;0<=i;i--)if(!1===o[i].apply(void 0,t))break;return this},e.prototype.off=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(2==e.length&&"function"==typeof e[1])return this.offListener(e[0],e[1]);for(var n=0,o=e;n<o.length;n++)delete this.listeners[o[n]];return this},e.prototype.once=function(n,o){function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.off(n,i),o.apply(void 0,e)}var r=this;return this.on(n,i),this},e.prototype.offListener=function(e,t){if(Object.prototype.hasOwnProperty.call(this.listeners,e))for(var n=this.listeners[e],o=n.length-1;0<=o;o--)n[o]===t&&n.splice(o,1);return this},e}(),DivElement=function(){function e(e,t){this.element=e,this.container=t,this.isComposition=!1,this.bindEvent()}return Object.defineProperty(e.prototype,"blockTagName",{get:function(){return this.container.option.blockTag},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selection",{get:function(){var e,t=window.getSelection();return t.rangeCount<1?((e=document.createRange()).setStart(this.element,this.element.children.length),e.setEnd(this.element,this.element.children.length),{start:this.element.children.length,end:this.element.children.length,range:e.cloneRange()}):{start:(e=t.getRangeAt(0)).startOffset,end:e.endOffset,range:e.cloneRange()}},set:function(e){var t,n=window.getSelection();e.range?t=e.range:((t=n.getRangeAt(0)).deleteContents(),(t=t.cloneRange()).setStart(this.element,e.start),t.setEnd(this.element,e.end)),n.removeAllRanges(),n.addRange(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectedValue",{get:function(){var t,n=this,o=[],i=this.selection.range;return this.eachRange(i,function(e){e===i.startContainer&&i.startContainer===i.endContainer?o.push(e.textContent.substring(i.startOffset,i.endOffset)):"BR"===e.nodeName?(o.push("\n"),t=void 0):(t!==e.parentNode&&e.parentNode!==n.element&&0<=["P","DIV","TR"].indexOf(e.parentNode.nodeName)&&(t&&o.push("\n"),t=e.parentNode),e===i.startContainer?o.push(e.textContent.substring(i.startOffset)):e===i.endContainer&&o.push(e.textContent.substring(0,i.endOffset)))}),o.join("")},set:function(e){this.insert({type:EditorBlockType.AddText,text:e})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.element.innerHTML},set:function(e){this.element.innerHTML=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.value.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wordLength",{get:function(){return EditorHelper.wordLength(this.element.innerText)},enumerable:!1,configurable:!0}),e.prototype.selectAll=function(){var e=window.getSelection(),t=document.createRange();t.selectNodeContents(this.element),e.removeAllRanges(),e.addRange(t)},e.prototype.insert=function(e,t){t=t||this.selection;var n=this[e.type+"Execute"];if("function"!=typeof n)throw new Error("insert type error:[".concat(e.type,"]"));n.call(this,t.range,e),this.container.emit(EDITOR_EVENT_EDITOR_CHANGE)},e.prototype.focus=function(){this.element.focus({preventScroll:!0})},e.prototype.blur=function(){return this.element.blur()},e.prototype.destroy=function(){},e.prototype.addHrExecute=function(e){var t=document.createElement("hr");this.replaceSelected(e,t)},e.prototype.indentExecute=function(e){var t=this,n=[];this.eachRangeParentNode(e,function(e){if(t.isBlockNode(e)||e.parentNode===t.element)return n.push(e),!0});for(var o=0,i=n;o<i.length;o++){var r=i[o],a=(this.isBlockNode(r)||((a=document.createElement(this.blockTagName)).appendChild(r.cloneNode(!0)),this.element.replaceChild(a,r),r=a),window.getComputedStyle(r));r.style.marginLeft=parseFloat(a.marginLeft.replace("px",""))+20+"px"}},e.prototype.outdentExecute=function(e){var n=this;this.eachRangeParentNode(e,function(e){var t;if(n.isBlockNode(e))return e=e,t=window.getComputedStyle(e),t=parseFloat(t.marginLeft.replace("px",""))-20,e.style.marginLeft=Math.max(0,t)+"px",!0})},e.prototype.tabExecute=function(e){var t=this.nodeParent(e.startContainer,"td,"+this.blockTagName);t instanceof HTMLTableCellElement?this.moveTableFocus(t)||this.focusAfter(this.nodeParent(t,"table")):this.indentExecute(e)},e.prototype.addTableExecute=function(e,t){for(var n=document.createElement("table"),o=(n.style.width="100%",n.createTBody()),i=100/t.column+"%",r=0;r<t.row;r++){for(var a=document.createElement("tr"),s=0;s<t.column;s++){var l=document.createElement("td");l.appendChild(document.createElement("br")),l.style.width=i,a.appendChild(l)}o.appendChild(a)}this.replaceSelected(e,n)},e.prototype.addImageExecute=function(e,t){var n=document.createElement("img");n.src=t.value,n.title=t.title||"",this.replaceSelected(e,n)},e.prototype.addTextExecute=function(e,t){var n=document.createElement("span");n.innerText=t.value,this.replaceSelected(e,n)},e.prototype.addRawExecute=function(e,t){for(var t=t.value.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,""),n=document.createElement("div"),o=(n.innerHTML=t,[]),i=0;i<n.childNodes.length;i++)o.push(n.childNodes[i]);this.replaceSelected.apply(this,__spreadArray([e],o,!1))},e.prototype.addVideoExecute=function(e,t){var n=document.createElement("video");n.src=t.value,n.title=t.title||"",this.replaceSelected(e,n)},e.prototype.addFileExecute=function(e,t){var n=document.createElement("a");n.href=t.value,n.title=t.title||"",this.replaceSelected(e,n)},e.prototype.addLinkExecute=function(e,t){var n=document.createElement("a");n.href=t.value,n.text=t.title,t.target&&(n.target="_blank"),this.insertElement(n,e),this.selectNode(n)},e.prototype.addLineBreakExecute=function(e){var t=this,n=e.startContainer,o=(e.startOffset,document.createElement(this.blockTagName));if(n===this.element)o.appendChild(document.createElement("br")),0===this.element.children.length?this.insertLast(this.element,o.cloneNode(!0),o):this.insertToChildIndex(o,n,e.startOffset);else{var i=this.nodeParent(n,"li,td,"+this.blockTagName);if(i){if("LI"===i.nodeName)return a=document.createElement(i.nodeName),this.insertAfter(i,a),void this.selectNode(a);if(i instanceof HTMLTableCellElement)return this.moveTableFocus(i)?void 0:void this.focusAfter(this.nodeParent(i,"table"))}var r,a,s=!1,l=(this.eachBlockNext(e.endContainer,e.endOffset,function(e){e===n&&(n=n.parentNode,s=!0),o.appendChild(e)}),o.appendChild(document.createElement("br")),this.removeRange(e),!1);this.eachParentNode(n,function(e){if(t.isBlockNode(e)&&e)return t.insertAfter(e,o),!(l=!(r=void 0));r=e}),l||(r?this.insertAfter(r,o):this.element.appendChild(o)),s&&((a=document.createElement(this.blockTagName)).appendChild(document.createElement("br")),this.insertBefore(o,a))}this.selectNode(o)},e.prototype.hExecute=function(e,t){this.replaceNodeName(e.startContainer,t.value)},e.prototype.blockquoteExecute=function(e){this.toggleRangeTag(e,"blockquote")},e.prototype.listExecute=function(e){var t=e.startContainer;if(r=this.nodeParent(t,"ul,ol")){for(var n=[],o=0;o<r.childNodes.length;o++){var i=r.childNodes[o];"li"!==i.nodeName?n.push(i):i.childNodes.forEach(function(e){n.push(e)})}this.replaceNode(r,n)}else{var r=document.createElement("ul"),a=document.createElement("li");r.appendChild(a),this.replaceNode(t,r,function(){a.appendChild(t)})}},e.prototype.boldExecute=function(e){this.toggleRangeTag(e,"b")},e.prototype.subExecute=function(e){this.toggleRangeStyle(e,{"vertical-align":"text-bottom","font-size":"8px"})},e.prototype.supExecute=function(e){this.toggleRangeStyle(e,{"vertical-align":"text-top","font-size":"8px"})},e.prototype.italicExecute=function(e,t){this.toggleRangeTag(e,"i")},e.prototype.underlineExecute=function(e){this.toggleRangeStyle(e,{"text-decoration":"underline"})},e.prototype.strikeExecute=function(e){this.toggleRangeStyle(e,{"text-decoration":"strike"})},e.prototype.fontSizeExecute=function(e,t){this.toggleRangeStyle(e,{"font-size":t.value})},e.prototype.fontFamilyExecute=function(e,t){this.toggleRangeStyle(e,{"font-family":t.value})},e.prototype.backgroundExecute=function(e,t){this.toggleRangeStyle(e,{"background-color":t.value})},e.prototype.foregroundExecute=function(e,t){this.toggleRangeStyle(e,{color:t.value})},e.prototype.clearStyleExecute=function(e){var t=this;this.eachRangeParentNode(e,function(e){if(e instanceof HTMLElement)return e.removeAttribute("style"),0<=["B","I"].indexOf(e.nodeName)?t.replaceNodeName(e,"span",!1):/^H\d$/.test(e.tagName)?t.replaceNodeName(e,t.blockTagName,!1):void 0})},e.prototype.alignExecute=function(e,t){this.toggleRangeStyle(e,{"text-align":t.value})},e.prototype.theadExecute=function(e){e=this.nodeParent(e.startContainer,"table");e&&(e.tHead?e.tHead=null:e.createTHead())},e.prototype.tfootExecute=function(e){e=this.nodeParent(e.startContainer,"table");e&&(e.tFoot?e.tFoot=null:e.createTFoot())},e.prototype.rowSpanExecute=function(e){var t=this.getTableCell(e.startContainer),n=this.getTableCell(e.endContainer),o=t.parentNode.parentNode,i=this.getTableCellSpan(t);if(t===n){if(!(t.rowSpan<2))for(var r=t.rowSpan-1,a=!(t.rowSpan=1),s=0;s<o.rows.length&&!(r<1);s++)if((c=o.rows[s])===t.parentNode)a=!0;else if(a){r--;for(var l=0,d=0;d<c.cells.length;d++){if((l+=(f=c.cells[s]).colSpan)===i){this.insertAfter(f,document.createElement(t.nodeName));break}if(i<l){f.colSpan++;break}}}}else if(t.parentNode!==n.parentNode&&o===n.parentNode.parentNode)for(var c,p=-1,h=0,s=o.rows.length-1;0<=s;s--){if((c=o.rows[s])===t.parentNode){t.rowSpan+=h;break}if((p=c===n.parentNode?s:p)<0)return;h++;for(var u=0,d=0;d<c.cells.length;d++){var f=c.cells[d];if(!((u+=f.colSpan)<i)){i<u||1<f.colSpan?f.colSpan--:c.removeChild(f);break}}}},e.prototype.colSpanExecute=function(e){var t=this.getTableCell(e.startContainer),n=this.getTableCell(e.endContainer);if(t===n){if(!(t.colSpan<2)){var o=t.colSpan-1;t.colSpan=1;for(var i=0;i<o;i++)this.insertAfter(t,document.createElement(t.nodeName))}}else{var r=t.parentNode;if(r===n.parentNode)for(var a=-1,s=0,i=r.cells.length-1;0<=i;i--){var l=r.cells[i];if(l===t){l.colSpan+=s;break}0<(a=l===n?i:a)&&(s+=l.colSpan,r.removeChild(l))}}},e.prototype.delTableExecute=function(e){e=this.nodeParent(e.startContainer,"table");e&&this.removeNode(e)},e.prototype.openLinkExecute=function(e){e=this.nodeParent(e.startContainer,"a");e&&window.open(e.getAttribute("href"))},e.prototype.getModuleItems=function(e){var t,n,o=null==(e=e.range)?void 0:e.startContainer;return o?(t=this.blockTagName.toUpperCase(),n=[],this.eachParentNode(o,function(e){if(o.nodeName===t||"IMG"===o.nodeName||"TABLE"===o.nodeName||"VIDEO"===o.nodeName)return!1;e instanceof HTMLElement&&("B"===e.nodeName?n.push("bold"):"I"===e.nodeName?n.push("italic"):"BLOCKQUOTE"===e.nodeName?n.push("blockquote"):/^H[1-6]$/.test(e.nodeName)&&n.push("head"),"text-top"===e.style.verticalAlign?n.push("sup"):"text-bottom"===e.style.verticalAlign&&n.push("sub"),"underline"===e.style.textDecoration?n.push("wavyline"):"wavyline"===e.style.textDecoration?n.push("dashed"):"strike"===e.style.textDecoration&&n.push("strike"),e.style.backgroundColor&&n.push("background"),e.style.color)&&n.push("foreground")}),n):[]},e.prototype.getTableCellSpan=function(e){for(var t=e.parentNode,n=0,o=0;o<t.cells.length;o++){var i=t.cells[o];if(i===e)break;n+=i.colSpan}return n},e.prototype.getTableCell=function(e){if(e instanceof HTMLTableCellElement)return e;for(;e.parentNode;)if(e.parentNode instanceof HTMLTableCellElement)return e.parentNode},e.prototype.moveTableFocus=function(e){if(e.nextSibling)this.selectNode(e.nextSibling);else{e=e.parentNode;if(!(e&&e instanceof HTMLTableRowElement))return!1;if(e.nextSibling&&1<=e.nextSibling.childNodes.length)this.selectNode(e.nextSibling.childNodes[0]);else{e=e.parentNode;if(!(e&&e instanceof HTMLTableSectionElement))return!1;if(!e.nextSibling||0===e.nextSibling.childNodes.length)return!1;e=e.nextSibling.childNodes[0];if(0===e.childNodes.length)return!1;this.selectNode(e.childNodes[0])}}return!0},e.prototype.replaceSelected=function(e){for(var t,n,o=this,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];this.isEmptyRange(e)?this.insertToElement.apply(this,__spreadArray([e.startContainer,e.startOffset],i,!1)):(this.removeRange(e),n=!1,this.eachParentNode(e.startContainer,function(e){if(o.isBlockNode(e)&&e)return o.insertAfter.apply(o,__spreadArray([e],i,!1)),!(n=!(t=void 0));t=e}),n||(t?this.insertAfter.apply(this,__spreadArray([t],i,!1)):this.insertLast.apply(this,__spreadArray([this.element],i,!1))),this.selectNode(i[i.length-1]))},e.prototype.includeSelected=function(e,t){this.insertLast.apply(this,__spreadArray([t],this.copySelectedNode(e),!1)),this.replaceSelected(e,t)},e.prototype.toggleRangeTag=function(r,a){var s=this;a=a.toUpperCase(),this.isEmptyRange(r)?this.toggleParentNode(r,a):this.eachTopRange(r,function(e){var t=s.splitNodeRange(e,r);if(0!==t.length)if(s.isBlockNode(t[0]))for(var n=0,o=t;n<o.length;n++){var i=o[n];s.isBlockNode(i)?s.toggleBlockTag(i,a):i.nodeName!==a&&s.replaceNodeName(i,a,!1)}else s.replaceNode(t[0],document.createElement(a),function(e){s.insertLast.apply(s,__spreadArray([e],t,!1))})})},e.prototype.toggleRangeStyle=function(i,r){var a=this;this.isEmptyRange(i)?this.toggleParentStyle(i,r):this.eachTopRange(i,function(e){e=a.splitNodeRange(e,i);if(0!==e.length)for(var t=0,n=e;t<n.length;t++){var o=n[t];o instanceof HTMLElement?EditorHelper.css(o,r):EditorHelper.css(a.replaceNodeName(o,"span",!1),r)}})},e.prototype.toggleBlockTag=function(e,t){for(var n=document.createElement(t),o=e.childNodes.length-1;0<=o;o--)n.append(e.childNodes[o]);e.append(n)},e.prototype.toggleParentNode=function(e,t){var n,o=this,i=document.createElement(t),r=e.startContainer;r===this.element?(this.insertToChildIndex(i,r,e.startOffset),this.selectNode(i)):(e=this.nodeParent(r,t))?this.replaceNodeName(e,"b"===t?"span":this.blockTagName):((n=r).parentNode&&r.parentNode!==this.element&&this.isOnlyNode(r)&&(n=r.parentNode),this.replaceNode(n,i,function(){i.appendChild(r),n!==r&&o.removeNode(n)}),this.selectNode(r))},e.prototype.toggleParentStyle=function(e,t){e=this.getBlockParent(e.startContainer);EditorHelper.css(e,t)},e.prototype.getBlockParent=function(e){var t,n=e.parentNode;return n!==this.element?n:(t=document.createElement(this.blockTagName),this.replaceNode(e,t,function(){t.appendChild(e)}),t)},e.prototype.nodeParent=function(e,t){var n,o;return t?(n=t.toUpperCase().split(","),this.eachParentNode(e,function(e){if(0<=n.indexOf(e.nodeName))return o=e,!1}),o):e.parentNode},e.prototype.hasNode=function(e){if(e!==this.element)for(;e.parentNode;){if("BODY"===e.parentNode.nodeName)return!1;if(e.parentNode===this.element)return!0;e=e.parentNode}return!1},e.prototype.replaceNodeName=function(t,e,n){void 0===n&&(n=!0);e=document.createElement(e);if(t instanceof HTMLElement){if(e.nodeName===t.nodeName)return t;e.innerHTML=t.innerHTML,this.replaceNode(t,e)}else this.replaceNode(t,e,function(e){e.appendChild(t)});return n&&this.selectNode(e),e},e.prototype.replaceNode=function(e,t,n){function o(){n?n(t):i.removeNode(e)}var i=this,r=t instanceof Array?t:[t],a=e.previousSibling;a?(o(),this.insertAfter.apply(this,__spreadArray([a],r,!1))):(a=e.nextSibling)?(o(),this.insertBefore.apply(this,__spreadArray([a],r,!1))):(a=e.parentNode,o(),this.insertLast.apply(this,__spreadArray([a],r,!1)))},e.prototype.selectNode=function(e,t){void 0===t&&(t=0);var n=window.getSelection(),o=document.createRange();o.setStart(e,t),o.setEnd(e,t),n.removeAllRanges(),n.addRange(o)},e.prototype.focusAfter=function(e){e&&(e.nextSibling?this.selectNode(e.nextSibling):this.selectNode(e.parentNode,e.parentNode.childNodes.length))},e.prototype.bindEvent=function(){var n=this;this.element.addEventListener("keydown",function(e){n.container.saveSelection(),"Tab"===e.key?(e.preventDefault(),n.tabExecute(n.selection.range)):n.container.emit(EDITOR_EVENT_INPUT_KEYDOWN,e),n.container.emit(EDITOR_EVENT_CLOSE_TOOL)}),this.element.addEventListener("keyup",function(){var e;n.isComposition||(e=n.selection.range,n.isEmptyLine(e)?n.container.emit(EDITOR_EVENT_SHOW_ADD_TOOL,n.getNodeOffset(e.startContainer).y):n.container.emit(EDITOR_EVENT_EDITOR_CHANGE))}),this.element.addEventListener("compositionstart",function(){n.isComposition=!0}),this.element.addEventListener("compositionend",function(){n.isComposition=!1,n.container.saveSelection(),n.container.emit(EDITOR_EVENT_SELECTION_CHANGE),n.container.emit(EDITOR_EVENT_EDITOR_CHANGE)}),this.element.addEventListener("mouseup",function(){n.container.saveSelection(),n.container.emit(EDITOR_EVENT_SELECTION_CHANGE)}),this.element.addEventListener("mouseenter",function(e){e.target&&e.target instanceof HTMLHRElement&&e.target.previousSibling instanceof HTMLHRElement&&(n.selectNode(e.target),n.container.emit(EDITOR_EVENT_SHOW_LINE_BREAK_TOOL,n.getNodeOffset(e.target.previousSibling)))}),this.element.addEventListener("mousemove",function(e){var t;e.target&&e.target instanceof HTMLTableCellElement&&(t=e.target,0<(e=e.offsetX)&&e<4&&t.previousSibling||t.nextSibling&&e>t.clientWidth-4?t.style.cursor="col-resize":t.style.cursor="auto")}),this.element.addEventListener("paste",function(e){e.preventDefault(),n.paste(e.clipboardData||window.clipboardData)}),this.element.addEventListener("mousedown",function(e){var t;e.target&&e.target instanceof HTMLTableCellElement&&(t=e.target,0<(e=e.offsetX)&&e<4&&t.previousSibling?n.moveTableCol(t.previousSibling):t.nextSibling&&e>t.clientWidth-4&&n.moveTableCol(t))}),this.element.addEventListener("touchend",function(){n.container.saveSelection()}),this.element.addEventListener("click",function(e){var t;n.container.saveSelection(),e.target instanceof HTMLImageElement?(t=e.target,n.selectNode(t),n.container.emit(EDITOR_EVENT_SHOW_IMAGE_TOOL,n.getNodeBound(t),function(e){return n.updateNode(t,e)})):(e=n.selection.range,n.isInBlock(e)||(n.isEmptyLine(e)?n.container.emit(EDITOR_EVENT_SHOW_ADD_TOOL,n.getNodeOffset(e.startContainer).y):(n.container.emit(EDITOR_EVENT_INPUT_CLICK),n.container.emit(EDITOR_EVENT_CLOSE_TOOL))))}),this.element.addEventListener("blur",function(){n.container.saveSelection(),n.container.emit(EDITOR_EVENT_INPUT_BLUR)})},e.prototype.paste=function(e){this.isPasteFile(e)?this.pasteFile(e):this.isPasteHtml(e)?this.pasteHtml(e):(e=e.getData("text"))&&this.insert({type:EditorBlockType.AddText,value:e})},e.prototype.isPasteFile=function(e){return 0<e.types.length&&"Files"===e.types[0]},e.prototype.isPasteHtml=function(e){return 1<e.types.length&&"text/html"===e.types[1]},e.prototype.pasteFile=function(n){for(var o=this,i=this,e=0;e<n.files.length;e++)!function(e){var e=n.files[e],t=EditorHelper.fileType(e);i.container.option.upload(e,t,function(e){o.insert({type:"add"+t[0].toUpperCase()+t.substring(1),value:e.url,title:e.title,size:e.size})},function(){})}(e)},e.prototype.pasteHtml=function(e){e=e.getData(e.types[1]);if(!e)return"";this.insert({type:EditorBlockType.AddRaw,value:e})},e.prototype.moveTableCol=function(s){var e,l,t,d,c=s.closest("table");c&&(e=this.element.getBoundingClientRect(),l=c.getBoundingClientRect(),t=s.getBoundingClientRect(),d=t.x+t.width-e.x,this.container.emit(EDITOR_EVENT_SHOW_COLUMN_TOOL,{x:d,y:c.offsetTop,width:0,height:l.height},function(e){for(var t=s.cellIndex+s.colSpan,n=100*(e.x-d)/l.width,o=0;o<c.rows.length;o++)for(var i=c.rows[o],r=0;r<i.cells.length;r++){var a=i.cells[r];a.cellIndex+a.colSpan===t&&(a.style.width=parseFloat(a.style.width.replace("%",""))+n+"%",(a=i.cells[r+1]).style.width=parseFloat(a.style.width.replace("%",""))-n+"%")}}))},e.prototype.updateNode=function(e,t){t.type===EditorBlockType.NodeResize&&(e.style.width=(t=t).width+"px",e.style.height=t.height+"px")},e.prototype.eachRange=function(e,t){var n=e.startContainer,o=e.endContainer;if(!1!==t(n)&&o!==n)for(var i=n;i!==o;){var r=this.nextNode(i);if(!r)break;if(r===o){t(r);break}for(;r.hasChildNodes()&&(r=r.firstChild)!==o;);if(!1===t(r))break;i=r}},e.prototype.eachTopRange=function(e,n){var t=e.startContainer,o=e.endContainer;if(!1!==n(t)&&o!==t){for(var i=[],r=(this.eachParentNode(t,function(e){i.push(e)}),[]),a=(this.eachParentNode(o,function(e){r.push(e)}),t),s=this;a!==o;){var l=function(){var t=s.nextNode(a);if(!t)return{value:void 0};if(t===o)return"break";if(s.eachParentNode(t,function(e){return!(0<=i.indexOf(e)||0<=r.indexOf(e))&&void(t=e)}),0<=i.indexOf(t))return a=t,"continue";var e=r.indexOf(t);if(0===e)return"break";if(0<e)for(;t.hasChildNodes()&&(t=t.childNodes[0],!(r.indexOf(t)<=0)););if(t!==o&&!1===n(t))return"break";a=t}();if("object"==typeof l)return l.value;if("break"===l)break}n(o)}},e.prototype.insertElement=function(e,t){this.insertToElement(t.startContainer,t.startOffset,e)},e.prototype.insertToElement=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var i=e instanceof Text;return t<1?i?void this.insertBefore.apply(this,__spreadArray([e],n,!1)):void this.insertFirst.apply(this,__spreadArray([e],n,!1)):(i?e:e.childNodes).length<=t?i?void this.insertAfter.apply(this,__spreadArray([e],n,!1)):void this.insertLast.apply(this,__spreadArray([e],n,!1)):void(i?this.insertBefore.apply(this,__spreadArray([e.splitText(t)],n,!1)):this.insertBefore.apply(this,__spreadArray([e.childNodes[t]],n,!1)))},e.prototype.insertFirst=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];e.childNodes.length<1?this.insertLast.apply(this,__spreadArray([e],t,!1)):this.insertBefore.apply(this,__spreadArray([e.childNodes[0]],t,!1))},e.prototype.insertLast=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var o=0,i=t;o<i.length;o++)e.appendChild(i[o])},e.prototype.insertBefore=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var o=e.parentNode,i=0,r=t;i<r.length;i++)o.insertBefore(r[i],e)},e.prototype.insertAfter=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];e.nextSibling?this.insertBefore.apply(this,__spreadArray([e.nextSibling],t,!1)):this.insertLast.apply(this,__spreadArray([e.parentNode],t,!1))},e.prototype.insertToChildIndex=function(e,t,n){t.childNodes.length<=n?t.appendChild(e):t.insertBefore(e,t.childNodes[n])},e.prototype.removeRange=function(e){var i=this;if(e.startContainer===e.endContainer){if(e.startOffset!==e.endOffset)if(e.startContainer instanceof Text)o=e.startContainer.textContent,e.startContainer.textContent=o.substring(0,e.startOffset)+o.substring(e.endOffset);else for(var t=e.endOffset;t>=e.startOffset;t--)e.startContainer.removeChild(e.startContainer.childNodes[t])}else{for(var r=[],a=(this.eachParentNode(e.startContainer,function(e){r.push(e)}),[]),n=(this.eachParentNode(e.endContainer,function(e){var t=r.indexOf(e);if(!(t<0))return r.splice(t,r.length-t),!1;a.push(e)}),Math.max(r.length,a.length)),s=this,t=1;t<=n;t++)!function(e){var t=r.length-e,e=a.length-e,n=0<=t?r[t]:void 0,o=0<=e?a[e]:void 0;n&&s.eachNextBrother(n,function(e){e&&e!==n&&e!==o&&i.removeNode(e)},o),!o||n&&o.parentNode===n.parentNode||s.eachBrother(o,function(e){if(e===o)return!1;e!==n&&i.removeNode(e)},!1)}(t);if(e.startContainer instanceof Text){var o=e.startContainer.textContent;e.startContainer.textContent=o.substring(0,e.startOffset)}else for(t=e.startContainer.childNodes.length-1;t>=e.startOffset;t--)e.startContainer.removeChild(e.startContainer.childNodes[t]);if(e.endContainer instanceof Text){o=e.endContainer.textContent;e.endContainer.textContent=o.substring(e.endOffset)}else for(t=e.endOffset-1;0<=t;t--)e.endContainer.removeChild(e.endContainer.childNodes[t])}},e.prototype.removeNode=function(e){e.parentNode&&e.parentNode.removeChild(e)},e.prototype.copySelectedNode=function(e){if(e.startContainer===e.endContainer)return e.startOffset===e.endOffset?[]:this.copyRangeNode(e.startContainer,e.startOffset,e.endOffset);for(var r,a,s=[],l=(this.eachParentNode(e.startContainer,function(e){s.push(e)}),[]),t=(this.eachParentNode(e.endContainer,function(e){var t=s.indexOf(e);if(!(t<0))return s.splice(t,s.length-t),!1;l.push(e)}),Math.max(s.length,l.length)),d=[],c=this,n=1;n<=t;n++)!function(n){var e=s.length-n,t=l.length-n,o=0<=e?s[e]:void 0,i=0<=t?l[t]:void 0;o&&c.eachNextBrother(o,function(e){var t=e.cloneNode(e===o||e===i);if(n<1?d.push(t):r.appendChild(t),e===o&&(r=t),e===i)return a=t,!1},i),!i||o&&i.parentNode===o.parentNode||c.eachBrother(i,function(e){var t=e.cloneNode(e===i);if(n<1?d.push(t):a.appendChild(t),e===i)return a=t,!1},!1)}(n);r?this.insertLast.apply(this,__spreadArray([r],this.copyRangeNode(e.startContainer,e.startOffset),!1)):d=[].concat(this.copyRangeNode(e.startContainer,e.startOffset),d),a?this.insertLast.apply(this,__spreadArray([a],this.copyRangeNode(e.endContainer,0,e.endOffset),!1)):d.push.apply(d,this.copyRangeNode(e.endContainer,0,e.endOffset))},e.prototype.copyRangeNode=function(e,t,n){if(e instanceof Text)return[new Text(e.textContent.substring(t,n))];for(var o=[],i=t;i<e.childNodes.length;i++){if(n&&n<i)return;o.push(e.childNodes[i].cloneNode(!0))}return o},e.prototype.indexOfNode=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},e.prototype.eachBrother=function(e,t,n){if(void 0===n&&(n=!0),e.parentNode)for(var o=n,i=e.parentNode,r=i.children.length-1;0<=r;r--){var a=i.children[r];if(a===e){if(!1===t(a))break;if(n)break;o=!0}if(o&&!1===t(a))break}},e.prototype.eachNextBrother=function(e,t,n){if(e.parentNode)for(var o=e.parentNode,n=n?this.indexOfNode(o.childNodes,n):-1,i=n<0?o.childNodes.length-1:n;0<=i;i--){var r=o.children[i];if(r===e){t(r);break}if(!1===t(r))break}},e.prototype.eachBlockNext=function(e,t,n){if(e!==this.element){t<1?n(e):e instanceof Text&&e.length>t&&n(e.splitText(t));for(var o=e;;)if(o.nextSibling){if("BR"===(o=o.nextSibling).nodeName||this.isBlockNode(o))break;n(o)}else{if(this.element===o.parentNode||this.isBlockNode(o.parentNode))break;o=o.parentNode}}},e.prototype.isBlockNode=function(e){return"P"===e.nodeName||"DIV"===e.nodeName},e.prototype.isInBlock=function(e){var t,n=["A"],o=["TABLE","TD","TR","TH"];return this.eachParentNode(e.startContainer,function(e){return 0<=n.indexOf(e.nodeName)?(t=EDITOR_EVENT_SHOW_LINK_TOOL,!1):0<=o.indexOf(e.nodeName)?(t=EDITOR_EVENT_SHOW_TABLE_TOOL,!1):void 0}),t&&this.container.emit(t,this.getNodeOffset(e.startContainer)),!!t},e.prototype.getNodeStyle=function(e){var t=["B","EM","I","STRONG"],n=[];return this.eachParentNode(e,function(e){0<=t.indexOf(e.nodeName)&&n.push(e.nodeName)}),n},e.prototype.eachParentNode=function(e,t){for(var n=e;n!==this.element;){var o=t(n);if(!1===o)break;if(!(n=o instanceof Node?o:n))break;n=n.parentNode}},e.prototype.eachRangeParentNode=function(e,n){var o=this,i=[];this.eachRange(e,function(e){var t=!1;if(o.eachParentNode(e,function(e){if(!(0<=i.indexOf(e))){e=n(e);if("boolean"!=typeof e)return e;!1===e&&(t=!0)}return!1}),t)return!1})},e.prototype.nextNode=function(e){return e.nextSibling||(e.parentNode!==this.element?this.nextNode(e.parentNode):void 0)},e.prototype.splitNodeRange=function(e,t,n){var o;if(void 0===n&&(n=-1),"object"==typeof t&&(t=(o=this.getNodeRange(e,t))[0],n=o[1]),t===n)return[];if(e instanceof Text)return o=e.length,0<t&&(e=e.splitText(t)),t<n&&0<n&&n<o-1&&e.splitText(n-t),[e];var i=t<n&&0<n&&n<e.childNodes.length?n+1:e.childNodes.length,r=0<t?t:0;if(r<=0&&i>=e.childNodes.length)return[e];for(var a=[];r<i;r++)a.push(e.childNodes[r]);return a},e.prototype.getNodeIndex=function(e){if(e.parentNode)for(var t=e.parentNode,n=0;n<t.childNodes.length;n++)if(t.childNodes[n]===e)return n;return-1},e.prototype.getNodeRange=function(e,t){return[e===t.startContainer?t.startOffset:0,e===t.endContainer?t.endOffset:-1]},e.prototype.getNodeOffset=function(e){var t;return(e=1!==e.nodeType?e.parentNode:e)===this.element?(t=getComputedStyle(this.element),{x:parseFloat(t.getPropertyValue("padding-left")),y:parseFloat(t.getPropertyValue("padding-top"))}):{y:e.offsetTop,x:e.offsetLeft}},e.prototype.getNodeBound=function(e){var t;return(e=1!==e.nodeType?e.parentNode:e)===this.element?(t=getComputedStyle(this.element),{x:parseFloat(t.getPropertyValue("padding-left")),y:parseFloat(t.getPropertyValue("padding-top")),width:0,height:0}):(e=(t=e).getBoundingClientRect(),{y:t.offsetTop,x:t.offsetLeft,width:e.width,height:e.height})},e.prototype.isEndNode=function(e,t){return e instanceof Text?e.length<=t:e.childNodes.length<1||1==e.childNodes.length&&"BR"===e.childNodes[0].nodeName},e.prototype.isEmptyRange=function(e){return e.startContainer===e.endContainer&&e.startOffset===e.endOffset},e.prototype.isEmptyLine=function(e){return!(e.startOffset!==e.endOffset||0<e.startOffset)&&e.startContainer===e.endContainer&&this.isEmptyLineNode(e.startContainer)},e.prototype.isOnlyNode=function(e){var t=e.parentNode;if(!t)return!1;for(var n=0;n<t.childNodes.length;n++){var o=t.childNodes[n];if(o!==e&&"BR"!==o.nodeName)return!1}return!0},e.prototype.isEmptyLineNode=function(e){if(1!==e.nodeType)return!1;for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(this.isBlockNode(n)){if(this.isEmptyLineNode(n))continue;return!1}if("BR"!==n.nodeName)return!1}return!0},e}(),EDITOR_EVENT_INPUT_KEYDOWN="input.keydown",EDITOR_EVENT_INPUT_BLUR="input.blur",EDITOR_EVENT_INPUT_CLICK="input.click",EDITOR_EVENT_MOUSE_UP="mouse.up",EDITOR_EVENT_MOUSE_MOVE="mouse.move",EDITOR_EVENT_EDITOR_CHANGE="change",EDITOR_EVENT_EDITOR_READY="ready",EDITOR_EVENT_EDITOR_DESTORY="destroy",EDITOR_EVENT_EDITOR_AUTO_SAVE="auto_save",EDITOR_EVENT_SELECTION_CHANGE="selection_change",EDITOR_EVENT_UNDO_CHANGE="undo",EDITOR_EVENT_SHOW_ADD_TOOL="tool.add",EDITOR_EVENT_SHOW_LINE_BREAK_TOOL="tool.line.break",EDITOR_EVENT_SHOW_IMAGE_TOOL="tool.image",EDITOR_EVENT_SHOW_COLUMN_TOOL="tool.column",EDITOR_EVENT_SHOW_LINK_TOOL="tool.link",EDITOR_EVENT_SHOW_TABLE_TOOL="tool.table",EDITOR_EVENT_CLOSE_TOOL="tool.flow.close",EventEmitter=function(){function e(){this.listeners=[]}return e.prototype.on=function(e,t,n){return e.addEventListener(t,n),this.listeners.push({target:e,type:t,listener:n}),this},e.prototype.off=function(e,t){for(var n=this.listeners.length-1;0<=n;n--){var o=this.listeners[n];o.target!==e||t&&t!==o.type||(this.offListener(o),this.listeners.splice(n,1))}return this},e.prototype.clear=function(){var e=this.listeners;this.listeners=[];for(var t=0,n=e;t<n.length;t++){var o=n[t];this.offListener(o)}return this},e.prototype.offListener=function(e){e&&e.target&&e.target.removeEventListener(e.type,e.listener)},e}(),EDITOR_CLOSE_TOOL=(!function(e){e.AddLineBreak="addLineBreak",e.AddHr="addHr",e.AddText="addText",e.AddRaw="addRaw",e.AddImage="addImage",e.AddLink="addLink",e.AddTable="addTable",e.AddVideo="addVideo",e.AddFile="addFile",e.AddCode="addCode",e.H="h",e.Bold="bold",e.Italic="italic",e.Underline="underline",e.Strike="strike",e.Wavyline="wavyline",e.Dashed="dashed",e.Sub="sub",e.Sup="sup",e.FontSize="fontSize",e.FontFamily="fontFamily",e.Background="background",e.Foreground="foreground",e.ClearStyle="clearStyle",e.Align="align",e.List="list",e.Blockquote="blockquote",e.Thead="thead",e.TFoot="tfoot",e.DeleteTable="delTable",e.RowSpan="rowSpan",e.ColSpan="colSpan",e.OpenLink="openLink",e.Indent="indent",e.Outdent="outdent",e.NodeResize="nodeResize",e.NodeMove="nodeMove"}(EditorBlockType=EditorBlockType||{}),"close"),EDITOR_ADD_TOOL="add",EDITOR_ENTER_TOOL="enter",EDITOR_UNDO_TOOL="undo",EDITOR_REDO_TOOL="redo",EDITOR_MORE_TOOL="more",EDITOR_FULL_SCREEN_TOOL="full-screen",EDITOR_CODE_TOOL="code",EDITOR_IMAGE_TOOL="image_edit",EDITOR_TABLE_TOOL="table_edit",EDITOR_VIDEO_TOOL="video_edit",EDITOR_LINK_TOOL="link_edit",EditorModules=[{name:"text",icon:"fa-font",label:"Edit Text"},{name:"paragraph",icon:"fa-paragraph",label:"Edit Paragraph"},{name:EDITOR_ADD_TOOL,icon:"fa-plus",label:"Add Content"},{name:EDITOR_UNDO_TOOL,icon:"fa-undo",label:"Undo",hotKey:"Ctrl+Z",handler:function(e){e.undo()}},{name:EDITOR_REDO_TOOL,icon:"fa-redo",label:"Redo",hotKey:"Ctrl+Shift+Z",handler:function(e){e.redo()}},{name:EDITOR_MORE_TOOL,icon:"fa-ellipsis-v",label:"More"},{name:EDITOR_CLOSE_TOOL,icon:"fa-times",label:"Close"},{name:EDITOR_ENTER_TOOL,icon:"fa-enter",label:"Link Break",handler:function(e){e.insert({type:EditorBlockType.AddLineBreak})}},{name:"head",icon:"fa-heading",label:"H1-H6",parent:"text",modal:new EditorDropdownComponent(!0),handler:function(e,t,n){e.insert(__assign(__assign({},n),{type:EditorBlockType.H}))}},{name:"bold",icon:"fa-bold",label:"Font Bold",parent:"text",handler:function(e){e.insert({type:EditorBlockType.Bold})}},{name:"italic",icon:"fa-italic",label:"Font Italic",parent:"text",handler:function(e){e.insert({type:EditorBlockType.Italic})}},{name:"underline",icon:"fa-underline",label:"Add Underline",parent:"text",handler:function(e){e.insert({type:EditorBlockType.Underline})}},{name:"wavyline",icon:"fa-wavyline",label:"Add Wavyline",parent:"text",handler:function(e){e.insert({type:EditorBlockType.Wavyline})}},{name:"dashed",icon:"fa-dashed",label:"下标加点",parent:"text",handler:function(e){e.insert({type:EditorBlockType.Dashed})}},{name:"strike",icon:"fa-strikethrough",label:"画线",parent:"text",handler:function(e){e.insert({type:EditorBlockType.Strike})}},{name:"sub",icon:"fa-subscript",label:"下标",parent:"text",handler:function(e){e.insert({type:EditorBlockType.Sub})}},{name:"sup",icon:"fa-superscript",label:"上标",parent:"text",handler:function(e){e.insert({type:EditorBlockType.Sub})}},{name:"fontsize",icon:"fa-pen-nib",label:"Font Size",parent:"text",modal:new EditorDropdownComponent,handler:function(e,t,n){e.insert(__assign(__assign({},n),{type:EditorBlockType.FontSize}))}},{name:"font",icon:"fa-font",label:"Font Family",parent:"text",modal:new EditorDropdownComponent,handler:function(e,t,n){e.insert(__assign(__assign({},n),{type:EditorBlockType.FontFamily}))}},{name:"foreground",icon:"fa-broom",label:"Font Color",parent:"text",modal:new EditorColorComponent,handler:function(e,t,n){e.insert(__assign(__assign({},n),{type:EditorBlockType.Foreground}))}},{name:"background",icon:"fa-fill",label:"Background",parent:"text",modal:new EditorColorComponent,handler:function(e,t,n){e.insert(__assign(__assign({},n),{type:EditorBlockType.Background}))}},{name:"clear",icon:"fa-tint-slash",label:"Clear Style",parent:"text",handler:function(e){e.insert({type:EditorBlockType.ClearStyle})}},{name:"align-left",icon:"fa-align-left",label:"Algin Left",parent:"paragraph",handler:function(e){e.insert({type:EditorBlockType.Align,value:"left"})}},{name:"align-center",icon:"fa-align-center",label:"Algin Center",parent:"paragraph",handler:function(e){e.insert({type:EditorBlockType.Align,value:"center"})}},{name:"align-right",icon:"fa-align-right",label:"Algin Right",parent:"paragraph",handler:function(e){e.insert({type:EditorBlockType.Align,value:"right"})}},{name:"align-justify",icon:"fa-align-justify",label:"Algin Justify",parent:"paragraph",handler:function(e){e.insert({type:EditorBlockType.Align,value:""})}},{name:"list",icon:"fa-list",label:"As List",parent:"paragraph",handler:function(e){e.insert({type:EditorBlockType.List})}},{name:"indent",icon:"fa-indent",label:"Line Indent",parent:"paragraph",handler:function(e){e.insert({type:EditorBlockType.Indent})}},{name:"outdent",icon:"fa-outdent",label:"Line Outdent",parent:"paragraph",handler:function(e){e.insert({type:EditorBlockType.Outdent})}},{name:"blockquote",icon:"fa-quote-left",label:"Add Blockquote",parent:"paragraph",handler:function(e){e.insert({type:EditorBlockType.Blockquote})}},{name:"link",icon:"fa-link",label:"Add Link",parent:EDITOR_ADD_TOOL,modal:new EditorLinkComponent,handler:function(e,t,n){e.insert(__assign({type:EditorBlockType.AddLink},n),t)}},{name:"image",icon:"fa-image",label:"Add Image",parent:EDITOR_ADD_TOOL,modal:new EditorImageComponent,handler:function(e,t,n){e.insert(__assign({type:EditorBlockType.AddImage},n),t)}},{name:"video",icon:"fa-file-video",label:"Add Video",parent:EDITOR_ADD_TOOL,modal:new EditorVideoComponent,handler:function(e,t,n){e.insert(__assign({type:EditorBlockType.AddVideo},n),t)}},{name:"table",icon:"fa-table",label:"Add Table",parent:"add",modal:new EditorTableComponent,handler:function(e,t,n){e.insert(__assign({type:EditorBlockType.AddTable},n),t)}},{name:"file",icon:"fa-file",label:"Add File",parent:EDITOR_ADD_TOOL,modal:new EditorFileComponent,handler:function(e,t,n){e.insert(__assign({type:EditorBlockType.AddFile},n),t)}},{name:"code",icon:"fa-code",label:"Add Code",parent:EDITOR_ADD_TOOL,modal:new EditorCodeComponent,handler:function(e,t,n){e.insert(__assign({type:EditorBlockType.AddCode},n),t)}},{name:"line",icon:"fa-minus",label:"Add Line",parent:EDITOR_ADD_TOOL,handler:function(e){e.insert({type:EditorBlockType.AddHr})}},{name:EDITOR_FULL_SCREEN_TOOL,icon:"fa-expand",label:"Toggle Full Screen",parent:EDITOR_MORE_TOOL},{name:"select-all",icon:"fa-braille",label:"Select All",parent:EDITOR_MORE_TOOL,handler:function(e,t,n){e.selectAll()}},{name:EDITOR_CODE_TOOL,icon:"fa-code",label:"View Code",parent:EDITOR_MORE_TOOL},{name:"replace-image",icon:"fa-exchange-alt",label:"替换",parent:EDITOR_IMAGE_TOOL},{name:"align-image",icon:"fa-align-right",label:"位置",parent:EDITOR_IMAGE_TOOL},{name:"caption-image",icon:"fa-image",label:"图片标题",parent:EDITOR_IMAGE_TOOL},{name:"delete-image",icon:"fa-trash",label:"删除图片",parent:EDITOR_IMAGE_TOOL},{name:"link-image",icon:"fa-link",label:"插入链接",parent:EDITOR_IMAGE_TOOL},{name:"alt-image",icon:"fa-font",label:"图片备注",modal:new EditorTextComponent("备注"),parent:EDITOR_IMAGE_TOOL},{name:"size-image",icon:"fa-ruler",label:"调整尺寸",modal:new EditorSizeComponent,parent:EDITOR_IMAGE_TOOL},{name:"replace-video",icon:"fa-exchange",label:"替换",parent:EDITOR_VIDEO_TOOL},{name:"align-video",icon:"fa-alignright",label:"位置",parent:EDITOR_VIDEO_TOOL},{name:"caption-video",icon:"fa-film",label:"视频标题",parent:EDITOR_VIDEO_TOOL},{name:"delete-video",icon:"fa-trash",label:"删除视频",parent:EDITOR_VIDEO_TOOL},{name:"size-video",icon:"fa-ruler",label:"调整尺寸",parent:EDITOR_VIDEO_TOOL},{name:"header-table",icon:"fa-heading",label:"表头",parent:EDITOR_TABLE_TOOL,handler:function(e){e.insert({type:EditorBlockType.Thead})}},{name:"footer-table",icon:"fa-table",label:"表尾",parent:EDITOR_TABLE_TOOL,handler:function(e){e.insert({type:EditorBlockType.TFoot})}},{name:"delete-table",icon:"fa-trash",label:"删除表格",parent:EDITOR_TABLE_TOOL,handler:function(e){e.insert({type:EditorBlockType.DeleteTable})}},{name:"row-table",icon:"fa-table",label:"行",parent:EDITOR_TABLE_TOOL},{name:"column-table",icon:"fa-table",label:"列",parent:EDITOR_TABLE_TOOL},{name:"style-table",icon:"fa-table",label:"表格样式",parent:EDITOR_TABLE_TOOL},{name:"cell-table",icon:"fa-table",label:"单元格",parent:EDITOR_TABLE_TOOL},{name:"cell-background-table",icon:"fa-brush",label:"单元格背景",parent:EDITOR_TABLE_TOOL},{name:"cell-style-table",icon:"fa-table",label:"单元格样式",parent:EDITOR_TABLE_TOOL},{name:"horizontal-table",icon:"fa-grip-horizontal",label:"横向合并",parent:EDITOR_TABLE_TOOL,handler:function(e){e.insert({type:EditorBlockType.ColSpan})}},{name:"vertical-table",icon:"fa-grip-vertical",label:"纵向合并",parent:EDITOR_TABLE_TOOL,handler:function(e){e.insert({type:EditorBlockType.RowSpan})}},{name:"open-link",icon:"fa-paper-plane",label:"打开链接",parent:EDITOR_LINK_TOOL,handler:function(e){e.insert({type:EditorBlockType.OpenLink})}},{name:"link-style",icon:"fa-brush",label:"更改样式",parent:EDITOR_LINK_TOOL},{name:"edit-link",icon:"fa-edit",label:"编辑链接",parent:EDITOR_LINK_TOOL},{name:"unlink",icon:"fa-unlink",label:"断开链接",parent:EDITOR_LINK_TOOL}],EditorOptionManager=function(){function e(){this.option={undoCount:10,blockTag:"p",toolbar:{left:["text","paragraph","add"],right:["undo","redo","more"]},uploader:{image:function(e,t,n){EditorHelper.uploadFile("/ueditor.php?action=uploadimage",e,t,n)},video:function(e,t,n){EditorHelper.uploadFile("/ueditor.php?action=uploadvideo",e,t,n)},file:function(e,t,n){EditorHelper.uploadFile("/ueditor.php?action=uploadfile",e,t,n)}}},this.moduleItems={},this.push.apply(this,EditorModules)}return Object.defineProperty(e.prototype,"leftToolbar",{get:function(){return this.filterTool(this.option.toolbar.left)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightToolbar",{get:function(){return this.filterTool(this.option.toolbar.right)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"closeTool",{get:function(){return this.toolOnly(EDITOR_CLOSE_TOOL)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"addTool",{get:function(){return this.toolOnly(EDITOR_ADD_TOOL)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enterTool",{get:function(){return this.toolOnly(EDITOR_ENTER_TOOL)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blockTag",{get:function(){return this.get("blockTag")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxUndoCount",{get:function(){return this.get("undoCount")},enumerable:!1,configurable:!0}),e.prototype.set=function(e,t){this.option[e]=t},e.prototype.merge=function(t){var e,n=this;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&"object"!=typeof this.option[e]&&(this.option[e]=t[e]);["icons","uploader"].forEach(function(e){Object.prototype.hasOwnProperty.call(t,e)&&"object"==typeof t[e]&&(n.option[e]=n.mergeObject(n.option[e],t[e]))}),this.option.hiddenModules=this.strToArr(t.hiddenModules),this.option.visibleModules=this.strToArr(t.visibleModules),t.toolbar&&(this.option.toolbar={left:this.strToArr(t.toolbar.left),right:this.strToArr(t.toolbar.right)})},e.prototype.get=function(e){return this.option[e]},e.prototype.toolOnly=function(e){return this.toTool(this.moduleItems[e])},e.prototype.tool=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=[],o=0,i=e;o<i.length;o++){var r=i[o];Object.prototype.hasOwnProperty.call(this.moduleItems,r)&&this.isVisible(r)&&n.push(this.moduleItems[r])}return n},e.prototype.toolChildren=function(t){var n=this,o=[];return this.moduleMap(function(e){e.parent==t&&n.isVisible(e.name)&&o.push(e)}),o},e.prototype.toolToggle=function(t,n){for(var o=this,e=!0,i=0,r=t="string"==typeof t?[t]:t;i<r.length;i++){var a=r[i];if(!this.isSystemTool(a)){e=!1;break}}var s=[];if(e)for(var l=0,d=t;l<d.length;l++){var a=d[l],c=this.moduleItems[a];this.isBoolEqual(c.actived,n)||(c.actived=n,s.push(c))}else this.moduleMap(function(e){0<=t.indexOf(e.name)?o.isBoolEqual(e.actived,n)||(e.actived=n,s.push(e)):e.actived&&!o.isSystemTool(e)&&(e.actived=!1,s.push(e))});this.toolUpdatedFn&&this.toolUpdatedFn(s)},e.prototype.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,o=e;n<o.length;n++){var i=o[n];this.moduleItems[i.name]=i}},e.prototype.hotKeyModule=function(e){for(var t in this.moduleItems)if(Object.prototype.hasOwnProperty.call(this.moduleItems,t)&&this.moduleItems[t].hotKey==e&&this.isVisible(t))return this.moduleItems[t]},e.prototype.moduleMap=function(e){for(var t in this.moduleItems)if(Object.prototype.hasOwnProperty.call(this.moduleItems,t)&&!1===e(this.moduleItems[t]))return},e.prototype.toModule=function(e){return"string"==typeof e?this.moduleItems[e]:!e.handler&&e.name?this.moduleItems[e.name]:e},e.prototype.upload=function(e,t,n,o){var i=this.option.uploader,r="function"==typeof i?i:void 0;(r="object"==typeof i?i[t]||i.file:r)?r(e,n,o):o("uploader not exist")},e.prototype.filterTool=function(e){if(!e)return[];for(var t=[],n=0,o=e;n<o.length;n++){var i=o[n];this.isVisible(i)&&Object.prototype.hasOwnProperty.call(this.moduleItems,i)&&t.push(this.toTool(this.moduleItems[i]))}return t},e.prototype.toTool=function(e){return{name:e.name,label:e.label,icon:this.option.icons&&Object.prototype.hasOwnProperty.call(this.option.icons,e.name)?this.option.icons[e.name]:e.icon}},e.prototype.isVisible=function(e){return!(this.option.hiddenModules&&0<=this.option.hiddenModules.indexOf(e))&&(!this.option.visibleModules||0<=this.option.visibleModules.indexOf(e))},e.prototype.strToArr=function(e){if(e)return"object"==typeof e?e:e.split(" ").filter(function(e){return!!e})},e.prototype.mergeObject=function(e,t){return e?$.extend(!0,{},e,t):t},e.prototype.isBoolEqual=function(e,t){return(!0===e||!0===t)&&e===t},e.prototype.isSystemTool=function(e){return!(e="string"==typeof e?this.moduleItems[e]:e).parent||e.parent===EDITOR_MORE_TOOL},e}(),TextareaElement=function(){function e(e,t){this.element=e,this.container=t,this.emitter=new EventEmitter,this.isComposition=!1,this.bindEvent()}return Object.defineProperty(e.prototype,"selection",{get:function(){return{start:this.element.selectionStart,end:this.element.selectionEnd}},set:function(e){this.element.selectionStart=e.start,this.element.selectionEnd=e.end,this.container.saveSelection()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectedValue",{get:function(){var e=this.selection;return!e||e.start>=e.end?"":this.value.substring(e.start,e.end)},set:function(e){var t=this.selection,n=this.value;this.value=n.substring(0,t.start)+e+n.substring(t.end),this.selection={start:t.start,end:t.start+e.length}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.value=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.value.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wordLength",{get:function(){return EditorHelper.wordLength(this.value)},enumerable:!1,configurable:!0}),e.prototype.selectAll=function(){this.selection={start:0,end:this.value.length}},e.prototype.insert=function(e,t){if(t=t||this.selection,e.begin&&e.end)this.includeBlock(e.begin,e.end,t);else{var n=this[(e.type===EditorBlockType.AddRaw?EditorBlockType.AddText:e.type)+"Execute"];if("function"!=typeof n)throw new Error("insert type error:[".concat(e.type,"]"));n.call(this,t,e)}},e.prototype.focus=function(){this.element.focus()},e.prototype.blur=function(){return this.element.blur()},e.prototype.addLineBreakExecute=function(e){this.insertText("\n",e)},e.prototype.indentExecute=function(e){this.replaceSelectLine(function(e){return e.split("\n").map(function(e){return"    "+e}).join("\n")},e)},e.prototype.outdentExecute=function(e){this.replaceSelectLine(function(e){return e.split("\n").map(function(e){if(e.length<1)return e;switch(e.charCodeAt(0)){case 9:return e.substring(1);case 32:return e.replace(/^\s{1,4}/,"");default:return e}}).join("\n")},e)},e.prototype.addTextExecute=function(e,t){var n=this.value;this.value=n.substring(0,e.start)+t.value+n.substring(e.end),this.moveCursor(e.start+(t.cursor||t.value.length))},e.prototype.addCodeExecute=function(e,t){var n=this.value,o=n.substring(e.start,e.end),t="```"+t.language+"\n"+(null!=(t=t.value)?t:o)+"\n```",o=(t=0<e.start&&"\n"!==n.charAt(e.start-1)?"\n"+t:t).length-4;(e.end>=n.length-1||"\n"!==n.charAt(e.end+1))&&(t+="\n"),this.value=n.substring(0,e.start)+t+n.substring(e.end),this.moveCursor(e.start+o)},e.prototype.addLinkExecute=function(e,t){t.value||(t.value=""),t.title?this.insertText("[".concat(t.title,"](").concat(t.value,")"),e):this.replaceSelect(function(e){return"[".concat(e,"](").concat(t.value,")")},e,t.value?t.value.length+4:3)},e.prototype.addImageExecute=function(e,t){this.replaceSelect(function(e){return 0===e.trim().length&&t.title&&(e=t.title),"![".concat(t.title,"](").concat(t.value,")")},e,t.title?t.title.length+4:2)},e.prototype.insertText=function(e,t,n){var o=this.value;this.value=o.substring(0,t.start)+e+o.substring(t.end),this.moveCursor(t.start+(n||e.length))},e.prototype.replaceSelectLine=function(e,t){var n=this.value,o=t.start;0<o&&(o=0<=(i=n.lastIndexOf("\n",o))?i+1:0);var i=e(n.substring(o,t.end));this.value=n.substring(0,o)+i+n.substring(t.end),this.selection={start:o,end:o+i.length},this.focus()},e.prototype.includeBlock=function(t,n,e){this.replaceSelect(function(e){return t+e+n},e,t.length)},e.prototype.replaceSelect=function(e,t,n,o){void 0===n&&(n=0),void 0===o&&(o=!0);var i=this.value,r=i.substring(t.start,t.end),e=e(r);this.value=i.substring(0,t.start)+e+i.substring(t.end),this.moveCursor(t.start+(o?r.length:0)+n)},e.prototype.moveCursor=function(e){this.selection={start:e,end:e},this.focus()},e.prototype.bindEvent=function(){var t=this;this.emitter.on(this.element,"keydown",function(e){t.container.emit(EDITOR_EVENT_INPUT_KEYDOWN,e)}).on(this.element,"keyup",function(e){t.isComposition||(t.container.saveSelection(),t.container.emit(EDITOR_EVENT_EDITOR_CHANGE))}).on(this.element,"blur",function(){t.container.emit(EDITOR_EVENT_INPUT_BLUR)}).on(this.element,"paste",function(e){e.preventDefault(),t.paste(e.clipboardData||window.clipboardData)}).on(this.element,"mouseup",function(){t.container.saveSelection(),t.container.emit(EDITOR_EVENT_SELECTION_CHANGE)}).on(this.element,"compositionstart",function(){t.isComposition=!0}).on(this.element,"compositionend",function(){t.isComposition=!1,t.container.emit(EDITOR_EVENT_SELECTION_CHANGE),t.container.emit(EDITOR_EVENT_EDITOR_CHANGE)})},e.prototype.paste=function(e){this.isPasteFile(e)?this.pasteFile(e):(e=e.getData("text"))&&this.insert({type:EditorBlockType.AddText,value:e})},e.prototype.destroy=function(){this.emitter.clear()},e.prototype.isPasteFile=function(e){return 0<e.types.length&&"Files"===e.types[0]},e.prototype.pasteFile=function(n){for(var o=this,i=this,e=0;e<n.files.length;e++)!function(e){var e=n.files[e],t=EditorHelper.fileType(e);i.container.option.upload(e,t,function(e){o.insert({type:"add"+t[0].toUpperCase()+t.substring(1),value:e.url,title:e.title,size:e.size})},function(){})}(e)},e}(),EditorHelper=function(){function r(){}return r.wordLength=function(e){if(!e)return 0;for(var t,n=0,o=e.length-1;0<=o;o--)(t=e.charCodeAt(o))<48||57<t&&t<65||90<t&&t<97||122<t&&t<128||128<t&&0<=this.OTHER_WORD_CODE.indexOf(t)||n++;return n},r.css=function(e,t){$(e).css(t)},r.height=function(e){return $(e).height()},r.nodeClass=function(e){var n=[];return $.each(e,function(e,t){(t="number"!=typeof e?t?e:"":t)&&n.push(t)}),n.join(" ")},r.nodeStyle=function(e){var n;return e?(n=[],$.each(e,function(e,t){"number"!=typeof e&&("z-index"!==e&&"number"==typeof t&&(t+="px"),t="".concat(e.toString(),":").concat(t,";")),t&&n.push(t)}),n.join("")):""},r.modalInputBind=function(e,t){e.on("change","input,textarea,select",function(){var e,t=$(this);"file"!==t.attr("type")&&(e=t.val(),t.parent().toggleClass("input-not-empty",!!e))}).on("click",".check-input",function(){var e=$(this),t=!e.hasClass("fa-check-square");r.toggleCheck(e,t)}).on("click",".btn",function(){t(r.modalInputData(e))})},r.toggleCheck=function(e,t){e.toggleClass("fa-check-square",!!(t=void 0===t?!1:t)).toggleClass("fa-square",!t)},r.modalInputData=function(e,n){var o={},i=!!n;if(e.find("input,textarea,select,.check-input").each(function(){var e,t=$(this);if("file"!==t.attr("type"))return e=t.attr("name"),t.hasClass(".check-input")?i?void r.toggleCheck(t,n[e]):void(o[e]=t.hasClass("fa-check-square")):void(i?t.val(n[e]||"").trigger("change"):o[e]=t.val())}),!i)return o},r.modalFileUpload=function(t,n){var o=this;t.on("change","input[type=file]",function(e){n(e.target.files)}).on("dragover",function(e){var t=o.getTransfer(e);o.haveFiles(t.types)&&(t.dropEffect="copy",o.preventAndStop(e))}).on("dragleave",function(e){e.currentTarget!==t[0]&&o.preventAndStop(e)}).on("drop",function(e){var t=o.getTransfer(e);t&&(o.preventAndStop(e),n(t.files))})},r.uploadFile=function(e,t,n,o,i){void 0===i&&(i="upfile");var r=new FormData;t instanceof File?r.append(i,t):r.append(i,t[0]),$.ajax({method:"POST",url:e,data:r,cache:!1,contentType:!1,processData:!1,success:function(e){e="string"==typeof e?JSON.parse(e):e;"SUCCESS"===e.state?(e.title=e.original,n(e)):o(e.state)}})},r.fileType=function(e){return 0<=e.type.indexOf("image")?"image":0<=e.type.indexOf("video")?"video":"file"},r.getTransfer=function(e){return e.dataTransfer||e.originalEvent.dataTransfer},r.preventAndStop=function(e){e.preventDefault(),e.stopPropagation()},r.haveFiles=function(e){return!!e&&(e.indexOf?-1!==e.indexOf("Files"):!!e.contains&&e.contains("Files"))},r.OTHER_WORD_CODE=[8220,8221,8216,8217,65281,12290,65292,12304,12305,12289,65311,65288,65289,12288,12298,12299,65306],r}(),EditorApp=function(){function e(e,t,n){this.isMarkdown=n=void 0===n?!1:n,this.isFullScreen=!1,this.resizer=new EditorResizerComponent,this.option=new EditorOptionManager,t&&this.option.merge(t),this.container=new EditorContainer(this.option),this.codeContainer=new EditorContainer(this.option),e.style.height&&this.option.set("height",e.style.height),e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?this.initByInput($(e)):this.initByDiv($(e)),this.ready()}return e.prototype.ready=function(){this.renderToolbar(this.option.leftToolbar,this.box.find(".tool-bar-top .tool-left")),this.renderToolbar(this.option.rightToolbar,this.box.find(".tool-bar-top .tool-right")),this.textbox=this.box.find(".editor-view"),this.codebox=this.box.find(".editor-code-container"),this.resetSize(),this.container.ready(this.textbox[0]),this.codeContainer.ready(new CodeElement(this.codebox[0],this.codeContainer)),this.subToolbar=this.box.find(".editor-tool-bar .tool-bar-bottom"),this.flowToolbar=this.box.find(".editor-flow-tool-bar"),this.modalContianer=this.box.find(".editor-flow-area .editor-modal-area"),this.footerBar=this.box.find(".editor-footer"),this.bindEvent(),this.resizer.ready(this.modalContianer.parent()),this.container.value=this.target.val(),this.box.data("_instance",this)},e.prototype.tapTool=function(e,t,n){this.container.focus(),e.name===this.subParentName?(this.toggleSubToolbar(e.name,t),this.subParentName=""):0===this.container.option.toolChildren(e.name).length?this.executeModule(e,this.getOffsetPosition(n)):this.toggleSubToolbar(e.name,t)},e.prototype.tapFlowTool=function(e,t){var n;this.container.focus(),e.name===EDITOR_CLOSE_TOOL?this.toggleFlowbar(!0):0<(n=this.container.option.toolChildren(e.name)).length?this.toggleFlowbar(__spreadArray([this.container.option.closeTool],n,!0)):(this.toggleFlowbar(),this.executeModule(e,this.getOffsetPosition(t)))},e.prototype.insert=function(e){this.container.insert(e)},e.prototype.toggle=function(e){this.box.toggle(e)},e.prototype.toggleEditor=function(e){var t;(e=void 0===e?!this.isMarkdown:e)!==this.isMarkdown&&(this.container.emit(EDITOR_EVENT_CLOSE_TOOL).destroy(),this.isMarkdown=e,e=this.box.find(".editor-area"),this.isMarkdown?(e.empty(),e.append(this.target),this.target.addClass("editor-view").attr("spellcheck","false").show(),t=this.target):(this.codeContainer=new EditorContainer(this.option),this.box.append(this.target),t=$('<div class="editor-view" contentEditable="true" spellcheck="false"></div>'),this.target.removeClass("editor-view").hide(),e.append(t)),this.textbox=t,this.resetSize(),this.container.ready(t[0]))},e.prototype.resetSize=function(){var e=this.option.get("height");e&&this.textbox.css({height:/^\d+$/.test(e)?e+"px":e,overflow:"auto"})},e.prototype.executeModule=function(e,t){var n,o=this,i=this.box.hasClass("editor-code-mode");this.modalContianer.html(""),e.name!==EDITOR_CODE_TOOL||this.isMarkdown?e.name===EDITOR_FULL_SCREEN_TOOL?this.toggleFullScreen():i||(n=this.container.option.toModule(e))&&(n.modal?("function"==typeof(e=n.modal).modalReady&&e.modalReady(n,this.modalContianer,this.option),e.open({},function(e){o.hideModal(),o.container.execute(n,void 0,e)},t)):this.container.execute(n)):(this.box.toggleClass("editor-code-mode",!i),this.option.toolToggle(EDITOR_CODE_TOOL,!i),this.container.emit(EDITOR_EVENT_CLOSE_TOOL),i||(this.codeContainer.value=this.container.value))},e.prototype.getOffsetPosition=function(e){var t=this.textbox.offset();if(e.currentTarget){var n,o=$(e.currentTarget);if(o.hasClass("tool-item"))return{x:(n=o.offset()).left-t.left,y:n.top+o.height()-t.top}}return{x:e.clientX-t.left,y:e.clientY-t.top}},e.prototype.toggleFullScreen=function(){this.isFullScreen=!this.isFullScreen},e.prototype.bindEvent=function(){var n=this,o=(this.container.on(EDITOR_EVENT_UNDO_CHANGE,function(){n.toggleTool({name:EDITOR_UNDO_TOOL,disabled:!n.container.canUndo},{name:EDITOR_REDO_TOOL,disabled:!n.container.canRedo})}).on(EDITOR_EVENT_SHOW_ADD_TOOL,function(e){n.resizer.close(),n.hideModal(),n.toggleFlowbar(n.option.tool(EDITOR_ADD_TOOL),{x:0,y:e})}).on(EDITOR_EVENT_SHOW_LINE_BREAK_TOOL,function(e){n.resizer.close(),n.toggleFlowbar(n.container.option.toolChildren(EDITOR_ENTER_TOOL),{x:0,y:e.y})}).on(EDITOR_EVENT_SHOW_TABLE_TOOL,function(e){n.resizer.close(),n.toggleFlowbar(n.container.option.toolChildren(EDITOR_TABLE_TOOL),e)}).on(EDITOR_EVENT_SHOW_LINK_TOOL,function(e){n.resizer.close(),n.toggleFlowbar(n.container.option.toolChildren(EDITOR_LINK_TOOL),e)}).on(EDITOR_EVENT_SHOW_IMAGE_TOOL,function(e,t){n.toggleFlowbar(n.option.toolChildren(EDITOR_IMAGE_TOOL),__assign(__assign({},e),{y:e.y+e.height+20})),n.resizer.openResize(e,t)}).on(EDITOR_EVENT_SHOW_COLUMN_TOOL,function(e,t){n.resizer.openHorizontalResize(e,t)}).on(EDITOR_EVENT_CLOSE_TOOL,function(){n.hideModal(),n.toggleFlowbar(),n.resizer.close()}).on(EDITOR_EVENT_EDITOR_CHANGE,function(){n.footerBar.text(n.container.wordLength+" words"),n.isMarkdown||n.target.val(n.container.value).trigger("change")}),this.codeContainer.on(EDITOR_EVENT_EDITOR_CHANGE,function(){n.container.value=n.codeContainer.value,n.container.emit(EDITOR_EVENT_EDITOR_CHANGE)}),this.option.toolUpdatedFn=function(e){n.toggleTool.apply(n,e)},this),i=(this.box.on("click",".tool-item",function(e){var t=$(this),n=t.data("module"),t=t.parent();t.is(o.flowToolbar)?o.tapFlowTool(o.option.toolOnly(n),e):o.tapTool(o.option.toolOnly(n),t.hasClass("tool-right"),e)}),$(document).on("click",function(e){$(e.target).closest(".editor-box").is(n.box)||n.container.emit(EDITOR_EVENT_CLOSE_TOOL)}),$(window).on("scroll",function(){var e=i.scrollTop(),t=n.box.offset();n.box.toggleClass("editor-header-fixed",t.top<e&&t.top+n.box.height()>e-80)}))},e.prototype.hideModal=function(){this.modalContianer.children().removeClass("modal-visible")},e.prototype.toggleFlowbar=function(e,t){var n,o;!0===e&&(e=this.flowLastTool,this.flowLastTool=void 0),!e||e.length<1?this.flowToolbar.hide():(this.renderToolbar(e,this.flowToolbar),t&&(n=0,o=this.box.offset(),t.x+o.left<40&&(n=40<t.y+o.top?-40:40),this.flowToolbar.css({top:t.y+n+"px",left:t.x+"px"})),this.flowToolbar.toggleClass("flow-tool-one",1===e.length),this.flowToolbar.show())},e.prototype.toggleSubToolbar=function(e,t){var n;void 0===t&&(t=!1),this.subParentName===e?this.subToolbar.hide():(n=this.option.toolChildren(e),this.subParentName=e,n.length<1&&this.subToolbar.hide(),this.renderToolbar(n,this.subToolbar),this.subToolbar.toggleClass("tool-align-right",t),this.subToolbar.show())},e.prototype.toggleTool=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var o={},n=0,i=e;n<i.length;n++){var r=i[n];o[r.name]=r}this.box.find(".tool-item").each(function(e,t){var t=$(t),n=t.data("module");n&&Object.prototype.hasOwnProperty.call(o,n)&&("boolean"==typeof(n=o[n]).actived&&t.toggleClass("active",n.actived),"boolean"==typeof n.disabled)&&t.toggleClass("disabled",n.disabled)})},e.prototype.initByDiv=function(e){this.target=$(document.createElement("textarea")),this.target.attr("name",e.attr("name")),"SCRIPT"===e[0].nodeName?(this.box=$('<div class="editor-box"></div>'),e.before(this.box),this.target.val(e.html())):(this.box=e,this.box.addClass("editor-box")),this.box.html(this.renderBase()),(this.isMarkdown?(this.target.addClass("editor-view"),this.box.find(".editor-area")):(this.target.hide(),this.box)).append(this.target)},e.prototype.initByInput=function(e){this.target=e,this.box=$('<div class="editor-box"></div>'),this.box.html(this.renderBase()),e.before(this.box),(this.isMarkdown?(e.addClass("editor-view").show(),this.box.find(".editor-area")):(e.hide(),this.box)).append(e)},e.prototype.renderBase=function(){var e=this.isMarkdown?"":'<div class="editor-view" contentEditable="true" spellcheck="false"></div>';return'<div class="editor-tool-bar">\n        <div class="tool-bar-top">\n            <div class="tool-left"></div>\n            <div class="tool-right"></div>\n        </div>\n        <div class="tool-bar-bottom">\n        </div>\n    </div>\n    <div class="editor-body">\n        <div class="editor-area">\n            '.concat(e,'\n        </div>\n        <div class="editor-flow-area">\n            <div class="editor-flow-tool-bar"></div>\n            <div class="editor-modal-area"></div>\n        </div>\n        <div class="editor-code-container"></div>\n    </div>\n    <div class="editor-footer">0 words</div>')},e.prototype.renderToolIcon=function(e,t){var n;if(!t)return n="",e.actived&&(n+=" active"),e.disabled&&(n+=" disabled"),'<div class="tool-item'.concat(n,'" title="').concat(e.label,'" data-module="').concat(e.name,'">\n        <i class="fa ').concat(e.icon,'"></i>\n    </div>');t.toggleClass("active",!!e.actived),t.toggleClass("disabled",!!e.disabled),t.attr("title",e.label),t.data("module",e.name),t.find("i").attr("class","fa "+e.icon)},e.prototype.renderToolbar=function(n,e){var o=this;if(!e)return n.map(function(e){return o.renderToolIcon(e)}).join();var i=-1;if(e.find(".tool-item").each(function(e,t){i++;t=$(t);i>=n.length?t.remove():o.renderToolIcon(n[i],t)}),!(++i>=n.length)){for(var t="";i<n.length;i++)t+=this.renderToolIcon(n[i]);e.append(t)}},e}();jQuery.fn.editor=function(e,t){if(void 0===t&&(t=!1),!this.data("editor"))return this.data("editor",1),new EditorApp(this[0],e,t)};