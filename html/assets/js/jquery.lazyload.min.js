var LazyMode;!function(t){t[t.once=0]="once",t[t.every=1]="every"}(LazyMode||(LazyMode={}));var LazyItem=function(){function t(t,a,o,n){void 0===o&&(o=LazyMode.once),void 0===n&&(n=0),this.element=t,this.callback=a,this.mode=o,this.diff=n}return t.prototype.refresh=function(){this._lastHeight=void 0},t.prototype.canRun=function(t,a){if(this.mode==LazyMode.once&&null!=this._lastHeight)return!1;if("function"==typeof this.diff)return this.diff.call(this,t,a);var o=this.element.offset().top;return o+this.diff>=t&&o<a},t.prototype.run=function(t,a){return!!this.canRun(t,a)&&(this.callback.call(this,this.element),this._lastHeight=t,!0)},t}(),Lazy=function(){function i(t,a){this.element=t,this.options=$.extend({},new LazyDefaultOptions,a);var o=$(window),n=this;this._init(),o.scroll(function(){n.scrollInvote()}),this.scrollInvote()}return i.prototype.scrollInvote=function(){var t=$(window),a=t.scrollTop(),o=t.height()+a;this.run(a,o)},i.prototype.run=function(t,a){if(this._data)for(var o=this._data.length-1;0<=o;o--){var n=this._data[o];n.run(t,a)&&n.mode==LazyMode.once&&this._data.splice(o,1)}},i.prototype._init=function(){var a=this;this._data=[];var e=this;this.element.each(function(t,a){var o=new LazyItem($(a),"function"!=typeof e.options.callback?i.getMethod(e.options.callback):e.options.callback,e.options.mode,e.options.diff);e._data.push(o)}),$.each(this.options.data,function(t,n){n instanceof LazyItem?a._data.push(n):("string"==typeof t&&(n.tag=t),$(n.tag).each(function(t,a){var o=new LazyItem($(a),"function"!=typeof n.callback?i.getMethod(n.callback):n.callback,n.mode||LazyMode.once,n.diff||0);e._data.push(o)}))})},i.addMethod=function(t,a){this.methods[t]=a},i.getMethod=function(t){return this.methods[t]},i.methods={},i}();Lazy.addMethod("img",function(t){var a=t.attr("data-original");$("<img />").bind("load",function(){t.attr("src",a)}).attr("src",a)}),Lazy.addMethod("tpl",function(a){var t=a.attr("data-url"),o=a.attr("data-tpl");$.getJSON(t,function(t){200==t.code&&("string"!=typeof t.data&&(t.data=template(o,t.data)),a.html(t.data))})}),Lazy.addMethod("scroll",function(a){var o=parseInt(a.attr("data-page")||"0")+1,t=a.attr("data-url"),n=a.attr("data-tpl"),e=a.attr("data-target");$.getJSON(t,{page:o},function(t){200==t.code&&("string"!=typeof t.data&&(t.data=template(n,t.data)),$(e).html(t.data),a.attr("data-page",o))})});var LazyDefaultOptions=function(){this.mode=LazyMode.once,this.diff=0};jQuery.fn.lazyload=function(t){return new Lazy(this,t)};