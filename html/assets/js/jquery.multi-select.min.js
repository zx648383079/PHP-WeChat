var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),CacheUrl=function(){function t(){}return t.hasData=function(t){return this._cacheData.hasOwnProperty(t)},t.hasEvent=function(t){return this._event.hasOwnProperty(t)},t.addEvent=function(t,e){this.hasEvent(t)?this._event[t].push(e):this._event[t]=[e]},t.getData=function(e,t){var n;this.hasData(e)?t(this._cacheData[e]):this.hasEvent(e)?this._event[e].push(t):(this._event[e]=[t],n=this,$.getJSON(e,function(t){200==t.code?n.setData(e,t.data):console.log("URL ERROR! "+e)}))},t.setData=function(t,e){this._cacheData[t]=e,this.hasEvent(t)&&(this._event[t].forEach(function(t){t(e)}),delete this._event[t])},t._cacheData={},t._event={},t}(),Eve=function(){function t(){}return t.prototype.on=function(t,e){return this.options["on"+t]=e,this},t.prototype.hasEvent=function(t){return this.options.hasOwnProperty("on"+t)},t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i="on"+t;if(this.hasEvent(t))return(i=this.options[i]).call.apply(i,[this].concat(e))},t}(),MultiSelect=function(o){function t(t,e){var n=o.call(this)||this,i=(n.element=t,n._index=-1,n);return n.options=$.extend({},new MultiSelectDefaultOptions,e),"function"==typeof n.options.data&&(n.options.data=n.options.data.call(n,function(t){i.options.data=t,i.init()})),"object"==typeof n.options.data?n.init():"string"==typeof n.options.data&&CacheUrl.getData(n.options.data,function(t){i.options.data=t,i.init()}),n}return __extends(t,o),Object.defineProperty(t.prototype,"val",{get:function(){var e="";return this.map(function(t){e=t}),e},set:function(t){this._val=t,this._selectedPath.apply(this,this.getPath(t))},enumerable:!0,configurable:!0}),t.prototype._selectedPath=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n,i=this.options.data;this._index=-1,this.element.html("");do{if(this._index++,n=t.shift(),"object"!=typeof i||!i.hasOwnProperty(n))return void this.addElement(i)}while(this.addElement(i,"请选择",n),i=i[n][this.options.children],0<t.length);n&&this.trigger("change")},t.prototype.init=function(){this._create(),this._bindEvent(),this.val=this._val||this.options.default},t.prototype._getHtml=function(t,e,n){var i="<option>"+(e=void 0===e?"请选择":e)+"</option>",o=this;return $.each(t,function(t,e){e=o._getIdAndName(e,t),t=e[0],e=e[1];i+=n&&t==n?'<option selected value="'+t+'">'+e+"</li>":'<option value="'+t+'">'+e+"</li>"}),'<select name="'+this.options.tag+'">'+i+"</ul>"},t.prototype._getIdAndName=function(t,e){if("object"!=typeof t)return[e,t];var n=t[this.options.name];return this.options.id&&t.hasOwnProperty(this.options.id)?[t[this.options.id],n]:[e,n]},t.prototype._create=function(){this.addElement(this.options.data)},t.prototype._bindEvent=function(){var n=this;this.element.on("change","select",function(){var t=$(this),e=t.val(),t=t.index();n.selected(e+"",t)})},t.prototype.bodyMap=function(i,t){void 0===t&&(t=this._index),this.element.find("select").eq(t).find("option").each(function(t,e){var e=$(e),n=e.val();if(n)return 0!=i.call(e,n,e.text(),t)&&void 0})},t.prototype.selected=function(t,e){void 0===e&&(e=this._index),this.remove(e+1);e=this._getNextData();return this.trigger("change"),"object"!=typeof e||e instanceof Array&&!(0<e.length)||this.addElement(e,"请选择"),e&&0!=e.length||this.trigger("done"),this},t.prototype._getNextData=function(){var e=this.options.data,n=this;return this.map(function(t){return"object"==typeof e&&e.hasOwnProperty(t)&&(e=e[t][n.options.children])?void 0:!(e=[])}),e},t.prototype.selectedId=function(e,t){void 0===t&&(t=this._index),this.bodyMap(function(t){if(t==e)return this.trigger("click"),!1},t)},t.prototype.addElement=function(t,e,n){t=this._getHtml(t,e=void 0===e?"请选择":e,n);return this.element.append(t),this},t.prototype.remove=function(t){void 0===t&&(t=1);for(var e=this.element.find("select"),n=e.length-1;t<=n;n--)e.eq(n).remove();return this},t.prototype.map=function(i){return this.element.find("select").each(function(t,e){var e=$(e),n=e.val();if(n)return 0!=i.call(e,n,e.find("option:selected").text(),t)&&void 0}),this},t.prototype.text=function(t){void 0===t&&(t=this.options.line);var n=[];return this.map(function(t,e){n.push(e)}),n.join(t)},t.prototype.lastText=function(){var n="请选择";return this.map(function(t,e){n=e}),n},t.prototype.all=function(){var e=[];return this.map(function(t){e.push(t)}),e},t.prototype.change=function(t){return this.on("change",t)},t.prototype.done=function(t){return this.on("done",t)},t.prototype.getPath=function(e){if(!e)return[];if(this.options.hasOwnProperty(e))return[e];var n=[],i=!1,o=this,r=function(t){if("object"==typeof t)return t.hasOwnProperty(e)?(n.push(e),void(i=!0)):void $.each(t,function(t,e){if(r(e[o.options.children]),i)return n.push(t),!1})};return $.each(this.options.data,function(t,e){if(r(e[o.options.children]),i)return n.push(t),!1}),n.reverse(),n},t}(Eve),MultiSelectDefaultOptions=function(){this.id="id",this.name="name",this.children="children"};jQuery.fn.multiSelect=function(t){return new MultiSelect(this,t)};