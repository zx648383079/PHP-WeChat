var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),__spreadArray=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var n,i=0,s=e.length;i<s;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},CacheUrl=function(){function t(){}return t.hasData=function(t){return this._cacheData.hasOwnProperty(t)},t.hasEvent=function(t){return this._event.hasOwnProperty(t)},t.addEvent=function(t,e){this.hasEvent(t)?this._event[t].push(e):this._event[t]=[e]},t.getData=function(e,t){var o;this.hasData(e)?t(this._cacheData[e]):this.hasEvent(e)?this._event[e].push(t):(this._event[e]=[t],o=this,$.getJSON(e,function(t){200==t.code?o.setData(e,t.data):console.log("URL ERROR! "+e)}))},t.setData=function(t,e){this._cacheData[t]=e,this.hasEvent(t)&&(this._event[t].forEach(function(t){t(e)}),delete this._event[t])},t._cacheData={},t._event={},t}(),Eve=function(){function t(){}return t.prototype.on=function(t,e){return this.options["on"+t]=e,this},t.prototype.hasEvent=function(t){return this.options.hasOwnProperty("on"+t)},t.prototype.trigger=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var n="on"+t;if(this.hasEvent(t))return(n=this.options[n]).call.apply(n,__spreadArray([this],e,!1))},t}(),MultiSelect=function(i){function t(t,e){var o=i.call(this)||this,n=(o.element=t,o._index=-1,o);return o.options=$.extend({},new MultiSelectDefaultOptions,e),o.customControl=o.options.searchable,o.customControl&&"string"==typeof o.options.data&&!o.options.searchUri&&(o.options.searchUri=o.options.data),"function"==typeof o.options.data&&(o.options.data=o.options.data.call(o,function(t){n.options.data=t,n.init()})),o.customControl||"object"==typeof o.options.data?o.init():"string"==typeof o.options.data&&CacheUrl.getData(o.options.data,function(t){n.options.data=t,n.init()}),o}return __extends(t,i),Object.defineProperty(t.prototype,"val",{get:function(){var e="";return this.map(function(t){e=t}),e},set:function(t){this._val=t,this._selectedPath.apply(this,this.getPath(t))},enumerable:!1,configurable:!0}),t.prototype._selectedPath=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.options.multiLevel){var o,n=this.options.data;this._index=-1,this.element.html("");do{if(this._index++,o=t.shift(),"object"!=typeof n||!n.hasOwnProperty(o))return void this.addElement(n)}while(this.addElement(n,"请选择",o),n=n[o][this.options.children],0<t.length);o&&this.trigger("change")}else this.controlVal(this.controlItems().eq(0),t[0])},t.prototype.init=function(){this._create(),this._bindEvent(),this.val=this._val||this.options.default},t.prototype._getHtml=function(t,e,o){var n=this,i=(void 0===e&&(e="请选择"),""),s=this;return $.each(t,function(t,e){e=s._getIdAndName(e,t),t=e[0],e=e[1];i+=n.renderOptionItem(t,e,o&&t==o)}),this.customControl?'<div class="select--with-search">\n            <div class="select-input">\n            '.concat(e,'\n            </div>\n            <div class="select-option-bar">\n                <div class="search-option-item">\n                    <input type="search" placeholder="Enter搜索">\n                    <i class="fa fa-search"></i>\n                </div>\n            </div>\n            <input type="hidden" name="').concat(this.options.tag,'">\n        </div>'):'<select name="'.concat(this.options.tag,'"><option>').concat(e,"</option>").concat(i,"</select>")},t.prototype.renderOptionItem=function(t,e,o){o=(o=void 0===o?!1:o)?" selected":"";return this.customControl?'<div class="option-item'.concat(o,'" data-value="').concat(t,'">').concat(e,"</div>"):'<option value="'.concat(t,'"').concat(o,">").concat(e,"</option>")},t.prototype._getIdAndName=function(t,e){if("object"!=typeof t)return[e,t];var o=t[this.options.name];return this.options.id&&t.hasOwnProperty(this.options.id)?[t[this.options.id],o]:[e,o]},t.prototype._create=function(){this.addElement("object"==typeof this.options.data?this.options.data:{})},t.prototype._bindEvent=function(){var o=this;this.customControl?(this.element.on("click",".select--with-search .select-input",function(){$(this).closest(".select--with-search").toggleClass("focus")}).on("keydown",".select--with-search .search-option-item input",function(t){var e;"Enter"===t.key&&(t.preventDefault(),t.stopPropagation(),e=(t=$(this)).closest(".select--with-search"),o.loadRomote(e,((e={})[o.options.query]=t.val(),e)))}).on("click",".select--with-search .option-item",function(){var t=$(this),e=$(this).closest(".select--with-search"),o=t.data("value");t.addClass("selected").siblings().removeClass("selected"),e.data("value",o),e.find(".select-input").text(t.text()),e.find("input[type=hidden]").val(o),e.trigger("change",[o,t.index()-2]),e.removeClass("focus")}).on("change",".select--with-search",function(t){var t=t[0],e=$(this).index();o.selected(t+"",e)}),$(document).on("click",function(t){var t=$(t.target),e=t.hasClass(".select--with-search")?t:t.closest(".select--with-search");o.controlItems().each(function(){var t=$(this);t.hasClass("focus")&&!t.is(e)&&t.removeClass("focus")})})):this.element.on("change","select",function(){var t=$(this),e=t.val(),t=t.index();o.selected(e+"",t)})},t.prototype.loadRomote=function(e,t,o){var n=this;t[this.options.parentId]=this.getParentId(e),e.addClass("select-loading"),$.getJSON(this.options.searchUri,t,function(t){e.removeClass("select-loading"),n.replaceOption(e,200===t.code?t.data:[]),o&&o()})},t.prototype.replaceOption=function(t,e){void 0===e&&(e=[]);var o=0,n=this;for(t.find(this.customControl?".option-item":"option").each(function(){var t=$(this);o>=e.length?t.remove():(n.optionVal(t,e[o][n.options.id]),t.text(e[o][n.options.name]),o++)});o<e.length;)this.appendOption(t,e[o]),o++},t.prototype.appendOption=function(t,e){(this.customControl?t.find(".select-option-bar"):t).append($(this.renderOptionItem(e[this.options.id],e[this.options.name])))},t.prototype.controlItems=function(){return this.element.find(this.customControl?".select--with-search":"select")},t.prototype.controlVal=function(t,o){var e,n,i,s=this;if(void 0===o)return this.customControl?t.data("value"):t.val();this.customControl?(n=this,t.find(".option-item").each(function(){var t=$(this),e=n.optionVal(t)==o;t.toggleClass(".selected",e),e&&(i=t)}),t.data("value",o),t.find("input[type=hidden]").val(o),i?t.find(".select-input").text(i.text()):this.loadRomote(t,((e={})[this.options.id]=o,e),function(){s.selectOption(t,o)})):t.val(o)},t.prototype.selectOption=function(t,o){var n;this.customControl?(n=this,t.find(".option-item").each(function(){var t=$(this),e=n.optionVal(t)==o;t.toggleClass(".selected",e)})):t.val(o)},t.prototype.optionVal=function(t,e){return void 0===e?this.customControl?t.data("value"):t.val():this.customControl?t.data("value",e):t.val(e)},t.prototype.getParentId=function(t){var e=this.controlItems(),t=e.index(t);return t<1?0:this.controlVal(e.eq(t-1))},t.prototype.bodyMap=function(n,t){void 0===t&&(t=this._index);var i=this;this.controlItems().eq(t).find(this.customControl?".option-item":"option").each(function(t,e){var e=$(e),o=i.optionVal(e);if(o)return 0!=n.call(e,o,e.text(),t)&&void 0})},t.prototype.selected=function(t,e){void 0===e&&(e=this._index),this.options.multiLevel&&this.remove(e+1),this.trigger("change");e=this.options.multiLevel?this._getNextData():void 0;return!this.options.multiLevel||"object"!=typeof e||e instanceof Array&&!(0<e.length)||this.addElement(e,"请选择"),e&&0!=e.length||this.trigger("done"),this},t.prototype._getNextData=function(){var e=this.options.data,o=this;return this.map(function(t){return"object"==typeof e&&e.hasOwnProperty(t)&&(e=e[t][o.options.children])?void 0:!(e=[])}),e},t.prototype.selectedId=function(e,t){void 0===t&&(t=this._index),this.bodyMap(function(t){if(t==e)return this.trigger("click"),!1},t)},t.prototype.addElement=function(t,e,o){t=this._getHtml(t,e=void 0===e?"请选择":e,o);return this.element.append(t),this},t.prototype.remove=function(t){void 0===t&&(t=1);for(var e=this.controlItems(),o=e.length-1;t<=o;o--)e.eq(o).remove();return this},t.prototype.map=function(n){var i=this;return this.controlItems().each(function(t,e){var e=$(e),o=i.controlVal(e);if(o)return 0!=n.call(e,o,e.find(i.customControl?".option-item.selected":"option:selected").text(),t)&&void 0}),this},t.prototype.text=function(t){void 0===t&&(t=this.options.line);var o=[];return this.map(function(t,e){o.push(e)}),o.join(t)},t.prototype.lastText=function(){var o="请选择";return this.map(function(t,e){o=e}),o},t.prototype.all=function(){var e=[];return this.map(function(t){e.push(t)}),e},t.prototype.change=function(t){return this.on("change",t)},t.prototype.done=function(t){return this.on("done",t)},t.prototype.getPath=function(e){if(!e)return[];if(!this.options.multiLevel||this.options.data.hasOwnProperty(e))return[e];var o=[],n=!1,i=this,s=function(t){if("object"==typeof t)return t.hasOwnProperty(e)?(o.push(e),void(n=!0)):void $.each(t,function(t,e){if(s(e[i.options.children]),n)return o.push(t),!1})};return $.each(this.options.data,function(t,e){if(s(e[i.options.children]),n)return o.push(t),!1}),o.reverse(),o},t}(Eve),MultiSelectDefaultOptions=function(){this.id="id",this.name="name",this.children="children",this.parentId="parent_id",this.query="keywords",this.multiLevel=!0};jQuery.fn.multiSelect=function(t){return new MultiSelect(this,t)};