var TargetMode;!function(t){t[t.tab=0]="tab",t[t.self=1]="self",t[t.blank=2]="blank",t[t.window=3]="window"}(TargetMode||(TargetMode={}));var NavbarDefaultOption=function(){return function(){}}(),NavItem=function(){function t(t,e,i,o,n,r){void 0===i&&(i="javascript:;"),void 0===n&&(n=TargetMode.tab),this.name=t,this.ico=e,this.url=i,this.children=o,this.target=n,this.id=r}return t.prototype.getChild=function(t){if(t.length<1)return this;if(!this.children)throw new Error("error id: "+t[0]);var e=t.shift();if(!this.children.hasOwnProperty(e))throw new Error("error id: "+e);return this.children[e].getChild(t)},t.prototype.addItem=function(t,e){return this.removeItem(t),this.children||(this.children={}),this.children[t]=e,this._renderChild(t,e),this},t.prototype.removeItem=function(t){return this.children?(this.children.hasOwnProperty(t)&&(this.children[t].remove(),delete this.children[t]),this):this},t.prototype.remove=function(){this.element.remove()},t.prototype.addActive=function(){return this.element.addClass("active").siblings().removeClass("active"),this},t.prototype.active=function(t){if(this.addActive(),!t||0==t.length||!this.children)return this.element.trigger("click"),this;var e="string"==typeof t?t:t.shift();if(!this.children.hasOwnProperty(e))throw new Error("error id: "+e);return"string"==typeof t?(this.children[e].active(),this):(this.children[e].active(t),this)},t.prototype.render=function(t){this.id=t,this.element=$("<li></li>"),this.element.data(this);var e='<a href="'+this.url+'">';return this.ico&&(e+='<i class="fa fa-'+this.ico+'"></i>'),e+="<span>"+this.name+"</span></a>",this.element.append(e),this._renderChildren(),this.element},t.prototype._addUl=function(){this.ul||(this.ul=$("<ul></ul>"),this.element.append(this.ul))},t.prototype._renderChildren=function(){if(this.children){this._addUl();var t=this.id+"/",e=this;$.each(this.children,function(i,o){e.ul.append(o.render(t+i))})}},t.prototype._renderChild=function(t,e){this._addUl(),this.ul.append(e.render(this.id+"/"+t))},t.prototype.clone=function(){var e=new t(this.name,this.ico,this.url);return e.id=this.id,e},t.parse=function(e){if(e instanceof t)return e;var i=new t(e.name);return e.hasOwnProperty("ico")&&(i.ico=e.ico),e.hasOwnProperty("target")&&(i.target="string"==typeof e.target?TargetMode[e.target]:e.target),e.hasOwnProperty("url")&&(i.url=e.url),e.hasOwnProperty("children")&&(i.children={},$.each(e.children,function(e,o){i.children[e]=t.parse(o)})),i},t}(),Tab=function(){function t(t,e){this.element=t,this.option=e,this._data=[],this._head=this.element.find(".zd-tab-head ul"),this._body=this.element.find(".zd-tab-body"),this._bindEvent()}return t.prototype._bindEvent=function(){var t=this;this._head.on("click",".zd-tab-item",function(){t.showItem($(this).index())}),this._head.on("click",".zd-tab-item .fa-close",function(){t.removeItem($(this).parent().index())})},t.prototype.setProperty=function(){var t=this._head.find(".zd-tab-item"),e=t.width();this._head.width(t.length*e)},t.prototype.addItem=function(t){this.hasItem(t)?this.showItem(t):(this._head.append('<li class="zd-tab-item"><span>'+t.name+'</span><i class="fa fa-close"></i></li>'),this._body.append('<iframe class="zd-tab-item" height="100%" src="'+t.url+'"></iframe>'),this._data.push(t.clone()),this.showItem(this._data.length-1),this.setProperty())},t.prototype.hasItem=function(t){return"string"!=typeof t&&(t=t.id),this._getIndexById(t)>=0},t.prototype.removeItem=function(t){if(!(this._data.length<2||("string"==typeof t&&(t=this._getIndexById(t)),t<0||t>=this._data.length))){var e=this._head.find(".zd-tab-item").eq(t);e.hasClass("active")&&this.showItem(t-1),e.remove(),this._body.find(".zd-tab-item").eq(t).remove(),this._data.splice(t,1)}},t.prototype.showItem=function(t){this._data.length<1||("string"==typeof t?t=this._getIndexById(t):"object"==typeof t&&(t=this._getIndexById(t.id)),t<0&&(t=0),t>=this._data.length&&(t=this._data.length-1),this._head.find(".zd-tab-item").eq(t).addClass("active").siblings().removeClass("active"),this._body.find(".zd-tab-item").eq(t).addClass("active").siblings().removeClass("active"),this.option.active&&this.option.active(this._data[t]),this._setHistory(this._data[t]))},t.prototype._getIndexById=function(t){for(var e=this._data.length-1;e>=0;e--)if(this._data[e].id==t)return e;return-1},t.prototype._setHistory=function(t){var e=window.location.href.split("#")[0]+"#"+t.id;history.pushState(t,t.name,e)},t}(),Navbar=function(){function t(t,e){this.element=t,this.option=$.extend({},new NavbarDefaultOption,e),this.tab=this.option.tab.tab({active:function(t){}}),this._bottom=this.element.find(".nav-bottom"),this._top=this.element.find(".nav-top"),this.refresh(),this._bindEvent();var i=window.location.href.split("#");i.length>1?this.open(i[1]):this.option.default&&this.open(this.option.default)}return t.prototype._bindEvent=function(){var t=this;this.element.on("click","li a",function(t){t.preventDefault()}),this.element.on("click","li",function(){var e=$(this).data();t.openItem(e)}),$(window).bind("popstate",function(e){var i=e.originalEvent.state;t.tab.showItem(i)}),$(window).resize(function(){t._setProperty(),t.tab.setProperty()})},t.prototype._setProperty=function(){this._top.height($(window).height()-this._top.offset().top-this._bottom.height())},t.prototype.open=function(t,e){void 0===e&&(e=!0),e=(o=this._pathToId(t,e))[0];var i=(t=o[1]).shift();if(this.option.data.hasOwnProperty(i))this.option.data[i].active(t);else if(this.option.bottom.hasOwnProperty(i))this.option.bottom[i].active(t);else{throw new Error("error id: "+i);var o}},t.prototype.openItem=function(t){if(t.addActive(),!(t.url.indexOf("#")>=0||t.url.indexOf("javascript:")>=0))switch(t.target){case TargetMode.tab:this.tab.addItem(t);break;case TargetMode.blank:window.open(t.url,"_blank");break;case TargetMode.self:window.location.href=t.url;break;case TargetMode.window:window.open(t.url)}},t.prototype.refresh=function(){this._addItem(this._top,this.option.data),this.option.bottom?(this._addItem(this._bottom,this.option.bottom),this._setProperty()):this._setProperty()},t.prototype.addItem=function(t,e){var i=this._pathToId(t),o=i[0],n=i[1],r=n.pop();if(n.length>0)this.getItem(n).addItem(r,NavItem.parse(e));else{this.removeItem([r],o);var h={};if(h[r]=e,o)return this.option.data[r]=e,void this._addItem(this._top,h);this.option.data[r]=e,this._addItem(this._bottom,h)}},t.prototype.removeItem=function(t,e){void 0===e&&(e=!0),e=(o=this._pathToId(t,e))[0];var i=(t=o[1]).pop();return t.length>0?(this.getItem(t).removeItem(i),this):e&&this.option.data.hasOwnProperty(i)?(this.option.data[i].remove(),delete this.option.data[i],this):this.option.bottom.hasOwnProperty(i)?(this.option.bottom[i].remove(),delete this.option.bottom[i],this):this;var o},t.prototype.getItem=function(t,e){void 0===e&&(e=!0),e=(o=this._pathToId(t,e))[0];var i=(t=o[1]).shift();if(e&&this.option.data.hasOwnProperty(i))return this.option.data[i].getChild(t);if(this.option.bottom.hasOwnProperty(i))return this.option.bottom[i].getChild(t);throw new Error("error id: "+i);var o},t.prototype._pathToId=function(t,e){if(void 0===e&&(e=!0),"string"!=typeof t)return[e,t];if(!e)return[e,[t]];var i=t.split(":");i.length>1&&"bottom"==i[0]&&(e=!1,t=i[1]);var o=[];return(i=t.split("/")).forEach(function(t){""!=t&&o.push(t)}),[e,o]},t.prototype._addItem=function(t,e){$.each(e,function(i,o){o=NavItem.parse(o),t.append(o.render(i)),e[i]=o})},t}();!function(t){t.fn.tab=function(t){return new Tab(this,t)},t.fn.navbar=function(t){return new Navbar(this,t)}}(jQuery);