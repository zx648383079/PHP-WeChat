var TargetMode;!function(t){t[t.tab=0]="tab",t[t.self=1]="self",t[t.blank=2]="blank",t[t.window=3]="window"}(TargetMode||(TargetMode={}));var NavbarDefaultOption=function(){},NavItem=function(){function o(t,e,i,o,n,r,h){void 0===i&&(i="javascript:;"),void 0===n&&(n=TargetMode.tab),this.name=t,this.ico=e,this.url=i,this.children=o,this.target=n,this.id=r,this.image=h}return o.prototype.getChild=function(t){if(t.length<1)return this;if(!this.children)throw new Error("error id: "+t[0]);var e=t.shift();if(!this.children.hasOwnProperty(e))throw new Error("error id: "+e);return this.children[e].getChild(t)},o.prototype.addItem=function(t,e){return this.removeItem(t),this.children||(this.children={}),this.children[t]=e,this._renderChild(t,e),this},o.prototype.removeItem=function(t){return this.children&&this.children.hasOwnProperty(t)&&(this.children[t].remove(),delete this.children[t]),this},o.prototype.remove=function(){this.element.remove()},o.prototype.addActive=function(){return this.element.addClass("active").siblings().removeClass("active"),this},o.prototype.active=function(t){if(this.addActive(),!t||0==t.length||!this.children)return this.element.trigger("click"),this;var e="string"==typeof t?t:t.shift();if(!this.children.hasOwnProperty(e))throw new Error("error id: "+e);return"string"==typeof t?this.children[e].active():this.children[e].active(t),this},o.prototype.render=function(t){this.id=t,this.element=$("<li></li>"),this.element.data(this);var e='<a href="'+this.url+'">';return this.ico&&(e+='<i class="fa fa-'+this.ico+'"></i>'),this.image&&(e+='<i class="fa image-icon" style="background-image: url('+this.image+')"></i>'),e+="<span>"+this.name+"</span></a>",this.element.append(e),this._renderChildren(),this.element},o.prototype._addUl=function(){this.ul||(this.ul=$("<ul></ul>"),this.element.append(this.ul))},o.prototype._renderChildren=function(){if(this.children){this._addUl();var i=this.id+"/",o=this;$.each(this.children,function(t,e){o.ul.append(e.render(i+t))})}},o.prototype._renderChild=function(t,e){this._addUl(),this.ul.append(e.render(this.id+"/"+t))},o.prototype.clone=function(){var t=new o(this.name,this.ico,this.url);return t.id=this.id,t},o.parse=function(t){if(t instanceof o)return t;var i=new o(t.name);return t.hasOwnProperty("ico")&&(i.ico=t.ico),t.hasOwnProperty("image")&&(i.image=t.image),t.hasOwnProperty("target")&&(i.target="string"==typeof t.target?TargetMode[t.target]:t.target),t.hasOwnProperty("url")&&(i.url=t.url),t.hasOwnProperty("children")&&(i.children={},$.each(t.children,function(t,e){i.children[t]=o.parse(e)})),i},o}(),Tab=function(){function t(t,e){this.element=t,this.option=e,this._data=[],this._head=this.element.find(".zd-tab-head ul"),this._body=this.element.find(".zd-tab-body"),this._bindEvent()}return t.prototype._bindEvent=function(){var t=this;this._head.on("click",".zd-tab-item",function(){t.showItem($(this).index())}),this._head.on("click",".zd-tab-item .fa-close",function(){t.removeItem($(this).parent().index())})},t.prototype.setProperty=function(){var t=this._head.find(".zd-tab-item"),e=t.width();this._head.width(t.length*e)},t.prototype.addItem=function(t){this.hasItem(t)?this.showItem(t):(this._head.append('<li class="zd-tab-item"><span>'+t.name+'</span><i class="fa fa-close"></i></li>'),this._body.append('<iframe class="zd-tab-item" height="100%" src="'+t.url+'"></iframe>'),this._data.push(t.clone()),this.showItem(this._data.length-1),this.setProperty())},t.prototype.hasItem=function(t){return"string"!=typeof t&&(t=t.id),0<=this._getIndexById(t)},t.prototype.removeItem=function(t){if(!(this._data.length<2||("string"==typeof t&&(t=this._getIndexById(t)),t<0||t>=this._data.length))){var e=this._head.find(".zd-tab-item").eq(t);e.hasClass("active")&&this.showItem(t-1),e.remove(),this._body.find(".zd-tab-item").eq(t).remove(),this._data.splice(t,1)}},t.prototype.showItem=function(t){this._data.length<1||("string"==typeof t?t=this._getIndexById(t):"object"==typeof t&&(t=this._getIndexById(t.id)),t<0&&(t=0),t>=this._data.length&&(t=this._data.length-1),this._head.find(".zd-tab-item").eq(t).addClass("active").siblings().removeClass("active"),this._body.find(".zd-tab-item").eq(t).addClass("active").siblings().removeClass("active"),this.option.active&&this.option.active(this._data[t]),this._setHistory(this._data[t]))},t.prototype._getIndexById=function(t){for(var e=this._data.length-1;0<=e;e--)if(this._data[e].id==t)return e;return-1},t.prototype._setHistory=function(t){var e=window.location.href.split("#")[0]+"#"+t.id;history.pushState(t,t.name,e)},t}(),Navbar=function(){function t(t,e){this.element=t,this.option=$.extend({},new NavbarDefaultOption,e),this.tab=$(this.option.tab).tab({active:function(t){}}),this._bottom=this.element.find(".nav-bottom"),this._top=this.element.find(".nav-top"),this.refresh(),this._bindEvent();var i=window.location.href.split("#");1<i.length?this.open(i[1]):this.option.default&&this.open(this.option.default)}return t.prototype._bindEvent=function(){var i=this;this.element.on("click","li a",function(t){t.preventDefault()}),this.element.on("click","li",function(){var t=$(this).data();i.openItem(t)}),$(window).bind("popstate",function(t){var e=t.originalEvent.state;i.tab.showItem(e)}),$(window).resize(function(){i._setProperty(),i.tab.setProperty()})},t.prototype._setProperty=function(){this._top.height($(window).height()-this._top.offset().top-this._bottom.height())},t.prototype.open=function(t,e){void 0===e&&(e=!0),e=(i=this._pathToId(t,e))[0];var i,o=(t=i[1]).shift();if(this.option.data.hasOwnProperty(o))this.option.data[o].active(t);else{if(!this.option.bottom.hasOwnProperty(o))throw new Error("error id: "+o);this.option.bottom[o].active(t)}},t.prototype.openItem=function(t){if(t.addActive(),!(0<=t.url.indexOf("#")||0<=t.url.indexOf("javascript:")))switch(t.target){case TargetMode.tab:this.tab.addItem(t);break;case TargetMode.blank:window.open(t.url,"_blank");break;case TargetMode.self:window.location.href=t.url;break;case TargetMode.window:window.open(t.url)}},t.prototype.refresh=function(){this._addItem(this._top,this.option.data),this.option.bottom&&this._addItem(this._bottom,this.option.bottom),this._setProperty()},t.prototype.addItem=function(t,e){var i=this._pathToId(t),o=i[0],n=i[1],r=n.pop();if(0<n.length)this.getItem(n).addItem(r,NavItem.parse(e));else{this.removeItem([r],o);var h={};if(h[r]=e,o)return this.option.data[r]=e,void this._addItem(this._top,h);this.option.data[r]=e,this._addItem(this._bottom,h)}},t.prototype.removeItem=function(t,e){void 0===e&&(e=!0),e=(i=this._pathToId(t,e))[0];var i,o=(t=i[1]).pop();return 0<t.length?this.getItem(t).removeItem(o):e&&this.option.data.hasOwnProperty(o)?(this.option.data[o].remove(),delete this.option.data[o]):this.option.bottom.hasOwnProperty(o)&&(this.option.bottom[o].remove(),delete this.option.bottom[o]),this},t.prototype.getItem=function(t,e){void 0===e&&(e=!0),e=(i=this._pathToId(t,e))[0];var i,o=(t=i[1]).shift();if(e&&this.option.data.hasOwnProperty(o))return this.option.data[o].getChild(t);if(this.option.bottom.hasOwnProperty(o))return this.option.bottom[o].getChild(t);throw new Error("error id: "+o)},t.prototype._pathToId=function(t,e){if(void 0===e&&(e=!0),"string"!=typeof t)return[e,t];if(!e)return[e,[t]];var i=t.split(":");1<i.length&&"bottom"==i[0]&&(e=!1,t=i[1]),i=t.split("/");var o=[];return i.forEach(function(t){""!=t&&o.push(t)}),[e,o]},t.prototype._addItem=function(i,o){$.each(o,function(t,e){e=NavItem.parse(e),i.append(e.render(t)),o[t]=e})},t}();!function(t){t.fn.tab=function(t){return new Tab(this,t)},t.fn.navbar=function(t){return new Navbar(this,t)}}(jQuery);