var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),Eve=function(){function t(){}return t.prototype.on=function(t,e){return this.options["on"+t]=e,this},t.prototype.hasEvent=function(t){return this.options.hasOwnProperty("on"+t)},t.prototype.trigger=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var i="on"+t;if(this.hasEvent(t)){return(n=this.options[i]).call.apply(n,[this].concat(e));var n}},t}(),Box=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.showPosition=function(){return this.setPosition(),this.box.show(),this},e.prototype.setPosition=function(){var t=this.element.offset(),e=t.left-$(window).scrollLeft(),o=t.top+this.element.outerHeight()-$(window).scrollTop();return this.box.css({left:e+"px",top:o+"px"}),this},e.getReal=function(t,e){return e>1?e:t*e},e}(Eve),Uri=function(){function t(t,e){void 0===t&&(t=""),void 0===e&&(e={}),this._path=t,this._data=e,t.indexOf("?")>=0&&(t=(o=this._parseUrl(t))[0],e=o[1]);var o}return t.prototype.setData=function(t,e){return"object"==typeof t?this._data=$.extend(this._data,t):this._data[t]=e,this},t.prototype.clearData=function(){return this._data={},this},t.prototype.get=function(t,e){$.get(this.toString(),t,e)},t.prototype.getJson=function(t){$.getJSON(this.toString(),t)},t.prototype.post=function(t,e,o){$.post(this.toString(),t,e,o)},t.parse=function(e){return"object"==typeof e?e:new t(e)},t.prototype.toString=function(){var e=t.getData(this._data);return""==e?this._path:this._path+"?"+e},t.getData=function(e){if("object"!=typeof e)return e;var o="";return $.each(e,function(e,i){o+=t._filterValue(i,e)}),o.substring(0,o.length-1)},t._filterValue=function(e,o){if("object"!=typeof e)return o+"="+e+"&";var i="",n=e instanceof Array;return $.each(e,function(e,s){i+=t._filterValue(s,o+(n?"[]":"["+e+"]"))}),i},t.prototype._parseUrl=function(t){var e=t.split("?",2),o=e[0],i=e[1];if(!i)return[o,{}];for(var n,s={},r=i.split("&"),a=r.length,c=0;c<a;c++)r[c]&&(s[(n=r[c].split("="))[0]]=n[1]);return[o,s]},t}(),Page=function(t){function e(e,o){var i=t.call(this)||this;return i.element=e,i.options=$.extend({},new PageDefaultOption,o),i.options.url=Uri.parse(i.options.url),i.options.deleteUrl=Uri.parse(i.options.deleteUrl),i.options.updateUrl=Uri.parse(i.options.updateUrl),i.init(),i.search(),i}return __extends(e,t),e.prototype.init=function(){var t=this;this._body=this.element.find(this.options.pageBody),this._searchForm=this.element.find(this.options.searchForm),this._searchElements=this._searchForm.find("input,select,textarea"),this._pager=$('<ul class="pager"></ul>').pager({paginate:function(e){t.search("page",e)}}),this._checkAll=this.element.find(".checkAll"),this.element.append(this._pager.element),this._bindEvent()},e.prototype.checkAll=function(){this._body.find(".checkbox").addClass("checked")},e.prototype.getCheckedRow=function(){var t=[],e=this;return this._body.find(".checkbox.checked").each(function(o,i){t.push($(i).parents(e.options.row))}),t},e.prototype.getChecked=function(){var t=[],e=this;return $.each(this.getCheckedRow(),function(o,i){t.push(i.attr(e.options.idTag))}),t},e.prototype.sort=function(t,e){this.search({sort:t,order:e})},e.prototype.search=function(t,e){void 0===t&&(t={}),"object"!=typeof t&&((o={})[t]=e,t=o),t.hasOwnProperty("page")||(t.page=1),this.options.url.setData(t),this.refresh();var o},e.prototype.deleteChecked=function(){var t=this,e=[];this.getCheckedRow().forEach(function(o){e.push(o.attr(t.options.idTag))}),this.deleteId.apply(this,e)},e.prototype.deleteRow=function(t){var e=t.attr(this.options.idTag);e&&this.deleteId(e)},e.prototype._getIdTag=function(){return this.options.idTag.replace("data-","")},e.prototype.deleteId=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0!=t.length){var o=this;0!=this.trigger.apply(this,["delete"].concat(t))?this.options.deleteUrl.setData(this._getIdTag(),t).post({},function(t){0==t.code&&o.refresh()},"json"):console.log("delete is stop!")}},e.prototype.refresh=function(){var t=this;this.options.beforeQuery&&0==this.options.beforeQuery.call(this)?console.log("query is stop!"):this.options.url.getJson(function(e){t.options.afterQuery&&t.options.afterQuery.call(this,e),0==e.code?(t._createBody(e.data.pagelist),t._pager.change(e.data.page,Math.ceil(e.data.total/e.data.pageSize))):console.log(e)})},e.prototype._checkEmpty=function(t){return!t||""==t||""==t.trim()},e.prototype.updateColumn=function(t){var e=t.attr("data-name");if(!this._checkEmpty(e)){var o=t.parents(this.options.row).attr(this.options.idTag);if(!(this._checkEmpty(o)||this.options.beforeUpdate&&0==this.options.beforeUpdate.call(this,t,o))){var i=this,n=$('<input type="text">');n.val(t.text()),n.blur(function(){var s=n.val();n.remove(),t.text(s),i.updateData(o,e,s)}),t.html("").append(n),n.focus()}}},e.prototype.updateData=function(t,e,o){if(0!=this.trigger("update",t,e,o)){this.options.updateUrl.post((i={},i[this._getIdTag()]=t,i.name=e,i.value=o,i),function(t){},"json");var i}else console.log("update is stop!")},e.prototype._bindEvent=function(){var t=this;this._searchForm.find("[type=submit]").click(function(){t.search(t._getSearchFormData())}),this.element.find(this.options.sortRow+">*").click(function(){var e=$(this),o=e.attr("data-name");t._checkEmpty(o)||(e.hasClass("sort-asc")?(e.removeClass().addClass("sort-desc"),t.sort(o,"desc")):(e.removeClass().addClass("sort-asc"),t.sort(o,"asc")))}),this._checkAll.click(function(){var e=$(this);e.hasClass("checked")?e.removeClass("checked"):(t._checkAll.addClass("checked"),t._body.find(".checkbox").addClass("checked"))}),this.element.find(".deleteAll").click(function(){var e=$(this).attr("data-tip")||t.options.deleteTip;confirm(e)&&t.deleteChecked()}),this.element.find(this.options.filterRow+" input").blur(function(){t._searchElement($(this))}),this.element.find(this.options.filterRow+" select").change(function(){t._searchElement($(this))}),this._body.on("click",".delete",function(){var e=$(this),o=e.attr("data-tip")||t.options.deleteTip;confirm(o)&&t.deleteRow(e.parents(t.options.row))}),this._body.on("click",".checkbox",function(){var e=$(this);if(e.hasClass("checked"))return e.removeClass("checked"),void t._checkAll.removeClass("checked");e.addClass("checked")}),this._body.on("click",this.options.column,function(){t.updateColumn($(this))})},e.prototype._searchElement=function(t){var e=t.attr("name");e&&this.search(e,t.val())},e.prototype._createBody=function(t){var e="";if("object"==typeof t){var o=this;$.each(t,function(t,i){e+=o.options.createRow(i)})}else e=t;this._body.html(e)},e.prototype._getSearchFormData=function(){var t={};return this._searchElements.each(function(e,o){var i=$(o),n=i.attr("name");i.is("[type=ridio]")?i.is(":checked")&&(t[n]=i.val()):i.is("[type=checkbox]")?i.is(":checked")&&(t[n]=i.val()):t[n]=i.val()}),t},e.prototype.delete=function(t){return this.on("delete",t)},e.prototype.update=function(t){return this.on("update",t)},e}(Box),PageDefaultOption=function(){return function(){this.url="query",this.updateUrl="update",this.deleteUrl="delete",this.idTag="data-id",this.searchForm=".page-search",this.deleteTip="确定删除？",this.pageBody=".page-body",this.filterRow=".filter-row",this.sortRow=".sort-row",this.row="tr",this.column="td"}}();jQuery.fn.page=function(t){return new Page(this,t)};