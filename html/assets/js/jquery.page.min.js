var __extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),Eve=function(){function t(){}return t.prototype.on=function(t,e){return this.options["on"+t]=e,this},t.prototype.hasEvent=function(t){return this.options.hasOwnProperty("on"+t)},t.prototype.trigger=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var i="on"+t;if(this.hasEvent(t))return(i=this.options[i]).call.apply(i,[this].concat(e))},t}(),Box=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.showPosition=function(){return this.setPosition(),this.box.show(),this},e.prototype.setPosition=function(){var t=this.element.offset(),e=t.left-$(window).scrollLeft(),t=t.top+this.element.outerHeight()-$(window).scrollTop();return this.box.css({left:e+"px",top:t+"px"}),this},e.getReal=function(t,e){return 1<e?e:t*e},e}(Eve),Uri=function(){function s(t,e){var o;void 0===t&&(t=""),void 0===e&&(e={}),this._path=t,this._data=e,0<=t.indexOf("?")&&(t=(o=this._parseUrl(t))[0],e=o[1])}return s.prototype.setData=function(t,e){return"object"==typeof t?this._data=$.extend(this._data,t):this._data[t]=e,this},s.prototype.clearData=function(){return this._data={},this},s.prototype.get=function(t,e){$.get(this.toString(),t,e)},s.prototype.getJson=function(t){$.getJSON(this.toString(),t)},s.prototype.post=function(t,e,o){$.post(this.toString(),t,e,o)},s.parse=function(t){return"object"==typeof t?t:new s(t)},s.prototype.toString=function(){var t=s.getData(this._data);return""==t?this._path:this._path+"?"+t},s.getData=function(t){if("object"!=typeof t)return t;var o="";return $.each(t,function(t,e){o+=s._filterValue(e,t)}),o.substring(0,o.length-1)},s._filterValue=function(t,o){if("object"!=typeof t)return o+"="+t+"&";var i="",n=t instanceof Array;return $.each(t,function(t,e){i+=s._filterValue(e,o+(n?"[]":"["+t+"]"))}),i},s.prototype._parseUrl=function(t){var e=t.split("?",2),t=e[0],e=e[1];if(!e)return[t,{}];for(var o,i={},n=e.split("&"),s=n.length,r=0;r<s;r++)n[r]&&(i[(o=n[r].split("="))[0]]=o[1]);return[t,i]},s}(),Page=function(i){function t(t,e){var o=i.call(this)||this;return o.element=t,o.options=$.extend({},new PageDefaultOption,e),o.options.url=Uri.parse(o.options.url),o.options.deleteUrl=Uri.parse(o.options.deleteUrl),o.options.updateUrl=Uri.parse(o.options.updateUrl),o.init(),o.search(),o}return __extends(t,i),t.prototype.init=function(){var e=this;this._body=this.element.find(this.options.pageBody),this._searchForm=this.element.find(this.options.searchForm),this._searchElements=this._searchForm.find("input,select,textarea"),this._pager=$('<ul class="pager"></ul>').pager({paginate:function(t){e.search("page",t)}}),this._checkAll=this.element.find(".checkAll"),this.element.append(this._pager.element),this._bindEvent()},t.prototype.checkAll=function(){this._body.find(".checkbox").addClass("checked")},t.prototype.getCheckedRow=function(){var o=[],i=this;return this._body.find(".checkbox.checked").each(function(t,e){o.push($(e).parents(i.options.row))}),o},t.prototype.getChecked=function(){var o=[],i=this;return $.each(this.getCheckedRow(),function(t,e){o.push(e.attr(i.options.idTag))}),o},t.prototype.sort=function(t,e){this.search({sort:t,order:e})},t.prototype.search=function(t,e){var o;void 0===t&&(t={}),"object"!=typeof t&&((o={})[t]=e,t=o),t.hasOwnProperty("page")||(t.page=1),this.options.url.setData(t),this.refresh()},t.prototype.deleteChecked=function(){var t=this.getCheckedRow(),e=this,o=[];t.forEach(function(t){o.push(t.attr(e.options.idTag))}),this.deleteId.apply(this,o)},t.prototype.deleteRow=function(t){t=t.attr(this.options.idTag);t&&this.deleteId(t)},t.prototype._getIdTag=function(){return this.options.idTag.replace("data-","")},t.prototype.deleteId=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];0!=t.length&&(0!=(e=this).trigger.apply(this,["delete"].concat(t))?this.options.deleteUrl.setData(this._getIdTag(),t).post({},function(t){200==t.code&&e.refresh()},"json"):console.log("delete is stop!"))},t.prototype.refresh=function(){var e=this;this.options.beforeQuery&&0==this.options.beforeQuery.call(this)?console.log("query is stop!"):this.options.url.getJson(function(t){e.options.afterQuery&&e.options.afterQuery.call(this,t),200==t.code?(e._createBody(t.data.pagelist),e._pager.change(t.data.page,Math.ceil(t.data.total/t.data.pageSize))):console.log(t)})},t.prototype._checkEmpty=function(t){return!t||""==t||""==t.trim()},t.prototype.updateColumn=function(e){var o,i,n,s=e.attr("data-name");this._checkEmpty(s)||(o=e.parents(this.options.row).attr(this.options.idTag),this._checkEmpty(o)||this.options.beforeUpdate&&0==this.options.beforeUpdate.call(this,e,o)||(i=this,(n=$('<input type="text">')).val(e.text()),n.blur(function(){var t=n.val();n.remove(),e.text(t),i.updateData(o,s,t)}),e.html("").append(n),n.focus()))},t.prototype.updateData=function(t,e,o){var i;0!=this.trigger("update",t,e,o)?this.options.updateUrl.post(((i={})[this._getIdTag()]=t,i.name=e,i.value=o,i),function(t){},"json"):console.log("update is stop!")},t.prototype._bindEvent=function(){var o=this;this._searchForm.find("[type=submit]").click(function(){o.search(o._getSearchFormData())}),this.element.find(this.options.sortRow+">*").click(function(){var t=$(this),e=t.attr("data-name");o._checkEmpty(e)||(t.hasClass("sort-asc")?(t.removeClass().addClass("sort-desc"),o.sort(e,"desc")):(t.removeClass().addClass("sort-asc"),o.sort(e,"asc")))}),this._checkAll.click(function(){var t=$(this);t.hasClass("checked")?t.removeClass("checked"):(o._checkAll.addClass("checked"),o._body.find(".checkbox").addClass("checked"))}),this.element.find(".deleteAll").click(function(){var t=$(this).attr("data-tip")||o.options.deleteTip;confirm(t)&&o.deleteChecked()}),this.element.find(this.options.filterRow+" input").blur(function(){o._searchElement($(this))}),this.element.find(this.options.filterRow+" select").change(function(){o._searchElement($(this))}),this._body.on("click",".delete",function(){var t=$(this),e=t.attr("data-tip")||o.options.deleteTip;confirm(e)&&o.deleteRow(t.parents(o.options.row))}),this._body.on("click",".checkbox",function(){var t=$(this);if(t.hasClass("checked"))return t.removeClass("checked"),void o._checkAll.removeClass("checked");t.addClass("checked")}),this._body.on("click",this.options.column,function(){o.updateColumn($(this))})},t.prototype._searchElement=function(t){var e=t.attr("name");e&&this.search(e,t.val())},t.prototype._createBody=function(t){var o,i="";"object"==typeof t?(o=this,$.each(t,function(t,e){i+=o.options.createRow(e)})):i=t,this._body.html(i)},t.prototype._getSearchFormData=function(){var i={};return this._searchElements.each(function(t,e){var o=$(e),e=o.attr("name");o.is("[type=ridio]")?o.is(":checked")&&(i[e]=o.val()):o.is("[type=checkbox]")&&!o.is(":checked")||(i[e]=o.val())}),i},t.prototype.delete=function(t){return this.on("delete",t)},t.prototype.update=function(t){return this.on("update",t)},t}(Box),PageDefaultOption=function(){this.url="query",this.updateUrl="update",this.deleteUrl="delete",this.idTag="data-id",this.searchForm=".page-search",this.deleteTip="确定删除？",this.pageBody=".page-body",this.filterRow=".filter-row",this.sortRow=".sort-row",this.row="tr",this.column="td"};jQuery.fn.page=function(t){return new Page(this,t)};