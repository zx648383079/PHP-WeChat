var __spreadArray=this&&this.__spreadArray||function(e,t,i){if(i||2===arguments.length)for(var n,r=0,l=t.length;r<l;r++)!n&&r in t||((n=n||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))};!function(n){var t="timeupdate",i="play",r="pause",l="ended",o="volumeupdate",s="tap_play",a="tap_pause",u="boot",c="tap_volume",p="tap_time",d="full_screen",f="exit_full_screen",m=function(){for(var e=0,t=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]];e<t.length;e++){var i=t[e];if(i&&i[1]in document)return i}return!1}(),h=(e.prototype.on=function(e,t){return this.options["on"+e]=t,this},e.prototype.hasEvent=function(e){return this.options.hasOwnProperty("on"+e)},e.prototype.trigger=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n="on"+e;if(this.hasEvent(e))return(n=this.options[n]).call.apply(n,__spreadArray([this],t,!1))},e.prototype.bindCustomEvent=function(){var n=this;this.on(u,function(){n.booted||("audio"===n.options.type?n.bindAudioEvent():"iframe"===n.options.type?(n.videoFrame(),n.booted=!0):(n.videoPlayer(),n.initBar(n.element.find(".player-bar")),n.bindVideoEvent()))}).on(s,function(){n.playerElement.play()}).on(a,function(){n.playerElement.pause()}).on(t,function(e,t){n.duration=t,n.playerBar.find(".time").text(n.formatMinute(e)+"/"+n.formatMinute(t));var i=n.playerBar.find(".slider .progress");i.attr("title",parseInt(e.toString())),i.find(".progress-bar").css("width",100*e/t+"%")}).on(i,function(){n.playerBar.find(".icon .fa").addClass("fa-pause").removeClass("fa-play")}).on(r,function(){n.playerBar.find(".icon .fa").removeClass("fa-pause").addClass("fa-play")}).on(l,function(){n.trigger(r)}).on(c,function(e){n.playerElement&&(n.playerElement.volume=e/100,n.trigger(o,e))}).on(o,function(e){var t=n.playerBar.find(".volume-slider .progress"),t=(t.attr("title",parseInt(e.toString())),t.find(".progress-bar").css("width",e+"%"),"fa-volume-up");e<=0?t="fa-volume-off":e<60&&(t="fa-volume-down"),n.playerBar.find(".volume-icon .fa").attr("class","fa "+t)}).on(p,function(e){n.playerElement&&(n.playerElement.currentTime=e)}).on(f,function(){n.playerBar.find(".full-icon .fa").attr("class","fa fa-expand"),n.element.removeClass("player-full")}).on(d,function(){n.element.addClass("player-full"),n.playerBar.find(".full-icon .fa").attr("class","fa fa-compress")})},e.prototype.hasExist=function(){return!this.options.src||this.element.has("iframe,video,audio").length},e.prototype.initExist=function(){var e=this.element.find("video");0<e.length?this.initVideoExist(e):0<(e=this.element.find("audio")).length?this.initAudioExist(e):this.element.addClass("video-player")},e.prototype.initAudioExist=function(e){this.element.addClass("audio-player"),this.options.type="audio",this.options.src||(this.options.src=e.attr("src")),e.removeAttr("controls"),this.playerElement=e[0],this.element.append(this.playerBarHtml()),this.initBar(this.element),this.bindAudioEvent()},e.prototype.initVideoExist=function(e){this.element.addClass("video-player"),this.options.type="video",this.options.src||(this.options.src=e.attr("src")),e.removeAttr("controls").addClass("player-video"),this.playerElement=e[0];var t=this.element.find(".player-bar");t.length<1&&(t=n(this.playerBarHtml()),e.after(t)),this.initBar(t),this.bindVideoEvent()},e.prototype.init=function(){"audio"===this.options.type?this.initAudio():this.initVideo()},e.prototype.initAudio=function(){this.audioPlayer(),this.initBar(this.element)},e.prototype.initBar=function(e){this.playerBar=e;var i=this;e.on("click",".icon .fa",function(){i.booted||i.trigger(u),i.trigger(n(this).hasClass("fa-play")?s:a)}).on("click",".volume-icon .fa",function(){var e=n(this);e.hasClass("fa-volume-mute")||e.hasClass("fa-volume-off")?i.trigger(c,i.volumeLast):(i.playerElement&&(i.volumeLast=100*i.playerElement.volume),i.trigger(c,0))}).on("click",".slider .progress",function(e){var t=n(this);i.trigger(p,(e.clientX-t.offset().left)*i.duration/t.width())}).on("click",".volume-slider .progress",function(e){var t=n(this);i.trigger(c,100*(e.clientX-t.offset().left)/t.width())}).on("click",".full-icon .fa",function(){i.element.hasClass("player-full")?i.exitFullscreen():i.fullScreen()})},e.prototype.initVideo=function(){var e=this;this.videoMask(),this.element.on("click",".player-mask",function(){e.trigger(u),e.playerElement&&e.trigger(s)})},e.prototype.bindAudioEvent=function(){var e=this;this.booted||(this.booted=!0,this.playerElement||(this.playerElement=document.createElement("audio")),this.options.src&&(this.playerElement.src=this.options.src),this.playerElement.addEventListener("timeupdate",function(){isNaN(e.playerElement.duration)||!isFinite(e.playerElement.duration)||e.playerElement.duration<=0?e.trigger(t,0,0):e.trigger(t,e.playerElement.currentTime,e.playerElement.duration)}),this.playerElement.addEventListener("ended",function(){e.trigger(l)}),this.playerElement.addEventListener("pause",function(){e.trigger(r)}),this.playerElement.addEventListener("play",function(){e.trigger(i)}),this.trigger(o,100*this.playerElement.volume))},e.prototype.bindVideoEvent=function(){var e=this;this.booted||(this.booted=!0,this.playerElement||(this.playerElement=this.element.find(".player-video")[0]),this.playerElement.addEventListener("timeupdate",function(){isNaN(e.playerElement.duration)||!isFinite(e.playerElement.duration)||e.playerElement.duration<=0?e.trigger(t,0,0):e.trigger(t,e.playerElement.currentTime,e.playerElement.duration)}),this.playerElement.addEventListener("ended",function(){e.trigger(l)}),this.playerElement.addEventListener("pause",function(){e.trigger(r)}),this.playerElement.addEventListener("play",function(){e.trigger(i)}),this.trigger(o,100*this.playerElement.volume),m&&document.addEventListener(m[4],function(){e.checkFull()?e.trigger(d):e.trigger(f)}))},e.prototype.audioPlayer=function(){this.element.addClass("audio-player"),this.element.html(this.playerBarHtml())},e.prototype.videoMask=function(){this.element.addClass("video-player"),this.element.html('<div class="player-mask" title="此处有视频，点击即可播放">\n            <i class="fa fa-play"></i>\n        </div>')},e.prototype.videoFrame=function(){this.element.html('\n            <iframe class="player-frame" src="'.concat(this.options.src,'" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>'))},e.prototype.videoPlayer=function(){this.element.html('<video class="player-video" src="'.concat(this.options.src,'"></video>').concat(this.playerBarHtml()))},e.prototype.playerBarHtml=function(){var e;return"iframe"===this.options.type?"":(e='<div class="icon" title="播放">\n            <i class="fa fa-play"></i>\n        </div>\n        <div class="slider">\n            <div class="progress" title="0">\n                <div class="progress-bar"></div>\n            </div>\n        </div>\n        <div class="time">\n            00:00/00:00\n        </div>\n        <div class="volume-icon">\n            <i class="fa fa-volume-up"></i>\n        </div>\n        <div class="volume-slider">\n            <div class="progress" title="100">\n                <div class="progress-bar" style="width: 100%;"></div>\n            </div>\n        </div>',"audio"===this.options.type?e:'<div class="player-bar">'.concat(e,'<div class="full-icon">\n            <i class="fa fa-expand"></i>\n        </div></div>'))},e.prototype.formatMinute=function(e){return this.twoPad(Math.floor(e/60))+":"+this.twoPad(Math.floor(e%60))},e.prototype.twoPad=function(e){e=e.toString();return e[1]?e:"0"+e},e.prototype.fullScreen=function(e){void 0===e&&(e=document.documentElement),m&&e[m[0]]()},e.prototype.exitFullscreen=function(e){void 0===e&&(e=document),m&&e[m[1]]()},e.prototype.checkFull=function(){return m&&Boolean(document[m[2]])},e);function e(e,t){this.element=e,this.options=t,this.booted=!1,this.volumeLast=100,this.duration=0,this.element.data("booted")||(this.element.data("booted",!0),this.bindCustomEvent(),this.hasExist()?this.initExist():this.init())}n.fn.player=function(t){if(this.length<2)return new h(this,t);this.each(function(){var e=n(this);new h(e,n.extend({},e.data(),t))})}}(jQuery);