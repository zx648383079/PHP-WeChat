var __spreadArray=this&&this.__spreadArray||function(e,t){for(var i=0,n=t.length,r=e.length;i<n;i++,r++)e[r]=t[i];return e},EVENT_TIME_UPDATE="timeupdate",EVENT_PLAY="play",EVENT_PAUSE="pause",EVENT_ENDED="ended",EVENT_VOLUME_UPDATE="volumeupdate",EVENT_TAP_PLAY="tap_play",EVENT_TAP_PAUSE="tap_pause",EVENT_BOOT="boot",EVENT_TAP_VOLUME="tap_volume",EVENT_TAP_TIME="tap_time",MediaPlayer=function(){function e(e,t){this.element=e,this.options=t,this.booted=!1,this.volumeLast=100,this.duration=0,this.options.src&&(this.init(),this.bindCustomEvent())}return e.prototype.on=function(e,t){return this.options["on"+e]=t,this},e.prototype.hasEvent=function(e){return this.options.hasOwnProperty("on"+e)},e.prototype.trigger=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n="on"+e;if(this.hasEvent(e))return(n=this.options[n]).call.apply(n,__spreadArray([this],t))},e.prototype.bindCustomEvent=function(){var n=this;this.on(EVENT_BOOT,function(){if(!n.booted)if("audio"!==n.options.type){if("iframe"===n.options.type)return n.videoFrame(),void(n.booted=!0);n.videoPlayer(),n.initBar(n.element.find(".player-bar")),n.bindVideoEvent()}else n.bindAudioEvent()}).on(EVENT_TAP_PLAY,function(){n.playerElement.play()}).on(EVENT_TAP_PAUSE,function(){n.playerElement.pause()}).on(EVENT_TIME_UPDATE,function(e,t){n.duration=t,n.playerBar.find(".time").text(n.formatMinute(e)+"/"+n.formatMinute(t));var i=n.playerBar.find(".slider .progress");i.attr("title",parseInt(e.toString())),i.find(".progress-bar").css("width",100*e/t+"%")}).on(EVENT_PLAY,function(){n.playerBar.find(".icon .fa").addClass("fa-pause").removeClass("fa-play")}).on(EVENT_PAUSE,function(){n.playerBar.find(".icon .fa").removeClass("fa-pause").addClass("fa-play")}).on(EVENT_ENDED,function(){n.trigger(EVENT_PAUSE)}).on(EVENT_TAP_VOLUME,function(e){n.playerElement&&(n.playerElement.volume=e/100,n.trigger(EVENT_VOLUME_UPDATE,e))}).on(EVENT_VOLUME_UPDATE,function(e){var t=n.playerBar.find(".volume-slider .progress");t.attr("title",parseInt(e.toString())),t.find(".progress-bar").css("width",e+"%");t="fa-volume-up";e<=0?t="fa-volume-off":e<60&&(t="fa-volume-down"),n.playerBar.find(".volume-icon .fa").attr("class","fa "+t)}).on(EVENT_TAP_TIME,function(e){n.playerElement&&(n.playerElement.currentTime=e)})},e.prototype.init=function(){"audio"!==this.options.type?this.initVideo():this.initAudio()},e.prototype.initAudio=function(){this.audioPlayer(),this.initBar(this.element)},e.prototype.initBar=function(e){this.playerBar=e;var i=this;e.on("click",".icon .fa",function(){i.booted||i.trigger(EVENT_BOOT),i.trigger($(this).hasClass("fa-play")?EVENT_TAP_PLAY:EVENT_TAP_PAUSE)}).on("click",".volume-icon .fa",function(){var e=$(this);e.hasClass("fa-volume-mute")||e.hasClass("fa-volume-off")?i.trigger(EVENT_TAP_VOLUME,i.volumeLast):(i.playerElement&&(i.volumeLast=100*i.playerElement.volume),i.trigger(EVENT_TAP_VOLUME,0))}).on("click",".slider .progress",function(e){var t=$(this);i.trigger(EVENT_TAP_TIME,(e.clientX-t.offset().left)*i.duration/t.width())}).on("click",".volume-slider .progress",function(e){var t=$(this);i.trigger(EVENT_TAP_VOLUME,100*(e.clientX-t.offset().left)/t.width())}).on("click",".full-icon .fa",function(){return i.element.hasClass("player-full")?(i.exitFullscreen(),void i.element.removeClass("player-full")):(i.element.addClass("player-full"),void i.fullScreen())})},e.prototype.initVideo=function(){var e=this;this.videoMask(),this.element.on("click",".player-mask",function(){e.trigger(EVENT_BOOT),e.playerElement&&e.trigger(EVENT_TAP_PLAY)})},e.prototype.bindAudioEvent=function(){var e=this;this.booted||(this.booted=!0,this.playerElement=document.createElement("audio"),this.playerElement.src=this.options.src,this.playerElement.addEventListener("timeupdate",function(){isNaN(e.playerElement.duration)||!isFinite(e.playerElement.duration)||e.playerElement.duration<=0?e.trigger(EVENT_TIME_UPDATE,0,0):e.trigger(EVENT_TIME_UPDATE,e.playerElement.currentTime,e.playerElement.duration)}),this.playerElement.addEventListener("ended",function(){e.trigger(EVENT_ENDED)}),this.playerElement.addEventListener("pause",function(){e.trigger(EVENT_PAUSE)}),this.playerElement.addEventListener("play",function(){e.trigger(EVENT_PLAY)}),this.trigger(EVENT_VOLUME_UPDATE,100*this.playerElement.volume))},e.prototype.bindVideoEvent=function(){var e=this;this.booted||(this.booted=!0,this.playerElement=this.element.find(".player-video")[0],this.playerElement.addEventListener("timeupdate",function(){isNaN(e.playerElement.duration)||!isFinite(e.playerElement.duration)||e.playerElement.duration<=0?e.trigger(EVENT_TIME_UPDATE,0,0):e.trigger(EVENT_TIME_UPDATE,e.playerElement.currentTime,e.playerElement.duration)}),this.playerElement.addEventListener("ended",function(){e.trigger(EVENT_ENDED)}),this.playerElement.addEventListener("pause",function(){e.trigger(EVENT_PAUSE)}),this.playerElement.addEventListener("play",function(){e.trigger(EVENT_PLAY)}),this.trigger(EVENT_VOLUME_UPDATE,100*this.playerElement.volume))},e.prototype.audioPlayer=function(){this.element.addClass("audio-player"),this.element.html('<div class="icon" title="播放">\n        <i class="fa fa-play"></i>\n    </div>\n    <div class="slider">\n        <div class="progress" title="0">\n            <div class="progress-bar"></div>\n        </div>\n    </div>\n    <div class="time">\n        00:00/00:00\n    </div>\n    <div class="volume-icon">\n        <i class="fa fa-volume-up"></i>\n    </div>\n    <div class="volume-slider">\n        <div class="progress" title="100">\n            <div class="progress-bar" style="width: 100%;"></div>\n        </div>\n    </div>')},e.prototype.videoMask=function(){this.element.addClass("video-player"),this.element.html('<div class="player-mask" title="此处有视频，点击即可播放">\n        <i class="fa fa-play"></i>\n    </div>')},e.prototype.videoFrame=function(){this.element.html('\n        <iframe class="player-frame" src="'+this.options.src+'" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>')},e.prototype.videoPlayer=function(){this.element.html('<video class="player-video" src="'+this.options.src+'"></video>\n        <div class="player-bar">\n            <div class="icon" title="播放">\n                <i class="fa fa-play"></i>\n            </div>\n            <div class="slider">\n                <div class="progress" title="0">\n                    <div class="progress-bar"></div>\n                </div>\n            </div>\n            <div class="time">\n                00:00/00:00\n            </div>\n            <div class="volume-icon">\n                <i class="fa fa-volume-up"></i>\n            </div>\n            <div class="volume-slider">\n                <div class="progress" title="100">\n                    <div class="progress-bar" style="width: 100%;"></div>\n                </div>\n            </div>\n            <div class="full-icon">\n                <i class="fa fa-expand"></i>\n            </div>\n        </div>')},e.prototype.formatMinute=function(e){return this.twoPad(Math.floor(e/60))+":"+this.twoPad(Math.floor(e%60))},e.prototype.twoPad=function(e){e=e.toString();return e[1]?e:"0"+e},e.prototype.fullScreen=function(){var e=document.documentElement;e.requestFullscreen&&e.requestFullscreen()},e.prototype.exitFullscreen=function(){document.exitFullscreen&&document.exitFullscreen()},e}();jQuery.fn.player=function(e){return new MediaPlayer(this,e)};