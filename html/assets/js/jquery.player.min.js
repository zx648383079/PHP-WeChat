var __spreadArray=this&&this.__spreadArray||function(e,t){for(var n=0,i=t.length,r=e.length;n<i;n++,r++)e[r]=t[n];return e};!function(i){var t="timeupdate",n="play",r="pause",l="ended",s="volumeupdate",a="tap_play",o="tap_pause",u="boot",c="tap_volume",d="tap_time",p="full_screen",f="exit_full_screen",m=function(){for(var e=0,t=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]];e<t.length;e++){var n=t[e];if(n&&n[1]in document)return n}return!1}(),v=(e.prototype.on=function(e,t){return this.options["on"+e]=t,this},e.prototype.hasEvent=function(e){return this.options.hasOwnProperty("on"+e)},e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i="on"+e;if(this.hasEvent(e))return(i=this.options[i]).call.apply(i,__spreadArray([this],t))},e.prototype.bindCustomEvent=function(){var i=this;this.on(u,function(){if(!i.booted)if("audio"!==i.options.type){if("iframe"===i.options.type)return i.videoFrame(),void(i.booted=!0);i.videoPlayer(),i.initBar(i.element.find(".player-bar")),i.bindVideoEvent()}else i.bindAudioEvent()}).on(a,function(){i.playerElement.play()}).on(o,function(){i.playerElement.pause()}).on(t,function(e,t){i.duration=t,i.playerBar.find(".time").text(i.formatMinute(e)+"/"+i.formatMinute(t));var n=i.playerBar.find(".slider .progress");n.attr("title",parseInt(e.toString())),n.find(".progress-bar").css("width",100*e/t+"%")}).on(n,function(){i.playerBar.find(".icon .fa").addClass("fa-pause").removeClass("fa-play")}).on(r,function(){i.playerBar.find(".icon .fa").removeClass("fa-pause").addClass("fa-play")}).on(l,function(){i.trigger(r)}).on(c,function(e){i.playerElement&&(i.playerElement.volume=e/100,i.trigger(s,e))}).on(s,function(e){var t=i.playerBar.find(".volume-slider .progress");t.attr("title",parseInt(e.toString())),t.find(".progress-bar").css("width",e+"%");t="fa-volume-up";e<=0?t="fa-volume-off":e<60&&(t="fa-volume-down"),i.playerBar.find(".volume-icon .fa").attr("class","fa "+t)}).on(d,function(e){i.playerElement&&(i.playerElement.currentTime=e)}).on(f,function(){i.playerBar.find(".full-icon .fa").attr("class","fa fa-expand"),i.element.removeClass("player-full")}).on(p,function(){i.element.addClass("player-full"),i.playerBar.find(".full-icon .fa").attr("class","fa fa-compress")})},e.prototype.init=function(){"audio"!==this.options.type?this.initVideo():this.initAudio()},e.prototype.initAudio=function(){this.audioPlayer(),this.initBar(this.element)},e.prototype.initBar=function(e){this.playerBar=e;var n=this;e.on("click",".icon .fa",function(){n.booted||n.trigger(u),n.trigger(i(this).hasClass("fa-play")?a:o)}).on("click",".volume-icon .fa",function(){var e=i(this);e.hasClass("fa-volume-mute")||e.hasClass("fa-volume-off")?n.trigger(c,n.volumeLast):(n.playerElement&&(n.volumeLast=100*n.playerElement.volume),n.trigger(c,0))}).on("click",".slider .progress",function(e){var t=i(this);n.trigger(d,(e.clientX-t.offset().left)*n.duration/t.width())}).on("click",".volume-slider .progress",function(e){var t=i(this);n.trigger(c,100*(e.clientX-t.offset().left)/t.width())}).on("click",".full-icon .fa",function(){n.element.hasClass("player-full")?n.exitFullscreen():n.fullScreen()})},e.prototype.initVideo=function(){var e=this;this.videoMask(),this.element.on("click",".player-mask",function(){e.trigger(u),e.playerElement&&e.trigger(a)})},e.prototype.bindAudioEvent=function(){var e=this;this.booted||(this.booted=!0,this.playerElement=document.createElement("audio"),this.playerElement.src=this.options.src,this.playerElement.addEventListener("timeupdate",function(){isNaN(e.playerElement.duration)||!isFinite(e.playerElement.duration)||e.playerElement.duration<=0?e.trigger(t,0,0):e.trigger(t,e.playerElement.currentTime,e.playerElement.duration)}),this.playerElement.addEventListener("ended",function(){e.trigger(l)}),this.playerElement.addEventListener("pause",function(){e.trigger(r)}),this.playerElement.addEventListener("play",function(){e.trigger(n)}),this.trigger(s,100*this.playerElement.volume))},e.prototype.bindVideoEvent=function(){var e=this;this.booted||(this.booted=!0,this.playerElement=this.element.find(".player-video")[0],this.playerElement.addEventListener("timeupdate",function(){isNaN(e.playerElement.duration)||!isFinite(e.playerElement.duration)||e.playerElement.duration<=0?e.trigger(t,0,0):e.trigger(t,e.playerElement.currentTime,e.playerElement.duration)}),this.playerElement.addEventListener("ended",function(){e.trigger(l)}),this.playerElement.addEventListener("pause",function(){e.trigger(r)}),this.playerElement.addEventListener("play",function(){e.trigger(n)}),this.trigger(s,100*this.playerElement.volume),m&&document.addEventListener(m[4],function(){e.checkFull()?e.trigger(p):e.trigger(f)}))},e.prototype.audioPlayer=function(){this.element.addClass("audio-player"),this.element.html('<div class="icon" title="播放">\n            <i class="fa fa-play"></i>\n        </div>\n        <div class="slider">\n            <div class="progress" title="0">\n                <div class="progress-bar"></div>\n            </div>\n        </div>\n        <div class="time">\n            00:00/00:00\n        </div>\n        <div class="volume-icon">\n            <i class="fa fa-volume-up"></i>\n        </div>\n        <div class="volume-slider">\n            <div class="progress" title="100">\n                <div class="progress-bar" style="width: 100%;"></div>\n            </div>\n        </div>')},e.prototype.videoMask=function(){this.element.addClass("video-player"),this.element.html('<div class="player-mask" title="此处有视频，点击即可播放">\n            <i class="fa fa-play"></i>\n        </div>')},e.prototype.videoFrame=function(){this.element.html('\n            <iframe class="player-frame" src="'+this.options.src+'" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>')},e.prototype.videoPlayer=function(){this.element.html('<video class="player-video" src="'+this.options.src+'"></video>\n            <div class="player-bar">\n                <div class="icon" title="播放">\n                    <i class="fa fa-play"></i>\n                </div>\n                <div class="slider">\n                    <div class="progress" title="0">\n                        <div class="progress-bar"></div>\n                    </div>\n                </div>\n                <div class="time">\n                    00:00/00:00\n                </div>\n                <div class="volume-icon">\n                    <i class="fa fa-volume-up"></i>\n                </div>\n                <div class="volume-slider">\n                    <div class="progress" title="100">\n                        <div class="progress-bar" style="width: 100%;"></div>\n                    </div>\n                </div>\n                <div class="full-icon">\n                    <i class="fa fa-expand"></i>\n                </div>\n            </div>')},e.prototype.formatMinute=function(e){return this.twoPad(Math.floor(e/60))+":"+this.twoPad(Math.floor(e%60))},e.prototype.twoPad=function(e){e=e.toString();return e[1]?e:"0"+e},e.prototype.fullScreen=function(e){void 0===e&&(e=document.documentElement),m&&e[m[0]]()},e.prototype.exitFullscreen=function(e){void 0===e&&(e=document),m&&e[m[1]]()},e.prototype.checkFull=function(){return m&&Boolean(document[m[2]])},e);function e(e,t){this.element=e,this.options=t,this.booted=!1,this.volumeLast=100,this.duration=0,this.options.src&&(this.init(),this.bindCustomEvent())}i.fn.player=function(e){return new v(this,e)}}(jQuery);