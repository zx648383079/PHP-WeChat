var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var o=Array(t),n=0;for(e=0;e<i;e++)for(var s=arguments[e],r=0,a=s.length;r<a;r++,n++)o[n]=s[r];return o},CacheUrl=function(){function t(){}return t.hasData=function(t){return this._cacheData.hasOwnProperty(t)},t.hasEvent=function(t){return this._event.hasOwnProperty(t)},t.addEvent=function(t,e){this.hasEvent(t)?this._event[t].push(e):this._event[t]=[e]},t.getData=function(e,t){if(this.hasData(e))t(this._cacheData[e]);else if(this.hasEvent(e))this._event[e].push(t);else{this._event[e]=[t];var i=this;$.getJSON(e,function(t){0!=t.code?console.log("URL ERROR! "+e):i.setData(e,t.data)})}},t.setData=function(t,e){this._cacheData[t]=e,this.hasEvent(t)&&(this._event[t].forEach(function(t){t(e)}),delete this._event[t])},t._cacheData={},t._event={},t}(),Eve=function(){function t(){}return t.prototype.on=function(t,e){return this.options["on"+t]=e,this},t.prototype.hasEvent=function(t){return this.options.hasOwnProperty("on"+t)},t.prototype.trigger=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];var n="on"+t;if(this.hasEvent(t))return(e=this.options[n]).call.apply(e,__spreadArrays([this],i))},t}(),SelectBox=function(n){function t(t,e){var i=n.call(this)||this;i.element=t,i._index=[],i._real_index=[],i.booted=!1,i.options=$.extend({},new SelectBoxDefaultOptions,e);var o=i;return"function"==typeof i.options.data?i._init():"object"==typeof i.options.data?i._init():"string"==typeof i.options.data&&CacheUrl.getData(i.options.data,function(t){o.options.data=t,o._init()}),i}return __extends(t,n),t.prototype._init=function(){var t=this;this.box=$('<div class="'+this._getBoxClass()+'" data-type="select"></div>'),$(document.body).append(this.box),this.box.html('<div class="dialog-header"><div class="dialog-close">取消</div><div class="dialog-title">'+this.options.title+'</div><div class="dialog-yes">确定</div></div><div class="dialog-body">'+this._createUl()+'<hr class="dialog-top-hr"><hr class="dialog-bottom-hr"></div>'),t._ulBox=[],this.box.find(".dialog-body ul").each(function(){t._ulBox.push($(this))}),this._bindEvent(),"function"!=typeof this.options.data?(this.triggerChange(0),this.notify()):this.triggerChange(0)},t.prototype._bindEvent=function(){var n=this;this.element.click(function(t){t.stopPropagation(),n.show()}),this.box.on("click",".dialog-close",function(){n.hide()}),this.box.on("click",".dialog-yes",function(){n.notify().hide()});function t(t){e._ulBox[t].on("click","li",function(){n.selected($(this),t)})}for(var s,e=this,i=0;i<this.options.column;i++)t(i);this.box.on("touchstart",function(t){var e=t.targetTouches[0];s={x:e.pageX,y:e.pageY}}).on("touchmove",function(t){var e=t.targetTouches[0];if(!(1<t.targetTouches.length||t.scale&&1!==t.scale)){t.preventDefault();var i=e.pageY-s.y,o=Math.abs(i);o>=n.options.lineHeight&&(s.y=e.pageY,n.touchMove(o,i<0,s.x))}})},t.prototype.triggerChange=function(i){var t;if(void 0===i&&(i=0),"function"==typeof this.options.data){function e(t,e){void 0===e&&(e=i),o.drawColum(t,e)}var o=this,n=[],s=!1;if(0<i&&this.mapSelected(function(t,e){return t.length<1?!(s=!0):(n.push(t.attr("data-value")),!(i-1<=e)&&void 0)}),!s){var r=(t=this.options.data).call.apply(t,__spreadArrays([this,e,i],n));"object"==typeof r&&e(r,i)}}else this.drawColum(this._getColumnOption(i),i)},t.prototype.touchMove=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=0);var o=e?Math.floor(t/this.options.lineHeight):-Math.ceil(t/this.options.lineHeight),n=0;return 0==o||(1<this.options.column&&(n=Math.floor(i/(this.box.width()/this.options.column))),this.selectedIndex(this._index[n]+o,n)),this},t.prototype.show=function(){return $('.dialog-select[data-type="select"]').hide(),this.box.show(),this},t.prototype.hide=function(){return this.box.hide(),this.restore(),this},t.prototype.restore=function(){for(var t=this._real_index.slice(),e=0;e<this.options.column;e++)this.selectedIndex(t[e],e);return this},t.prototype.refresh=function(){this._refreshUl(0,this.options.data);for(var t=0;t<this.options.column;t++)this._real_index[t]=0;return this.restore(),this},t.prototype.applyValue=function(t){if(this.options.column<2)return this.selectedValue(t);var e=this.getPath(t);return e&&0<e.length&&(this._real_index=e,this.restore()),this},t.prototype.getPath=function(o){if(!o)return[];if("function"!=typeof this.options.data)return[];var n=[],s=!1,r=this,a=function(t){if("object"==typeof t){var i=-1;$.each(t,function(t,e){return i++,t==o||e[r.options.valueTag]==o?(n.push(i),!(s=!0)):e.hasOwnProperty(r.options.childrenTag)?(a(e[r.options.childrenTag]),s?(n.push(i),!1):void 0):void 0})}},i=-1;return $.each(this.options.data,function(t,e){if(i++,a(e[r.options.childrenTag]),s)return n.push(i),!1}),n.reverse(),n},t.prototype._createUl=function(){for(var t="",e=0;e<this.options.column;e++)t+='<ul class="dialog-column-'+e+'"></ul>';return t},t.prototype._getBoxClass=function(){return this.options.column<2?"dialog dialog-select":"dialog dialog-select dialog-select-column-"+this.options.column},t.prototype._getOptionByIndex=function(t,e){if(void 0===e&&(e=0),t instanceof Array)return t[e][this.options.childrenTag];for(var i in t)if(t.hasOwnProperty(i)&&--e<0)return t[i][this.options.childrenTag];return null},t.prototype._getColumnOption=function(o){var n=this,s=this.options.data;return o<1||this.mapSelected(function(t,e){var i=t.attr("data-value");if(!(s=n._getChildren(i,s))||s.length<1||o-1<=e)return!1}),s},t.prototype._getChildren=function(t,e){if("object"!=typeof e)return[];if(!(e instanceof Array))return e.hasOwnProperty(t)?e[t][this.options.childrenTag]:[];for(var i=0;i<e.length;i++)if(e[i][this.options.valueTag]==t)return e[i][this.options.childrenTag];return[]},t.prototype._refreshUl=function(t,e){void 0===t&&(t=0),this._ulBox[t].html(this._createOptionHtml(e))},t.prototype.drawColum=function(t,e){this._refreshUl(e,t),!this.booted&&this.options.default&&this.options.default[e]?this.selectedValue(this.options.default[e],e):this.selectedIndex(0,e),!this.booted&&e>=this.options.column-1&&(this.booted=!0)},t.prototype.refreshColumn=function(t){if(void 0===t&&(t=0),"function"==typeof this.options.data)return this.triggerChange(t),this;var e=this._getColumnOption(t);return this._refreshUl(t,e),this.selectedIndex(0,t),this},t.prototype._createOptionHtml=function(t){var s="",r=this;return $.each(t,function(t,e){var i=r._getValueAndText(e,t),o=i[0],n=i[1];r.options.createOption&&(n=r.options.createOption(e,t)),s+='<li data-value="'+o+'">'+n+"</li>"}),s},t.prototype._getValueAndText=function(t,e){if("object"!=typeof t)return this.options.valueTag?[e,t]:[t,t];var i=t[this.options.textTag];return this.options.valueTag&&t.hasOwnProperty(this.options.valueTag)?[t[this.options.valueTag],i]:[e,i]},t.prototype.selected=function(t,e){return void 0===e&&(e=0),"number"==typeof t?this.selectedIndex(t,e):"object"==typeof t?this.selectedOption(t,e):this.selectedValue(t,e)},t.prototype.selectedIndex=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),t<0&&(t=0);var i=this._ulBox[e].find("li"),o=i.length;o<=t&&(t=o-1);var n=i.eq(t);return this.selectedOption(n,e),this},t.prototype.selectedValue=function(t,e){void 0===e&&(e=0);var i=this._ulBox[e].find('li[data-value="'+t+'"]');return i.length<1&&this.selectedIndex(0,e),this.selectedOption(i,e),this},t.prototype.selectedOption=function(t,e){void 0===e&&(e=0),t.addClass("active").siblings().removeClass("active"),this.booted&&this.trigger("change",e,t.data("value"),t.text(),t),this._index[e]=t.index();var i=2*this.options.lineHeight-this._index[e]*this.options.lineHeight;return this._ulBox[e].css("transform","translate(0px, "+i+"px) translateZ(0px)"),this.options.column>e+1&&this.refreshColumn(e+1),this},t.prototype.val=function(){var e=[];return this.mapSelected(function(t){e.push(t.data("value"))}),1<this.options.column?e:e[0]},t.prototype.mapSelected=function(t){for(var e=0;e<this.options.column&&(!t||!1!==t(this.getSelectedOption(e),e));e++);return this},t.prototype.getSelectedOption=function(t){return void 0===t&&(t=0),this._ulBox[t].find("li").eq(this._index[t])},t.prototype.notify=function(){this._real_index=this._index.slice();var e=[],i=[],o=[];return this.mapSelected(function(t){e.push(t),o.push(t.text()),i.push(t.data("value"))}),this.trigger.apply(this,__spreadArrays(["done"],i,o,e,this._index)),this},t.prototype.range=function(t,e,i){var o=[];for(void 0!==i&&0!==i||(i=e<t?-1:1);!(0<i&&e<t||i<0&&t<e);)o.push(t),t+=i;return o},t}(Eve),SelectBoxDefaultOptions=function(){this.title="请选择",this.column=1,this.textTag="value",this.valueTag="id",this.childrenTag="children",this.lineHeight=30},SelectElemnt=function(){function t(t){this.element=t,this._init()}return t.prototype._init=function(){this.element.hide(),this.selectInput=$('<div class="dialog-select-input"></div>'),this.element.after(this.selectInput);var i=this,t=this.element.val();this.box=new SelectBox(this.selectInput,{title:this._getTitle(),data:this._getOptions(),default:t,ondone:function(t,e){i.selectInput.text(e),i.element.val(t).trigger("change")}}),this.element.on("optionschange",function(){i.refresh()})},t.prototype._getOptions=function(){var t=[];return this.element.find("option").each(function(){t.push({id:this.getAttribute("value"),value:this.innerText})}),t},t.prototype.refresh=function(){return this.box.options.data=this._getOptions(),this.box.refresh(),this},t.prototype._getTitle=function(){var t=this.element.attr("id");if(!t||t.length<1)return"请选择";var e=$("label[for="+t+"]").text();return e?"请选择"+e:"请选择"},t}();!function(e){e.fn.select=function(t){return this.is("select")?(this.each(function(){new SelectElemnt(e(this))}),this):new SelectBox(this,t)}}(jQuery);