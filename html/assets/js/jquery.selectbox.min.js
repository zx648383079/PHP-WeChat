var __extends=this&&this.__extends||(()=>{var o=function(t,e){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};return function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}})(),__spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var o=Array(t),n=0,e=0;e<i;e++)for(var s=arguments[e],r=0,h=s.length;r<h;r++,n++)o[n]=s[r];return o},CacheUrl=(()=>{function t(){}return t.hasData=function(t){return this._cacheData.hasOwnProperty(t)},t.hasEvent=function(t){return this._event.hasOwnProperty(t)},t.addEvent=function(t,e){this.hasEvent(t)?this._event[t].push(e):this._event[t]=[e]},t.getData=function(e,t){var i;this.hasData(e)?t(this._cacheData[e]):this.hasEvent(e)?this._event[e].push(t):(this._event[e]=[t],i=this,$.getJSON(e,function(t){0==t.code?i.setData(e,t.data):console.log("URL ERROR! "+e)}))},t.setData=function(t,e){this._cacheData[t]=e,this.hasEvent(t)&&(this._event[t].forEach(function(t){t(e)}),delete this._event[t])},t._cacheData={},t._event={},t})(),Eve=(()=>{function t(){}return t.prototype.on=function(t,e){return this.options["on"+t]=e,this},t.prototype.hasEvent=function(t){return this.options.hasOwnProperty("on"+t)},t.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var o="on"+t;if(this.hasEvent(t))return(t=this.options[o]).call.apply(t,__spreadArrays([this],e))},t})(),SelectBox=(n=>{function t(t,e){var i=n.call(this)||this,o=(i.element=t,i._index=[],i._real_index=[],i.booted=!1,i.options=$.extend({},new SelectBoxDefaultOptions,e),i);return"function"==typeof i.options.data?i._init():"object"==typeof i.options.data?i._init():"string"==typeof i.options.data&&CacheUrl.getData(i.options.data,function(t){o.options.data=t,o._init()}),i}return __extends(t,n),t.prototype._init=function(){var t=this;this.box=$('<div class="'+this._getBoxClass()+'" data-type="select"></div>'),$(document.body).append(this.box),this.box.html('<div class="dialog-header"><div class="dialog-close">取消</div><div class="dialog-title">'+this.options.title+'</div><div class="dialog-yes">确定</div></div><div class="dialog-body">'+this._createUl()+'<hr class="dialog-top-hr"><hr class="dialog-bottom-hr"></div>'),t._ulBox=[],this.box.find(".dialog-body ul").each(function(){t._ulBox.push($(this))}),this._bindEvent(),"function"==typeof this.options.data?this.triggerChange(0):(this.triggerChange(0),this.notify())},t.prototype._bindEvent=function(){for(var o,n=this,e=(this.element.click(function(t){t.stopPropagation(),n.show()}),this.box.on("click",".dialog-close",function(){n.hide()}),this.box.on("click",".dialog-yes",function(){n.notify().hide()}),this),t=0;t<this.options.column;t++)(t=>{e._ulBox[t].on("click","li",function(){n.selected($(this),t)})})(t);this.box.on("touchstart",function(t){t=t.targetTouches[0];o={x:t.pageX,y:t.pageY}}).on("touchmove",function(t){var e,i=t.targetTouches[0];1<t.targetTouches.length||t.scale&&1!==t.scale||(t.preventDefault(),t=i.pageY-o.y,(e=Math.abs(t))>=n.options.lineHeight&&(o.y=i.pageY,n.touchMove(e,t<0,o.x)))})},t.prototype.triggerChange=function(i){var o,t,n,s,e;void 0===i&&(i=0),"function"!=typeof this.options.data?this.drawColum(this._getColumnOption(i),i):(o=this,t=function(t,e){void 0===e&&(e=i),o.drawColum(t,e)},s=!(n=[]),0<i&&this.mapSelected(function(t,e){return t.length<1?!(s=!0):(n.push(t.attr("data-value")),!(i-1<=e)&&void 0)}),s||"object"==typeof(e=(e=this.options.data).call.apply(e,__spreadArrays([this,t,i],n)))&&t(e,i))},t.prototype.touchMove=function(t,e,i){void 0===i&&(i=0);e=(e=void 0===e?!0:e)?Math.floor(t/this.options.lineHeight):-Math.ceil(t/this.options.lineHeight),t=0;return 0!=e&&(1<this.options.column&&(t=Math.floor(i/(this.box.width()/this.options.column))),this.selectedIndex(this._index[t]+e,t)),this},t.prototype.show=function(){return $('.dialog-select[data-type="select"]').hide(),this.box.show(),this},t.prototype.hide=function(){return this.box.hide(),this.restore(),this},t.prototype.restore=function(){for(var t=this._real_index.slice(),e=0;e<this.options.column;e++)this.selectedIndex(t[e],e);return this},t.prototype.refresh=function(){this._refreshUl(0,this.options.data);for(var t=0;t<this.options.column;t++)this._real_index[t]=0;return this.restore(),this},t.prototype.applyValue=function(t){return this.options.column<2?this.selectedValue(t):((t=this.getPath(t))&&0<t.length&&(this._real_index=t,this.restore()),this)},t.prototype.getPath=function(o){var n,s,r,h,i;return!o||"function"!=typeof this.options.data?[]:(s=!(n=[]),r=this,h=function(t){var i;"object"==typeof t&&(i=-1,$.each(t,function(t,e){return i++,t==o||e[r.options.valueTag]==o?(n.push(i),!(s=!0)):e.hasOwnProperty(r.options.childrenTag)&&(h(e[r.options.childrenTag]),s)?(n.push(i),!1):void 0}))},i=-1,$.each(this.options.data,function(t,e){if(i++,h(e[r.options.childrenTag]),s)return n.push(i),!1}),n.reverse(),n)},t.prototype._createUl=function(){for(var t="",e=0;e<this.options.column;e++)t+='<ul class="dialog-column-'+e+'"></ul>';return t},t.prototype._getBoxClass=function(){return this.options.column<2?"dialog dialog-select":"dialog dialog-select dialog-select-column-"+this.options.column},t.prototype._getOptionByIndex=function(t,e){if(void 0===e&&(e=0),t instanceof Array)return t[e][this.options.childrenTag];for(var i in t)if(t.hasOwnProperty(i)&&--e<0)return t[i][this.options.childrenTag];return null},t.prototype._getColumnOption=function(i){var o=this,n=this.options.data;return i<1||this.mapSelected(function(t,e){t=t.attr("data-value");if(!(n=o._getChildren(t,n))||n.length<1||i-1<=e)return!1}),n},t.prototype._getChildren=function(t,e){if("object"==typeof e){if(!(e instanceof Array))return e.hasOwnProperty(t)?e[t][this.options.childrenTag]:[];for(var i=0;i<e.length;i++)if(e[i][this.options.valueTag]==t)return e[i][this.options.childrenTag]}return[]},t.prototype._refreshUl=function(t,e){this._ulBox[t=void 0===t?0:t].html(this._createOptionHtml(e))},t.prototype.drawColum=function(t,e){this._refreshUl(e,t),!this.booted&&this.options.default&&this.options.default[e]?this.selectedValue(this.options.default[e],e):this.selectedIndex(0,e),!this.booted&&e>=this.options.column-1&&(this.booted=!0)},t.prototype.refreshColumn=function(t){var e;return void 0===t&&(t=0),"function"==typeof this.options.data?this.triggerChange(t):(e=this._getColumnOption(t),this._refreshUl(t,e),this.selectedIndex(0,t)),this},t.prototype._createOptionHtml=function(t){var n="",s=this;return $.each(t,function(t,e){var i=s._getValueAndText(e,t),o=i[0],i=i[1];s.options.createOption&&(i=s.options.createOption(e,t)),n+='<li data-value="'+o+'">'+i+"</li>"}),n},t.prototype._getValueAndText=function(t,e){var i;return"object"!=typeof t?this.options.valueTag?[e,t]:[t,t]:(i=t[this.options.textTag],this.options.valueTag&&t.hasOwnProperty(this.options.valueTag)?[t[this.options.valueTag],i]:[e,i])},t.prototype.selected=function(t,e){return void 0===e&&(e=0),"number"==typeof t?this.selectedIndex(t,e):"object"==typeof t?this.selectedOption(t,e):this.selectedValue(t,e)},t.prototype.selectedIndex=function(t,e){(t=void 0===t?0:t)<0&&(t=0);var i=this._ulBox[e=void 0===e?0:e].find("li"),o=i.length,i=i.eq(t=o<=t?o-1:t);return this.selectedOption(i,e),this},t.prototype.selectedValue=function(t,e){t=this._ulBox[e=void 0===e?0:e].find('li[data-value="'+t+'"]');return t.length<1&&this.selectedIndex(0,e),this.selectedOption(t,e),this},t.prototype.selectedOption=function(t,e){void 0===e&&(e=0),t.addClass("active").siblings().removeClass("active"),this.booted&&this.trigger("change",e,t.data("value"),t.text(),t),this._index[e]=t.index();t=2*this.options.lineHeight-this._index[e]*this.options.lineHeight;return this._ulBox[e].css("transform","translate(0px, "+t+"px) translateZ(0px)"),this.options.column>e+1&&this.refreshColumn(e+1),this},t.prototype.val=function(){var e=[];return this.mapSelected(function(t){e.push(t.data("value"))}),1<this.options.column?e:e[0]},t.prototype.mapSelected=function(t){for(var e=0;e<this.options.column&&(!t||!1!==t(this.getSelectedOption(e),e));e++);return this},t.prototype.getSelectedOption=function(t){return this._ulBox[t=void 0===t?0:t].find("li").eq(this._index[t])},t.prototype.notify=function(){this._real_index=this._index.slice();var e=[],i=[],o=[];return this.mapSelected(function(t){e.push(t),o.push(t.text()),i.push(t.data("value"))}),this.trigger.apply(this,__spreadArrays(["done"],i,o,e,this._index)),this},t.prototype.range=function(t,e,i){var o=[];for(void 0!==i&&0!==i||(i=e<t?-1:1);;){if(0<i&&e<t||i<0&&t<e)break;o.push(t),t+=i}return o},t})(Eve),SelectBoxDefaultOptions=function(){this.title="请选择",this.column=1,this.textTag="value",this.valueTag="id",this.childrenTag="children",this.lineHeight=30},SelectElemnt=(()=>{function t(t){this.element=t,this._init()}return t.prototype._init=function(){this.element.hide(),this.selectInput=$('<div class="dialog-select-input"></div>'),this.element.after(this.selectInput);var i=this,t=this.element.val();this.box=new SelectBox(this.selectInput,{title:this._getTitle(),data:this._getOptions(),default:t,ondone:function(t,e){i.selectInput.text(e),i.element.val(t).trigger("change")}}),this.element.on("optionschange",function(){i.refresh()})},t.prototype._getOptions=function(){var t=[];return this.element.find("option").each(function(){t.push({id:this.getAttribute("value"),value:this.innerText})}),t},t.prototype.refresh=function(){return this.box.options.data=this._getOptions(),this.box.refresh(),this},t.prototype._getTitle=function(){var t=this.element.attr("id");return t&&!(t.length<1)&&(t=$("label[for="+t+"]").text())?"请选择"+t:"请选择"},t})();(e=>{e.fn.select=function(t){return this.is("select")?(this.each(function(){new SelectElemnt(e(this))}),this):new SelectBox(this,t)}})(jQuery);