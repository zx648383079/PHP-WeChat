var SideNav=function(){function t(t,i){this.element=t,this.option=$.extend({},new SideNavDefaultOption,i),this.init()}return t.prototype.init=function(){this._window=$(window),this._initBox(),this.getHeaders(),this.headers.length<1?this.box.hide():(this.box.show(),this._bindEvent(),this.fixed(),this.setActive())},t.prototype._bindEvent=function(){var e=this;this.box.on("click","a",function(t){t.preventDefault();var i=$(this).attr("href").split("#")[1];i&&e.scrollTo("#"+i)}),this._window.scroll(function(){e.setActive()})},t.prototype._getScrollTop=function(){return window.pageYOffset},t.prototype._getScrollHeight=function(){return window.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)},t.prototype._getOffsetHeight=function(){return window.innerHeight},t.prototype.refresh=function(){var i=this;this._scrollHeight=this._getScrollHeight();var e=[];this._offsets=[],this.headers.map(function(t){return[t.offset().top,t]}).filter(function(t){return t}).sort(function(t,i){return t[0]-i[0]}).forEach(function(t){i._offsets.push(t[0]),e.push(t[1])}),this.headers=e},t.prototype.setActive=function(){var t,i=this._getScrollTop()+this.option.offset,e=this._getScrollHeight();this._scrollHeight!=e&&this.refresh();for(var o=this._offsets.length;o--;)if(this._offsets[o]<i){t=this.headers[o].attr("id");break}this._activeId!=t&&(this._activeId=t,this._clear(),this.box.find('a[href="#'+t+'"]').closest("li").addClass(this.option.active))},t.prototype._clear=function(){this.box.find("li."+this.option.active).removeClass(this.option.active)},t.prototype._initBox=function(){this.option.target?this.box=$(this.option.target):(this.box=$('<div class="side-nav" data-type="sideNav"></div>'),$(document.body).append(this.box))},t.prototype.fixed=function(){this._window.scrollTop()>=this.option.fixedTop?this.box.css({position:"fixed"}):this.box.css({position:"absolute"})},t.prototype.scrollTo=function(t,i){var e=$(t).offset().top,o=$("html,body");o.is(":animated")||o.animate({scrollTop:e},this.option.speed,this.option.easing,i)},t.prototype.getHeaders=function(){var s,t=this.element.find(":header"),n="",h=this,r=[],a={h1:0,h2:0,h3:0,h4:0,h5:0,h6:0};t.each(function(){var t=this.localName.toLowerCase();a.hasOwnProperty(t)&&a[t]++});var l=0;for(var i in a)a.hasOwnProperty(i)&&(l+=a[i],(a[i]<=0||l>this.option.maxLength)&&delete a[i]);s=Object.keys(a),l=0,t.each(function(){var t=this.localName.toLowerCase();if(a.hasOwnProperty(t)){var i=$(this),e=i.text(),o="autoid-"+l;i.attr("id",o),r.push(i),e.length>h.option.contentLength&&(e=e.substr(0,h.option.contentLength)+"..."),n+='<li class="nav-level-'+s.indexOf(t)+'"><a href="#'+o+'" title="'+e+'">'+e+"</a></li>",l++}}),this.headers=r,this.option.title&&0<this.option.title.length&&(n='<li class="nav-title">'+this.option.title+"</li>"+n),this.box.html("<ul>"+n+"</ul>")},t}(),SideNavDefaultOption=function(){this.maxLength=17,this.fixedTop=0,this.speed=500,this.easing="swing",this.active="active",this.offset=10,this.title="本文目录",this.contentLength=26};jQuery.fn.sideNav=function(t){return new SideNav(this,t)};