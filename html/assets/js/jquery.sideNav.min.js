var SideNav=function(){function t(t,i){this.element=t,this.option=$.extend({},new SideNavDefaultOption,i),this.init()}return t.prototype.init=function(){this._window=$(window),this._initBox(),this.getHeaders(),this.headers.length<1?this.box.hide():(this.box.show(),this._bindEvent(),this.fixed(),this.setActive())},t.prototype._bindEvent=function(){var t=this;this.box.on("click","a",function(i){i.preventDefault();var e=$(this).attr("href").split("#")[1];e&&t.scrollTo("#"+e)}),this._window.scroll(function(){t.setActive()})},t.prototype._getScrollTop=function(){return window.pageYOffset},t.prototype._getScrollHeight=function(){return window.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)},t.prototype._getOffsetHeight=function(){return window.innerHeight},t.prototype.refresh=function(){var t=this;this._scrollHeight=this._getScrollHeight();var i=[];this._offsets=[],this.headers.map(function(t){return[t.offset().top,t]}).filter(function(t){return t}).sort(function(t,i){return t[0]-i[0]}).forEach(function(e){t._offsets.push(e[0]),i.push(e[1])}),this.headers=i},t.prototype.setActive=function(){var t,i=this._getScrollTop()+this.option.offset,e=this._getScrollHeight();this._scrollHeight!=e&&this.refresh();for(var o=this._offsets.length;o--;)if(this._offsets[o]<i){t=this.headers[o].attr("id");break}this._activeId!=t&&(this._activeId=t,this._clear(),this.box.find('a[href="#'+t+'"]').closest("li").addClass(this.option.active))},t.prototype._clear=function(){this.box.find("li."+this.option.active).removeClass(this.option.active)},t.prototype._initBox=function(){this.option.target?this.box=$(this.option.target):(this.box=$('<div class="side-nav" data-type="sideNav"></div>'),$(document.body).append(this.box))},t.prototype.fixed=function(){this._window.scrollTop()>=this.option.fixedTop?this.box.css({position:"fixed"}):this.box.css({position:"absolute"})},t.prototype.scrollTo=function(t,i){var e=$(t).offset().top,o=$("html,body");o.is(":animated")||o.animate({scrollTop:e},this.option.speed,this.option.easing,i)},t.prototype.getHeaders=function(){var t,i=this.element.find(":header"),e="",o=this,s=[],n={h1:0,h2:0,h3:0,h4:0,h5:0,h6:0};i.each(function(){var t=this.localName.toLowerCase();n.hasOwnProperty(t)&&n[t]++});var h=0;for(var r in n)n.hasOwnProperty(r)&&(h+=n[r],(n[r]<=0||h>this.option.maxLength)&&delete n[r]);t=Object.keys(n),h=0,i.each(function(){var i=this.localName.toLowerCase();if(n.hasOwnProperty(i)){var r=$(this),a=r.text(),l="autoid-"+h;r.attr("id",l),s.push(r),a.length>o.option.contentLength&&(a=a.substr(0,o.option.contentLength)+"..."),e+='<li class="nav-level-'+t.indexOf(i)+'"><a href="#'+l+'" title="'+a+'">'+a+"</a></li>",h++}}),this.headers=s,this.option.title&&this.option.title.length>0&&(e='<li class="nav-title">'+this.option.title+"</li>"+e),this.box.html("<ul>"+e+"</ul>")},t}(),SideNavDefaultOption=function(){return function(){this.maxLength=17,this.fixedTop=0,this.speed=500,this.easing="swing",this.active="active",this.offset=10,this.title="本文目录",this.contentLength=26}}();jQuery.fn.sideNav=function(t){return new SideNav(this,t)};