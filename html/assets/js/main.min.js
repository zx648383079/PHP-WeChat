function postJson(e,t,a){"function"==typeof t&&(a=t,t={}),$.post(e,t,a||parseAjax,"json")}function ajaxForm(e,t,a){postJson(e,t,function(e){(a||parseAjax)(e)})}function formData(e){var t=[];return e.find("input,textarea,select").each(function(){this.type&&0<=["radio","checkbox"].indexOf(this.type)&&!this.checked||t.push(encodeURIComponent(this.name)+"="+encodeURIComponent($(this).val().toString()))}),t.join("&")}function parseAjax(e){if(302===e.code||401===e.code&&e.url)window.location.href=e.url;else{if(200!==e.code)return"object"==typeof e.message?void $.each(e.message,function(a,e){$.each(e,function(e,t){Dialog.tip(a+(t||"操作执行失败！"))})}):void Dialog.tip(e.message||"操作执行失败！");Dialog.tip(e.message||"操作执行完成！"),e.data&&e.data.refresh&&setTimeout(function(){e.data.no_jax||"function"!=typeof parseAjaxUri?window.location.reload():parseAjaxUri(window.location.href)},500),e.data&&e.data.url&&setTimeout(function(){-1===e.data.url?history.go(-1):e.data.no_jax||"function"!=typeof parseAjaxUri?window.location.href=e.data.url:parseAjaxUri(e.data.url)},500)}}function bindMultipleTable(e){function n(e){var t=e.find(".page-multiple-count"),e=e.find(".page-multiple-td .checkbox.checked"),t=(t.text(e.length),t.closest("a")),a=[];e.each(function(){a.push($(this).parent().data("id"))}),t.attr("href",t.attr("href").replace(/id=[\d,]*/,"id="+a.join(","))),t.data("tip","确定要删除选中的 ".concat(e.length," 条数据？"))}e.on("click",".page-multiple-table .page-multiple-toggle",function(e){e.preventDefault(),$(this).closest(".page-multiple-table").toggleClass("page-multiple-enable")}).on("click",".page-multiple-table .page-multiple-td .checkbox",function(){var e,t=$(this),a=t.closest(".page-multiple-table"),i=!t.hasClass("checked");t.toggleClass("checked",i),i?(e=!0,a.find(".page-multiple-td .checkbox").each(function(){$(this).hasClass("checked")||(e=!1)}),e&&a.find(".page-multiple-th .checkbox").addClass("checked")):a.find(".page-multiple-th .checkbox").removeClass("checked"),n(a)}).on("click",".page-multiple-table .page-multiple-th .checkbox",function(){var e=$(this),t=e.closest(".page-multiple-table"),e=!e.hasClass("checked");t.find(".page-multiple-th .checkbox").toggleClass("checked",e),t.find(".page-multiple-td .checkbox").toggleClass("checked",e),n(t)})}function bindNavBar(e){e.on("click",".sidebar-container .sidebar-container-toggle,.app-header-container .sidebar-container-toggle,.app-wrapper .app-mask",function(){var e=$(this).closest(".app-wrapper").toggleClass("wrapper-min");e.find("ul").height()<$(window).height()-100&&e.toggleClass("sidebar-fixed",e.hasClass("wrapper-min")),$(window).trigger("resize")}).on("click",".app-header-container .nav-item a",function(e){var t=$(this).closest(".nav-item");0<t.find(".drop-bar").length&&t.toggleClass("nav-drop-open")}).on("click",".sidebar-container li a",function(){var e=$(this),t=e.closest("li");0<t.find("ul").length?t.toggleClass("expand"):($(".sidebar-container li").removeClass("active"),t.addClass("active"),e.closest(".app-wrapper").removeClass("wrapper-min"))})}var toFloat=function(e){return(e=e&&e.toString().replace(",","").match(/[\d\.]+/))?parseFloat(e):0},toInt=function(e){return(e=e&&e.toString().replace(",","").match(/[\d]+/))?parseInt(e,10):0},strFormat=function(e){for(var a=[],t=1;t<arguments.length;t++)a[t-1]=arguments[t];return e.replace(/\{(\d+)\}/g,function(e,t){return a[t]})},file_upload;$(function(){"function"==typeof Upload&&"string"==typeof UPLOAD_URI&&(file_upload=new Upload(null,{url:UPLOAD_URI,name:"upfile",template:"{url}",onbefore:function(e,t){return t.closest(".file-input").addClass("file-uploading"),e},onafter:function(e,t){return"SUCCESS"==e.state?t.prev("input").val(e.url):302===e.code&&(location.href=e.url),t.closest(".file-input").removeClass("file-uploading"),!1},onerror:function(e,t){Dialog.tip(413==e.status?"文件太大，无法上传":"上传失败"),t.closest(".file-input").removeClass("file-uploading")}}));var doc=$(document).on("click","a[data-type=refresh]",function(){window.location.reload()}).on("click","a[data-type=del]",function(e){e.preventDefault();var t,e=$(this).data("tip")||"确定删除这条数据？";confirm(e)&&(t=Dialog.loading(),postJson($(this).attr("href"),function(e){t.close(),200!=e.code||e.msg||(e.msg="删除成功！"),parseAjax(e)}))}).on("click","a[data-type=ajax]",function(e){e.preventDefault();var $this=$(this),successTip=$this.data("success")||"提交成功！",errorTip=$this.data("error")||"提交失败！",callback=$this.data("callback"),loading=Dialog.loading();postJson($this.attr("href"),function(data){loading.close(),200!=data.code||data.msg||(data.msg=successTip),200==data.code&&callback&&eval(callback+"($this, data);"),parseAjax(data)})}).on("submit","form[data-type=ajax]",function(){var e=$(this),t=Dialog.loading();return ajaxForm(e.attr("action"),e.serialize(),function(e){t.close(),parseAjax(e)}),!1}).on("click","a[data-type=post]",function(e){e.preventDefault();e=$('<form action="'+$(this).attr("href")+'" method="post"></form');$(document.body).append(e),e.trigger("submit")}).on("click",".file-input [data-type=upload]",function(){var e,t=$(this);t.closest(".file-input").hasClass("file-uploading")?Dialog.tip("文件正在上传中。。。"):(e=t.data("allow")||"",(file_upload.options.filter=e).indexOf("image")<0&&(file_upload.options.url=UPLOAD_URI.replace("uploadimage","uploadfile")),file_upload.start(t))}).on("click",".file-input [data-type=preview]",function(){var a,e=$(this).closest(".file-input"),t=0<=(e.find("[data-type=upload]").data("allow")||"").indexOf("image"),e=e.find("input").val();e?t?((a=new Image).src=e,a.onload=function(){var e,t=Dialog.box({title:"预览",content:""});(a.width>window.innerWidth||a.height>window.innerHeight)&&(e=Math.min((window.innerWidth-100)/a.width,(window.innerHeight-100)/a.height),a.style.width=e*a.width+"px",a.style.height=e*a.height+"px"),t.find(".dialog-body").append(a),t.showCenter()}):window.open(e,"_blank"):Dialog.tip("请上传".concat(t?"图片":"文件","！"))}).on("click",".tab-box .tab-header .tab-item",function(){var e=$(this),t=(e.addClass("active").siblings().removeClass("active"),e.closest(".tab-box").find(".tab-body .tab-item").eq(e.index()).addClass("active"));t.siblings().removeClass("active"),t.trigger("tabActived",e.index())}).on("click",".tree-table .tree-item-arrow",function(e){e.preventDefault();for(var e=$(this).closest(".tree-item"),t=toInt(e.data("level")),a=!e.hasClass("tree-item-open"),i=(e.toggleClass("tree-item-open",a),e.next(".tree-item"));i&&0<i.length;){var n=toInt(i.data("level"));if(n<=t)return;i.toggleClass("tree-level-open",a&&n===t+1),i=i.next(".tree-item")}}).on("click",".page-tip .toggle",function(){$(this).closest(".page-tip").toggleClass("min")}),autoRedirct=(bindMultipleTable(doc),bindNavBar(doc),function(){var e,t,a,i,n=$(".autoRedirct");n.length<1||(e=n.attr("href")||n.attr("data-url"),t=n.text(),(a=toInt(n.attr("data-time")))<1&&(a=3),n.text(t+"("+a+" 秒)"),i=setInterval(function(){a--,n.text(t+"("+a+" 秒)"),a<=0&&(clearInterval(i),n.text(t+"(正在跳转...)"),window.location.href=e)},1e3))});autoRedirct()});