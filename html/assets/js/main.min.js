function postJson(t,a,e){"function"==typeof a&&(e=a,a={}),$.post(t,a,e||parseAjax,"json")}function ajaxForm(t,a,e){postJson(t,a,function(t){(e||parseAjax)(t)})}function formData(t){var a=[];return t.find("input,textarea,select").each(function(){this.type&&0<=["radio","checkbox"].indexOf(this.type)&&!this.checked||a.push(encodeURIComponent(this.name)+"="+encodeURIComponent($(this).val().toString()))}),a.join("&")}function parseAjax(t){if(302===t.code||401===t.code&&t.url)window.location.href=t.url;else{if(200!==t.code)return"object"==typeof t.message?void $.each(t.message,function(e,t){$.each(t,function(t,a){Dialog.tip(e+(a||"操作执行失败！"))})}):void Dialog.tip(t.message||"操作执行失败！");Dialog.tip(t.message||"操作执行完成！"),t.data&&t.data.refresh&&setTimeout(function(){t.data.no_jax||"function"!=typeof parseAjaxUri?window.location.reload():parseAjaxUri(window.location.href)},500),t.data&&t.data.url&&setTimeout(function(){-1===t.data.url?history.go(-1):t.data.no_jax||"function"!=typeof parseAjaxUri?window.location.href=t.data.url:parseAjaxUri(t.data.url)},500)}}var toFloat=function(t){return(t=t&&t.toString().replace(",","").match(/[\d\.]+/))?parseFloat(t):0},toInt=function(t){return(t=t&&t.toString().replace(",","").match(/[\d]+/))?parseInt(t,10):0},strFormat=function(t){for(var e=[],a=1;a<arguments.length;a++)e[a-1]=arguments[a];return t.replace(/\{(\d+)\}/g,function(t,a){return e[a]})},file_upload;$(function(){"function"==typeof Upload&&"string"==typeof UPLOAD_URI&&(file_upload=new Upload(null,{url:UPLOAD_URI,name:"upfile",template:"{url}",onbefore:function(t,a){return a.closest(".file-input").addClass("file-uploading"),t},onafter:function(t,a){return"SUCCESS"==t.state?a.prev("input").val(t.url):302===t.code?location.href=t.url:Dialog.tip(null!=(t=t.state)?t:"上传失败"),a.closest(".file-input").removeClass("file-uploading"),!1},onerror:function(t,a){Dialog.tip(413==t.status?"文件太大，无法上传":"上传失败"),a.closest(".file-input").removeClass("file-uploading")}}));var doc=$(document).on("click","a[data-type=refresh]",function(){window.location.reload()}).on("click","a[data-type=ajax]",function(e){e.preventDefault();var $this=$(this),successTip=$this.data("success")||"提交成功！",errorTip=$this.data("error")||"提交失败！",callback=$this.data("callback"),loading=Dialog.loading();postJson($this.attr("href"),function(data){loading.close(),200!=data.code||data.msg||(data.msg=successTip),200==data.code&&callback&&eval(callback+"($this, data);"),parseAjax(data)})}).on("submit","form[data-type=ajax]",function(){var a=$(this),e=Dialog.loading();return ajaxForm(a.attr("action"),a.serialize(),function(t){e.close(),parseAjax(t),400===t.code&&"object"==typeof t.message&&a.trigger("form:invalid",t.message)}),!1}).on("click","a[data-type=post]",function(t){t.preventDefault();t=$('<form action="'+$(this).attr("href")+'" method="post"></form');$(document.body).append(t),t.trigger("submit")}).on("click",".file-input [data-type=upload]",function(){var t,a=$(this);a.closest(".file-input").hasClass("file-uploading")?Dialog.tip("文件正在上传中。。。"):(t=a.data("allow")||"",(file_upload.options.filter=t).indexOf("image")<0&&(file_upload.options.url=UPLOAD_URI.replace("uploadimage","uploadfile")),file_upload.start(a))}).on("click",".file-input [data-type=preview]",function(){var e,t=$(this).closest(".file-input"),a=0<=(t.find("[data-type=upload]").data("allow")||"").indexOf("image"),t=t.find("input").val();t?a?((e=new Image).src=t,e.onload=function(){var t,a=Dialog.box({title:"预览",content:""});(e.width>window.innerWidth||e.height>window.innerHeight)&&(t=Math.min((window.innerWidth-100)/e.width,(window.innerHeight-100)/e.height),e.style.width=t*e.width+"px",e.style.height=t*e.height+"px"),a.find(".dialog-body").append(e),a.showCenter()}):window.open(t,"_blank"):Dialog.tip("请上传".concat(a?"图片":"文件","！"))}).on("click",".tab-box .tab-header .tab-item",function(){var t=$(this),a=t.index();toggleTab(t,t.closest(".tab-box").find(".tab-body .tab-item").eq(a),a)}).on("tab:toggle",".tab-box .tab-body .tab-item",function(){var t,a=$(this);a.hasClass("active")||(t=a.index(),toggleTab(a.closest(".tab-box").find(".tab-header .tab-item").eq(t),a,t))}),toggleTab=function(t,a,e){t.addClass("active").siblings().removeClass("active"),a.addClass("active").siblings().removeClass("active"),a.trigger("tab:actived",e)}});