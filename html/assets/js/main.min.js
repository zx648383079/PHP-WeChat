function postJson(t,e,a){"function"==typeof e&&(a=e,e={}),$.post(t,e,a||parseAjax,"json")}function ajaxForm(t,e,a){postJson(t,e,function(t){(a||parseAjax)(t)})}function formData(t){var e=[];return t.find("input,textarea,select").each(function(){this.type&&0<=["radio","checkbox"].indexOf(this.type)&&!this.checked||e.push(encodeURIComponent(this.name)+"="+encodeURIComponent($(this).val().toString()))}),e.join("&")}function parseAjax(t){if(302===t.code||401===t.code&&t.url)window.location.href=t.url;else{if(200!==t.code)return"object"==typeof t.message?void $.each(t.message,function(a,t){$.each(t,function(t,e){Dialog.tip(a+(e||"操作执行失败！"))})}):void Dialog.tip(t.message||"操作执行失败！");Dialog.tip(t.message||"操作执行完成！"),t.data&&t.data.refresh&&setTimeout(function(){t.data.no_jax||"function"!=typeof parseAjaxUri?window.location.reload():parseAjaxUri(window.location.href)},500),t.data&&t.data.url&&setTimeout(function(){-1===t.data.url?history.go(-1):t.data.no_jax||"function"!=typeof parseAjaxUri?window.location.href=t.data.url:parseAjaxUri(t.data.url)},500)}}var toFloat=function(t){return(t=t&&t.toString().replace(",","").match(/[\d\.]+/))?parseFloat(t):0},toInt=function(t){return(t=t&&t.toString().replace(",","").match(/[\d]+/))?parseInt(t,10):0},strFormat=function(t){for(var a=[],e=1;e<arguments.length;e++)a[e-1]=arguments[e];return t.replace(/\{(\d+)\}/g,function(t,e){return a[e]})},file_upload;$(function(){"function"==typeof Upload&&"string"==typeof UPLOAD_URI&&(file_upload=new Upload(null,{url:UPLOAD_URI,name:"upfile",template:"{url}",onbefore:function(t,e){return e.closest(".file-input").addClass("file-uploading"),t},onafter:function(t,e){return"SUCCESS"==t.state?e.prev("input").val(t.url):302===t.code&&(location.href=t.url),e.closest(".file-input").removeClass("file-uploading"),!1},onerror:function(t,e){Dialog.tip(413==t.status?"文件太大，无法上传":"上传失败"),e.closest(".file-input").removeClass("file-uploading")}})),$(document).on("click","a[data-type=refresh]",function(){window.location.reload()}).on("click","a[data-type=del]",function(t){t.preventDefault();var e,t=$(this).attr("data-tip")||"确定删除这条数据？";confirm(t)&&(e=Dialog.loading(),postJson($(this).attr("href"),function(t){e.close(),200!=t.code||t.msg||(t.msg="删除成功！"),parseAjax(t)}))}).on("click","a[data-type=ajax]",function(e){e.preventDefault();var $this=$(this),successTip=$this.attr("data-success")||"提交成功！",errorTip=$this.attr("data-error")||"提交失败！",callback=$this.attr("data-callback"),loading=Dialog.loading();postJson($this.attr("href"),function(data){loading.close(),200!=data.code||data.msg||(data.msg=successTip),200==data.code&&callback&&eval(callback+"($this, data);"),parseAjax(data)})}).on("submit","form[data-type=ajax]",function(){var t=$(this),e=Dialog.loading();return ajaxForm(t.attr("action"),t.serialize(),function(t){e.close(),parseAjax(t)}),!1}).on("click","a[data-type=post]",function(t){t.preventDefault();t=$('<form action="'+$(this).attr("href")+'" method="post"></form');$(document.body).append(t),t.trigger("submit")}).on("click",".file-input [data-type=upload]",function(){var t,e=$(this);e.closest(".file-input").hasClass("file-uploading")?Dialog.tip("文件正在上传中。。。"):(t=e.data("allow")||"",(file_upload.options.filter=t).indexOf("image")<0&&(file_upload.options.url=UPLOAD_URI.replace("uploadimage","uploadfile")),file_upload.start(e))}).on("click",".file-input [data-type=preview]",function(){var a,t=$(this).closest(".file-input"),e=0<=(t.find("[data-type=upload]").data("allow")||"").indexOf("image"),t=t.find("input").val();t?e?((a=new Image).src=t,a.onload=function(){var t,e=Dialog.box({title:"预览",content:""});(a.width>window.innerWidth||a.height>window.innerHeight)&&(t=Math.min((window.innerWidth-100)/a.width,(window.innerHeight-100)/a.height),a.style.width=t*a.width+"px",a.style.height=t*a.height+"px"),e.find(".dialog-body").append(a),e.showCenter()}):window.open(t,"_blank"):Dialog.tip("请上传".concat(e?"图片":"文件","！"))}).on("click",".zd-tab .zd-tab-head .zd-tab-item",function(){var t=$(this),e=(t.addClass("active").siblings().removeClass("active"),t.closest(".zd-tab").find(".zd-tab-body .zd-tab-item").eq(t.index()).addClass("active"));e.siblings().removeClass("active"),e.trigger("tabActived",t.index())}).on("click",".tab-box .tab-header .tab-item",function(){var t=$(this),e=(t.addClass("active").siblings().removeClass("active"),t.closest(".tab-box").find(".tab-body .tab-item").eq(t.index()).addClass("active"));e.siblings().removeClass("active"),e.trigger("tabActived",t.index())}).on("click",".tree-table .tree-item-arrow",function(t){t.preventDefault();for(var t=$(this).closest(".tree-item"),e=toInt(t.data("level")),a=!t.hasClass("tree-item-open"),i=(t.toggleClass("tree-item-open",a),t.next(".tree-item"));i&&0<i.length;){var n=toInt(i.data("level"));if(n<=e)return;i.toggleClass("tree-level-open",a&&n===e+1),i=i.next(".tree-item")}}).on("click",".page-tip .toggle",function(){$(this).closest(".page-tip").toggleClass("min")}),$(".sidebar-container .sidebar-container-toggle,.app-header-container .sidebar-container-toggle,.app-wrapper .app-mask").on("click",function(){var t=$(this).closest(".app-wrapper").toggleClass("wrapper-min");t.find("ul").height()<$(window).height()-100&&t.toggleClass("sidebar-fixed",t.hasClass("wrapper-min")),$(window).trigger("resize")}),$(".app-header-container .nav-item a").on("click",function(t){var e=$(this).closest(".nav-item");0<e.find(".drop-bar").length&&e.toggleClass("nav-drop-open")}),$(".sidebar-container li a").on("click",function(){var t=$(this),e=t.closest("li");0<e.find("ul").length?e.toggleClass("expand"):($(".sidebar-container li").removeClass("active"),e.addClass("active"),t.closest(".app-wrapper").removeClass("wrapper-min"))});var autoRedirct=function(){var t,e,a,i,n=$(".autoRedirct");n.length<1||(t=n.attr("href")||n.attr("data-url"),e=n.text(),(a=toInt(n.attr("data-time")))<1&&(a=3),n.text(e+"("+a+" 秒)"),i=setInterval(function(){a--,n.text(e+"("+a+" 秒)"),a<=0&&(clearInterval(i),n.text(e+"(正在跳转...)"),window.location.href=t)},1e3))};autoRedirct()});