var CHECKED_CHANGE="cart_checked_change";function addToCart(e,a){void 0===a&&(a=1),postJson("cart/add?goods="+e+"&amount="+a,function(e){parseAjax(e)})}function buyGoods(e,a){void 0===a&&(a=1)}function collectGoods(e,a){postJson("collect/toggle?id="+e,function(e){200==e.code&&a&&$(a).toggleClass("active",e.data)})}function mapItem(e){$(".cart-item").each(function(){if(0==e($(this)))return!1})}function mapCheckedItem(a){mapItem(function(e){if(e.find(".check-box").hasClass("active"))return 0!=a(e)&&void 0})}function refreshCart(){var a=0;mapCheckedItem(function(e){a++}),$(".cart-footer .cart-checked-count").text(a)}function search(e){window.location.href=$(".header-search").data("url")+"?keywords="+e}function bindCart(o){$(".number-box input").change(function(){var e=$(this),a=e.val(),t=e.closest(".cart-item").attr("data-id");$.getJSON(o+"cart/update",{id:t,amount:a},function(e){parseAjax(e)})}),$(".cart-item .fa-trash").click(function(){var a=$(this).closest(".cart-item"),e=a.attr("data-id");$.getJSON(o+"cart/delete",{id:e},function(e){parseAjax(e),200==e.code&&a.remove()})}),$(".cart-group-item .group-header .check-box").on(CHECKED_CHANGE,function(){var e=$(this),a=e.hasClass("active");togglecChecked(a,e.closest(".cart-group-item").find(".cart-item .check-box")),a||togglecChecked(a,t),refreshCart()}),$(".cart-item .check-box").on(CHECKED_CHANGE,function(){var e=$(this);e.hasClass("active")||togglecChecked(!1,t,e.closest(".cart-group-item").find(".group-header .check-box")),refreshCart()});var t=$(".cart-footer .check-box, .cart-header .check-box").on(CHECKED_CHANGE,function(){togglecChecked($(this).hasClass("active"),$(".cart-group-item .check-box"),t),refreshCart()})}function togglecChecked(a){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];e.forEach(function(e){e.each(function(){var e=$(this);e.toggleClass("active",a),e.is("input")&&(this.checked=a)})})}function goPhoneLogin(){$(".login-type-box").hide(),$(".login-box").removeClass("hide")}function goEmailLogin(){$(".login-type-box").hide(),$(".login-box").removeClass("hide"),$(".login-box .email-password").removeClass("hide"),$(".login-box .phone-code,.login-box .phone-password").addClass("hide")}function bindStore(){var t=$(window),o=$(".store-page"),i=t.scrollTop();t.scroll(function(){var e=t.scrollTop(),a=e-i<0;(i=e)<183?o.removeClass("min").removeClass("min-up"):a?o.addClass("min-up").removeClass("min"):o.addClass("min").removeClass("min-up")})}function bindCategory(){$(".category-menu .menu-item").click(function(){var e=$(this);e.addClass("active").siblings().removeClass("active");var a=$(".category-main .item").eq(e.index());a.addClass("active").siblings().removeClass("active"),a.hasClass("lazy-loading")&&(a.removeClass("lazy-loading"),$.get(a.data("url"),function(e){a.html(e)}))}).eq(0).trigger("click")}function bindCartDialog(t){var o=$(".cart-dialog").on("click",".dailog-yes",function(e){e.preventDefault();var a=parseInt(o.find(".number-box .number-input").val()+"");addToCart(t,a)}).on("click",".dialog-close",function(e){e.preventDefault(),o.hide()}).click(function(e){e.pageY<o.find(".dialog-body").offset().top&&o.hide()});$(document).on("click","[data-action=cart]",function(e){e.preventDefault(),o.show()}).on("click","[data-action=buy]",function(e){e.preventDefault(),o.show()})}$(function(){$(".check-box").click(function(){$(this).toggleClass("active").trigger(CHECKED_CHANGE)}),$(".toggle-box").click(function(){$(this).toggleClass("active").trigger("change")}),$(".number-box .fa-minus").click(function(){var e=$(this).closest(".number-box").find("input"),a=e.attr("min")||0,t=Number(e.val())||0;a<t&&(t-=1),e.val(t).trigger("change")}),$(".number-box .fa-plus").click(function(){var e=$(this).closest(".number-box").find("input"),a=e.attr("max")||999,t=Number(e.val())||0;t<a&&(t+=1),e.val(t).trigger("change")}),$(".cart-footer .btn").click(function(e){e.preventDefault();var a=[];mapCheckedItem(function(e){a.push(e.data("id"))}),a.length<1?Dialog.tip("请选择结算的商品"):window.location.href=$(this).attr("href")+"?cart="+a.join("-")}),$(".checkout-footer .btn").click(function(e){e.preventDefault();var a=$(this).closest("form"),t=!0;$.each(a.serializeArray(),function(){return"address"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择收货地址"),t=!1):"shipping"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择配送方式"),t=!1):"payment"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择支付方式"),t=!1):void 0}),t&&ajaxForm(a.attr("action"),a.serialize())}),$(".tab-box .tab-header .tab-item").click(function(){var e=$(this);e.addClass("active").siblings().removeClass("active"),e.closest(".tab-box").find(".tab-body .tab-item").eq(e.index()).addClass("active").siblings().removeClass("active")}),$(".header-nav>li").mouseenter(function(){$(".header-nav .nav-dropdown").hide(),$(this).find(".nav-dropdown").show()}),$(".scroll-nav .nav-arrow").click(function(){$(this).closest(".scroll-nav").toggleClass("unfold")}),$(".header-nav").mouseleave(function(){$(this).find(".nav-dropdown").hide()}),$(".header-cart").mouseover(function(){$(this).find(".cart-dialog").show()}).mouseout(function(){$(this).find(".cart-dialog").hide()}),$(".header-search").mouseover(function(){$(this).addClass("expanded")}).mouseout(function(){$(this).removeClass("expanded")}),$("img.lazy").lazyload({callback:"img"}),$(".more-load").lazyload({mode:1,callback:function(a){if(!a.data("is_loading")){a.data("is_loading",!0);var t=parseInt(a.data("page")||"0")+1,e=a.data("url"),o=a.data("target");$.getJSON(e,{page:t},function(e){a.data("is_loading",!1),200==e.code&&($(o).append(e.data.html),a.data("page",t),e.data.has_more||a.remove())})}}});var e=$(".header-search input").keydown(function(e){13==e.keyCode&&search($(this).val())});$(".header-search .fa-search").click(function(){search(e.val())}),$(window).scroll(function(){$(".header-main").toggleClass("top-fixed",180<$(this).scrollTop())}).trigger("scroll")});