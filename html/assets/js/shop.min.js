var CHECKED_CHANGE="cart_checked_change";function addToCart(t,e,a){void 0===e&&(e=1),"boolean"==typeof e&&(e=parseInt($(".number-input").val()+"",10)),e<1?Dialog.tip("数量不能小于1"):postJson(BASE_URI+"cart/add",{goods:t,amount:e,properties:JSON.stringify(a)},function(t){parseAjax(t),200===t.code&&$(".header-cart").trigger("cartRefresh")})}function buyGoods(t,e,a){void 0===e&&(e=1),"boolean"==typeof e&&(e=parseInt($(".number-input").val()+"",10)),e<1?Dialog.tip("数量不能小于1"):window.location.href=BASE_URI+"cashier?type=1&cart="+JSON.stringify([{goods:t,amount:e,properties:a}])}function collectGoods(t,e){postJson(BASE_URI+"collect/toggle?id="+t,function(t){200==t.code&&e&&$(e).toggleClass("active",t.data)})}function mapItem(t){$(".cart-item").each(function(){if(0==t($(this)))return!1})}function mapCheckedItem(e){mapItem(function(t){if(t.find(".check-box").hasClass("active"))return 0!=e(t)&&void 0})}function refreshCart(){var e=0;mapCheckedItem(function(t){e++}),$(".cart-footer .cart-checked-count").text(e)}function search(t){window.location.href=$(".header-search").data("url")+"?keywords="+t}function bindCart(){$(".number-box input").change(function(){var t=$(this),e=t.val(),a=t.closest(".cart-item").attr("data-id");$.getJSON(BASE_URI+"cart/update",{id:a,amount:e},function(t){parseAjax(t)})}),$(".cart-item .fa-trash").click(function(){var e=$(this).closest(".cart-item"),t=e.attr("data-id");$.getJSON(BASE_URI+"cart/delete",{id:t},function(t){parseAjax(t),200==t.code&&e.remove()})}),$(".cart-group-item .group-header .check-box").on(CHECKED_CHANGE,function(){var t=$(this),e=t.hasClass("active");togglecChecked(e,t.closest(".cart-group-item").find(".cart-item .check-box")),e||togglecChecked(e,a),refreshCart()}),$(".cart-item .check-box").on(CHECKED_CHANGE,function(){var t=$(this);t.hasClass("active")||togglecChecked(!1,a,t.closest(".cart-group-item").find(".group-header .check-box")),refreshCart()});var a=$(".cart-footer .check-box, .cart-header .check-box").on(CHECKED_CHANGE,function(){togglecChecked($(this).hasClass("active"),$(".cart-group-item .check-box"),a),refreshCart()})}function togglecChecked(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];t.forEach(function(t){t.each(function(){var t=$(this);t.toggleClass("active",e),t.is("input")&&(this.checked=e)})})}function goPhoneLogin(){$(".login-type-box").hide(),$(".login-box").removeClass("hide")}function goEmailLogin(){$(".login-type-box").hide(),$(".login-box").removeClass("hide"),$(".login-box .email-password").removeClass("hide"),$(".login-box .phone-code,.login-box .phone-password").addClass("hide")}function bindStore(){var a=$(window),i=$(".store-page"),n=a.scrollTop();a.scroll(function(){var t=a.scrollTop(),e=t-n<0;(n=t)<183?i.removeClass("min").removeClass("min-up"):e?i.addClass("min-up").removeClass("min"):i.addClass("min").removeClass("min-up")})}function bindCategory(){$(".category-menu .menu-item").click(function(){var t=$(this);t.addClass("active").siblings().removeClass("active");var e=$(".category-main .item").eq(t.index());e.addClass("active").siblings().removeClass("active"),e.hasClass("lazy-loading")&&(e.removeClass("lazy-loading"),$.get(e.data("url"),function(t){e.html(t)}))}).eq(0).trigger("click")}function bindCartDialog(i){function a(t){c.find(".group .group-body .active").each(function(){t&&t($(this))})}function e(){var t=parseInt(c.find(".number-box .number-input").val()+""),e=o();postJson(BASE_URI+"goods/price",{id:i,amount:t,properties:JSON.stringify(e)},function(t){200==t.code?(c.find(".price").html(t.data.price),c.find(".stock").html("库存："+t.data.stock)):parseAjax(t)})}var n=$(".selected-property"),o=function(){var e=[];return a(function(t){e.push(t.data("value"))}),e},c=$(".cart-dialog").on("click",".dailog-yes",function(t){t.preventDefault();var e=parseInt(c.find(".number-box .number-input").val()+""),a=o();"buy"==c.data("step")?buyGoods(i,e,a):addToCart(i,e,a),c.hide()}).on("click",".dialog-close",function(t){t.preventDefault(),c.hide()}).on("click",".group .group-body span",function(){var t=$(this);t.hasClass("disable")||(0<t.closest(".multi-group").length?t.toggleClass("active"):t.addClass("active").siblings().removeClass("active"),function(){var e=[];a(function(t){e.push(t.text())}),n.text(0<e.length?"已选："+e.join(" "):"")}(),e())}).on("change",".number-box .number-input",function(){e()}).click(function(t){t.pageY<c.find(".dialog-body").offset().top&&c.hide()});$(document).on("click","[data-action=cart]",function(t){t.preventDefault(),c.show().data("step","cart")}).on("click","[data-action=buy]",function(t){t.preventDefault(),c.show().data("step","buy")}),$(window).scroll(function(){var i=$(this).scrollTop();$(".top-tab a").removeClass("active").each(function(){var t=$(this),e=$(t.attr("href")),a=e.offset().top;if(a<=i&&i<a+e.height())return t.addClass("active"),!1})})}function bindMobileCashier(){var a=$("form");$("select").change(function(){ajaxForm(a.attr("action").replace("checkout","preview"),a.serialize(),function(t){if(200!=t.code)return parseAjax(t);$.each(t.data,function(t,e){"object"!=typeof e&&a.find("*[data-key="+t+"]").html(e)})})}).select()}function bindComment(){$(".comment-star i").click(function(){var t=$(this),e=t.index()+1,a=t.closest(".comment-star");a.find("input").val(e),a.find("i").each(function(){$(this).toggleClass("active",$(this).index()<e)})}),$(".comment-form-item").submit(function(){var e=$(this);return ajaxForm(e.attr("action"),e.serialize(),function(t){return 200!=t.code?parseAjax(t):1<$(".comment-form-item").length?(e.remove(),void Dialog.tip("已提交评价")):parseAjax(t)}),!1}),$(".multi-image-box .add-item").upload({url:"/ueditor.php?action=uploadimage",name:"upfile",multiple:!0,isAppend:!1,allowMultiple:!0,removeTag:".fa-times",template:'<div class="image-item"><img src="{url}" alt=""><input type="hidden" name="images[]" value="{url}"><i class="fa fa-times"></i></div>',onafter:function(t){return"SUCCESS"==t.state&&t}})}function bindMemberCenter(){$(window).scroll(function(){$("header.top").toggleClass("fixed",$(window).scrollTop()<176)})}function bindPay(){var e=$("input[name=payment]"),a=$(".payment-item").click(function(){var t=$(this);a.removeClass("active"),t.addClass("active"),e.val(t.data("id"))})}function bindAddress(){function e(t){a.find(".dialog-title").text(t?"修改地址":"新建地址"),a.find("input,textarea").each(function(){"checkbox"!==this.type?this.value=t&&t[this.name]?t[this.name]:"":this.checked=!t||t[this.name]}),t&&0<t.region_id&&(i.val=t.region_id)}var a=$(".address-dialog").dialog(),i=$(".address-dialog .region-input").multiSelect({default:0,data:BASE_URI+"region/tree",tag:"region_id"});a.on("done",function(){this.close(),postJson(BASE_URI+"address/save",formData(a),o)}),$(".add-btn").click(function(){e(),a.show()});var n=$(".address-page-box").on("click",".pagination a",function(t){t.preventDefault(),c($(this).attr("href"))}).on("click",'a[data-action="edit"]',function(t){t.preventDefault(),$.getJSON($(this).attr("href"),function(t){e(t.data),a.show()})}).on("click",'a[data-action="del"]',function(t){t.preventDefault(),confirm("确定要删除此收货地址?")&&postJson($(this).attr("href"),o)}).on("click",'a[data-action="default"]',function(t){t.preventDefault(),postJson($(this).attr("href"),o)}),o=function(t){if(200===t.code){if("object"==typeof t.data){var e=t.data.url;t.data.refresh&&(e=window.location.href),c(e)}}else parseAjax(t)},c=function(t){partialLoad(n,t,"我的收货地址")}}function formData(t){var e=[];return t.find("input,textarea,select").each(function(){this.type&&0<=["radio","checkbox"].indexOf(this.type)&&!this.checked||e.push(encodeURIComponent(this.name)+"="+encodeURIComponent($(this).val().toString()))}),e.join("&")}function bindPayTime(){var t=$('[data-type="countdown"]');setInterval(function(){var a=Math.floor((new Date).getTime()/1e3);t.each(function(){var t=$(this),e=Math.max(t.data("end")-a,0);t.text(formatTime(e))})},1e3)}function twoPad(t){return t<10&&0<=t?"0"+t:t.toString()}function formatTime(t){var e=Math.floor(t/3600);t-=3600*e;var a=Math.floor(t/60),i=t%60;return 0!==e?twoPad(e)+"时"+twoPad(a)+"分"+twoPad(i)+"秒":0!==a?twoPad(a)+"分"+twoPad(i)+"秒":twoPad(i)+"秒"}function bindHome(){$(".banner .slider").slider({width:1,height:420});$(".template-lazy").on("lazyLoaded",function(){var t=$(this).find(".slider-goods");t.length<1||t.slider({width:266,height:344,haspoint:!1})})}function bindGoods(e){$(".template-lazy").on("lazyLoaded",function(){var t=$(this).find(".slider-goods");t.length<1||t.slider({width:266,height:344,haspoint:!1})}),$(".picture-box").on("mouseover","ul li",function(){var t=$(this);t.addClass("active").siblings().removeClass("active"),t.closest(".picture-box").find(".view img").attr("src",t.find("img").attr("src"))}),$(".detail-box .tab-body .tab-item").on("tabActived",function(t,e){0<e&&lazyTab($(this))}),$("#comment-tab").on("click",".pagination a",function(t){t.preventDefault();var e=$(this);$.get(e.attr("href"),function(t){e.closest(".comment-page-box").html(t)})}),$(document).on("click",'[data-type="buy"]',function(t){t.preventDefault(),buyGoods(e,$(".info-box .number-input").val())}).on("click",'[data-type="addCart"]',function(t){t.preventDefault(),addToCart(e,$(".info-box .number-input").val())}).on("click",'[data-type="collect"]',function(t){t.preventDefault(),collectGoods(e,$(this))})}function lazyTab(e){var t=e.data("url");!t||e.hasClass("lazy-loading")||e.hasClass("tab-lazy-loaded")||(e.addClass("lazy-loading"),$.get(t,function(t){e.removeClass("lazy-loading"),e.html(t),e.addClass("tab-lazy-loaded")}))}function bindOrder(){function a(t,e){void 0===e&&(e="订单"),partialLoad(i,t,e)}$(".order-tab a").click(function(t){t.preventDefault();var e=$(this);e.addClass("active").siblings().removeClass("active"),a(e.attr("href"),e.text())});var i=$(".order-page-box").on("click",".pagination a",function(t){t.preventDefault();var e=$(this);a(e.attr("href"),"我的订单第"+e.text()+"页")})}function partialLoad(e,a,i){void 0===i&&(i="zodream"),$.get(a,function(t){e.html(t),history.pushState(null,i,a)})}function bindCashier(){function i(){var t=$(".address-edit .region-input");if(!(t.length<1))t.multiSelect({default:t.data("value")||0,data:BASE_URI+"region/tree",tag:"region_id"})}function a(){postJson(BASE_URI+"cashier/preview",e.find("form").serialize(),function(t){200===t.code?e.find(".checkout-footer").html(t.data.checkout):parseAjax(t)})}var e=$(".cashier-page").on("click",'.address-edit [data-action="save"]',function(){var e=$(this).closest(".panel-body");$.post(BASE_URI+"cashier/save_address",formData(e),function(t){0!==t.indexOf("false,")?(e.html(t),a()):Dialog.tip(t.substr(6))})}).on("click",'.address-view [data-action="edit"]',function(t){t.preventDefault();var e=$(this),a=e.closest(".panel-body");$.get(e.attr("href"),function(t){a.html(t),i()})}).on("click",'.shipping-box [name="shipping"],.payment-box [name="payment"]',function(){a()});i()}$(function(){$(".check-box").click(function(){$(this).toggleClass("active").trigger(CHECKED_CHANGE)}),$(".toggle-box").click(function(){$(this).toggleClass("active").trigger("change")}),$(".number-box .fa-minus").click(function(){var t=$(this).closest(".number-box").find("input"),e=t.attr("min")||0,a=Number(t.val())||0;e<a&&(a-=1),t.val(a).trigger("change")}),$(".number-box .fa-plus").click(function(){var t=$(this).closest(".number-box").find("input"),e=t.attr("max")||999,a=Number(t.val())||0;a<e&&(a+=1),t.val(a).trigger("change")}),$(".cart-footer .btn").click(function(t){t.preventDefault();var e=[];mapCheckedItem(function(t){e.push(t.data("id"))}),e.length<1?Dialog.tip("请选择结算的商品"):window.location.href=$(this).attr("href")+"?cart="+e.join("-")}),$(".checkout-footer").on("click",".btn",function(t){t.preventDefault();var e=$(this).closest("form"),a=!0;$.each(e.serializeArray(),function(){return"address"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择收货地址"),a=!1):"shipping"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择配送方式"),a=!1):"payment"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择支付方式"),a=!1):void 0}),a&&ajaxForm(e.attr("action"),e.serialize())}),$(".header-nav>li").mouseenter(function(){$(".header-nav .nav-dropdown").hide(),$(this).find(".nav-dropdown").show()}),$(".scroll-nav .nav-arrow").click(function(){$(this).closest(".scroll-nav").toggleClass("unfold")}),$(".header-nav").mouseleave(function(){$(this).find(".nav-dropdown").hide()});var e=$(".header-cart").mouseover(function(){$(this).find(".cart-dialog").show()}).mouseout(function(){$(this).find(".cart-dialog").hide()}).on("cartRefresh",function(){var e=$(this);$.get(e.data("url"),function(t){e.html(t)})}).on("click",".action .fa-times",function(){$.getJSON(BASE_URI+"cart/delete",{id:$(this).closest(".cart-item").data("id")},function(t){200==t.code&&e.trigger("cartRefresh")})});$(".header-search").mouseover(function(){$(this).addClass("expanded")}).mouseout(function(){$(this).removeClass("expanded")}),$("img.lazy").lazyload({callback:"img"}),$(".template-lazy").lazyload({callback:"tpl"}),$(".more-load").lazyload({mode:1,callback:function(e){if(!e.data("is_loading")){e.data("is_loading",!0);var a=parseInt(e.data("page")||"0")+1,t=e.data("url"),i=e.data("target");$.getJSON(t,{page:a},function(t){e.data("is_loading",!1),200==t.code&&($(i).append(t.data.html),e.data("page",a),t.data.has_more||e.remove())})}}});var t=$(".header-search input").keydown(function(t){13==t.keyCode&&search($(this).val())});$(".header-search .fa-search").click(function(){search(t.val())}),$(window).scroll(function(){$(".header-main").toggleClass("top-fixed",180<$(this).scrollTop())}).trigger("scroll")});