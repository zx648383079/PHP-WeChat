var CHECKED_CHANGE="cart_checked_change";function addToCart(t,e,a){void 0===e&&(e=1),"boolean"==typeof e&&(e=parseInt($(".number-input").val()+"",10)),e<1?Dialog.tip("数量不能小于1"):postJson("cart/add",{goods:t,amount:e,properties:JSON.stringify(a)},function(t){parseAjax(t)})}function buyGoods(t,e,a){void 0===e&&(e=1),"boolean"==typeof e&&(e=parseInt($(".number-input").val()+"",10)),e<1?Dialog.tip("数量不能小于1"):window.location.href="cashier?type=1&cart="+JSON.stringify([{goods:t,amount:e,properties:a}])}function collectGoods(t,e){postJson("collect/toggle?id="+t,function(t){200==t.code&&e&&$(e).toggleClass("active",t.data)})}function mapItem(t){$(".cart-item").each(function(){if(0==t($(this)))return!1})}function mapCheckedItem(e){mapItem(function(t){if(t.find(".check-box").hasClass("active"))return 0!=e(t)&&void 0})}function refreshCart(){var e=0;mapCheckedItem(function(t){e++}),$(".cart-footer .cart-checked-count").text(e)}function search(t){window.location.href=$(".header-search").data("url")+"?keywords="+t}function bindCart(i){$(".number-box input").change(function(){var t=$(this),e=t.val(),a=t.closest(".cart-item").attr("data-id");$.getJSON(i+"cart/update",{id:a,amount:e},function(t){parseAjax(t)})}),$(".cart-item .fa-trash").click(function(){var e=$(this).closest(".cart-item"),t=e.attr("data-id");$.getJSON(i+"cart/delete",{id:t},function(t){parseAjax(t),200==t.code&&e.remove()})}),$(".cart-group-item .group-header .check-box").on(CHECKED_CHANGE,function(){var t=$(this),e=t.hasClass("active");togglecChecked(e,t.closest(".cart-group-item").find(".cart-item .check-box")),e||togglecChecked(e,a),refreshCart()}),$(".cart-item .check-box").on(CHECKED_CHANGE,function(){var t=$(this);t.hasClass("active")||togglecChecked(!1,a,t.closest(".cart-group-item").find(".group-header .check-box")),refreshCart()});var a=$(".cart-footer .check-box, .cart-header .check-box").on(CHECKED_CHANGE,function(){togglecChecked($(this).hasClass("active"),$(".cart-group-item .check-box"),a),refreshCart()})}function togglecChecked(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];t.forEach(function(t){t.each(function(){var t=$(this);t.toggleClass("active",e),t.is("input")&&(this.checked=e)})})}function goPhoneLogin(){$(".login-type-box").hide(),$(".login-box").removeClass("hide")}function goEmailLogin(){$(".login-type-box").hide(),$(".login-box").removeClass("hide"),$(".login-box .email-password").removeClass("hide"),$(".login-box .phone-code,.login-box .phone-password").addClass("hide")}function bindStore(){var a=$(window),i=$(".store-page"),o=a.scrollTop();a.scroll(function(){var t=a.scrollTop(),e=t-o<0;(o=t)<183?i.removeClass("min").removeClass("min-up"):e?i.addClass("min-up").removeClass("min"):i.addClass("min").removeClass("min-up")})}function bindCategory(){$(".category-menu .menu-item").click(function(){var t=$(this);t.addClass("active").siblings().removeClass("active");var e=$(".category-main .item").eq(t.index());e.addClass("active").siblings().removeClass("active"),e.hasClass("lazy-loading")&&(e.removeClass("lazy-loading"),$.get(e.data("url"),function(t){e.html(t)}))}).eq(0).trigger("click")}function bindCartDialog(i){var a=$(".selected-property"),o=function(t){r.find(".group .group-body .active").each(function(){t&&t($(this))})},n=function(){var t=parseInt(r.find(".number-box .number-input").val()+""),e=c();postJson("goods/price",{id:i,amount:t,properties:JSON.stringify(e)},function(t){200==t.code?(r.find(".price").html(t.data.price),r.find(".stock").html("库存："+t.data.stock)):parseAjax(t)})},c=function(){var e=[];return o(function(t){e.push(t.data("value"))}),e},r=$(".cart-dialog").on("click",".dailog-yes",function(t){t.preventDefault();var e=parseInt(r.find(".number-box .number-input").val()+""),a=c();"buy"==r.data("step")?buyGoods(i,e,a):addToCart(i,e,a),r.hide()}).on("click",".dialog-close",function(t){t.preventDefault(),r.hide()}).on("click",".group .group-body span",function(){var e,t=$(this);t.hasClass("disable")||(0<t.closest(".multi-group").length?t.toggleClass("active"):t.addClass("active").siblings().removeClass("active"),e=[],o(function(t){e.push(t.text())}),a.text(0<e.length?"已选："+e.join(" "):""),n())}).on("change",".number-box .number-input",function(){n()}).click(function(t){t.pageY<r.find(".dialog-body").offset().top&&r.hide()});$(document).on("click","[data-action=cart]",function(t){t.preventDefault(),r.show().data("step","cart")}).on("click","[data-action=buy]",function(t){t.preventDefault(),r.show().data("step","buy")}),$(window).scroll(function(){var i=$(this).scrollTop();$(".top-tab a").removeClass("active").each(function(){var t=$(this),e=$(t.attr("href")),a=e.offset().top;if(a<=i&&i<a+e.height())return t.addClass("active"),!1})})}function bindMobileCashier(){var a=$("form");$("select").change(function(){ajaxForm(a.attr("action").replace("checkout","preview"),a.serialize(),function(t){if(200!=t.code)return parseAjax(t);$.each(t.data,function(t,e){"object"!=typeof e&&a.find("*[data-key="+t+"]").html(e)})})}).select()}function bindComment(){$(".comment-star i").click(function(){var t=$(this),e=t.index()+1,a=t.closest(".comment-star");a.find("input").val(e),a.find("i").each(function(){$(this).toggleClass("active",$(this).index()<e)})}),$(".comment-form-item").submit(function(){var e=$(this);return ajaxForm(e.attr("action"),e.serialize(),function(t){return 200!=t.code?parseAjax(t):1<$(".comment-form-item").length?(e.remove(),void Dialog.tip("已提交评价")):parseAjax(t)}),!1}),$(".multi-image-box .add-item").upload({url:"/ueditor.php?action=uploadimage",name:"upfile",multiple:!0,isAppend:!1,allowMultiple:!0,removeTag:".fa-times",template:'<div class="image-item"><img src="{url}" alt=""><input type="hidden" name="images[]" value="{url}"><i class="fa fa-times"></i></div>',onafter:function(t){return"SUCCESS"==t.state&&t}})}function bindMemberCenter(){$(window).scroll(function(){$("header.top").toggleClass("fixed",$(window).scrollTop()<176)})}function bindPay(){var e=$("input[name=payment]"),a=$(".payment-item").click(function(){var t=$(this);a.removeClass("active"),t.addClass("active"),e.val(t.data("id"))})}function bindAddress(t){var e=$(".address-dialog").dialog();$(".address-dialog .region-input").multiSelect({default:0,data:t+"region/tree",tag:"region_id"});e.on("done",function(){this.close(),postJson(t+"address/save",formData(e),function(t){parseAjax(t)})}),$(".add-btn").click(function(){var t;e.find(".dialog-title").text(t?"修改地址":"新建地址"),e.find("input,textarea").each(function(){"checkbox"!==this.type?this.value=t&&t[this.name]?t[this.name]:"":this.checked=!t||t[this.name]}),e.show()})}function formData(t){var e=[];return t.find("input,textarea,select").each(function(){this.type&&0<=["radio","checkbox"].indexOf(this.type)&&!this.checked||e.push(encodeURIComponent(this.name)+"="+encodeURIComponent($(this).val().toString()))}),e.join("&")}function bindPayTime(){var t=$('[data-type="countdown"]');setInterval(function(){var a=Math.floor((new Date).getTime()/1e3);t.each(function(){var t=$(this),e=Math.max(t.data("end")-a,0);t.text(formatTime(e))})},1e3)}function twoPad(t){return t<10&&0<=t?"0"+t:t.toString()}function formatTime(t){var e=Math.floor(t/3600);t-=3600*e;var a=Math.floor(t/60),i=t%60;return 0!==e?twoPad(e)+"时"+twoPad(a)+"分"+twoPad(i)+"秒":0!==a?twoPad(a)+"分"+twoPad(i)+"秒":twoPad(i)+"秒"}function bindHome(){$(".banner .slider").slider({width:1,height:420});$(".template-lazy").on("lazyLoaded",function(){var t=$(this).find(".slider-goods");t.length<1||t.slider({width:266,height:344,haspoint:!1})})}$(function(){$(".check-box").click(function(){$(this).toggleClass("active").trigger(CHECKED_CHANGE)}),$(".toggle-box").click(function(){$(this).toggleClass("active").trigger("change")}),$(".number-box .fa-minus").click(function(){var t=$(this).closest(".number-box").find("input"),e=t.attr("min")||0,a=Number(t.val())||0;e<a&&(a-=1),t.val(a).trigger("change")}),$(".number-box .fa-plus").click(function(){var t=$(this).closest(".number-box").find("input"),e=t.attr("max")||999,a=Number(t.val())||0;a<e&&(a+=1),t.val(a).trigger("change")}),$(".cart-footer .btn").click(function(t){t.preventDefault();var e=[];mapCheckedItem(function(t){e.push(t.data("id"))}),e.length<1?Dialog.tip("请选择结算的商品"):window.location.href=$(this).attr("href")+"?cart="+e.join("-")}),$(".checkout-footer .btn").click(function(t){t.preventDefault();var e=$(this).closest("form"),a=!0;$.each(e.serializeArray(),function(){return"address"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择收货地址"),a=!1):"shipping"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择配送方式"),a=!1):"payment"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择支付方式"),a=!1):void 0}),a&&ajaxForm(e.attr("action"),e.serialize())}),$(".tab-box .tab-header .tab-item").click(function(){var t=$(this);t.addClass("active").siblings().removeClass("active"),t.closest(".tab-box").find(".tab-body .tab-item").eq(t.index()).addClass("active").siblings().removeClass("active")}),$(".header-nav>li").mouseenter(function(){$(".header-nav .nav-dropdown").hide(),$(this).find(".nav-dropdown").show()}),$(".scroll-nav .nav-arrow").click(function(){$(this).closest(".scroll-nav").toggleClass("unfold")}),$(".header-nav").mouseleave(function(){$(this).find(".nav-dropdown").hide()}),$(".header-cart").mouseover(function(){$(this).find(".cart-dialog").show()}).mouseout(function(){$(this).find(".cart-dialog").hide()}),$(".header-search").mouseover(function(){$(this).addClass("expanded")}).mouseout(function(){$(this).removeClass("expanded")}),$("img.lazy").lazyload({callback:"img"}),$(".template-lazy").lazyload({callback:"tpl"}),$(".more-load").lazyload({mode:1,callback:function(e){if(!e.data("is_loading")){e.data("is_loading",!0);var a=parseInt(e.data("page")||"0")+1,t=e.data("url"),i=e.data("target");$.getJSON(t,{page:a},function(t){e.data("is_loading",!1),200==t.code&&($(i).append(t.data.html),e.data("page",a),t.data.has_more||e.remove())})}}});var t=$(".header-search input").keydown(function(t){13==t.keyCode&&search($(this).val())});$(".header-search .fa-search").click(function(){search(t.val())}),$(window).scroll(function(){$(".header-main").toggleClass("top-fixed",180<$(this).scrollTop())}).trigger("scroll")});