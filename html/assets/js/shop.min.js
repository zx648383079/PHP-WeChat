var CHECKED_CHANGE="cart_checked_change";function addToCart(t,a,e){void 0===a&&(a=1),"boolean"==typeof a&&(a=parseInt($(".number-input").val()+"",10)),a<1?Dialog.tip("数量不能小于1"):postJson(BASE_URI+"cart/add",{goods:t,amount:a,properties:JSON.stringify(e)},function(t){parseAjax(t),200===t.code&&$(".header-cart").trigger("cartRefresh")})}function buyGoods(t,a,e){void 0===a&&(a=1),"boolean"==typeof a&&(a=parseInt($(".number-input").val()+"",10)),a<1?Dialog.tip("数量不能小于1"):window.location.href=BASE_URI+"cashier?type=1&cart="+JSON.stringify([{goods:t,amount:a,properties:e}])}function collectGoods(t,a){postJson(BASE_URI+"collect/toggle?id="+t,function(t){200==t.code&&a&&$(a).toggleClass("active",t.data)})}function mapItem(t){$(".cart-item").each(function(){if(0==t($(this)))return!1})}function mapCheckedItem(a){mapItem(function(t){if(t.find(".check-box").hasClass("active"))return 0!=a(t)&&void 0})}function refreshCart(){var a=0;mapCheckedItem(function(t){a++}),$(".cart-footer .cart-checked-count").text(a)}function search(t){window.location.href=$(".header-search").data("url")+"?keywords="+t}function bindCart(){$(".number-box input").change(function(){var t=$(this),a=t.val(),e=t.closest(".cart-item").attr("data-id");$.getJSON(BASE_URI+"cart/update",{id:e,amount:a},function(t){parseAjax(t)})}),$(".cart-item .fa-trash").click(function(){var a=$(this).closest(".cart-item"),t=a.attr("data-id");$.getJSON(BASE_URI+"cart/delete",{id:t},function(t){parseAjax(t),200==t.code&&a.remove()})}),$(".cart-group-item .group-header .check-box").on(CHECKED_CHANGE,function(){var t=$(this),a=t.hasClass("active");togglecChecked(a,t.closest(".cart-group-item").find(".cart-item .check-box")),a||togglecChecked(a,e),refreshCart()}),$(".cart-item .check-box").on(CHECKED_CHANGE,function(){var t=$(this);t.hasClass("active")||togglecChecked(!1,e,t.closest(".cart-group-item").find(".group-header .check-box")),refreshCart()});var e=$(".cart-footer .check-box, .cart-header .check-box").on(CHECKED_CHANGE,function(){togglecChecked($(this).hasClass("active"),$(".cart-group-item .check-box"),e),refreshCart()})}function togglecChecked(a){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];t.forEach(function(t){t.each(function(){var t=$(this);t.toggleClass("active",a),t.is("input")&&(this.checked=a)})})}function goPhoneLogin(){$(".login-type-box").hide(),$(".login-box").removeClass("hide")}function goEmailLogin(){$(".login-type-box").hide(),$(".login-box").removeClass("hide"),$(".login-box .email-password").removeClass("hide"),$(".login-box .phone-code,.login-box .phone-password").addClass("hide")}function bindStore(){var e=$(window),i=$(".store-page"),n=e.scrollTop();e.scroll(function(){var t=e.scrollTop(),a=t-n<0;(n=t)<183?i.removeClass("min").removeClass("min-up"):a?i.addClass("min-up").removeClass("min"):i.addClass("min").removeClass("min-up")})}function bindCategory(){$(".category-menu .menu-item").click(function(){var t=$(this);t.addClass("active").siblings().removeClass("active");var a=$(".category-main .item").eq(t.index());a.addClass("active").siblings().removeClass("active"),a.hasClass("lazy-loading")&&(a.removeClass("lazy-loading"),$.get(a.data("url"),function(t){a.html(t)}))}).eq(0).trigger("click")}function bindCartDialog(i){function e(t){c.find(".group .group-body .active").each(function(){t&&t($(this))})}function a(){var t=parseInt(c.find(".number-box .number-input").val()+""),a=o();postJson(BASE_URI+"goods/price",{id:i,amount:t,properties:JSON.stringify(a)},function(t){200==t.code?(c.find(".price").html(t.data.price),c.find(".stock").html("库存："+t.data.stock)):parseAjax(t)})}var n=$(".selected-property"),o=function(){var a=[];return e(function(t){a.push(t.data("value"))}),a},c=$(".cart-dialog").on("click",".dailog-yes",function(t){t.preventDefault();var a=parseInt(c.find(".number-box .number-input").val()+""),e=o();"buy"==c.data("step")?buyGoods(i,a,e):addToCart(i,a,e),c.hide()}).on("click",".dialog-close",function(t){t.preventDefault(),c.hide()}).on("click",".group .group-body span",function(){var t=$(this);t.hasClass("disable")||(0<t.closest(".multi-group").length?t.toggleClass("active"):t.addClass("active").siblings().removeClass("active"),function(){var a=[];e(function(t){a.push(t.text())}),n.text(0<a.length?"已选："+a.join(" "):"")}(),a())}).on("change",".number-box .number-input",function(){a()}).click(function(t){t.pageY<c.find(".dialog-body").offset().top&&c.hide()});$(document).on("click","[data-action=cart]",function(t){t.preventDefault(),c.show().data("step","cart")}).on("click","[data-action=buy]",function(t){t.preventDefault(),c.show().data("step","buy")}),$(window).scroll(function(){var i=$(this).scrollTop();$(".top-tab a").removeClass("active").each(function(){var t=$(this),a=$(t.attr("href")),e=a.offset().top;if(e<=i&&i<e+a.height())return t.addClass("active"),!1})})}function bindMobileCashier(){var e=$("form");$("select").change(function(){ajaxForm(e.attr("action").replace("checkout","preview"),e.serialize(),function(t){if(200!=t.code)return parseAjax(t);$.each(t.data,function(t,a){"object"!=typeof a&&e.find("*[data-key="+t+"]").html(a)})})}).select()}function bindComment(){$(".comment-star i").click(function(){var t=$(this),a=t.index()+1,e=t.closest(".comment-star");e.find("input").val(a),e.find("i").each(function(){$(this).toggleClass("active",$(this).index()<a)})}),$(".comment-form-item").submit(function(){var a=$(this);return ajaxForm(a.attr("action"),a.serialize(),function(t){return 200!=t.code?parseAjax(t):1<$(".comment-form-item").length?(a.remove(),void Dialog.tip("已提交评价")):parseAjax(t)}),!1}),$(".multi-image-box .add-item").upload({url:"/ueditor.php?action=uploadimage",name:"upfile",multiple:!0,isAppend:!1,allowMultiple:!0,removeTag:".fa-times",template:'<div class="image-item"><img src="{url}" alt=""><input type="hidden" name="images[]" value="{url}"><i class="fa fa-times"></i></div>',onafter:function(t){return"SUCCESS"==t.state&&t}})}function bindMemberCenter(){$(window).scroll(function(){$("header.top").toggleClass("fixed",$(window).scrollTop()<176)})}function bindPay(){var a=$("input[name=payment]"),e=$(".payment-item").click(function(){var t=$(this);e.removeClass("active"),t.addClass("active"),a.val(t.data("id"))})}function bindAddress(){function a(t){e.find(".dialog-title").text(t?"修改地址":"新建地址"),e.find("input,textarea").each(function(){"checkbox"!==this.type?this.value=t&&t[this.name]?t[this.name]:"":this.checked=!t||t[this.name]}),t&&0<t.region_id&&(i.val=t.region_id)}var e=$(".address-dialog").dialog(),i=$(".address-dialog .region-input").multiSelect({default:0,data:BASE_URI+"region/tree",tag:"region_id"});e.on("done",function(){this.close(),postJson(BASE_URI+"address/save",formData(e),o)}),$(".add-btn").click(function(){a(),e.show()});var n=$(".address-page-box").on("click",".pagination a",function(t){t.preventDefault(),c($(this).attr("href"))}).on("click",'a[data-action="edit"]',function(t){t.preventDefault(),$.getJSON($(this).attr("href"),function(t){a(t.data),e.show()})}).on("click",'a[data-action="del"]',function(t){t.preventDefault(),confirm("确定要删除此收货地址?")&&postJson($(this).attr("href"),o)}).on("click",'a[data-action="default"]',function(t){t.preventDefault(),postJson($(this).attr("href"),o)}),o=function(t){if(200===t.code){if("object"==typeof t.data){var a=t.data.url;t.data.refresh&&(a=window.location.href),c(a)}}else parseAjax(t)},c=function(t){partialLoad(n,t,"我的收货地址")}}function bindPayTime(){var t=$('[data-type="countdown"]');setInterval(function(){var e=Math.floor((new Date).getTime()/1e3);t.each(function(){var t=$(this),a=Math.max(t.data("end")-e,0);t.text(formatTime(a))})},1e3)}function twoPad(t){return t<10&&0<=t?"0"+t:t.toString()}function formatTime(t){var a=Math.floor(t/3600);t-=3600*a;var e=Math.floor(t/60),i=t%60;return 0!==a?twoPad(a)+"时"+twoPad(e)+"分"+twoPad(i)+"秒":0!==e?twoPad(e)+"分"+twoPad(i)+"秒":twoPad(i)+"秒"}function bindHome(){$(".banner .slider").slider({width:1,height:420});$(".template-lazy").on("lazyLoaded",function(){var t=$(this).find(".slider-goods");t.length<1||t.slider({width:266,height:344,haspoint:!1})})}function bindGoods(a){$(".template-lazy").on("lazyLoaded",function(){var t=$(this).find(".slider-goods");t.length<1||t.slider({width:266,height:344,haspoint:!1})}),$(".picture-box").on("mouseover","ul li",function(){var t=$(this);t.addClass("active").siblings().removeClass("active"),t.closest(".picture-box").find(".view img").attr("src",t.find("img").attr("src"))}),$(".detail-box .tab-body .tab-item").on("tabActived",function(t,a){0<a&&lazyTab($(this))}),$("#comment-tab").on("click",".pagination a",function(t){t.preventDefault();var a=$(this);$.get(a.attr("href"),function(t){a.closest(".comment-page-box").html(t)})}),$(document).on("click",'[data-type="buy"]',function(t){t.preventDefault(),buyGoods(a,$(".info-box .number-input").val())}).on("click",'[data-type="addCart"]',function(t){t.preventDefault(),addToCart(a,$(".info-box .number-input").val())}).on("click",'[data-type="collect"]',function(t){t.preventDefault(),collectGoods(a,$(this))})}function lazyTab(a){var t=a.data("url");!t||a.hasClass("lazy-loading")||a.hasClass("tab-lazy-loaded")||(a.addClass("lazy-loading"),$.get(t,function(t){a.removeClass("lazy-loading"),a.html(t),a.addClass("tab-lazy-loaded")}))}function bindOrder(){function e(t,a){void 0===a&&(a="订单"),partialLoad(i,t,a)}$(".order-tab a").click(function(t){t.preventDefault();var a=$(this);a.addClass("active").siblings().removeClass("active"),e(a.attr("href"),a.text())});var i=$(".order-page-box").on("click",".pagination a",function(t){t.preventDefault();var a=$(this);e(a.attr("href"),"我的订单第"+a.text()+"页")})}function partialLoad(a,e,i){void 0===i&&(i="zodream"),$.get(e,function(t){a.html(t),history.pushState(null,i,e)})}function bindCashier(){function i(){var t=$(".address-edit .region-input");if(!(t.length<1))t.multiSelect({default:t.data("value")||0,data:BASE_URI+"region/tree",tag:"region_id"})}function e(){postJson(BASE_URI+"cashier/preview",a.find("form").serialize(),function(t){200===t.code?a.find(".checkout-footer").html(t.data.checkout):parseAjax(t)})}var a=$(".cashier-page").on("click",'.address-edit [data-action="save"]',function(){var a=$(this).closest(".panel-body");$.post(BASE_URI+"cashier/save_address",formData(a),function(t){0!==t.indexOf("false,")?(a.html(t),e()):Dialog.tip(t.substr(6))})}).on("click",'.address-edit [data-action="cancel"]',function(){var t=$(this),a=t.closest(".panel-body");$.post(BASE_URI+"cashier/address",{id:t.attr("data-prev")},function(t){a.html(t)})}).on("click",'.address-view [data-action="edit"]',function(t){t.preventDefault();var a=$(this),e=a.closest(".panel-body");$.get(a.attr("href"),function(t){e.html(t),i()})}).on("click",'.address-view [data-action="dialog"]',function(t){t.preventDefault();var a=$(this);a.closest(".panel-body");$.get(a.attr("href"),function(t){n.find(".dialog-body").html(t),n.show()})}).on("click",'.shipping-box [name="shipping"],.payment-box [name="payment"]',function(){e()});i();var n=$("#address-dialog").dialog();n.box.on("click",".address-item",function(){$(this).addClass("active").siblings(".address-item").removeClass("active")}).on("click",".pagination a",function(t){t.preventDefault(),$.get($(this).attr("href"),function(t){n.find(".dialog-body").html(t)})}),n.on("done",function(){var t=this.find(".address-item.active");t.length<1?Dialog.tip("请选择地址"):(this.close(),$.post(BASE_URI+"cashier/address",{id:t.attr("data-id")},function(t){a.find(".address-view").closest(".panel-body").html(t),e()}))})}$(function(){$(".back-to-top").click(function(){$("body,html").animate({scrollTop:0},100)}),$(".check-box").click(function(){$(this).toggleClass("active").trigger(CHECKED_CHANGE)}),$(".toggle-box").click(function(){$(this).toggleClass("active").trigger("change")}),$(".number-box .fa-minus").click(function(){var t=$(this).closest(".number-box").find("input"),a=t.attr("min")||0,e=Number(t.val())||0;a<e&&(e-=1),t.val(e).trigger("change")}),$(".number-box .fa-plus").click(function(){var t=$(this).closest(".number-box").find("input"),a=t.attr("max")||999,e=Number(t.val())||0;e<a&&(e+=1),t.val(e).trigger("change")}),$(".cart-footer .btn").click(function(t){t.preventDefault();var a=[];mapCheckedItem(function(t){a.push(t.data("id"))}),a.length<1?Dialog.tip("请选择结算的商品"):window.location.href=$(this).attr("href")+"?cart="+a.join("-")}),$(".checkout-footer").on("click",".btn",function(t){t.preventDefault();var a=$(this).closest("form"),e=!0;$.each(a.serializeArray(),function(){return"address"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择收货地址"),e=!1):"shipping"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择配送方式"),e=!1):"payment"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择支付方式"),e=!1):void 0}),e&&ajaxForm(a.attr("action"),a.serialize())}),$(".header-nav>li").mouseenter(function(){$(".header-nav .nav-dropdown").hide(),$(this).find(".nav-dropdown").show()}),$(".scroll-nav .nav-arrow").click(function(){$(this).closest(".scroll-nav").toggleClass("unfold")}),$(".header-nav").mouseleave(function(){$(this).find(".nav-dropdown").hide()});var a=$(".header-cart").mouseover(function(){$(this).find(".cart-dialog").show()}).mouseout(function(){$(this).find(".cart-dialog").hide()}).on("cartRefresh",function(){var a=$(this);$.get(a.data("url"),function(t){a.html(t)})}).on("click",".action .fa-times",function(){$.getJSON(BASE_URI+"cart/delete",{id:$(this).closest(".cart-item").data("id")},function(t){200==t.code&&a.trigger("cartRefresh")})});$(".header-search").mouseover(function(){$(this).addClass("expanded")}).mouseout(function(){$(this).removeClass("expanded")}),$("img.lazy").lazyload({callback:"img"}),$(".template-lazy").lazyload({callback:"tpl"}),$(".more-load").lazyload({mode:1,callback:function(a){if(!a.data("is_loading")){a.data("is_loading",!0);var e=parseInt(a.data("page")||"0")+1,t=a.data("url"),i=a.data("target");$.getJSON(t,{page:e},function(t){a.data("is_loading",!1),200==t.code&&($(i).append(t.data.html),a.data("page",e),t.data.has_more||a.remove())})}}});var t=$(".header-search input").keydown(function(t){13==t.keyCode&&search($(this).val())});$(".header-search .fa-search").click(function(){search(t.val())}),$(window).scroll(function(){$(".header-main").toggleClass("top-fixed",180<$(this).scrollTop())}).trigger("scroll")});