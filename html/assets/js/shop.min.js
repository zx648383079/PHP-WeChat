var CHECKED_CHANGE="cart_checked_change";function addToCart(a,e){void 0===e&&(e=1),postJson("cart/add?goods="+a+"&amount="+e,function(a){parseAjax(a)})}function buyGoods(a,e){void 0===e&&(e=1)}function collectGoods(a,e){postJson("collect/toggle?id="+a,function(a){200==a.code&&e&&$(e).toggleClass("active",a.data)})}function mapItem(a){$(".cart-item").each(function(){if(0==a($(this)))return!1})}function mapCheckedItem(e){mapItem(function(a){if(a.find(".check-box").hasClass("active"))return 0!=e(a)&&void 0})}function refreshCart(){var e=0;mapCheckedItem(function(a){e++}),$(".cart-footer .cart-checked-count").text(e)}function search(a){window.location.href=$(".header-search").data("url")+"?keywords="+a}function bindCart(o){$(".number-box input").change(function(){var a=$(this),e=a.val(),t=a.closest(".cart-item").attr("data-id");$.getJSON(o+"cart/update",{id:t,amount:e},function(a){parseAjax(a)})}),$(".cart-item .fa-trash").click(function(){var e=$(this).closest(".cart-item"),a=e.attr("data-id");$.getJSON(o+"cart/delete",{id:a},function(a){parseAjax(a),200==a.code&&e.remove()})}),$(".cart-group-item .group-header .check-box").on(CHECKED_CHANGE,function(){var a=$(this),e=a.hasClass("active");togglecChecked(e,a.closest(".cart-group-item").find(".cart-item .check-box")),e||togglecChecked(e,t),refreshCart()}),$(".cart-item .check-box").on(CHECKED_CHANGE,function(){var a=$(this);a.hasClass("active")||togglecChecked(!1,t,a.closest(".cart-group-item").find(".group-header .check-box")),refreshCart()});var t=$(".cart-footer .check-box, .cart-header .check-box").on(CHECKED_CHANGE,function(){togglecChecked($(this).hasClass("active"),$(".cart-group-item .check-box"),t),refreshCart()})}function togglecChecked(e){for(var a=[],t=1;t<arguments.length;t++)a[t-1]=arguments[t];a.forEach(function(a){a.each(function(){var a=$(this);a.toggleClass("active",e),a.is("input")&&(this.checked=e)})})}function goPhoneLogin(){$(".login-type-box").hide(),$(".login-box").removeClass("hide")}function goEmailLogin(){$(".login-type-box").hide(),$(".login-box").removeClass("hide"),$(".login-box .email-password").removeClass("hide"),$(".login-box .phone-code,.login-box .phone-password").addClass("hide")}function bindStore(){var t=$(window),o=$(".store-page"),i=t.scrollTop();t.scroll(function(){var a=t.scrollTop(),e=a-i<0;(i=a)<183?o.removeClass("min").removeClass("min-up"):e?o.addClass("min-up").removeClass("min"):o.addClass("min").removeClass("min-up")})}function bindCategory(){$(".category-menu .menu-item").click(function(){var a=$(this);a.addClass("active").siblings().removeClass("active");var e=$(".category-main .item").eq(a.index());e.addClass("active").siblings().removeClass("active"),e.hasClass("lazy-loading")&&(e.removeClass("lazy-loading"),$.get(e.data("url"),function(a){e.html(a)}))}).eq(0).trigger("click")}function bindCartDialog(t){var o=$(".cart-dialog").on("click",".dailog-yes",function(a){a.preventDefault();var e=parseInt(o.find(".number-box .number-input").val()+"");"buy"==o.data("step")?buyGoods(t,e):addToCart(t,e),o.hide()}).on("click",".dialog-close",function(a){a.preventDefault(),o.hide()}).click(function(a){a.pageY<o.find(".dialog-body").offset().top&&o.hide()});$(document).on("click","[data-action=cart]",function(a){a.preventDefault(),o.show().data("step","cart")}).on("click","[data-action=buy]",function(a){a.preventDefault(),o.show().data("step","buy")})}$(function(){$(".check-box").click(function(){$(this).toggleClass("active").trigger(CHECKED_CHANGE)}),$(".toggle-box").click(function(){$(this).toggleClass("active").trigger("change")}),$(".number-box .fa-minus").click(function(){var a=$(this).closest(".number-box").find("input"),e=a.attr("min")||0,t=Number(a.val())||0;e<t&&(t-=1),a.val(t).trigger("change")}),$(".number-box .fa-plus").click(function(){var a=$(this).closest(".number-box").find("input"),e=a.attr("max")||999,t=Number(a.val())||0;t<e&&(t+=1),a.val(t).trigger("change")}),$(".cart-footer .btn").click(function(a){a.preventDefault();var e=[];mapCheckedItem(function(a){e.push(a.data("id"))}),e.length<1?Dialog.tip("请选择结算的商品"):window.location.href=$(this).attr("href")+"?cart="+e.join("-")}),$(".checkout-footer .btn").click(function(a){a.preventDefault();var e=$(this).closest("form"),t=!0;$.each(e.serializeArray(),function(){return"address"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择收货地址"),t=!1):"shipping"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择配送方式"),t=!1):"payment"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择支付方式"),t=!1):void 0}),t&&ajaxForm(e.attr("action"),e.serialize())}),$(".tab-box .tab-header .tab-item").click(function(){var a=$(this);a.addClass("active").siblings().removeClass("active"),a.closest(".tab-box").find(".tab-body .tab-item").eq(a.index()).addClass("active").siblings().removeClass("active")}),$(".header-nav>li").mouseenter(function(){$(".header-nav .nav-dropdown").hide(),$(this).find(".nav-dropdown").show()}),$(".scroll-nav .nav-arrow").click(function(){$(this).closest(".scroll-nav").toggleClass("unfold")}),$(".header-nav").mouseleave(function(){$(this).find(".nav-dropdown").hide()}),$(".header-cart").mouseover(function(){$(this).find(".cart-dialog").show()}).mouseout(function(){$(this).find(".cart-dialog").hide()}),$(".header-search").mouseover(function(){$(this).addClass("expanded")}).mouseout(function(){$(this).removeClass("expanded")}),$("img.lazy").lazyload({callback:"img"}),$(".more-load").lazyload({mode:1,callback:function(e){if(!e.data("is_loading")){e.data("is_loading",!0);var t=parseInt(e.data("page")||"0")+1,a=e.data("url"),o=e.data("target");$.getJSON(a,{page:t},function(a){e.data("is_loading",!1),200==a.code&&($(o).append(a.data.html),e.data("page",t),a.data.has_more||e.remove())})}}});var a=$(".header-search input").keydown(function(a){13==a.keyCode&&search($(this).val())});$(".header-search .fa-search").click(function(){search(a.val())}),$(window).scroll(function(){$(".header-main").toggleClass("top-fixed",180<$(this).scrollTop())}).trigger("scroll")});