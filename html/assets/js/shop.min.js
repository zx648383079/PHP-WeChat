var CHECKED_CHANGE="cart_checked_change";function addToCart(e,t,a){void 0===t&&(t=1),postJson("cart/add",{goods:e,amount:t,properties:JSON.stringify(a)},function(e){parseAjax(e)})}function buyGoods(e,t,a){void 0===t&&(t=1),window.location.href="cashier?type=1&cart="+JSON.stringify([{goods:e,amount:t,properties:a}])}function collectGoods(e,t){postJson("collect/toggle?id="+e,function(e){200==e.code&&t&&$(t).toggleClass("active",e.data)})}function mapItem(e){$(".cart-item").each(function(){if(0==e($(this)))return!1})}function mapCheckedItem(t){mapItem(function(e){if(e.find(".check-box").hasClass("active"))return 0!=t(e)&&void 0})}function refreshCart(){var t=0;mapCheckedItem(function(e){t++}),$(".cart-footer .cart-checked-count").text(t)}function search(e){window.location.href=$(".header-search").data("url")+"?keywords="+e}function bindCart(i){$(".number-box input").change(function(){var e=$(this),t=e.val(),a=e.closest(".cart-item").attr("data-id");$.getJSON(i+"cart/update",{id:a,amount:t},function(e){parseAjax(e)})}),$(".cart-item .fa-trash").click(function(){var t=$(this).closest(".cart-item"),e=t.attr("data-id");$.getJSON(i+"cart/delete",{id:e},function(e){parseAjax(e),200==e.code&&t.remove()})}),$(".cart-group-item .group-header .check-box").on(CHECKED_CHANGE,function(){var e=$(this),t=e.hasClass("active");togglecChecked(t,e.closest(".cart-group-item").find(".cart-item .check-box")),t||togglecChecked(t,a),refreshCart()}),$(".cart-item .check-box").on(CHECKED_CHANGE,function(){var e=$(this);e.hasClass("active")||togglecChecked(!1,a,e.closest(".cart-group-item").find(".group-header .check-box")),refreshCart()});var a=$(".cart-footer .check-box, .cart-header .check-box").on(CHECKED_CHANGE,function(){togglecChecked($(this).hasClass("active"),$(".cart-group-item .check-box"),a),refreshCart()})}function togglecChecked(t){for(var e=[],a=1;a<arguments.length;a++)e[a-1]=arguments[a];e.forEach(function(e){e.each(function(){var e=$(this);e.toggleClass("active",t),e.is("input")&&(this.checked=t)})})}function goPhoneLogin(){$(".login-type-box").hide(),$(".login-box").removeClass("hide")}function goEmailLogin(){$(".login-type-box").hide(),$(".login-box").removeClass("hide"),$(".login-box .email-password").removeClass("hide"),$(".login-box .phone-code,.login-box .phone-password").addClass("hide")}function bindStore(){var a=$(window),i=$(".store-page"),o=a.scrollTop();a.scroll(function(){var e=a.scrollTop(),t=e-o<0;(o=e)<183?i.removeClass("min").removeClass("min-up"):t?i.addClass("min-up").removeClass("min"):i.addClass("min").removeClass("min-up")})}function bindCategory(){$(".category-menu .menu-item").click(function(){var e=$(this);e.addClass("active").siblings().removeClass("active");var t=$(".category-main .item").eq(e.index());t.addClass("active").siblings().removeClass("active"),t.hasClass("lazy-loading")&&(t.removeClass("lazy-loading"),$.get(t.data("url"),function(e){t.html(e)}))}).eq(0).trigger("click")}function bindCartDialog(i){var a=$(".selected-property"),o=function(e){r.find(".group .group-body .active").each(function(){e&&e($(this))})},n=function(){var e=parseInt(r.find(".number-box .number-input").val()+""),t=c();postJson("goods/price",{id:i,amount:e,properties:JSON.stringify(t)},function(e){200==e.code?(r.find(".price").html(e.data.price),r.find(".stock").html("库存："+e.data.stock)):parseAjax(e)})},c=function(){var t=[];return o(function(e){t.push(e.data("value"))}),t},r=$(".cart-dialog").on("click",".dailog-yes",function(e){e.preventDefault();var t=parseInt(r.find(".number-box .number-input").val()+""),a=c();"buy"==r.data("step")?buyGoods(i,t,a):addToCart(i,t,a),r.hide()}).on("click",".dialog-close",function(e){e.preventDefault(),r.hide()}).on("click",".group .group-body span",function(){var t,e=$(this);e.hasClass("disable")||(0<e.closest(".multi-group").length?e.toggleClass("active"):e.addClass("active").siblings().removeClass("active"),t=[],o(function(e){t.push(e.text())}),a.text(0<t.length?"已选："+t.join(" "):""),n())}).on("change",".number-box .number-input",function(){n()}).click(function(e){e.pageY<r.find(".dialog-body").offset().top&&r.hide()});$(document).on("click","[data-action=cart]",function(e){e.preventDefault(),r.show().data("step","cart")}).on("click","[data-action=buy]",function(e){e.preventDefault(),r.show().data("step","buy")}),$(window).scroll(function(){var i=$(this).scrollTop();$(".top-tab a").removeClass("active").each(function(){var e=$(this),t=$(e.attr("href")),a=t.offset().top;if(a<=i&&i<a+t.height())return e.addClass("active"),!1})})}function bindMobileCashier(){var a=$("form");$("select").change(function(){ajaxForm(a.attr("action").replace("checkout","preview"),a.serialize(),function(e){if(200!=e.code)return parseAjax(e);$.each(e.data,function(e,t){"object"!=typeof t&&a.find("*[data-key="+e+"]").html(t)})})}).select()}function bindComment(){$(".comment-star i").click(function(){var e=$(this),t=e.index()+1,a=e.closest(".comment-star");a.find("input").val(t),a.find("i").each(function(){$(this).toggleClass("active",$(this).index()<t)})}),$(".comment-form-item").submit(function(){var t=$(this);return ajaxForm(t.attr("action"),t.serialize(),function(e){return 200!=e.code?parseAjax(e):1<$(".comment-form-item").length?(t.remove(),void Dialog.tip("已提交评价")):parseAjax(e)}),!1}),$(".multi-image-box .add-item").upload({url:"/ueditor.php?action=uploadimage",name:"upfile",multiple:!0,isAppend:!1,allowMultiple:!0,removeTag:".fa-times",template:'<div class="image-item"><img src="{url}" alt=""><input type="hidden" name="images[]" value="{url}"><i class="fa fa-times"></i></div>',onafter:function(e){return"SUCCESS"==e.state&&e}})}function bindMemberCenter(){$(window).scroll(function(){$("header.top").toggleClass("fixed",$(window).scrollTop()<176)})}function bindPay(){var t=$("input[name=payment]"),a=$(".payment-item").click(function(){var e=$(this);a.removeClass("active"),e.addClass("active"),t.val(e.data("id"))})}$(function(){$(".check-box").click(function(){$(this).toggleClass("active").trigger(CHECKED_CHANGE)}),$(".toggle-box").click(function(){$(this).toggleClass("active").trigger("change")}),$(".number-box .fa-minus").click(function(){var e=$(this).closest(".number-box").find("input"),t=e.attr("min")||0,a=Number(e.val())||0;t<a&&(a-=1),e.val(a).trigger("change")}),$(".number-box .fa-plus").click(function(){var e=$(this).closest(".number-box").find("input"),t=e.attr("max")||999,a=Number(e.val())||0;a<t&&(a+=1),e.val(a).trigger("change")}),$(".cart-footer .btn").click(function(e){e.preventDefault();var t=[];mapCheckedItem(function(e){t.push(e.data("id"))}),t.length<1?Dialog.tip("请选择结算的商品"):window.location.href=$(this).attr("href")+"?cart="+t.join("-")}),$(".checkout-footer .btn").click(function(e){e.preventDefault();var t=$(this).closest("form"),a=!0;$.each(t.serializeArray(),function(){return"address"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择收货地址"),a=!1):"shipping"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择配送方式"),a=!1):"payment"==this.name&&parseInt(this.value)<1?(Dialog.tip("请选择支付方式"),a=!1):void 0}),a&&ajaxForm(t.attr("action"),t.serialize())}),$(".tab-box .tab-header .tab-item").click(function(){var e=$(this);e.addClass("active").siblings().removeClass("active"),e.closest(".tab-box").find(".tab-body .tab-item").eq(e.index()).addClass("active").siblings().removeClass("active")}),$(".header-nav>li").mouseenter(function(){$(".header-nav .nav-dropdown").hide(),$(this).find(".nav-dropdown").show()}),$(".scroll-nav .nav-arrow").click(function(){$(this).closest(".scroll-nav").toggleClass("unfold")}),$(".header-nav").mouseleave(function(){$(this).find(".nav-dropdown").hide()}),$(".header-cart").mouseover(function(){$(this).find(".cart-dialog").show()}).mouseout(function(){$(this).find(".cart-dialog").hide()}),$(".header-search").mouseover(function(){$(this).addClass("expanded")}).mouseout(function(){$(this).removeClass("expanded")}),$("img.lazy").lazyload({callback:"img"}),$(".more-load").lazyload({mode:1,callback:function(t){if(!t.data("is_loading")){t.data("is_loading",!0);var a=parseInt(t.data("page")||"0")+1,e=t.data("url"),i=t.data("target");$.getJSON(e,{page:a},function(e){t.data("is_loading",!1),200==e.code&&($(i).append(e.data.html),t.data("page",a),e.data.has_more||t.remove())})}}});var e=$(".header-search input").keydown(function(e){13==e.keyCode&&search($(this).val())});$(".header-search .fa-search").click(function(){search(e.val())}),$(window).scroll(function(){$(".header-main").toggleClass("top-fixed",180<$(this).scrollTop())}).trigger("scroll")});