var __spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var l=arguments[e],a=0,s=l.length;a<s;a++,o++)n[o]=l[a];return n},DEL_URI="weight/destroy",NEW_URI="weight/create",REFRESH_URI="weight/refresh",EDIT_URI="weight/save",EDIT_DAILOG_URI="weight/edit_dialog",SETTING_URI="weight/setting",SAVE_SETTING_URI="weight/save_setting",INFO_URI="weight/info",PropertyInput=function(){function l(){}return l.guid=function(){return l._guid++},l.title=function(t){void 0===t&&(t="");var e="title_"+l.guid();return l.input(e,"标题",l.text(e,"title",t))},l.lazy=function(t){var e="settings_lazy_"+l.guid();return l.input(e,"懒加载",l.radio(e,"settings[lazy]",["关闭","开启"],t||0))},l.margin=function(t){return void 0===t&&(t=[]),l.sideInput("settings[style][margin]","外边距",t)},l.padding=function(t,e){return void 0===e&&(e=[]),l.sideInput("settings[style]["+t+"][padding]","内边距",e)},l.position=function(t){var e=l.positionSide(null==t?void 0:t.type,null==t?void 0:t.value),i=l.option({static:"无",relative:"相对定位",absolute:"绝对定位",fixed:"固定定位"},null==t?void 0:t.type);return l.input("","悬浮",'<select name="settings[style][position][type]">'+i+'</select><div class="side-input">'+e+"</div>","position-input")},l.positionSide=function(t,e){return t&&"static"!=t?l.side("settings[style][position][value]","settings[style][position][value]",e):""},l.border=function(t,e){var i=l.nameToId(t="settings[style]"+(t?"["+t+"]":"")+"[border]")+"_"+l.guid(),n=l.checkbox(i,t+"[side][]",["上","右","下","左"],null==e?void 0:e.side),o=l.option(["实线","虚线"],e&&e.value&&1==e.value[1]?1:0);return l.input(i,"边框",'<input type="text" class="form-control" name="'+t+'[value][]" value="'+(null==e?void 0:e.value[0])+'" placeholder="粗细" size="4"><select name="'+t+'[value][]">'+o+'</select><input type="color" name="'+t+'[value][]" value="'+(null==e?void 0:e.value[2])+'"><div class="side-input">'+n+"</div>\n        ")},l.radius=function(t,e){var i=l.nameToId(t="settings[style]"+(t?"["+t+"]":"")+"[border-radius]")+"_"+l.guid();return l.input(i,"圆角",'<input type="text" id="'+i+'_0" class="form-control " name="'+t+'[]" value="" size="4" placeholder="左上">\n        <input type="text" id="'+i+'_1" class="form-control " name="'+t+'[]" value="" size="4" placeholder="右上">\n        <br/>\n        <input type="text" id="'+i+'_2" class="form-control " name="'+t+'[]" value="" size="4" placeholder="左下">\n        <input type="text" id="'+i+'_3" class="form-control " name="'+t+'[]" value="" size="4" placeholder="右下">')},l.color=function(t,e){var i=l.nameToId(t="settings[style]"+(t?"["+t+"]":"")+"[color]")+"_"+l.guid();return l.input(i,"字体颜色",l.radio(i,t+"[type]",["无","有"],null==e?void 0:e.type)+'<input type="color" name="'+t+'[value]" value="'+(null==e?void 0:e.value)+'">')},l.background=function(t,e){var i=l.nameToId(t="settings[style]"+(t?"["+t+"]":"")+"[background]")+"_"+l.guid(),n=l.radio(i,t+"[type]",["无","颜色","图片"],"0")+'<div class="value-input">'+l.backgroundValue(t,null==e?void 0:e.type)+"</div>";return l.input(i,"背景",n,"background-input")},l.backgroundValue=function(t,e){return!e||e<1?"":2==e?'<div class="file-input">\n            <input type="text" class="form-control " name="'+t+'[value]" value="" size="10">\n            <button type="button" data-type="upload">上传</button>\n        </div>':'<input type="color" name="'+t+'[value]">'},l.visibility=function(t,e){var i=l.nameToId(t="settings[style]["+t+"][visibility]")+"_"+l.guid();return l.input(i,"可见",l.radio(i,t,["显示","隐藏"],e))},l.fontSize=function(t,e){var i=l.nameToId(t="settings[style]["+t+"][font-size]")+"_"+l.guid();return l.input(i,"字体大小",l.text(i,t,e,4))},l.textAlign=function(t,e){var i=l.nameToId(t="settings[style]["+t+"][text-align]")+"_"+l.guid();return l.input(i,"字体位置",l.radio(i,t,["居左","居中","居右"],e||0))},l.fontWeight=function(t,e){var i=l.nameToId(t="settings[style]["+t+"][font-weight]")+"_"+l.guid();return l.input(i,"字体粗细",l.text(i,t,e,4))},l.option=function(t,e){var i="";return $.each(t,function(t){i+='<option value="'+t+'"'+(e==t?" selected":"")+">"+this+"</option>"}),i},l.sideInput=function(t,e,i){void 0===i&&(i=[]);var n=l.nameToId(t)+"_"+l.guid();return l.input(n,e,l.side(n,t,i),"side-input")},l.side=function(i,n,o){void 0===o&&(o=[]);var l="";return $.each(["上","右","下","左"],function(t){var e=o&&o.length>t?o[t]:"";l+='<input type="text" id="'+i+"_"+t+'" class="form-control " name="'+n+'[]" size="4" value="'+e+'" placeholder="'+this+'">'}),l},l.radio=function(i,n,t,o){var l="",a=0;return $.each(t,function(t){var e=[i,a++].join("_");l+='<span class="radio-label"><input type="radio" id="'+e+'" name="'+n+'" value="'+t+'"'+(t==o?" checked":"")+'><label for="'+e+'">'+this+"</label></span>"}),l},l.checkbox=function(n,o,t,l){void 0===l&&(l=[]);var a="",s=0;return $.each(t,function(t){var e=[n,s++].join("_"),i=l&&0<=l.indexOf(t)?" checked":"";a+='<span class="check-label"><input type="checkbox" id="'+e+'" name="'+o+'" value="'+t+'"'+i+'><label for="'+e+'">'+this+"</label></span>"}),a},l.text=function(t,e,i,n){return void 0===i&&(i=""),'<input type="text" id="'+t+'" class="form-control" name="'+e+'" value="'+(i=i||"")+'"'+(n?' size="'+n+'"':"")+">"},l.input=function(t,e,i,n){return void 0===n&&(n=""),'<div class="input-group"><label for="'+t+'">'+e+'</label><div class="'+n+'">'+i+"</div></div>"},l.nameToId=function(t){return t.replace(/\[/g,"_").replace(/\]/g,"")},l._guid=0,l}(),Weight=function(){function t(t){this.box=t}return t.prototype.toggle=function(t){return this.box.toggleClass("weight-edit-mode",t),this},t.prototype.toggleLoading=function(t){return this.box.toggleClass("weight-loading",t),this},t.prototype.html=function(t){var e=$(t);return this.box=this.box.replaceWith(e),this.box=e,this},t.prototype.id=function(){return parseInt(this.box.attr("data-id"))},t.prototype.weightId=function(){return parseInt(this.box.attr("data-weight"))},t}(),Page=function(){function t(t,e){void 0===e&&(e=BASE_URI),this.id=t,this.baseUri=e,this.box=$("#page-box"),this.element=$("#mainMobile"),this.bodyBox=$("#mainGrid"),this.panelGroup=this.box.find(".panel-group"),this.editDialog=$("#edit-dialog").dialog();function i(){n.body=n.bodyBox.contents().find("body"),n._init()}var n=this,o=this.bodyBox[0];o.attachEvent?o.attachEvent("onload",i):o.onload=i}return t.prototype._init=function(){this._bindEvent(),this.resize()},t.prototype._bindEvent=function(){var e=this;$(window).on("resize",function(){e.resize()}),this.body.on("click",".weight-action .del",function(){e.removeWeight($(this).closest(".weight-edit-grid"))}).on("click",".weight-action .edit",function(t){t.stopPropagation(),e.setWeight($(this).parents(".weight-edit-grid")),e.showEditDialog()}).on("click",".weight-action .refresh",function(t){t.stopPropagation(),e.refreshWeight($(this).closest(".weight-edit-grid"))}).on("click",".weight-action .property",function(t){t.stopPropagation(),e.setWeight($(this).closest(".weight-edit-grid")),e.showPropertyPanel()}).on("click","a",function(t){t.preventDefault()}),this.panelGroup.on("click",".panel-item .panel-header .fa-close",function(t){t.stopPropagation(),$(this).closest(".panel-item").addClass("min"),e.resize()}).on("click",".panel-item .panel-header",function(){var t=$(this).closest(".panel-item");t.hasClass("min")&&(t.removeClass("min").siblings().addClass("min"),e.resize())}).on("click",".expand-box .expand-header",function(){$(this).closest(".expand-box").toggleClass("open")}).on("change",".position-input select",function(){var t=$(this);t.next().html(PropertyInput.positionSide(t.val()))}).on("click",'.background-input input[type="radio"]',function(){var t=$(this);t.closest(".background-input").find(".value-input").html(PropertyInput.backgroundValue(t.attr("name").replace("[type]",""),t.val()))}).on("change","input,textarea",function(){e.autoSave()}).on("click",".style-item",function(){$(this).addClass("active").siblings().removeClass("active"),e.autoSave()}).find(".weight-edit-grid").attr("draggable","true").on("dragstart",function(t){t.originalEvent.dataTransfer.setData("Text",t.target.id),i=$(this)});var i=null;this.body.on("dragover",".weight-row",function(t){t.stopPropagation(),t.preventDefault()}).on("drop",".weight-row",function(t){t.stopPropagation(),t.preventDefault(),e.addWeight(i.clone(),$(this))}),this.editDialog.box.on("click",".multiple-box .multiple-add-btn",function(){var t=$(this);t.before(t.prev(".item").clone())}).on("click",".multiple-box .multiple-del-btn",function(){var t=$(this);1<t.closest(".multiple-box").find(".item").length&&t.closest(".item").remove()}),this.editDialog.on("done",function(){e.post(EDIT_URI,e.editDialog.find(".dialog-body").serialize(),function(t){200===t.code&&(e.showPropertyPanel(),e.weight.html(t.data.html))}),this.close()}),this.bindRule()},t.prototype.autoSave=function(){var e=this,t=formData(this.panelGroup.find(".form-table"))+"&theme_style_id="+this.panelGroup.find(".style-item.active").attr("data-id")+"&id="+this.weight.id();this.post(EDIT_URI,t,function(t){200===t.code&&e.weight.html(t.data.html)})},t.prototype.showEditDialog=function(){var e=this;this.post(EDIT_DAILOG_URI,{id:this.weight.id()},function(t){200===t.code&&(e.editDialog.find(".dialog-body").html('<input type="hidden" name="id" value="'+e.weight.id()+'">'+t.data.html),e.editDialog.show())})},t.prototype.showPropertyPanel=function(){var b=this;this.post(SETTING_URI,{id:this.weight.id()},function(t){var e,i,n,o,l,a,s,r,d,u,c,p,h,g;if(200===t.code){var v=t.data,f=null===(e=v.settings)||void 0===e?void 0:e.style,m=b.panelGroup.find(".form-table .tab-item");m[0].innerHTML=PropertyInput.title(v.title)+PropertyInput.lazy(null===(i=v.settings)||void 0===i?void 0:i.lazy);var y=$(m[1]).find(".expand-body");y[0].innerHTML=PropertyInput.margin(null==f?void 0:f.margin)+PropertyInput.position(null==f?void 0:f.position)+PropertyInput.border(null,null==f?void 0:f.border)+PropertyInput.radius(null,v.settings?v.settings["border-radius"]:null)+PropertyInput.color(null,null===(n=v.settings)||void 0===n?void 0:n.color)+PropertyInput.background(null,null===(o=v.settings)||void 0===o?void 0:o.background),y[1].innerHTML=PropertyInput.visibility("title",null===(l=null==f?void 0:f.title)||void 0===l?void 0:l.visibility)+PropertyInput.padding("title",null===(a=null==f?void 0:f.title)||void 0===a?void 0:a.padding)+PropertyInput.border("title",null===(s=null==f?void 0:f.title)||void 0===s?void 0:s.border)+PropertyInput.radius("title",null==f?void 0:f.title["border-radius"])+PropertyInput.color("title",null===(r=null==f?void 0:f.title)||void 0===r?void 0:r.color)+PropertyInput.fontSize("title",null==f?void 0:f.title["font-size"])+PropertyInput.fontWeight("title",null==f?void 0:f.title["font-weight"])+PropertyInput.textAlign("title",null==f?void 0:f.title["text-align"])+PropertyInput.background("title",null===(d=null==f?void 0:f.title)||void 0===d?void 0:d.background),y[2].innerHTML=PropertyInput.visibility("content",null===(u=null==f?void 0:f.content)||void 0===u?void 0:u.visibility)+PropertyInput.padding("content",null===(c=null==f?void 0:f.content)||void 0===c?void 0:c.padding)+PropertyInput.border("content",null===(p=null==f?void 0:f.content)||void 0===p?void 0:p.border)+PropertyInput.radius("content",null==f?void 0:f.content["border-radius"])+PropertyInput.color("content",null===(h=null==f?void 0:f.content)||void 0===h?void 0:h.color)+PropertyInput.fontSize("content",null==f?void 0:f.content["font-size"])+PropertyInput.fontWeight("content",null==f?void 0:f.content["font-weight"])+PropertyInput.textAlign("content",null==f?void 0:f.content["text-align"])+PropertyInput.background("content",null===(g=null==f?void 0:f.content)||void 0===g?void 0:g.background),b.panelGroup.find(".style-item").each(function(){var t=$(this);t.toggleClass("active",t.attr("data-id")==v.theme_style_id)}),b.showPanel("property")}})},t.prototype.showPanel=function(t){var e=this.panelGroup.find("[data-panel="+t+"]");return e.removeClass("min").siblings().addClass("min"),e},t.prototype.bindRule=function(){var i,e=0,n=this.element.find(".rule-box").on("mousedown",".rule-lines div",function(t){t.stopPropagation(),e=0,i=$(this)}).on("mousedown",".top-rule",function(){e=1}).on("mousemove",".top-rule",function(){1===e&&(i=$('<div class="h-line"></div>'),n.find(".rule-lines").append(i),e=0)}).on("mousedown",".left-rule",function(){e=2}).on("mousemove",".left-rule",function(){2===e&&(i=$('<div class="v-line"></div>'),n.find(".rule-lines").append(i),e=0)});$(document).on("mousemove",function(t){if(i)if(i.hasClass("v-line"))i.css("left",t.clientX+"px");else{var e=t.clientY-n.offset().top;i.css("top",e+"px")}}).on("mouseup",function(){i&&(i.hasClass("v-line")?i.offset().left<20&&i.remove():i.offset().top-n.offset().top<20&&i.remove(),i=void 0)})},t.prototype.refreshWeight=function(t){if(t||this.weight)if(t){var e=t.attr("data-id"),i=this.setWeight(t,!1).toggleLoading(!0);this.post(REFRESH_URI,{id:e},function(t){i.toggleLoading(!1),200==t.code&&i.html(t.data.html)})}else{var n=this.weight.toggleLoading(!0);this.post(REFRESH_URI,{id:n.id()},function(t){n.toggleLoading(!1),200==t.code&&n.html(t.data.html)})}},t.prototype.setWeight=function(t,e){return void 0===e&&(e=!0),this.weight&&this.weight.toggle(!1),this.weight=new Weight(t),this.weight.toggle(!0),this.weight},t.prototype.removeWeight=function(e){this.post(DEL_URI,{id:e.attr("data-id")},function(t){200==t.code&&e.remove()})},t.prototype.addWeight=function(t,e){e.append(t),t.width("auto");var i=this.setWeight(t).toggleLoading(!0);return this.post(NEW_URI,{weight_id:t.attr("data-weight"),parent_id:e.attr("data-id")},function(t){i.toggleLoading(!1),200==t.code&&i.html(t.data.html)}),i},t.prototype.resize=function(){var t=16;this.panelGroup.find(".panel-item").each(function(){$(this).hasClass("min")||(t=240)}),this.panelGroup.width(t),this.panelGroup.find(".panel-body .tab-body").height(this.panelGroup.height()-60),this.box.css("padding-left",t+"px");var e=$(window).height()-this.box.offset().top;this.box.height(e);var i=!!this.element.attr("class");i||this.element.height(e-25);var n=i?this.bodyBox.offset().top-this.element.offset().top-20:0,o=i?this.bodyBox.offset().left-this.element.offset().left-20:0;this.drawRule(this.element.find(".top-rule").css("top",n+"px"),20+o),this.drawRule(this.element.find(".left-rule").css("left",o+"px"),20+n),this.bodyBox.width(this.element.width()-20),this.bodyBox.height(this.element.height()-20)},t.prototype.html=function(){return $.htmlClean(this.body.html(),{format:!0,allowedAttributes:[["id"],["class"],["data-toggle"],["data-target"],["data-parent"],["role"],["data-dismiss"],["aria-labelledby"],["aria-hidden"],["data-slide-to"],["data-slide"]]})},t.prototype.getSetting=function(e,i){var n=this;return this._cacheSettings.hasOwnProperty(e)?i&&i(this._cacheSettings[e]):this.post(SETTING_URI,{id:e},function(t){200==t.code&&(n._cacheSettings[e]=t.data,i&&i(t.data))}),this},t.prototype.saveSetting=function(e,t,i){var n=this;return this.post(SAVE_SETTING_URI,{id:e,setting:t},function(t){200==t.code&&(n._cacheSettings[e]=t,i&&i(t.data))}),this},t.prototype.post=function(t,e,i){return"string"==typeof e?e+="&page_id="+this.id:e.page_id=this.id,postJson(this.baseUri+t,e,i),this},t.prototype.drawRule=function(t,e,i){void 0===i&&(i=1);var n=t.width(),o=t.height(),l=t[0];l.width=n,l.height=o;var a=l.getContext("2d");a.clearRect(0,0,l.width,l.height);for(var s=l.width>l.height,r=s?l.width:l.height,d=e;d<r;d+=10){var u=d-e,c=u%50==0?10:5;this.drawLine(a,s,d,c,5<c?u.toString():void 0)}},t.prototype.drawLine=function(t,e,i,n,o){e?(t.moveTo(i,20-n),t.lineTo(i,20)):(t.moveTo(20-n,i),t.lineTo(20,i)),t.lineWidth=1,t.strokeStyle="red",t.stroke(),o&&(t.font="6px Microsoft YaHei",e?t.fillText(o,i-5,10):t.fillText(o,0,i+3))},t}();function bindPage(t){var e=new Page(t);$(".mobile-size li").click(function(){$(".mobile-size").parent().removeClass("open");var t=$(this).attr("data-size").split("*");e.element.removeClass().removeAttr("style").addClass("mobile-"+t[0]),e.resize()}),$(".navbar>li>div").click(function(){$(this).parent().toggleClass("open")}),$(".mobile-size li").click(function(){$(this).addClass("active").siblings().removeClass("active")}),$(".mobile-rotate").click(function(){e.element.toggleClass("rotate")}),$(".expand>.head").click(function(){$(this).parent().toggleClass("open")}),769<$(window).width()&&$(".sidebar-container-toggle").trigger("click")}function bindEdit(){$(".theme-select").on("click",".theme-item",function(){$(this).addClass("active").siblings().removeClass("active"),$("input[name=theme_id]").val($(this).data("id"))})}var SearchDailog=function(){function t(t){var e=this;this.selected=[],this._selected=[],this.dialog=$(t).dialog({}),$.get(this.dialog.box.data("url"),{selected:this.selected.join(",")},function(t){e.html(t)}),this.bindEvent()}return t.prototype.bindEvent=function(){var t=this,i=this;this.on("submit",".dialog-search form",function(){var t=$(this);return $.get(t.attr("action"),t.serialize()+"&selected="+i.selected.join(","),function(t){i.html(t)}),!1}).on("click",".dialog-body-box .item",function(){var t=$(this).toggleClass("selected"),e=parseInt(t.data("id"),10);i.toggleItem(e,t.hasClass("selected"))}).on("click",".dialog-pager a",function(t){t.preventDefault(),$.get($(this).attr("href"),function(t){i.html(t)})}),this.dialog.on("done",function(){t.selected=__spreadArrays(t._selected),t.dialog.close(),t._doneCallback&&t._doneCallback.call(t,t.selected)})},t.prototype.toggleItem=function(t,e){if(!(t<1)){var i=this._selected.indexOf(t);void 0===e&&(e=i<0),e?i<0&&this._selected.push(t):0<=i&&(this._selected=this._selected.splice(i,1))}},t.prototype.html=function(t){return 0<t.indexOf("dialog-body-box")?this.find(".dialog-body").html(t):this.find(".dialog-body .dialog-body-box").html(t),this.dialog.resize(),this},t.prototype.find=function(t){return this.dialog.find(t)},t.prototype.on=function(t,e,i){return"done"===t?this._doneCallback=e:this.dialog.box.on(t,e,i),this},t.prototype.show=function(){var n=this;this._selected=__spreadArrays(this.selected),this.find(".dialog-body-box .item").each(function(t,e){var i=$(e);i.toggleClass("selected",0<=n._selected.indexOf(i.data("id")))}),this.dialog.show()},t}();function bindNewTheme(){var t=new SearchDailog(".theme-dialog");$('*[data-type="add"]').click(function(){t.show()}),t.on("done",function(t){})}