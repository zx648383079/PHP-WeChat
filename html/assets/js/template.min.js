var __spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var s=arguments[e],a=0,r=s.length;a<r;a++,o++)n[o]=s[a];return n},DEL_URI="weight/destroy",NEW_URI="weight/create",REFRESH_URI="weight/refresh",EDIT_URI="weight/save",EDIT_DAILOG_URI="weight/edit_dialog",SETTING_URI="weight/setting",SAVE_SETTING_URI="weight/save_setting",INFO_URI="weight/info",PropertyInput=function(){function o(){}return o.guid=function(){return o._guid++},o.title=function(t){void 0===t&&(t="");var e="title_"+o.guid();return o.input(e,"标题",o.text(e,"title",t))},o.lazy=function(t){var e="settings_lazy_"+o.guid();return o.input(e,"懒加载",o.radio(e,"settings[lazy]",["关闭","开启"],t))},o.margin=function(t){return void 0===t&&(t=[]),o.sideInput("settings[style][margin]","外边距",t)},o.padding=function(t,e){return void 0===e&&(e=[]),o.sideInput("settings[style]["+t+"][padding]","内边距",e)},o.position=function(t){var e=t&&"static"!=t.type?o.side("settings[style][position][value]","settings[style][position][value]",null==t?void 0:t.value):"",i=o.option({static:"无",relative:"相对定位",absolute:"绝对定位",fixed:"固定定位"},null==t?void 0:t.type);return o.input("","悬浮",'<select name="settings[style][position][type]">'+i+'</select><div class="side-input">'+e+"</div>")},o.border=function(t,e){var i=o.nameToId(t="settings[style]"+(t?"["+t+"]":"")+"[border]")+"_"+o.guid(),n=o.checkbox(i,t+"[side]",["上","右","下","左"],null==e?void 0:e.side);return o.input(i,"边框",'<input type="text" class="form-control" name="'+t+'[value][]" placeholder="粗细" size="4">\n        <select name="'+t+'[value][]">\n            <option value="">实线</option>\n            <option value="">虚线</option>\n        </select>\n        <input type="color" name="'+t+'[value][]"><div class="side-input">'+n+"</div>\n        ")},o.radius=function(t,e){var i=o.nameToId(t="settings[style]"+(t?"["+t+"]":"")+"[border-radius]")+"_"+o.guid();return o.input(i,"圆角",'<input type="text" id="'+i+'_0" class="form-control " name="'+t+'[]" value="" size="4" placeholder="左上">\n        <input type="text" id="'+i+'_1" class="form-control " name="'+t+'[]" value="" size="4" placeholder="右上">\n        <br/>\n        <input type="text" id="'+i+'_2" class="form-control " name="'+t+'[]" value="" size="4" placeholder="左下">\n        <input type="text" id="'+i+'_3" class="form-control " name="'+t+'[]" value="" size="4" placeholder="右下">')},o.color=function(t){var e=o.nameToId(t="settings[style]"+(t?"["+t+"]":"")+"[color]")+"_"+o.guid();return o.input(e,"字体颜色",'<input type="color" name="'+t+'">')},o.background=function(t,e){var i=o.nameToId(t="settings[style]"+(t?"["+t+"]":"")+"[background]")+"_"+o.guid(),n=o.radio(i,t,["颜色","图片"],"0");return e&&1==e.type?n+='<div class="file-input">\n            <input type="text" id="'+i+'_value" class="form-control " name="'+t+'[value]" value="" size="20">\n            <button type="button" data-type="upload">上传</button>\n        </div>':n+='<input type="color" name="'+t+'[value]">',o.input(i,"背景",n)},o.visibility=function(t,e){var i=o.nameToId(t="settings[style]"+t+"[visibility]")+"_"+o.guid();return o.input(i,"可见",o.radio(i,t,["显示","隐藏"],e))},o.fontSize=function(t,e){var i=o.nameToId(t="settings[style]"+t+"[font-size]")+"_"+o.guid();return o.input(i,"字体大小",o.text(i,t,e,4))},o.textAlign=function(t,e){var i=o.nameToId(t="settings[style]"+t+"[text-align]")+"_"+o.guid();return o.input(i,"字体位置",o.radio(i,t,["居左","居中","居右"],e))},o.fontWeight=function(t,e){var i=o.nameToId(t="settings[style]"+t+"[font-weight]")+"_"+o.guid();return o.input(i,"字体粗细",o.text(i,t,e,4))},o.option=function(t,e){var i="";return $.each(t,function(t){i+='<option value="'+t+'"'+(e==t?" selected":"")+">"+this+"</option>"}),i},o.sideInput=function(t,e,i){void 0===i&&(i=[]);var n=o.nameToId(t)+"_"+o.guid();return o.input(n,e,o.side(n,t,i),"side-input")},o.side=function(i,n,o){void 0===o&&(o=[]);var s="";return $.each(["上","右","下","左"],function(t){var e=o&&o.length>t?o[t]:"";s+='<input type="text" id="'+i+"_"+t+'" class="form-control " name="'+n+'[]" size="4" value="'+e+'" placeholder="'+this+'">'}),s},o.radio=function(i,n,t,o){var s="",a=0;return $.each(t,function(t){var e=[i,a++].join("_");s+='<span class="radio-label"><input type="radio" id="'+e+'" name="'+n+'" value="'+t+'"'+(t==o?" checked":"")+'><label for="'+e+'">'+this+"</label></span>"}),s},o.checkbox=function(n,o,t,s){void 0===s&&(s=[]);var a="",r=0;return $.each(t,function(t){var e=[n,r++].join("_"),i=s&&0<=s.indexOf(t)?" checked":"";a+='<span class="check-label"><input type="checkbox" id="'+e+'" name="'+o+'" value="'+t+'"'+i+'><label for="'+e+'">'+this+"</label></span>"}),a},o.text=function(t,e,i,n){return void 0===i&&(i=""),'<input type="text" id="'+t+'" class="form-control" name="'+e+'" value="'+i+'"'+(n?' size="'+n+'"':"")+">"},o.input=function(t,e,i,n){return void 0===n&&(n=""),'<div class="input-group"><label for="'+t+'">'+e+'</label><div class="'+n+'">'+i+"</div></div>"},o.nameToId=function(t){return t.replace(/\[/g,"_").replace(/\]/g,"")},o._guid=0,o}(),Weight=function(){function t(t){this.box=t}return t.prototype.toggle=function(t){return this.box.toggleClass("weight-edit-mode",t),this},t.prototype.toggleLoading=function(t){return this.box.toggleClass("weight-loading",t),this},t.prototype.html=function(t){return this.box.replaceWith(t)},t.prototype.id=function(){return parseInt(this.box.attr("data-id"))},t.prototype.weightId=function(){return parseInt(this.box.attr("data-weight"))},t}(),Page=function(){function t(t,e){void 0===e&&(e=BASE_URI),this.id=t,this.baseUri=e,this.box=$("#page-box"),this.element=$("#mainMobile"),this.bodyBox=$("#mainGrid"),this.panelGroup=this.box.find(".panel-group"),this.editDialog=$("#edit-dialog").dialog();function i(){n.body=n.bodyBox.contents().find("body"),n._init()}var n=this,o=this.bodyBox[0];o.attachEvent?o.attachEvent("onload",i):o.onload=i}return t.prototype._init=function(){this._bindEvent(),this.resize()},t.prototype._bindEvent=function(){var e=this;$(window).on("resize",function(){e.resize()}),this.body.on("click",".weight-action .del",function(){e.removeWeight($(this).closest(".weight-edit-grid"))}).on("click",".weight-action .edit",function(t){t.stopPropagation(),e.setWeight($(this).parents(".weight-edit-grid")),e.showEditDialog()}).on("click",".weight-action .refresh",function(t){t.stopPropagation(),e.refreshWeight($(this).closest(".weight-edit-grid"))}).on("click",".weight-action .property",function(t){t.stopPropagation(),e.setWeight($(this).closest(".weight-edit-grid")),e.showPropertyPanel()}),this.panelGroup.on("click",".panel-item .panel-header .fa-close",function(t){t.stopPropagation(),$(this).closest(".panel-item").addClass("min"),e.resize()}).on("click",".panel-item .panel-header",function(){var t=$(this).closest(".panel-item");t.hasClass("min")&&(t.removeClass("min").siblings().addClass("min"),e.resize())}).on("click",".expand-box .expand-header",function(){$(this).closest(".expand-box").toggleClass("open")}).find(".weight-edit-grid").attr("draggable","true").on("dragstart",function(t){t.originalEvent.dataTransfer.setData("Text",t.target.id),i=$(this)});var i=null;this.body.find(".weight-row").on("dragover",function(t){t.stopPropagation(),t.preventDefault()}).on("drop",function(t){t.stopPropagation(),t.preventDefault(),e.addWeight(i.clone(),$(this))}),this.bindRule()},t.prototype.showEditDialog=function(){var e=this;this.post(EDIT_DAILOG_URI,{id:this.weight.id()},function(t){e.editDialog.show()})},t.prototype.showPropertyPanel=function(){var f=this;this.post(SETTING_URI,{id:this.weight.id()},function(t){var e,i,n,o,s,a,r,l,d,u,p;if(200===t.code){var c=t.data,h=f.panelGroup.find(".form-table .tab-item");h[0].innerHTML=PropertyInput.title(c.title)+PropertyInput.lazy(null===(e=c.settings)||void 0===e?void 0:e.lazy);var g=$(h[1]).find(".expand-body");g[0].innerHTML=PropertyInput.margin(null===(n=null===(i=c.settings)||void 0===i?void 0:i.style)||void 0===n?void 0:n.margin)+PropertyInput.position(null===(s=null===(o=c.settings)||void 0===o?void 0:o.style)||void 0===s?void 0:s.position)+PropertyInput.border(null,null===(r=null===(a=c.settings)||void 0===a?void 0:a.style)||void 0===r?void 0:r.border)+PropertyInput.radius()+PropertyInput.color()+PropertyInput.background(),g[1].innerHTML=PropertyInput.visibility("title",0)+PropertyInput.padding("title")+PropertyInput.border("title",null===(d=null===(l=c.settings)||void 0===l?void 0:l.style)||void 0===d?void 0:d.border)+PropertyInput.radius("title")+PropertyInput.color("title")+PropertyInput.fontSize("title")+PropertyInput.fontWeight("title")+PropertyInput.textAlign("title")+PropertyInput.background("title"),g[2].innerHTML=PropertyInput.visibility("content",0)+PropertyInput.padding("content")+PropertyInput.border("content",null===(p=null===(u=c.settings)||void 0===u?void 0:u.style)||void 0===p?void 0:p.border)+PropertyInput.radius("content")+PropertyInput.color("content")+PropertyInput.fontSize("content")+PropertyInput.fontWeight("content")+PropertyInput.textAlign("content")+PropertyInput.background("content"),f.showPanel("property")}})},t.prototype.showPanel=function(t){var e=this.panelGroup.find("[data-panel="+t+"]");return e.removeClass("min").siblings().addClass("min"),e},t.prototype.bindRule=function(){var i,e=0,n=this.element.find(".rule-box").on("mousedown",".rule-lines div",function(t){t.stopPropagation(),e=0,i=$(this)}).on("mousedown",".top-rule",function(){e=1}).on("mousemove",".top-rule",function(){1===e&&(i=$('<div class="h-line"></div>'),n.find(".rule-lines").append(i),e=0)}).on("mousedown",".left-rule",function(){e=2}).on("mousemove",".left-rule",function(){2===e&&(i=$('<div class="v-line"></div>'),n.find(".rule-lines").append(i),e=0)});$(document).on("mousemove",function(t){if(i)if(i.hasClass("v-line"))i.css("left",t.clientX+"px");else{var e=t.clientY-n.offset().top;i.css("top",e+"px")}}).on("mouseup",function(){i&&(i.hasClass("v-line")?i.offset().left<20&&i.remove():i.offset().top-n.offset().top<20&&i.remove(),i=void 0)})},t.prototype.refreshWeight=function(t){var e=t.attr("data-id"),i=this.setWeight(t,!1).toggleLoading(!0);this.post(REFRESH_URI,{id:e},function(t){i.toggleLoading(!1),200==t.code&&i.html(t.data.html)})},t.prototype.setWeight=function(t,e){return void 0===e&&(e=!0),this.weight&&this.weight.toggle(!1),this.weight=new Weight(t),this.weight.toggle(!0),this.weight},t.prototype.removeWeight=function(e){this.post(DEL_URI,{id:e.attr("data-id")},function(t){200==t.code&&e.remove()})},t.prototype.addWeight=function(t,e){e.append(t),t.width("auto");var i=this.setWeight(t).toggleLoading(!0);return this.post(NEW_URI,{weight_id:t.attr("data-weight"),parent_id:e.attr("data-id")},function(t){i.toggleLoading(!1),200==t.code&&i.html(t.data.html)}),i},t.prototype.resize=function(){var t=16;this.panelGroup.find(".panel-item").each(function(){$(this).hasClass("min")||(t=240)}),this.panelGroup.width(t),this.panelGroup.find(".panel-body .tab-body").height(this.panelGroup.height()-60),this.box.css("padding-left",t+"px");var e=$(window).height()-this.box.offset().top;this.box.height(e);var i=!!this.element.attr("class");i||this.element.height(e-25);var n=i?this.bodyBox.offset().top-this.element.offset().top-20:0,o=i?this.bodyBox.offset().left-this.element.offset().left-20:0;this.drawRule(this.element.find(".top-rule").css("top",n+"px"),20+o),this.drawRule(this.element.find(".left-rule").css("left",o+"px"),20+n),this.bodyBox.width(this.element.width()-20),this.bodyBox.height(this.element.height()-20)},t.prototype.html=function(){return $.htmlClean(this.body.html(),{format:!0,allowedAttributes:[["id"],["class"],["data-toggle"],["data-target"],["data-parent"],["role"],["data-dismiss"],["aria-labelledby"],["aria-hidden"],["data-slide-to"],["data-slide"]]})},t.prototype.getSetting=function(e,i){var n=this;return this._cacheSettings.hasOwnProperty(e)?i&&i(this._cacheSettings[e]):this.post(SETTING_URI,{id:e},function(t){200==t.code&&(n._cacheSettings[e]=t.data,i&&i(t.data))}),this},t.prototype.saveSetting=function(e,t,i){var n=this;return this.post(SAVE_SETTING_URI,{id:e,setting:t},function(t){200==t.code&&(n._cacheSettings[e]=t,i&&i(t.data))}),this},t.prototype.post=function(t,e,i){return e.page_id=this.id,postJson(this.baseUri+t,e,i),this},t.prototype.drawRule=function(t,e,i){void 0===i&&(i=1);var n=t.width(),o=t.height(),s=t[0];s.width=n,s.height=o;var a=s.getContext("2d");a.clearRect(0,0,s.width,s.height);for(var r=s.width>s.height,l=r?s.width:s.height,d=e;d<l;d+=10){var u=d-e,p=u%50==0?10:5;this.drawLine(a,r,d,p,5<p?u.toString():void 0)}},t.prototype.drawLine=function(t,e,i,n,o){e?(t.moveTo(i,20-n),t.lineTo(i,20)):(t.moveTo(20-n,i),t.lineTo(20,i)),t.lineWidth=1,t.strokeStyle="red",t.stroke(),o&&(t.font="6px Microsoft YaHei",e?t.fillText(o,i-5,10):t.fillText(o,0,i+3))},t}();function bindPage(t){var e=new Page(t);$(".mobile-size li").click(function(){$(".mobile-size").parent().removeClass("open");var t=$(this).attr("data-size").split("*");e.element.removeClass().removeAttr("style").addClass("mobile-"+t[0]),e.resize()}),$(".navbar>li>div").click(function(){$(this).parent().toggleClass("open")}),$(".mobile-size li").click(function(){$(this).addClass("active").siblings().removeClass("active")}),$(".mobile-rotate").click(function(){e.element.toggleClass("rotate")}),$(".expand>.head").click(function(){$(this).parent().toggleClass("open")}),769<$(window).width()&&$(".sidebar-container-toggle").trigger("click")}function bindEdit(){$(".theme-select").on("click",".theme-item",function(){$(this).addClass("active").siblings().removeClass("active"),$("input[name=theme_id]").val($(this).data("id"))})}var SearchDailog=function(){function t(t){var e=this;this.selected=[],this._selected=[],this.dialog=$(t).dialog({}),$.get(this.dialog.box.data("url"),{selected:this.selected.join(",")},function(t){e.html(t)}),this.bindEvent()}return t.prototype.bindEvent=function(){var t=this,i=this;this.on("submit",".dialog-search form",function(){var t=$(this);return $.get(t.attr("action"),t.serialize()+"&selected="+i.selected.join(","),function(t){i.html(t)}),!1}).on("click",".dialog-body-box .item",function(){var t=$(this).toggleClass("selected"),e=parseInt(t.data("id"),10);i.toggleItem(e,t.hasClass("selected"))}).on("click",".dialog-pager a",function(t){t.preventDefault(),$.get($(this).attr("href"),function(t){i.html(t)})}),this.dialog.on("done",function(){t.selected=__spreadArrays(t._selected),t.dialog.close(),t._doneCallback&&t._doneCallback.call(t,t.selected)})},t.prototype.toggleItem=function(t,e){if(!(t<1)){var i=this._selected.indexOf(t);void 0===e&&(e=i<0),e?i<0&&this._selected.push(t):0<=i&&(this._selected=this._selected.splice(i,1))}},t.prototype.html=function(t){return 0<t.indexOf("dialog-body-box")?this.find(".dialog-body").html(t):this.find(".dialog-body .dialog-body-box").html(t),this.dialog.resize(),this},t.prototype.find=function(t){return this.dialog.find(t)},t.prototype.on=function(t,e,i){return"done"===t?this._doneCallback=e:this.dialog.box.on(t,e,i),this},t.prototype.show=function(){var n=this;this._selected=__spreadArrays(this.selected),this.find(".dialog-body-box .item").each(function(t,e){var i=$(e);i.toggleClass("selected",0<=n._selected.indexOf(i.data("id")))}),this.dialog.show()},t}();function bindNewTheme(){var t=new SearchDailog(".theme-dialog");$('*[data-type="add"]').click(function(){t.show()}),t.on("done",function(t){})}