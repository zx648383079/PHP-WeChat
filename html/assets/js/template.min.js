var DEL_URI="weight/destroy",NEW_URI="weight/create",EDIT_URI="weight/save",SETTING_URI="weight/setting",SAVE_SETTING_URI="weight/save_setting",INFO_URI="weight/info",Panel=function(){function t(t,i){this.page=i,this.element=$(t),this._init()}return t.prototype._init=function(){this._bindEvent()},t.prototype._bindEvent=function(){var t=this;this.element.find(".panel .head .fa-close").click(function(){t.element.addClass("min")}),this.element.find(".menu>li>.head").click(function(){$(this).parent().toggleClass("active")})},t.prototype.toggle=function(t){return"boolean"==typeof t&&(t=!t),this.element.toggleClass("min",t),this},t.prototype.bindDrag=function(){var o=this;this.element.find(".weight-edit-grid").draggable({connectToSortable:".weight-row",helper:"clone",opacity:.3,revert:"invalid",start:function(){o.page.body.addClass("hover")},stop:function(t,i){o.page.body.removeClass("hover");var e=i.helper,n=e.closest(".weight-row");!n||n.length<1||o.page.addWeight(e,n)}})},t}(),Weight=function(){function t(t){this.box=t}return t.prototype.toggle=function(t){return this.box.toggleClass("weight-edit-mode",t),this},t.prototype.toggleLoading=function(t){return this.box.toggleClass("weight-loading",t),this},t.prototype.html=function(t){return this.box.find(".weight-view").html(t)},t.prototype.id=function(){return parseInt(this.box.attr("data-id"))},t.prototype.weightId=function(){return parseInt(this.box.attr("data-weight"))},t}(),Page=function(){function t(t,i){this.id=t,this.baseUri=i,this.box=$("#page-box"),this.element=$("#mainMobile"),this.body=$("#mainGrid"),this.weightBox=new Panel("#weight",this),this.propertyBox=new Panel("#property",this),this._init()}return t.prototype._init=function(){this._bindEvent(),this.resize()},t.prototype._bindEvent=function(){var i=this;$(window).resize(function(){i.resize()}),this.body.find(".weight-row").sortable({connectWith:".weight-row"}),this.body.on("click",".weight-action .del",function(){i.removeWeight($(this).closest(".weight-edit-grid"))}).on("click",".weight-action .edit",function(t){t.stopPropagation(),i.setWeight($(this).parents(".weight-edit-grid"))}),this.weightBox.bindDrag()},t.prototype.setWeight=function(t){return this.weight&&this.weight.toggle(!1),this.weight=new Weight(t),this.weight.toggle(!0),this.weightBox.toggle(!0),this.propertyBox.toggle(!0),this.weight},t.prototype.removeWeight=function(i){this.post(DEL_URI,{id:i.attr("data-id")},function(t){200==t.code&&i.remove()})},t.prototype.addWeight=function(i,t){i.width("auto");var e=this.setWeight(i).toggleLoading(!0);return this.post(NEW_URI,{weight_id:i.attr("data-weight"),parent_id:t.attr("data-id")},function(t){e.toggleLoading(!1),200==t.code&&(i.attr("data-id",t.data.id),e.html(t.data.html))}),e},t.prototype.resize=function(){this.box.height($(window).height()-57)},t.prototype.html=function(){return $.htmlClean($("#mainGrid").html(),{format:!0,allowedAttributes:[["id"],["class"],["data-toggle"],["data-target"],["data-parent"],["role"],["data-dismiss"],["aria-labelledby"],["aria-hidden"],["data-slide-to"],["data-slide"]]})},t.prototype.getSetting=function(i,e){var n=this;return this._cacheSettings.hasOwnProperty(i)?e&&e(this._cacheSettings[i]):this.post(SETTING_URI,{id:i},function(t){200==t.code&&(n._cacheSettings[i]=t.data,e&&e(t.data))}),this},t.prototype.saveSetting=function(i,t,e){var n=this;return this.post(SAVE_SETTING_URI,{id:i,setting:t},function(t){200==t.code&&(n._cacheSettings[i]=t,e&&e(t.data))}),this},t.prototype.post=function(t,i,e){return i.page_id=this.id,postJson(this.baseUri+t,i,e),this},t}();function bindPage(t,i){var e=new Page(t,i);$(".mobile-size li").click(function(){$(".mobile-size").parent().removeClass("open");var t=$(this).attr("data-size").split("*");e.element.removeClass().addClass("mobile-"+t[0])}),$(".navbar>li>div").click(function(){$(this).parent().toggleClass("open")}),$(".mobile-size li").click(function(){$(this).addClass("active").siblings().removeClass("active")}),$(".mobile-rotate").click(function(){e.element.toggleClass("rotate")}),$(".expand>.head").click(function(){$(this).parent().toggleClass("open")})}