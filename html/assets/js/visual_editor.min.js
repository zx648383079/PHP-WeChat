var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var n,o=0,a=e.length;o<a;o++)!n&&o in e||((n=n||Array.prototype.slice.call(e,0,o))[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},EditorEventGetWeights="editor_get_wegihts",EditorEventGetWeightProperty="editor_get_wegiht_property",EditorEventSaveWeightProperty="editor_save_wegiht_property",EditorEventRefreshWeight="editor_refresh_weight",EditorEventAddWeight="editor_add_weight",EditorEventMoveWeight="editor_move_weight",EditorEventWeightForm="editor_weight_form",EditorEventRemoveWeight="editor_remove_weight",EditorEventSavePage="editor_save_page",EditorEventGetPage="editor_get_page",EditorEventWindowResize="editor_Window_resize",EditorEventResize="editor_resize",EditorEventOuterWidthChange="editor_outer_width_change",EditorEventViewInit="editor_view_init",EditorEventGetStyleSuccess="editor_get_style_success",EditorEventAfterViewInit="editor_after_view_init",EditorEventBrowserResize="editor_browser_resize",EditorEventScroll="editor_scroll",EditorEventPositionChange="editor_position_change",EditorEventDragStart="editor_drag_start",EditorEventBrowserReady="editor_browser_ready",EditorEventOpenEditDialog="editor_open_edit_dialog",EditorEventOpenProperty="editor_open_property",EditorEventDrag="editor_drag",EditorEventDrog="editor_drog",EditorEventOperateWeight="editor_operate_weight",EditorEventMouseMove="editor_mouse_move",EditorEventMouseUp="editor_mouse_up",EditorEventTimeLoop="editor_time_loop",EditorMobileStyle="mobile-style",VisualEditor=function(){function t(t){this.box=t,this.listeners={},this.mouseListener={move:void 0,finish:void 0},this.hScrollBar=new EditorScrollBar(this,!0),this.vScrollBar=new EditorScrollBar(this,!1),this.toolBar=new EditorToolBar(this),this.hRuleBar=new EditorRuler(this,!0),this.vRuleBar=new EditorRuler(this,!1),this.browser=new EditorBrowser(this),this.panelGroup=new EditorPanelGroup(this),this.weightSoul=new EditorWeightSoul(this),this.dialog=new EditorDialog(this),this.viewInited=!1,this.browserAdaptive=!1}return Object.defineProperty(t.prototype,"outerWidth",{get:function(){return this.box.width()},set:function(t){this.box.width(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"outerHeight",{get:function(){return this.box.height()},set:function(t){this.box.height(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"innerWidth",{get:function(){return this.viewInited?this.workspace.width()-this.vScrollBar.barSize-this.vRuleBar.barSize:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"innerHeight",{get:function(){return this.viewInited?this.workspace.height()-this.hRuleBar.barSize-this.hScrollBar.barSize:0},enumerable:!1,configurable:!0}),t.prototype.on=function(t,e){return Object.prototype.hasOwnProperty.call(this.listeners,t)||(this.listeners[t]=[]),this.listeners[t].push(e),this},t.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(Object.prototype.hasOwnProperty.call(this.listeners,t))for(var n=this.listeners[t],o=n.length-1;0<=o;o--)if(!1===n[o].apply(void 0,e))break;return this},Object.defineProperty(t.prototype,"hasMouseListener",{get:function(){return void 0!==this.mouseListener.move},enumerable:!1,configurable:!0}),t.prototype.onMouse=function(t,e){var i=this;this.mouseListener={move:t,finish:t||e?function(t){i.mouseListener={move:void 0,finish:void 0},e&&e(t)}:void 0}},t.prototype.mobile=function(t,e){this.browserAdaptive=!1,this.browser.toggleShell(!0),this.resize(t,e)},t.prototype.normal=function(t,e){this.browser.toggleShell(!1),t&&e?(this.browserAdaptive=!1,this.resize(t,e)):(this.browserAdaptive=!0,this.resize(this.innerWidth,this.innerHeight))},t.prototype.resize=function(t,e){this.browser.resize(t,e)},t.prototype.reset=function(){this.browser.reset()},t.prototype.reload=function(){this.browser.reload()},t.prototype.serialize=function(){return this.browser.serialize()},t.prototype.rotate=function(){this.browser.rotate()},t.prototype.scale=function(t){this.browser.scale(t)},t.prototype.find=function(t){return this.box.find(t)},t.prototype.run=function(){var e=this;this.viewInited=!1,this.bindEvent(),this.viewInit(),this.emit(EditorEventGetPage,function(t){e.browser.navigate(t.editable_url)},function(t){})},t.prototype.bindEvent=function(){function e(t,e){void 0===e&&(e=!1),t.on("keydown",function(t){t.ctrlKey&&"KeyS"==t.code&&(t.preventDefault(),n.emit(EditorEventSavePage,n.serialize(),function(){}))}).on("paste",function(t){!t.clipboardData&&!t.originalEvent||null!=(t=t.clipboardData||window.clipboardData)&&t.getData("text")}).on("mousemove",function(t){t={x:t.clientX,y:t.clientY};n.emit(EditorEventMouseMove,e?n.browser.globePosition(t):t)}).on("mouseup",function(t){t={x:t.clientX,y:t.clientY};n.emit(EditorEventMouseUp,e?n.browser.globePosition(t):t)}).on("touchmove",function(t){t={x:t.touches[0].clientX,y:t.touches[0].clientY};n.emit(EditorEventMouseMove,e?n.browser.globePosition(t):t)}).on("touchend",function(t){t={x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY};n.emit(EditorEventMouseUp,e?n.browser.globePosition(t):t)})}var n=this,t=$(window);t.on("resize",function(){n.emit(EditorEventWindowResize,t.width(),t.height())});this.on(EditorEventResize,function(t,e){n.browserAdaptive&&n.resize(t,e)}).on(EditorEventOuterWidthChange,function(){n.viewInited&&n.emit(EditorEventResize,n.innerWidth,n.innerHeight)}).on(EditorEventAfterViewInit,function(){n.emit(EditorEventResize,n.innerWidth,n.innerHeight),n.normal()}).on(EditorEventWindowResize,function(t,e){var i=e-n.box.offset().top-(0<n.box.closest(".only-editor").length?2:20);n.box.toggleClass("visual-mobile-editor",t<780&&t<e),n.outerHeight=i,n.viewInited&&n.emit(EditorEventResize,n.innerWidth,n.innerHeight)}).on(EditorEventMouseMove,function(t){n.mouseListener.move&&n.mouseListener.move(t)}).on(EditorEventMouseUp,function(t){n.mouseListener.finish&&n.mouseListener.finish(t)}).on(EditorEventBrowserReady,function(t){t.find("body").addClass("visual-editor-editable"),e(t,!0)}),e($(document)),this.emit(EditorEventWindowResize,t.width(),t.height()),this.loopCheckBox()},t.prototype.loopCheckBox=function(){var e=this,i=this.box.width(),n=500,o=function(){var t=new Date,t=(e.emit(EditorEventTimeLoop,t),e.box.width());i!==t&&(i=t,e.emit(EditorEventOuterWidthChange,t)),setTimeout(o,n)};setTimeout(o,n)},t.prototype.viewInit=function(){this.box.addClass("visual-editor"),this.box.html('\n        <div class="panel-group"></div>\n        <div class="editor-container">\n            <div class="work-container">\n                <div class="shell-box">\n                    <div class="shell-bar">\n                        <div>\n                            <i class="fa fa-ellipsis-h"></i>\n                            <i class="fa fa-signal"></i>\n                            <i class="fa fa-wifi"></i>\n                        </div>\n                        <div class="time">\n                        </div>\n                        <div class="pull-right">\n                            100%\n                            <i class="fa fa-battery-full"></i>\n                        </div>\n                    </div>\n                </div>\n                <iframe class="panel-main"></iframe>\n            </div>\n            <div class="rule-box">\n                <canvas class="h-rule-bar"></canvas>\n                <canvas class="v-rule-bar"></canvas>\n                <div class="rule-line-bar"></div>\n            </div>\n            <div class="h-scroll-bar">\n                <div class="inner-bar"></div>\n            </div>\n            <div class="v-scroll-bar">\n                <div class="inner-bar"></div>\n            </div>\n            <div class="panel-tool-bar">\n                <i class="fa fa-minus-circle" title="缩小"></i>\n                <i class="scale-text">100%</i>\n                <i class="fa fa-plus-circle" title="放大"></i>\n                <i class="fa fa-expand-arrows-alt" title="重置"></i>\n                <i class="fa fa-expand" title="全屏"></i>\n                <i class="fa fa-undo" title="翻转"></i>\n            </div>\n        </div>\n        <div class="await-widget-box">\n        </div>\n        <div class="dialog dialog-box editor-dialog" data-type="dialog" >\n            <div class="dialog-header">\n                <div class="dialog-title">编辑</div>\n                <i class="fa fa-close dialog-close"></i>\n            </div>\n            <form class="dialog-body control-dialog-body">\n                \n            </form>\n            <div class="dialog-footer">\n                <button type="button" class="dialog-yes">确认</button>\n                <button type="button" class="dialog-close">取消</button>\n            </div>\n        </div>\n        '),this.emit(EditorEventViewInit),this.workspace=this.find(".editor-container"),this.viewInited=!0,this.emit(EditorEventAfterViewInit)},t}(),EditorToolBar=function(){function t(t){var n=this;this.editor=t,this.scaleValue=100,this.editor.on(EditorEventViewInit,function(){var t=n.editor.find(".panel-tool-bar");n.scaleBar=t.find(".scale-text"),n.bindEvent(t)}).on(EditorEventPositionChange,function(t,e,i){n.scaleValue=i,n.scaleBar.text(i+"%")})}return t.prototype.bindEvent=function(t){var e=this;t.on("click",".fa-minus-circle",function(){e.scaleValue<30||e.editor.scale(e.scaleValue-10)}).on("click",".fa-plus-circle",function(){300<e.scaleValue||e.editor.scale(e.scaleValue+10)}).on("click",".fa-undo",function(){e.editor.rotate()}).on("click",".fa-expand",function(){e.editor.normal()}).on("click",".fa-expand-arrows-alt",function(){e.editor.reset()})},t}(),EditorWeightSoul=function(){function t(t){var l=this;this.editor=t,this.isNew=!1,this.editor.on(EditorEventViewInit,function(){l.box=l.editor.find(".await-widget-box")}).on(EditorEventDrag,function(t,e,i){var n=t.offset(),o=i.x-n.left,a=i.y-n.top,r=t.width(),s=t.height();l.target=t,l.isNew=e,l.box.html(t.prop("outerHTML")),l.editor.onMouse(function(t){l.target&&l.setBound(t.x-o,t.y-a,r,s)},function(t){var e;l.target&&((t=l.editor.browser.getElementByPoint(t))&&t[0]?(e=l.editor).emit.apply(e,__spreadArray([EditorEventDrog],t,!1)):l.reset())})}).on(EditorEventDrog,function(t,e){l.target&&(l.editor.emit(EditorEventOperateWeight,l.isNew,l.target,t,e),l.reset())})}return t.prototype.setBound=function(t,e,i,n){this.box.css({width:i+"px",height:n+"px",left:t+"px",top:e+"px"})},t.prototype.reset=function(){this.target&&(this.target=void 0,this.setBound(0,0,0,0))},t}(),EditorPanelGroup=function(){function t(t){var n=this;this.editor=t,this.children=[new EditorWeightPanel(this.editor),new EditorPropertyPanel(this.editor),new EditorLayerPanel(this.editor)],this.renderedChildren=[],this.visible=!0,this.editor.on(EditorEventViewInit,function(){n.box=n.editor.find(".panel-group");for(var t=0,e=n.children;t<e.length;t++){var i=e[t];n.onRender(i)}}).on(EditorEventAfterViewInit,function(){n.bindEvent()}).on(EditorEventResize,function(){for(var t=n.box.height(),e=0,i=n.renderedChildren;e<i.length;e++)i[e].target.find(".panel-body").height(t-36)})}return t.prototype.bindEvent=function(){var a=this;this.box.on("click",".panel-item .panel-header .fa-close",function(t){t.stopPropagation();for(var e=$(this).closest(".panel-item"),i=0,n=a.renderedChildren;i<n.length;i++){var o=n[i];a.isSame(o.target,e)&&o.control.hide()}a.toggle(!1)}).on("click",".panel-header",function(){var t=$(this).closest(".panel-item");if(t.hasClass("min")){for(var e=0,i=a.renderedChildren;e<i.length;e++){var n=i[e];a.isSame(n.target,t)?n.control.show():n.control.hide()}a.toggle(!0)}}).on("click",".expand-box .expand-header",function(){$(this).closest(".expand-box").toggleClass("open")})},t.prototype.toggle=function(t){this.visible!==t&&(this.box.toggleClass("min",!t),this.visible=t,this.editor.emit(EditorEventResize,this.editor.innerWidth,this.editor.innerHeight))},t.prototype.add=function(t){this.children.push(t),this.onRender(t)},t.prototype.onRender=function(t){var e;this.box&&(this.children.indexOf(t),e=t.render(),this.box.append(e),e.addClass("panel-item"),0<this.renderedChildren.length?t.hide():t.show(),this.renderedChildren.push({target:e,control:t}))},t.prototype.isSame=function(t,e){return t.is(e)},t}(),EditorPropertyPanel=function(){function t(t){var e=this;this.editor=t,this.lastAt=0,this.isAsync=!1,this.editor.on(EditorEventAfterViewInit,function(){e.bindEvent()}).on(EditorEventGetStyleSuccess,function(t){e.renderStyle(t)}).on(EditorEventOpenProperty,function(t){e.saveSync(),e.box.find(".panel-header").trigger("click"),e.target=t,e.editor.emit(EditorEventGetWeightProperty,t.id(),function(t){e.editor.emit(EditorEventGetStyleSuccess,t.styles),e.lastAt=(new Date).getTime(),e.applyForm(t)})}).on(EditorEventTimeLoop,function(t){e.isAsync&&2e4<(t=t.getTime())-e.lastAt&&(e.saveSync(),e.lastAt=t)})}return t.prototype.bindEvent=function(){var t,e=this;this.box&&(EditorHtmlHelper.bindInputEvent((t=this).box),this.box.on("change","input,textarea",function(){t.autoSave()}).on("click",".style-item",function(){$(this).addClass("active").siblings().removeClass("active"),t.autoSave()}).on("click",".reset-btn",function(){e.applyForm({}),e.autoSave()}))},t.prototype.saveSync=function(){var t,e=this;this.isAsync=!1,this.target&&(t=formData(this.box.find(".form-table"))+"&style_id="+EditorHelper.parseNumber(this.box.find(".style-item.active").attr("data-id"))+"&id="+this.target.id(),this.editor.emit(EditorEventSaveWeightProperty,this.target.id(),t,function(t){e.target.html(t.html)}))},t.prototype.autoSave=function(){this.isAsync=!0,this.lastAt=(new Date).getTime()},t.prototype.render=function(){return this.box=$('<div class="panel-item min" data-panel="property"></div'),this.box.html('\n            <div class="panel-header">\n                <span class="title">属性</span>\n                <a class="fa fa-close"></a>\n            </div>\n            <div class="panel-body">\n            <div class="tab-box">\n                    <div class="tab-header"><div class="tab-item active">\n                            普通\n                        </div><div class="tab-item">\n                            高级\n                        </div><div class="tab-item">\n                            样式\n                        </div></div>\n                    <div class="tab-body">\n                        <div class="tab-item active">\n                        </div>\n                        <div class="tab-item">\n                        <div class="expand-box open">\n                                <div class="expand-header">整体<span class="fa fa-chevron-right"></span></div>\n                                <div class="expand-body">\n                                    \n                                </div>\n                            </div>\n                            <div class="expand-box">\n                                <div class="expand-header">标题<span class="fa fa-chevron-right"></span></div>\n                                <div class="expand-body">\n                                    \n                                </div>\n                            </div>\n                            <div class="expand-box">\n                                <div class="expand-header">内容<span class="fa fa-chevron-right"></span></div>\n                                <div class="expand-body">\n                                    \n                                </div>\n                            </div>\n                        </div>\n                        <div class="tab-item style-panel">\n                            <div class="style-item" data-id="0">\n                                无\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '),this.box},t.prototype.renderStyle=function(t){t=EditorHtmlHelper.mapJoinHtml(t,function(t){return'<div class="style-item" data-id="'.concat(t.id,'">\n            <img src="').concat(t.thumb,'" alt="').concat(t.name,'">\n        </div>')});this.box.find(".style-panel").html('<div class="style-item" data-id="0">无</div>'.concat(t))},t.prototype.show=function(){this.box.removeClass("min")},t.prototype.hide=function(){this.box.addClass("min")},t.prototype.applyForm=function(e){var t=this.box.find(".tab-body .tab-item");t[0].innerHTML=EditorHtmlHelper.render(e.form.basic)+EditorHtmlHelper.buttonGroup(EditorHtmlHelper.button("重置","reset-btn")),t[1].innerHTML=EditorHtmlHelper.render(e.form.style),this.box.find(".style-item").each(function(){var t=$(this);t.toggleClass("active",t.attr("data-id")==e.style_id)})},t}(),EditorWeightPanel=function(){function t(t){var e=this;this.editor=t,this.editor.on(EditorEventAfterViewInit,function(){e.editor.emit(EditorEventGetWeights,function(t){e.renderWeight(t.weights)}),e.bindEvent()})}return t.prototype.bindEvent=function(){var i=this.editor;this.box.on("mousedown",".visual-edit-control",function(t){var e=$(this);"true"!==e.attr("draggable")&&(t.stopPropagation(),t.preventDefault(),i.emit(EditorEventDrag,e,!0,{x:t.clientX,y:t.clientY}))}).on("touchstart",".visual-edit-control",function(t){var e=$(this);t.stopPropagation(),t.preventDefault(),i.emit(EditorEventDrag,e,!0,{x:t.touches[0].clientX,y:t.touches[0].clientY})}).on("dragstart",".visual-edit-control",function(t){t.originalEvent.dataTransfer.setData("Text",t.target.id),i.emit(EditorEventDragStart,$(this))})},t.prototype.render=function(){return this.box=$('<div class="panel-item" data-panel="weight"></div'),this.box.html('\n            <div class="panel-header">\n                <span class="title">部件</span>\n                <a class="fa fa-close"></a>\n            </div>\n            <div class="panel-body">\n            </div>\n        '),this.box},t.prototype.renderWeight=function(t){t=EditorHtmlHelper.mapJoinHtml(t,function(i){var t=EditorHtmlHelper.mapJoinHtml(i.items,function(t){var e;return t?(e=t.editable?'<a class="edit">编辑</a>':"",'<div class="visual-edit-control" data-type="weight" data-weight="'.concat(t.id,'" data-group="').concat(i.id,'">\n                <div class="visual-preview">\n                    <div class="thumb">\n                        <img src="').concat(t.thumb,'" alt="').concat(t.name,'" title="').concat(t.description,'">\n                    </div>\n                    <p class="title">').concat(t.name,'</p>\n                </div>\n                <div class="visual-action">\n                    <a class="refresh">刷新</a>\n                    ').concat(e,'\n                    <a class="property">属性</a>\n                    <a class="drag">拖拽</a>\n                    <a class="del">删除</a>\n                </div>\n                <div class="visual-view">\n                    <img src="/assets/images/ajax.gif" alt="">\n                </div>\n            </div>')):""});return'\n            <ul class="menu">\n                <li class="expand-box open">\n                    <div class="expand-header">\n                        '.concat(i.name,'\n                        <span class="fa fa-chevron-right"></span>\n                    </div>\n                    <div class="expand-body list-view">\n                    ').concat(t,"\n                    </div>\n                    </li>\n                </ul>\n            ")});this.box.find(".panel-body").html(t)},t.prototype.show=function(){this.box.removeClass("min")},t.prototype.hide=function(){this.box.addClass("min")},t}(),EditorLayerPanel=function(){function t(t){var e=this;this.editor=t,this.editor.on(EditorEventAfterViewInit,function(){e.bindEvent()})}return t.prototype.bindEvent=function(){this.editor;this.box.on("click",".structure-item .item-open-icon",function(){$(this).closest(".structure-item").toggleClass("open")})},t.prototype.render=function(){return this.box=$('<div class="panel-item" data-panel="layer"></div'),this.box.html('\n            <div class="panel-header">\n                <span class="title">组件层</span>\n                <a class="fa fa-close"></a>\n            </div>\n            <div class="panel-body">\n            </div>\n        '),this.box},t.prototype.show=function(){this.box.removeClass("min")},t.prototype.hide=function(){this.box.addClass("min")},t.prototype.renderItems=function(n){var o=this;return n.map(function(t){var e="",i="";return t.children&&0<t.children.length&&(e='<div class="item-children">'.concat(o.renderItems(n),"</div>"),i='<div class="item-open-icon">\n                <i class="fa fa-chevron-right"></i>\n            </div>'),'<div class="structure-item">\n            <div class="item-body">\n                '.concat(i,'\n                <div class="item-icon">\n                    <i class="fa fa-chain"></i>\n                </div>\n                <input type="text" class="item-title" value="').concat(t.name,'">\n                <div class="item-action-icon">\n                    <i class="fa fa-ellipsis-h"></i>\n                </div>\n                <div class="item-action-bar">\n                    <a>\n                        <i class="fa fa-trash"></i>\n                    </a>\n                    <a>\n                        <i class="fa fa-copy"></i>\n                    </a>\n                    <a>\n                        <i class="fa fa-plus"></i>\n                    </a>\n                    <a>\n                        <i class="fa fa-edit"></i>\n                    </a>\n                </div>\n            </div>\n            ').concat(e,"\n        </div>")}).join("")},t}(),EditorDialog=function(){function t(t){var i=this,e=(this.editor=t,this);this.editor.on(EditorEventViewInit,function(){var t=i.editor.find(".editor-dialog");i.innerForm=t.find(".dialog-body"),i.box=t.dialog(),i.bindEvent(),i.box.on("done",function(){i.editor.emit(EditorEventSaveWeightProperty,i.target.id(),t.find(".dialog-body").serialize(),function(t){e.editor.emit(EditorEventOpenProperty,e.target),e.target.html(t.html)}),i.box.close()})}).on(EditorEventOpenEditDialog,function(e){i.target=e,i.editor.emit(EditorEventWeightForm,e.id(),function(t){i.box.find(".dialog-body").html('<input type="hidden" name="id" value="'.concat(e.id(),'">').concat(EditorHtmlHelper.render(t.form))),i.box.showCenter()})})}return t.prototype.bindEvent=function(){EditorHtmlHelper.bindInputEvent(this.box.box)},t}(),EditorBrowser=function(){function t(t){var o=this;this.editor=t,this.frameScale=100,this.shellVisbile=!1,this.editor.on(EditorEventViewInit,function(){o.shellTimeBar=o.editor.find(".shell-bar .time"),o.shell=o.editor.find(".work-container"),o.frame=o.editor.find(".panel-main"),o.bindEvent()}).on(EditorEventScroll,function(t,e){e?o.bound.left=-t:o.bound.top=-t,o.renderTransform(),o.editor.emit(EditorEventPositionChange,o.bound.left,o.bound.top,o.frameScale)}).on(EditorEventResize,function(){o.bound&&o.resize(o.bound.width,o.bound.height)}).on(EditorEventDragStart,function(t){o.dragWeight=t}).on(EditorEventTimeLoop,function(t){o.shellVisbile&&o.shellTimeBar.text([t.getHours(),t.getMinutes()].map(EditorHelper.twoPad).join(":"))}).on(EditorEventOperateWeight,function(t,e,i,n){o.dragWeight=void 0,t?(o.selectedWeight=new EditorWeight(o.editor,e.clone()),o.selectedWeight.appendTo(i,n)):(o.selectedWeight=new EditorWeight(o.editor,e),o.selectedWeight.moveTo(i,n))})}return t.prototype.bindEvent=function(){var e=this;this.frame.on("load",function(){var t=e.frame.contents();e.frameBody=t.find("body"),e.editor.emit(EditorEventBrowserReady,t),e.bindFrameEvent()})},t.prototype.bindFrameEvent=function(){function e(t,e){i.dragWeight?(i.selectedWeight=new EditorWeight(i.editor,i.dragWeight.clone()),i.selectedWeight.appendTo(t,e)):i.selectedWeight&&i.selectedWeight.moveTo(t,e)}var i=this;this.frameBody.on("dragover",".visual-edit-row",function(t){t.stopPropagation(),t.preventDefault()}).on("drop",".visual-edit-row",function(t){t.stopPropagation(),t.preventDefault(),e($(this))}).on("mouseup",".visual-edit-row",function(t){t.stopPropagation(),t.preventDefault(),i.editor.emit(EditorEventDrog,$(this))}).on("mouseup",".visual-edit-control",function(t){t.stopPropagation(),t.preventDefault();t=$(this);i.editor.emit(EditorEventDrog,t.closest(".visual-edit-row"),t)}).on("touchend",".visual-edit-row",function(t){t.stopPropagation(),t.preventDefault(),i.editor.emit(EditorEventDrog,$(this))}).on("touchend",".visual-edit-control",function(t){t.stopPropagation(),t.preventDefault();t=$(this);i.editor.emit(EditorEventDrog,t.closest(".visual-edit-row"),t)}).on("dragover",".visual-edit-control",function(t){t.stopPropagation(),t.preventDefault()}).on("drop",".visual-edit-control",function(t){t.stopPropagation(),t.preventDefault();t=$(this);e(t.closest(".visual-edit-row"),t)}).on("dragstart",".visual-edit-control",function(t){t.originalEvent.dataTransfer.setData("Text",t.target.id),i.selectedWeight=new EditorWeight(i.editor,$(this))}).on("dragend",".visual-edit-control",function(){$(this).attr("draggable","false")}).on("mousedown",".visual-action .drag",function(t){t.stopPropagation(),i.dragWeight=void 0;var e=$(this).closest(".visual-edit-control");i.editor.emit(EditorEventDrag,e,!1,{x:t.clientX,y:t.clientY})}).on("touchstart",".visual-action .drag",function(t){t.stopPropagation(),t.preventDefault(),i.dragWeight=void 0;var e=$(this).closest(".visual-edit-control");i.editor.emit(EditorEventDrag,e,!1,{x:t.touches[0].clientX,y:t.touches[0].clientY})}).on("click",".visual-action .del",function(t){t.stopPropagation(),i.selectedWeight=new EditorWeight(i.editor,$(this).closest(".visual-edit-control")),i.selectedWeight.tapRemove()}).on("click",".visual-action .edit",function(t){t.stopPropagation(),i.selectedWeight=new EditorWeight(i.editor,$(this).closest(".visual-edit-control")),i.selectedWeight.tapEdit()}).on("click",".visual-action .refresh",function(t){t.stopPropagation(),i.selectedWeight=new EditorWeight(i.editor,$(this).closest(".visual-edit-control")),i.selectedWeight.tapRefresh()}).on("click",".visual-action .property",function(t){t.stopPropagation(),i.selectedWeight=new EditorWeight(i.editor,$(this).closest(".visual-edit-control")),i.selectedWeight.tapProperty()}).on("click","a",function(t){t.preventDefault()})},t.prototype.globePosition=function(t){var e=this.frame.offset();return{x:t.x+e.left,y:t.y+e.top}},t.prototype.framePosition=function(t){var e=this.frame.offset();return{x:t.x-e.left,y:t.y-e.top}},t.prototype.getElementByPoint=function(t){var i=this.framePosition(t);if(i.x<0||i.y<0||i.x>this.frame.width()||i.y>this.frame.height())return[void 0,void 0];for(var e,n=function(t){var e=t.offset();return!(e.left>i.x||e.top>i.y)&&e.left+t.width()>i.x&&e.top+t.height()>i.y},o=void 0,a=this.frameBody;"break"!==function(){var e=!1;if(a.find(".visual-edit-row").each(function(){var t=$(this);if(n(t))return a=o=t,!(e=!0)}),!e)return"break"}(););return o?(e=void 0,o.find(".visual-edit-control").each(function(){var t=$(this);if(n(t))return e=t,!1}),[o,e]):[void 0,void 0]},t.prototype.toggleShell=function(t){this.shellVisbile=t,this.shell.toggleClass(EditorMobileStyle,t)},t.prototype.rotate=function(){this.resize(this.bound.height,this.bound.width)},t.prototype.scale=function(t){this.frameScale=t,this.renderTransform(),this.emitRealSize(),this.editor.emit(EditorEventPositionChange,this.bound.left,this.bound.top,this.frameScale)},t.prototype.renderTransform=function(){var t=[];100!==this.frameScale&&t.push("scale("+this.frameScale/100+")"),0===this.bound.left&&0===this.bound.top||t.push("translate(".concat(this.bound.left,"px, ").concat(this.bound.top,"px)")),this.shell.css("transform",t.join(" "))},t.prototype.resize=function(t,e,i,n,o){var a=this.editor.innerWidth,r=this.editor.innerHeight;i||n||(t=a<=(i=t)?0:(a-i)/2,e=r<=(n=e)?0:(r-n)/2),this.shell.css({width:i+"px",height:n+"px",transform:"translate(".concat(t,"px, ").concat(e,"px)")}),this.bound={left:t,top:e,height:n,width:i},o&&(this.frameScale=o,this.renderTransform()),this.emitRealSize(),this.editor.emit(EditorEventPositionChange,t,e,this.frameScale)},t.prototype.emitRealSize=function(){var t=this.editor.innerWidth,e=this.editor.innerHeight,i=this.frameScale/100;this.editor.emit(EditorEventBrowserResize,this.bound.left*i,this.bound.top*i,this.bound.width*i,this.bound.height*i,t,e)},t.prototype.reset=function(){this.resize(this.bound.width,this.bound.height,0,0,100)},t.prototype.navigate=function(t){this.frame.attr("src",t)},t.prototype.reload=function(){this.frame[0].contentWindow.location.reload()},t.prototype.navigateString=function(t){this.frame.attr("src","data:text/html;charset=utf-8,"+encodeURI(t))},t.prototype.serialize=function(){var o;return this.frameBody?(o=[],this.frameBody.find(".visual-edit-row").each(function(){var t=$(this),i=t.attr("data-id"),n=t.attr("data-index");t.children(".visual-edit-control").each(function(t){var e=$(this);o.push({id:e.attr("data-id"),parent_id:i,parent_index:n,position:t+1})})}),o):[]},t}(),EditorWeight=function(){function t(t,e){this.editor=t,this.box=e}return t.prototype.toggle=function(t){return this.box.toggleClass("visual-edit-mode",t),this},t.prototype.toggleLoading=function(t){return this.box.toggleClass("visual-loading",t),this},t.prototype.html=function(t){t=$(t);return this.box=this.box.replaceWith(t),this.box=t,this},t.prototype.id=function(){return EditorHelper.parseNumber(this.box.attr("data-id"))},t.prototype.weightId=function(){return EditorHelper.parseNumber(this.box.attr("data-weight"))},t.prototype.tapRefresh=function(){var e=this;this.toggleLoading(!0),this.editor.emit(EditorEventRefreshWeight,this.id(),function(t){e.toggleLoading(!1),e.html(t.html)},function(){e.toggleLoading(!1)})},t.prototype.tapEdit=function(){this.editor.emit(EditorEventOpenEditDialog,this)},t.prototype.tapProperty=function(){this.editor.emit(EditorEventOpenProperty,this)},t.prototype.tapRemove=function(){var t=this;this.editor.emit(EditorEventRemoveWeight,this.id(),function(){t.remove()})},t.prototype.moveTo=function(t,e){e=this.appendToPosition(t,e);this.editor.emit(EditorEventMoveWeight,{id:this.id(),parent_id:t.attr("data-id"),parent_index:t.attr("data-index"),position:e},function(){})},t.prototype.appendTo=function(t,e){var i=this,e=this.appendToPosition(t,e);this.box.width("auto"),this.toggleLoading(!0),this.editor.emit(EditorEventAddWeight,{weight_id:this.weightId(),weight_group:this.box.attr("data-group"),parent_id:t.attr("data-id"),parent_index:t.attr("data-index"),position:e},function(t){i.toggleLoading(!1),i.html(t.html)},function(){i.toggleLoading(!1)})},t.prototype.appendToPosition=function(t,e){var i;return!e||(i=t.children().index(e))<0?(t.append(this.box),t.children().length):(this.box.insertBefore(e),i+1)},t.prototype.remove=function(){this.box.remove()},t}(),EditorScrollBar=function(){function t(t,e){var r=this;void 0===e&&(e=!0),this.editor=t,this.horizontal=e,this.baseSize=8,this.left=0,this.maxLeft=0,this.pxScale=1,this.editor.on(EditorEventViewInit,function(){r.element=r.editor.find(r.horizontal?".h-scroll-bar":".v-scroll-bar"),r.innerBar=r.element.find(".inner-bar"),r.baseSize=r.horizontal?r.element.height():r.element.width(),r.innerBar.on("mousedown",function(t){var i={x:t.clientX,y:t.clientY};r.editor.onMouse(function(t){var e=r.horizontal?t.x-i.x:t.y-i.y;r.scroll(r.left+e),i=t})})}).on(EditorEventBrowserResize,function(t,e,i,n,o,a){r.horizontal?r.onRender(t,o,i,r.element.width()):r.onRender(e,a,n,r.element.height())})}return Object.defineProperty(t.prototype,"barSize",{get:function(){return this.baseSize},enumerable:!1,configurable:!0}),t.prototype.move=function(t){this.scroll(t/this.pxScale)},t.prototype.scroll=function(t){this.left=Math.max(0,Math.min(t,this.maxLeft)),this.innerBar.css(this.horizontal?"left":"top",this.left+"px"),this.output()},t.prototype.scrollTo=function(t){this.scroll(t*this.maxLeft/100)},t.prototype.output=function(){this.editor.emit(EditorEventScroll,this.converter(this.left),this.horizontal)},t.prototype.converter=function(t){return t*this.pxScale},t.prototype.onRender=function(t,e,i,n){var o;i<=e?(this.maxLeft=0,this.applySize(0,n)):(o=Math.min(6*this.baseSize,this.baseSize/2),this.maxLeft=n-(e=(i=n-(n=i-e))<=o?o:i),this.pxScale=n/this.maxLeft,this.applySize(t/this.pxScale,e))},t.prototype.applySize=function(t,e){var i;this.left=Math.max(0,Math.min(t,this.maxLeft)),this.innerBar.css(((i={})[this.horizontal?"left":"top"]=t+"px",i[this.horizontal?"width":"height"]=e+"px",i))},t}(),EditorRuler=function(){function t(t,e){var n=this;void 0===e&&(e=!0),this.editor=t,this.horizontal=e,this.offset=0,this.gap=10,this.scale=1,this.foreground="#333",this.background="#ccc",this.baseWidth=0,this.baseX=0,this.baseSize=16,this.editor.on(EditorEventViewInit,function(){n.element=n.editor.find(n.horizontal?".h-rule-bar":".v-rule-bar"),n.baseSize=n.horizontal?n.element.height():n.element.width()}).on(EditorEventResize,function(t,e){n.refresh(),n.onAfterViewInit()}).on(EditorEventPositionChange,function(t,e,i){n.offset=n.horizontal?t:e,n.scale=i/100,n.onRender(n.element[0].getContext("2d"))})}return Object.defineProperty(t.prototype,"barSize",{get:function(){return this.baseSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetX",{get:function(){return this.barSize-this.offset},enumerable:!1,configurable:!0}),t.prototype.refresh=function(){this.baseWidth=this.horizontal?this.editor.innerWidth:this.editor.innerHeight},t.prototype.onAfterViewInit=function(){var t;this.element.length<1||(t=this.element[0],this.horizontal?(t.width=this.baseWidth,t.height=this.barSize):(t.width=this.barSize,t.height=this.baseWidth),this.onRender(t.getContext("2d")))},t.prototype.createLine=function(t){t=(this.horizontal?t.clientX:t.clientY)-this.baseX;return{value:t,label:Math.floor((t+this.offsetX)/this.scale),horizontal:this.horizontal}},t.prototype.onRender=function(t){t.fillStyle=this.background,t.lineWidth=2;for(var e=this.barSize,i=(this.horizontal?t.fillRect(0,0,this.baseWidth,e):t.fillRect(0,0,e,this.baseWidth),this.gap*this.scale),n=Math.ceil(this.baseWidth/i),o=Math.ceil(this.offsetX/i),a=.3*e,r=0;r<n;r++){var s=o+r,l=s%5==0,c=s*i-this.offsetX,d=e*(l?.6:.4);this.horizontal?(this.drawLine(t,{x:c,y:0},{x:c,y:d},this.foreground),l&&this.drawText(t,(s*this.gap).toString(),a,this.foreground,{x:c,y:d})):(this.drawLine(t,{x:0,y:c},{x:d,y:c},this.foreground),l&&this.drawText(t,(s*this.gap).toString(),a,this.foreground,{x:d-2*a,y:c}))}},t.prototype.drawText=function(t,e,i,n,o){t.font="normal normal bold ".concat(i,"px"),t.fillStyle=n,t.fillText(e,o.x,o.y+i)},t.prototype.drawLine=function(t,e,i,n){t.beginPath(),t.strokeStyle=n,t.moveTo(e.x,e.y),t.lineTo(i.x,i.y),t.stroke()},t}(),EditorTree=function(){function t(t,e,i,n){void 0===n&&(n={titleKey:"title",childrenKey:"children",iconKey:"icon",inputPrefix:"item_"}),this.box=t,this.itemForm=e,this.dataInput=i,this.option=n,this.items=[];t=this.dataInput.val();t&&(this.items=JSON.parse(t)),this.bindEvent(),this.render()}return t.prototype.bindEvent=function(){var e=this;this.box.on("click",".tree-add",function(){var t=$(this).parent();e.addSource(t)}).on("click",".tree-item-line",function(){e.editSource($(this).closest(".tree-item"))}).on("click",".tree-item-action .fa-arrow-up",function(t){t.stopPropagation(),e.move($(this).closest(".tree-item"),-1)}).on("click",".tree-item-action .fa-arrow-down",function(t){t.stopPropagation(),e.move($(this).closest(".tree-item"),1)}).on("click",".tree-item-action .fa-times",function(t){t.stopPropagation(),e.remove($(this).closest(".tree-item"))}),this.itemForm.on("click",".tree-save-btn",function(){e.saveSource()})},t.prototype.getPath=function(t){for(var e=t.parent(),i=[t.index()];e.hasClass("tree-children");){var n=e.closest(".tree-item");i.push(n.index()),e=n.parent()}return i.reverse()},t.prototype.getSource=function(t){for(var t=this.getPath(t),e=t.pop(),i=this.items,n=0,o=t;n<o.length;n++)i=i[o[n]][this.option.childrenKey];return[i,e]},t.prototype.remove=function(t){var e=this.getSource(t),i=e[0],e=e[1];i.splice(e,1),this.editNode.is(t)&&(this.editData=void 0,this.editNode=void 0),t.remove(),this.output()},t.prototype.move=function(t,e){var i,n,o,a;0===e||0==(i=t.index())&&e<0||i===(n=t.parent().children(".tree-item")).length-1&&0<e||(e<0&&i+e<0?e=-i:0<e&&i+e>=n.length&&(e=n.length-i-1),(o=this.getSource(t)[0]).splice(a=i+e,0,o[i]),o.splice(i+e<0?1:0,1),t.insertBefore(n[a]),this.output())},t.prototype.output=function(){this.dataInput.val(JSON.stringify(this.items))},t.prototype.editSource=function(t){var i=this,t=(this.editNode=t,this.parentNode=t.parent(),this.getSource(t)),e=t[0],t=t[1];this.editData=e[t],this.parentData=e,EditorHelper.eachObject(this.editData,function(t,e){i.itemForm.find("*[name="+i.option.inputPrefix+e+"]").val(t).trigger("change")})},t.prototype.addSource=function(t){var e;this.parentNode=t,this.editData=void 0,this.editNode=void 0,this.itemForm.find("input,textarea").each(function(){var t=$(this),e=t.attr("type");"checkbox"!==e&&"radio"!==e&&"color"!==e&&"hidden"!==e&&t.val("")}),t.hasClass("tree-children")?(e=(t=this.getSource(t.closest(".tree-item")))[0],t=t[1],this.parentData=e[t][this.option.childrenKey]):this.parentData=this.items},t.prototype.saveSource=function(){this.parentData||(this.parentData=this.items,this.parentNode=this.box);var t,e=this.editData||{},i=this;this.itemForm.find("select,input,textarea").each(function(){var t=$(this);0<t.closest(".hidden").length||(e[t.attr("name").substring(i.option.inputPrefix.length)]=t.val())}),e[this.option.titleKey]?("children"===e.type?e[this.option.childrenKey]=[]:delete e[this.option.childrenKey],this.editNode?this.editNode.replaceWith(this.renderTreeItem(e)):(this.editData=e,this.parentData.push(e),(t=this.parentNode.children(".tree-add")).before(this.renderTreeItem(e)),this.editNode=t.prev(),console.log(this.editNode)),this.output()):Dialog.tip("请输入标题")},t.prototype.render=function(){this.box.html(this.renderTree(this.items))},t.prototype.renderTree=function(t){for(var e="",i=0,n=t;i<n.length;i++){var o=n[i];e+=this.renderTreeItem(o)}return e+'<div class="tree-add">\n        <i class="fa fa-plus"></i>\n    </div>'},t.prototype.renderTreeItem=function(t){var e="",i=(t[this.option.childrenKey]&&(e='<div class="tree-children">'+this.renderTree(t[this.option.childrenKey])+"</div>"),""),t=(t[this.option.iconKey]&&(i='<i class="fa '+t[this.option.iconKey]+'"></i>'),t[this.option.titleKey]);return'<div class="tree-item">\n        <div class="tree-item-line">\n            '.concat(i,"\n            <span>").concat(t,'</span>\n            <div class="tree-item-action">\n                <i class="fa fa-arrow-up"></i>\n                <i class="fa fa-arrow-down"></i>\n                <i class="fa fa-times"></i>\n            </div>\n        </div>\n        ').concat(e,"\n    </div>")},t}(),EditorHelper=function(){function n(){}return n.twoPad=function(t){return t<10&&0<=t?"0"+t:t.toString()},n.parseNumber=function(t){return!t||isNaN(t)?0:"number"==typeof t?t:"boolean"==typeof t?t?1:0:(t=0<(t=0<(t="string"!=typeof t?t.toString():t).indexOf(",")?t.replace(/,/g,""):t).indexOf(".")?parseFloat(t):parseInt(t,10),isNaN(t)?0:t)},n.checkRange=function(t,e,i){return void 0===i&&(i=100),t<(e=void 0===e?0:e)?e:e<i&&i<t?i:t},n.cloneObject=function(t){if("object"!=typeof t)return t;if(t instanceof Array)return t.map(function(t){return n.cloneObject(t)});var e,i={};for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=n.cloneObject(t[e]));return i},n.eachObject=function(t,e){if("object"!=typeof t)return e(t,void 0);if(t instanceof Array){for(var i=0;i<t.length;i++)if(!1===e(t[i],i))return!1}else for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&!1===e(t[n],n))return!1},n.colorToRgba=function(t){function e(t){return t.substring(t.indexOf("(")+1,t.indexOf(")")).split(",").map(function(t){return toFloat(t)})}var i,n=t.charAt(0);return"h"===n?(i=e(t),this.hslToRgba({h:i[0],s:i[1],l:i[2],a:1})):"r"===n?3<(i=e(t)).length?{r:i[0],g:i[1],b:i[2],a:i[3]}:{r:i[0],g:i[1],b:i[2],a:1}:this.hexToRgba(t)},n.rgbaToHex=function(t){return["#",t.r.toString(16),t.g.toString(16),t.b.toString(16),0<=t.a&&t.a<1?Math.round(255*t.a).toString(16):""].join("")},n.hexToRgba=function(t){function e(t,e){return void 0===e&&(e=!1),t?(t=parseInt(t,16),e?17*t:t):0}var i=1,n=(t="#"===t.charAt(0)?t.substring(1):t).length<=4?1:2;return{r:e(t.substring(0,n),2==n),g:e(t.substring(n,2*n),2==n),b:e(t.substring(2*n,3*n),2==n),a:i=t.length>3*n?e(t.substring(3*n,4*n),2==n):i}},n.rgbaToHsl=function(t){var e,i=t.r,n=t.g,o=t.b,a=(i/=255,n/=255,o/=255,Math.max(i,n,o)),r=Math.min(i,n,o),s=(a+r)/2;if(a==r)e=c=0;else{var l=a-r,c=.5<s?l/(2-a-r):l/(a+r);switch(a){case i:e=(n-o)/l+(n<o?6:0);break;case n:e=(o-i)/l+2;break;case o:e=(i-n)/l+4}e/=6}return{h:e,s:c,l:s,a:t.a}},n.hslToRgba=function(t){var e,i,n,o,a=t.h/360,r=t.s/100,s=t.l/100;return 0==r?i=n=o=s:(i=(e=function(t,e,i){return i<0&&(i+=1),1<i&&--i,i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t})(r=2*s-(s=s<.5?s*(1+r):s+r-s*r),s,a+1/3),n=e(r,s,a),o=e(r,s,a-1/3)),{r:Math.round(255*i),g:Math.round(255*n),b:Math.round(255*o),a:t.a}},n}(),EditorHtmlHelper=function(){function i(){}return i.guid=function(){return this._guid++},i.value=function(t,e){return void 0===e&&(e=""),null==t?e:t},i.join=function(){for(var e=this,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return t.map(function(t){return e.value(t)}).join("")},i.mapJoinHtml=function(t,i){var n="";return EditorHelper.eachObject(t,function(t,e){n+=i(t,e)}),n},i.horizontalAlign=function(t,e,i,n){void 0===t&&(t="horizontal-align"),void 0===e&&(e="horizontal-align");var o=[{name:'<i class="fa fa-align-left" title="左对齐"></i>',value:"left"},{name:'<i class="fa fa-align-center" title="水平居中"></i>',value:"center"},{name:'<i class="fa fa-align-right" title="右对齐"></i>',value:"right"}];return(n=void 0===n?!1:n)||o.push({name:'<i class="fa fa-align-justify" title="水平等间距"></i>',value:"stretch"}),this.radioInput(t,e,o,i)},i.verticalAlign=function(t,e,i){return this.radioInput(t=void 0===t?"vertical-align":t,e=void 0===e?"vertical-align":e,[{name:'<i class="fa fa-align-left fa-vertical" title="上对齐"></i>',value:"top"},{name:'<i class="fa fa-align-center fa-vertical" title="垂直居中"></i>',value:"center"},{name:'<i class="fa fa-align-right fa-vertical" title="下对齐"></i>',value:"bottom"},{name:'<i class="fa fa-align-justify fa-vertical" title="垂直等间距"></i>',value:"stretch"}],i)},i.positionSide=function(t,e){var i="settings[style][position][value]";return"static"!==t?this.boundInput(this.nameToId(i),i,e):""},i.border=function(t,e){var i=this.nameToId(t="settings[style]"+(t?"["+t+"]":"")+"[border]")+"_"+this.guid();return this.input(i,"边框",this.borderPopup(i,t,e))},i.radius=function(t,e){var i=this.nameToId(t="settings[style]"+(t?"["+t+"]":"")+"[border-radius]")+"_"+this.guid();return this.input(i,"圆角",this.radiusInput(i,t,e=e||[]),"control-line-group")},i.color=function(t,e){var i=this.nameToId(t="settings[style]"+(t?"["+t+"]":"")+"[color]")+"_"+this.guid();return this.input(i,"字体颜色",this.colorPopup(i,t,e))},i.background=function(t,e){var i=this.nameToId(t="settings[style]"+(t?"["+t+"]":"")+"[background]")+"_"+this.guid();return this.input(i,"背景",this.backgroundPopup(i,t,e))},i.visibility=function(t,e){var i=this.nameToId(t="settings[style]["+t+"][visibility]")+"_"+this.guid();return this.input(i,"可见",this.switch(i,t,e,"显示","隐藏"))},i.fontSize=function(t,e){var i=this.nameToId(t="settings[style]["+t+"][font-size]")+"_"+this.guid();return this.input(i,"字体大小",this.sizeInput(void 0,i,t,e))},i.textAlign=function(t,e){var i=this.nameToId(t="settings[style]["+t+"][text-align]")+"_"+this.guid();return this.input(i,"字体位置",this.radioInput(i,t,[{name:"居左",value:0},{name:"居中",value:1},{name:"居右",value:2}],e||0),"control-line-group")},i.fontWeight=function(t,e){for(var i=this.nameToId(t="settings[style]["+t+"][font-weight]")+"_"+this.guid(),n=[],o=1;o<10;o++){var a=100*o;n.push({name:a,value:a})}return this.input(i,"字体粗细",this.selectControl(i,t,n,e))},i.selectControl=function(t,e,i,n){return'<select class="form-control" name="'.concat(e,'" id="').concat(t,'">\n        ').concat(this.selectOption(i,n),"\n        </select>")},i.sideInput=function(t,e,i){void 0===i&&(i=[]);var n=this.nameToId(t)+"_"+this.guid();return this.input(n,e,this.boundInput(n,t,i),"control-line-group")},i.switch=function(t,e,i,n,o){return void 0===n&&(n="开启"),void 0===o&&(o="关闭"),i=EditorHelper.parseNumber(i),this.join('<div id="',t,'" class="switch-input" data-on="',n,'" data-off="',o,'"><span class="switch-control"></span><span class="switch-label">',0<i?n:o,'</span><input type="hidden" name="',e,'" value="',i,'"/></div>')},i.radioInput=function(n,o,t,a){return this.join.apply(this,__spreadArray(__spreadArray(['<div class="control-row">'],t.map(function(t,e){var e=[n,e].join("_"),i=t.value==a?" checked":"";return'<span class="radio-label radio-control-item"><input type="radio" id="'.concat(e,'" name="').concat(o,'" value="').concat(t.value,'"').concat(i,'><label for="').concat(e,'">').concat(t.name,"</label></span>")}),!1),["</div>"],!1))},i.checkbox=function(n,o,t,a){return void 0===a&&(a=[]),this.join.apply(this,__spreadArray(__spreadArray(['<div class="control-row">'],t.map(function(t,e){var e=[n,e].join("_"),i=a&&0<=a.indexOf(t.value)?" checked":"";return'<span class="check-label radio-control-item"><input type="checkbox" id="'.concat(e,'" name="').concat(o,'" value="').concat(t.value,'"').concat(i,'><label for="').concat(e,'">').concat(t.name,"</label></span>")}),!1),["</div>"],!1))},i.text=function(t,e,i,n){void 0===i&&(i="");n=n?' size="'.concat(n,'"'):"";return i=this.value(i),'<input type="text" id="'.concat(t,'" name="').concat(e,'" value="').concat(i,'"').concat(n,">")},i.input=function(t,e,i,n){return'<div class="'.concat(n=void 0===n?"control-inline-group":n,'"><label for="').concat(t,'">').concat(e,"</label>").concat(i,"</div>")},i.buttonGroup=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.join.apply(this,__spreadArray(__spreadArray(['<div class="btn-group control-offset">'],t,!1),["</div>"],!1))},i.button=function(t,e){return'<button type="button" class="btn '.concat(e,'">').concat(t,"</button>")},i.animationInput=function(){return'<div class="animation-container">\n        <div class="effect-show">效果展示</div>\n        <div class="control-inline-group">\n            <label for="">动效</label>\n            <select class="form-control">\n            '.concat(this.selectOption([{value:"",name:"无"},{value:"bounce",name:"弹跳"},{value:"fadeIn",name:"渐现"},{value:"fadeOut",name:"渐出"},{value:"flash",name:"闪烁"},{value:"pulse",name:"跳动"},{value:"rubberBand",name:"橡皮筋"},{value:"shake",name:"抖动"},{value:"swing",name:"摆动"},{value:"tada",name:"哒嘟"},{value:"wobble",name:"摇晃"},{value:"jello",name:"扭曲抖动"},{value:"bounceIn",name:"弹入"},{value:"bounceInDown",name:"上弹入"},{value:"bounceInLeft",name:"左弹入"},{value:"bounceInRight",name:"右弹入"},{value:"bounceInUp",name:"下弹入"},{value:"flipInX",name:"水平翻转"},{value:"flipInY",name:"垂直翻转"},{value:"spinning",name:"旋转（顺时针）"},{value:"spinning-reverse",name:"旋转（逆时针）"},{value:"rotateIn",name:"旋入"},{value:"rotateInDownLeft",name:"左下旋转"},{value:"rotateInDownRight",name:"右下旋转"},{value:"rotateInUpLeft",name:"左上旋转"},{value:"rotateInUpRight",name:"右上旋转"},{value:"slideInDown",name:"上滑入"},{value:"slideInLeft",name:"左滑入"},{value:"slideInRight",name:"右滑入"},{value:"slideInUp",name:"下滑入"},{value:"zoomIn",name:"逐渐放大"},{value:"zoomInDown",name:"从下放大"},{value:"zoomInLeft",name:"从左放大"},{value:"zoomInRight",name:"从右放大"},{value:"zoomInUp",name:"从上放大"},{value:"rollIn",name:"滚入"},{value:"lightSpeedIn",name:"闪入"}]),'\n            </select>\n        </div>\n        <div class="control-inline-group">\n            <label for="">延时</label>\n            <select class="form-control">\n            ').concat(this.selectOption([{value:"",name:"无"},{value:"0.1s",name:"100ms"},{value:"0.2s",name:"200ms"},{value:"0.3s",name:"300ms"},{value:"0.5s",name:"500ms"},{value:"1s",name:"1s"},{value:"2s",name:"2s"},{value:"3s",name:"3s"},{value:"4s",name:"4s"},{value:"5s",name:"5s"},{value:"6s",name:"6s"},{value:"7s",name:"7s"},{value:"8s",name:"8s"},{value:"9s",name:"9s"},{value:"10s",name:"10s"}]),'\n            </select>\n        </div>\n        <div class="control-inline-group">\n            <label for="">时长</label>\n            <select class="form-control">\n            ').concat(this.selectOption([{value:"0.25s",name:"250ms"},{value:"0.5s",name:"500ms"},{value:"0.75s",name:"750ms"},{value:"1s",name:"1s"},{value:"2s",name:"2s"},{value:"3s",name:"3s"},{value:"4s",name:"4s"},{value:"5s",name:"5s"}]),'\n            </select>\n        </div>\n        <div class="control-inline-group">\n            <label for="">重复</label>\n            <select class="form-control">\n            ').concat(this.selectOption([{value:"1",name:"1"},{value:"2",name:"2"},{value:"3",name:"3"},{value:"4",name:"4"},{value:"5",name:"5"},{value:"6",name:"6"},{value:"7",name:"7"},{value:"8",name:"8"},{value:"9",name:"9"},{value:"10",name:"10"},{value:"infinite",name:"无限循环"}]),"\n            </select>\n        </div>\n    </div>")},i.backgroundPopup=function(t,e,i){return'<div class="control-popup-target">\n        <div class="color-icon">\n            <i class="fa fa-edit"></i>\n        </div>\n    </div>\n    <div class="control-popup">\n        <div class="control-inline-group">\n            <label for="">背景色</label>\n            '.concat(this.colorPopup(t,e),'\n        </div>\n        <div class="control-line-group">\n            <label for="">背景图片</label>\n            ').concat(this.imageInput(t,e),"\n        </div>\n    </div>\n    ")},i.imageInput=function(t,e,i){return i?'<div class="image-control-item">\n            <div class="control-body">\n                <img src="'.concat(i,'">\n            </div>\n            <div class="control-action"></div>\n                <i class="fa fa-edit"></i>\n                <i class="fa fa-trash"></i>\n            </div>\n        </div>'):'<label class="drag-control-container" for="'.concat(t,'">\n            拖放文件\n            <p>(或点击)</p>\n            <input type="file" id="').concat(t,'" name="').concat(e,'">\n        </label>')},i.shadowPopup=function(t,e){return'<div class="control-popup-target">\n        <div class="color-icon">\n            <i class="fa fa-edit"></i>\n        </div>\n    </div>\n    <div class="control-popup">\n        <div class="control-row">\n            '.concat(this.sizeInput("X",t,e),"\n            ").concat(this.sizeInput("Y",t,e),"\n            ").concat(this.sizeInput("BLUR",t,e),"\n            ").concat(this.sizeInput("SPREAD",t,e),'\n        </div>\n       \n        <div class="control-inline-group">\n            <label for="">Color</label>\n            ').concat(this.colorPopup(t,e),'\n        </div>\n        <div class="control-inline-group">\n            <label for="">Inset</label>\n            ').concat(this.switch(t,e,""),"\n        </div>\n    </div>")},i.selectOption=function(t,i){return t.map(function(t){var e=i===t.value?" selected":"";return'<option value="'.concat(t.value,'"').concat(e,">").concat(t.name,"</option>")}).join("")},i.borderPopup=function(t,e,i){return'<div class="control-popup-target">\n        <div class="color-icon">\n            <i class="fa fa-edit"></i>\n        </div>\n    </div>\n    <div class="control-popup">\n        <div class="control-line-group">\n            <label for="">Width</label>\n            '.concat(this.boundInput(t,e),'\n        </div>\n        <div class="control-inline-group">\n            <label for="">Style</label>\n            <select>\n                ').concat(this.selectOption([{name:"无",value:""},{name:"横线",value:"solid"},{name:"点线",value:"dotted"},{name:"虚线",value:"double"}]),'\n            </select>\n        </div>\n        <div class="control-inline-group">\n            <label for="">Color</label>\n            ').concat(this.colorPopup(t,e),'\n        </div>\n        <div class="control-line-group">\n            <label for="">Radius</label>\n            ').concat(this.radiusInput(t,e),"\n        </div>\n    </div>")},i.iconPopup=function(t,e,i){var n=[{name:"无",value:""},{name:"横线",value:"solid"},{name:"点线",value:"dotted"},{name:"虚线",value:"double"}].map(function(t){return'<div class="icon-option-item">\n        <i class="fa '.concat(t.value,'"></i>\n        <span>').concat(t.name,"</span>\n        </div>")}).join("");return'<div class="control-popup-target">\n        <div class="color-icon">\n            <i class="fa fa-edit"></i>\n        </div>\n    </div>\n    <div class="control-popup">\n        <div class="search-header-bar">\n            <input>\n            <i class="fa fa-search"></i>\n        </div>\n        <div class="search-body">\n            '.concat(n,"\n        </div>\n    </div>")},i.colorPopup=function(t,e,i){return'<div class="control-popup-target">\n        <div class="color-icon">\n            <i class="fa fa-edit"></i>\n        </div>\n    </div>\n    <div class="control-popup">\n        <div class="popup-action">\n            <div class="btn btn-danger">清除</div>\n        </div>\n        <div class="control-line-group">\n            <label for="">Hue</label>\n            <input type="range" class="hue-bar" min="0" max="360" step="1" value="0">\n        </div>\n        <div class="control-line-group">\n            <label for="">Saturation</label>\n            <input type="range" class="saturation-bar" min="0" max="100" step="1" value="0">\n        </div>\n        <div class="control-line-group">\n            <label for="">Lightness</label>\n            <input type="range" class="lightness-bar" min="0" max="100" step="1" value="0">\n        </div>\n        <div class="control-line-group alpha-ouline-bar">\n            <label for="">Transparency</label>\n            <input type="range" class="alpha-bar" min="0" max="100" step="1" value="1">\n        </div>\n    \n        <div class="control-row tab-bar-target active">\n            <div class="control-half-group">\n                <input type="text">\n                <label for="">HEX</label>\n            </div>\n        </div>\n        <div class="control-row tab-bar-target">\n            <div class="control-half-group">\n                <input type="number">\n                <label for="">R</label>\n            </div>\n            <div class="control-half-group">\n                <input type="number">\n                <label for="">G</label>\n            </div>\n            <div class="control-half-group">\n                <input type="number">\n                <label for="">B</label>\n            </div>\n            <div class="control-half-group">\n                <input type="number">\n                <label for="">A</label>\n            </div>\n        </div>\n        <div class="control-row tab-bar-target">\n            <div class="control-half-group">\n                <input type="number">\n                <label for="">H</label>\n            </div>\n            <div class="control-half-group">\n                <input type="number">\n                <label for="">S</label>\n            </div>\n            <div class="control-half-group">\n                <input type="number">\n                <label for="">L</label>\n            </div>\n            <div class="control-half-group">\n                <input type="number">\n                <label for="">A</label>\n            </div>\n        </div>\n        <div class="tab-bar">\n            <a class="item active">HEX</a>\n            <a class="item">RGB</a>\n            <a class="item">HSL</a>\n        </div>\n    </div>'},i.colorPopupColor=function(t,e){var i=t.find(".hue-bar"),n=t.find(".saturation-bar"),o=t.find(".lightness-bar"),t=t.find(".alpha-bar");if(void 0===e)return{h:toInt(i.val()),s:toInt(n.val()),l:toInt(o.val()),a:toInt(t.val())/100};e=EditorHelper.colorToRgba(e),e=EditorHelper.rgbaToHsl(e);i.val(e.h),n.val(e.s),o.val(e.l),t.val(100*e.a)},i.boundInput=function(i,n,o){var a=this,t=["上","右","下","左"].map(function(t,e){return a.sizeInput(t,"".concat(i,"_").concat(e),"".concat(n,"[]"),o&&o.length>e?o[e]:"")}).join("");return'<div class="control-row">'.concat(t,"</div>")},i.maskInput=function(){return'<div class="mark-container">\n        <div class="clip-path-box">\n            <div class="shape" style="clip-path: inset(10%);"></div>\n            <div class="shape" style="clip-path: circle(45% at 50% 50%);"></div>\n            <div class="shape" style="clip-path: ellipse(30% 45% at 50% 50%);"></div>\n            <div class="shape"\n                style="clip-path: polygon(50% 0%, 0% 100%, 100% 100%);"\n            ></div>\n            <div\n                class="shape"\n                style="clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%);"\n            ></div>\n            <div\n                class="shape"\n                style="clip-path: polygon(25% 0%, 100% 0%, 75% 100%, 0% 100%);"\n            ></div>\n            <div\n                class="shape"\n                style="clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);"\n            ></div>\n            <div\n                class="shape"\n                style="clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);"\n            ></div>\n            <div\n                class="shape"\n                style="clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);"\n            ></div>\n        </div>\n        <button class="btn btn-primary">一键取消</button>\n    </div>\n    '},i.radiusInput=function(i,n,o){var a=this,t=["左上","右上","右下","左下"].map(function(t,e){return a.sizeInput(t,"".concat(i,"_").concat(e),"".concat(n,"[]"),o&&o.length>e?o[e]:"")}).join("");return'<div class="control-row">'.concat(t,"</div>")},i.selectInput=function(t,e,i,n,o,a,r){void 0===a&&(a=!1),void 0===r&&(r="fa-angle-down");o=(o=void 0===o?!1:o)?'<input type="text" class="input-body" id="'.concat(t,'" name="').concat(e,'" value="').concat(i,'">'):'<span class="input-body">'.concat(i,"</span>");return this.join('<div class="select-control-container">','<div class="select-input-container">\n        '.concat(o,'\n        <div class="input-clear">\n            <i class="fa fa-close"></i>\n        </div>\n        <div class="input-arrow">\n            <i class="fa ').concat(r,'"></i>\n        </div>\n    </div>'),this.selectOptionBar(n,i,a),"</div>")},i.sizeInput=function(t,e,i,n,o){void 0===o&&(o="px"),n=toFloat(n);i='<input type="number" id="'.concat(e,'" name="').concat(i,'" value="').concat(n,'">');return'<div class="select-with-control">'+(t?'<div class="control-body">\n        <label for="'.concat(e,'">').concat(t,"</label>\n        ").concat(i,'\n        <span class="extra-control">').concat(o,"</span>\n    </div>"):'<div class="control-body">\n    <span class="extra-control">'.concat(o,"</span>\n    ").concat(i,"\n</div>"))+this.selectOptionBar(["px","em","rem","vh","vw","%","auto","none"])+"</div>"},i.selectOptionBar=function(t,i,e){e=(e=void 0===e?!1:e)?'<div class="search-option-item">\n        <input type="text">\n        <i class="fa fa-search"></i>\n    </div>':"";return e+=t.map(function(t){var e="object"==typeof t?t.name:t,t="object"==typeof t?t.value:t;return'<div class="option-item'.concat(t===i?" selected":"",'" data-value="').concat(t,'">').concat(e,"</div>")}).join(""),'<div class="select-option-bar">'.concat(e,"</div>")},i.nameToId=function(t){return t.replace(/\[/g,"_").replace(/\]/g,"")},i.render=function(t){return t.map(this.renderInput.bind(this)).join("")},i.renderForm=function(t,e){var i=this;return t.map(function(t){return i.renderInput(__assign(__assign({},t),{value:e?e[t.name]:void 0}))}).join("")},i.renderInput=function(t){var e=t.name+"_"+this.guid(),i=this[t.type+"Execute"];return"function"==typeof i?i.call(this,t,e):this.textExecute(t,e)},i.groupExecute=function(t){return t.label?'<div class="expand-box">\n        <div class="expand-header">'.concat(t.label,'<span class="fa fa-chevron-right"></span></div>\n        <div class="expand-body">\n        ').concat(this.render(t.items),"\n        </div>\n    </div>"):'<div class="'.concat(t.class,'">').concat(this.render(t.items),"</div>")},i.alignExecute=function(t,e){return this.horizontalAlign()+this.verticalAlign()},i.borderExecute=function(t,e){return this.input(e,t.label,this.borderPopup(e,t.name,t.value))},i.textAlignExecute=function(t,e){return this.input(e,t.label,this.horizontalAlign(e,t.name,t.value,!0),"control-line-group")},i.colorExecute=function(t,e){return this.input(e,t.label,this.colorPopup(e,t.name,t.value))},i.backgroundExecute=function(t,e){return this.input(e,t.label,this.backgroundPopup(e,t.name,t.value))},i.iconExecute=function(t,e){return this.input(e,t.label,this.iconPopup(e,t.name,t.value))},i.numberExecute=function(t,e){return this.input(e,t.label,'<input type="number" id="'.concat(e,'" name="').concat(t.name,'" value="').concat(t.value,'">'))},i.textareaExecute=function(t,e){return this.input(e,t.label,'<textarea class="form-control" id="'.concat(e,'" name="').concat(t.name,'">').concat(t.value,"</textarea>"),"control-line-group")},i.sizeExecute=function(t,e){return this.input(e,t.label,this.sizeInput(void 0,e,t.name,t.value))},i.rangeExecute=function(t,e){for(var i=[],n=t.min;n<=t.max;n+=t.step)i.push({name:n,value:n});return this.input(e,t.label,this.selectControl(e,t.name,i,t.value))},i.selectExecute=function(t,e){return!t.search&&t.items?this.input(e,t.label,this.selectControl(e,t.name,t.items,t.value)):this.input(e,t.label,this.selectInput(e,t.name,t.items,t.value))},i.positionExecute=function(t,e){var i=t.value,n=[{name:"无",value:"static"},{name:"相对定位",value:"relative"},{name:"绝对定位",value:"absolute"},{name:"固定定位",value:"fixed"}],o=i.type||n[0].value,a="".concat(t.name,"[value]"),a=o!==n[0].value?this.boundInput(this.nameToId(a),a,i.value):"",i=this.input(e,t.label,this.selectControl(e,t.name+"[type]",n,o));return'<div class="position-container">\n        '.concat(i,"\n        <div>").concat(a,"</div>\n    </div>")},i.boundExecute=function(t,e){return this.input(e,t.label,this.boundInput(e,t.name,t.value),"control-line-group")},i.switchExecute=function(t,e){return this.input(e,t.label,this.switch(e,t.name,t.value))},i.textExecute=function(t,e){return this.input(e,t.label,t.items&&0<t.items.length?this.selectInput(e,t.name,t.value,t.items,!0,!1,"fa-bolt"):this.text(e,t.name,t.value),"control-line-group")},i.imageExecute=function(t,e){return this.input(e,t.label,this.imageInput(e,t.name,t.value),"control-line-group")},i.imagesExecute=function(t,e){var i=[],n=t.name+"[]";if(t.items)for(var o=0,a=t.items;o<a.length;o++){var r=a[o];i.push(this.imageInput(e,n,r))}return i.push(this.imageInput(e,n)),this.input(e,t.label,i.join(""),"control-line-group")},i.multipleExecute=function(t,e){var i=[];t.name;if(t.items)for(var n=0,o=t.items;n<o.length;n++){var a=o[n];i.push('<div class="multiple-control-item">\n                <div class="multiple-control-header">\n                    <span>'.concat(a.title,'</span>\n                    <div class="control-action"></div>\n                        <i class="fa fa-edit"></i>\n                        <i class="fa fa-trash"></i>\n                    </div>\n                </div>\n                <div class="multiple-control-body">\n                    ').concat(this.render(a.input),"\n                </div>\n            </div>"))}return i.push('<div class="multiple-add-btn">\n            <i class="fa fa-plus"></i>\n        </div>'),this.input(e,t.label,'<div class="multiple-container">'.concat(i.join(""),"</div>"),"control-line-group")},i.treeExecute=function(t,e){},i.htmlExecute=function(t,e){return this.input(e,t.label,'<textarea class="form-control" id="'.concat(e,'" name="').concat(t.name,'">').concat(t.value,"</textarea>"),"control-line-group")},i.bindInputEvent=function(t){t.on("change",".position-container select",function(){var t=$(this);t.next().html(i.positionSide(t.val()))}).on("click",".switch-input",function(){var t=$(this),e=!t.hasClass("checked");t.toggleClass("checked",e),t.find(".switch-label").text(e?t.data("on"):t.data("off")),t.find("input").val(e?1:0).trigger("change")}).on("click",".control-popup-target",function(){$(this).next(".control-popup").toggleClass("open")}).on("click",".select-with-control .control-body .extra-control",function(){$(this).closest(".select-with-control").find(".select-option-bar").toggleClass("select-focus")}).on("select:change",".select-with-control .select-option-bar",function(t,e){e=$(e);e.closest(".select-with-control").removeClass("select-focus").find(".control-body .extra-control").text(e.text())}).on("click",".select-option-bar .option-item",function(){var t=$(this);t.addClass("selected").siblings().removeClass("selected"),t.closest(".select-option-bar").trigger("select:change",this)}).on("change",".hue-bar,.saturation-bar,.lightness-bar,.alpha-bar",function(){var t=$(this).closest(".control-popup"),n=i.colorPopupColor(t),o=EditorHelper.hslToRgba(n),e="rgba(".concat(o.r,", ").concat(o.g,", ").concat(o.b,", ").concat(o.a,")");t.find(".saturation-bar").css("background-image","linear-gradient(to right, gray, ".concat(e,")")),t.find(".lightness-bar").css("background-image","linear-gradient(to right, black, ".concat(e,")")),t.find(".alpha-bar").css("background-image","linear-gradient(to right, transparent, ".concat(e,")")),t.find(".tab-bar-target").each(function(t){var e,i=$(this);0===t?i.find("input").val(EditorHelper.rgbaToHex(o)):(e=1===t?[o.r,o.g,o.b,o.a]:[n.h,n.s,n.l,n.a],i.find("input").each(function(t){this.value=e[t].toString()}))})}).on("change",".select-control-container .input-body",function(){var t=$(this),e=this instanceof HTMLInputElement?this.value:t.text();t.next(".input-clear").toggle(!!e),t.closest(".select-control-container").find(".select-option-bar .option-item").each(function(){var t=$(this);t.toggleClass("selected",e===t.data("value"))})}).on("click",".select-control-container .input-clear",function(){var t=$(this).prev(".input-body");t[0]instanceof HTMLInputElement?t.val(""):t.text(""),t.trigger("change")}).on("click",".select-control-container .input-arrow",function(){$(this).closest(".select-control-container").toggleClass("select-focus")}).on("select:change",".select-control-container .select-option-bar",function(t,e){var e=$(e),i=e.closest(".select-control-container").removeClass("select-focus").find(".input-body");i[0]instanceof HTMLInputElement?i.val(e.data("value")):i.text(e.data("value")),i.trigger("change")}).on("click",".tab-bar .item",function(){var t=$(this);t.addClass("active").siblings().removeClass("active"),t.closest(".tab-bar").siblings(".tab-bar-target").removeClass("active").eq(t.index()).addClass("active")})},i._guid=0,i}();