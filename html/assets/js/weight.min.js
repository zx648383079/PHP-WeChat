var WeightSearchBar=function(){function t(t,e){this.option=e,this.suggestItems=[],this.dropIndex=-1,this.histories=[],this.openType=0,this.historyKey="",this.target=$(t),this.formTarget=this.target.find("form"),this.inputTarget=this.target.find("input[type=text]"),this.bindEvent(),this.loadHistory()}return t.prototype.bindEvent=function(){var i=this;this.target.on("click",".search-btn",function(){}).on("click",".clear-btn",function(){i.keywords=""}).on("click",".suggest-body li",function(){var t=$(this),e=i.suggestItems[t.index()];i.keywords=this.formatTitle(e),this.dropIndex=this.suggestItems.indexOf(e),t.addClass("active").siblings().removeClass("active"),this.toggleOpenType(0)}).on("click",".history-body li",function(){i.keywords=$(this).find(".item-text").text()}).on("click",".history-body .clear-line",function(t){t.stopPropagation(),this.histories=[],this.saveHistory()}).on("click",".history-body li .fa-times",function(t){t.stopPropagation();t=$(this).closest("li");i.histories.splice(t.index(),1),this.saveHistory(),t.remove()}),this.inputTarget.on("keydown",function(t){"Enter"===t.key?i.tapConfirm():"ArrowDown"!==t.key&&"ArrowUp"!==t.key?(i.dropIndex=-1,i.refreshSuggestion(i.keywords)):1===i.openType?i.moveDrop(i.suggestItems,"ArrowUp"===t.key):2===i.openType&&i.moveDrop(i.histories,"ArrowUp"===t.key)}).on("blur",function(){2===i.openType&&i.toggleOpenType(0)}).on("focus",function(){i.toggleOpenType(i.useHistory&&0<i.histories.length?2:0)}).on("change",function(){i.target.find(".clear-btn").toggle(0<i.keywords.length)})},Object.defineProperty(t.prototype,"keywords",{get:function(){return this.inputTarget.val()},set:function(t){this.inputTarget.val(t).trigger("change")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useHistory",{get:function(){return 0<this.option.open_history},enumerable:!1,configurable:!0}),t.prototype.moveDrop=function(t,e){var i;void 0===e&&(e=!0),t.length<0||(i=this.dropIndex,i=e?(i<1?t.length:i)-1:i<t.length-1?i+1:0,this.toggleDropIndex(i),this.keywords=this.formatTitle(t[i]))},t.prototype.toggleDropIndex=function(e){this.dropIndex=e,this.openType<1||this.target.find(1===this.openType?".suggest-body li":".history-body li").each(function(t){$(this).toggleClass("active",e===t)})},t.prototype.tapConfirm=function(){var t=1===this.openType&&0<=this.dropIndex?this.suggestItems[this.dropIndex]:this.keywords,e=(this.toggleOpenType(0),this.formatTitle(t));this.addHistory(e),"object"==typeof t&&t.url?window.location.href=t.url:0<this.formTarget.length?this.formTarget.trigger("submit"):this.gotoSearch(e)},t.prototype.suggest=function(t){var i=this;this.suggestItems=t,this.dropIndex=-1,this.toggleOpenType(0<t.length?1:0);t.forEach(function(t,e){i.renderSuggestItem(e+1,t)}),this.target.find(".suggest-body ul").html(""),this.toggleOpenType(1)},t.prototype.formatTitle=function(t){return"object"!=typeof t?t:t.title||t.name},t.prototype.toggleOpenType=function(t){this.openType=t,this.target.find(".suggest-body").toggle(1===t),this.target.find(".history-body").toggle(this.useHistory&&2===t)},t.prototype.refreshSuggestion=function(t){var e=this,i=this.target.find(".suggest-body ul");!t||t.length<1?(i.html(""),this.toggleOpenType(0)):this.loadSuggest(t.trim(),function(t){0===t.length?(i.html(""),e.toggleOpenType(0)):e.suggest(t)})},t.prototype.renderSuggestItem=function(t,e){e=this.formatTitle(e);return'<li>\n        <span class="item-no">'.concat(t,'</span>\n        <span class="item-text">').concat(e,"</span>\n    </li>")},t.prototype.renderHistoryItem=function(t,e){return'<li>\n        <i class="fa fa-history"></i>\n        <span class="item-text">'.concat(e,'</span>\n        <i class="fa fa-times"></i>\n    </li>')},t.prototype.addHistory=function(t){!this.useHistory||(t=t.trim()).length<1||0<=this.histories.indexOf(t)||(this.histories.push(t),8<this.histories.length&&this.histories.splice(8),this.saveHistory())},t.prototype.saveHistory=function(){this.useHistory&&this.historyKey&&(0===this.histories.length?window.localStorage.removeItem(this.historyKey):window.localStorage.setItem(this.historyKey,JSON.stringify(this.histories)))},t.prototype.loadHistory=function(){var t,i=this;this.useHistory&&this.historyKey&&(t=window.localStorage.getItem(this.historyKey))&&(this.histories=JSON.parse(t)||[],this.histories.forEach(function(t,e){i.renderHistoryItem(e+1,t)}),this.target.find(".history-body ul").html(""))},t.prototype.gotoSearch=function(i){var o;this.option.search_type<1?window.location.href=this.option.search_url+(0<=this.option.search_url.indexOf("?")?"&":"?")+"keywords="+encodeURIComponent(i):1==this.option.search_type?lazyWeight(this.option.search_weight_id,{keywords:i}):(o=this,$(this.option.search_tag).each(function(){var t=$(this),e=t.find(o.option.search_tag_text).text();t.toggle(o.isMatch(e,i))}))},t.prototype.isMatch=function(t,e){if(!e||0<=t.indexOf(e))return!0;if(!(t.length<=e.length))for(var i=0,o=e.split(" ");i<o.length;i++){var s=o[i];if(s&&0<=t.indexOf(s))return!0}return!1},t.prototype.loadSuggest=function(e,i){var o,s;this.option.search_type<1?(this.option.search_suggest_url&&$.getJSON(this.option.search_suggest_url,{keywords:e},function(t){200!=t.code?i([]):i(t.data)}),i([])):!e||1==this.option.search_type?i([]):(o=this,s=[],$(this.option.search_tag).each(function(){var t=$(this).find(o.option.search_tag_text).text();o.isMatch(t,e)&&s.push(t)}),i(s))},t}();function lazyWeight(t,e){var i=$(this.option.search_weight_id);i.length<1||(i.hasClass("template-lazy")?lazyHtml(i,void 0,e):i.trigger("weight_query",e))}function lazyHtml(e,t,i){var o;e.length<1||(e.addClass("lazy-loading"),o=e.attr("id"),(t=t||e.attr("data-url"))&&$.get(t,i,function(t){o&&0<t.indexOf('id="'.concat(o,'"'))?e.replaceAll(t):(e.removeClass("lazy-loading").removeClass("template-lazy"),e.html(t),e.trigger("lazyLoaded"))}))}$(function(){var e=$(window);e.on("scroll",function(){var i,o,t=$(".template-lazy");t.length<=0||(i=e.scrollTop(),o=e.height()+i,t.each(function(){var t,e=$(this);e.hasClass("lazy-loading")||(t=e.offset().top,i<=t+0&&t<o&&lazyHtml(e))}))})});